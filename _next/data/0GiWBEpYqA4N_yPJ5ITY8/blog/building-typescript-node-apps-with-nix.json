{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var d=Object.create;var c=Object.defineProperty;var t=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,y=Object.prototype.hasOwnProperty;var i=n=>c(n,\"__esModule\",{value:!0});var m=(n,s)=>()=>(s||n((s={exports:{}}).exports,s),s.exports),u=(n,s)=>{i(n);for(var r in s)c(n,r,{get:s[r],enumerable:!0})},v=(n,s,r)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let e of h(s))!y.call(n,e)&&e!==\"default\"&&c(n,e,{get:()=>s[e],enumerable:!(r=t(s,e))||r.enumerable});return n},C=n=>v(i(c(n!=null?d(p(n)):{},\"default\",n&&n.__esModule&&\"default\"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var a=m((b,F)=>{F.exports=_jsx_runtime});var k={};u(k,{default:()=>N,frontmatter:()=>g});var l=C(a()),g={title:\"Building Typescript Node Apps With Nix\",date:new Date(1662508675477),tags:[\"nix\",\"typescript\",\"node\"],draft:!1,summary:\"Trying some different nix builders for typescript node apps\",images:[],layout:\"PostLayout\"};function x(n={}){let{wrapper:s}=n.components||{};return s?(0,l.jsx)(s,Object.assign({},n,{children:(0,l.jsx)(r,{})})):r();function r(){let e=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",code:\"code\",pre:\"pre\",div:\"div\",h3:\"h3\",strong:\"strong\",ul:\"ul\",li:\"li\"},n.components),{TOCInline:o}=e;return o||B(\"TOCInline\",!0),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o,{toc:n.toc,asDisclosure:!0}),`\n`,(0,l.jsxs)(e.h2,{id:\"being-a-nix-stan\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#being-a-nix-stan\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Being a Nix Stan\"]}),`\n`,(0,l.jsx)(e.p,{children:`I recently accepted that I am obsessed with nix. Ask anyone with a remotely technical person with a pulse, and they can probably mention at least 10 times I've told them \"but with nix X is way easier/a non issue\" (same with rust, but that's for another day...).`}),`\n`,(0,l.jsxs)(e.p,{children:[`The issue is, I'm a bit of a poser. I've been using Nix on/off for about 2.5 years but only seriously for the last 10ish months.\nI've mostly just consumed existing NixOS modules, nix packages, setup basic nix-shells/flakes, and relatively simple nix builders (`,(0,l.jsx)(e.a,{href:\"/blog/rust-enviorment-and-docker-build-with-nix-flakes\",children:\"like for rust/docker images\"}),\"). All of these uses of nix where pretty great, and it definitely made my life easier, but it only went so far to solve some of the challenges I come across in my personal projects/work.\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"During my initial nix learning phase I came across \",(0,l.jsx)(e.code,{children:\"node2nix\"}),` but the codegen step made me think that node and nix just don't get along well, and I never looked further.\nMy job primarily involves node web servers written in typescript. All I've done with nix so far at work is set up basic dev environments with node. While it did make our README(s) a little nicer, it does not really solve our issues in actually deploying our apps.\nNow that I got over the initial hump of adding nix to some of our processes, it's time to make it even better!`]}),`\n`,(0,l.jsxs)(e.h2,{id:\"the-app\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#the-app\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"The APP\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"The source code for the app is \",(0,l.jsx)(e.a,{href:\"https://github.com/JRMurr/example-ts-node-nix\",children:\"here\"})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"First I need a basic app to build. I have been using \",(0,l.jsx)(e.a,{href:\"https://www.fastify.io/\",children:\"Fastify\"}),\" recently, so I will attempt to build this basic web server.\"]}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"index.ts\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"ts\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"#!/usr/bin/env node\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"import\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" fastify \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"from\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"fastify\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"const\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" server \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"fastify\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"();\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"server.\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"get\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"/ping\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"async\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" (\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"_request\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"_reply\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=>\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"return\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"pong\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\\\\n\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"});\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"server.\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"listen\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"({ host\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"0.0.0.0\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", port\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"8080\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" }, (\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"err\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"address\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=>\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"if\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" (err) {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    console.\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"error\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(err);\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    process.\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"exit\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"1\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\");\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  }\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  console.\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"log\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"`Server listening at \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"${\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"address\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"`\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\");\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"});\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"One important note about the \",(0,l.jsx)(e.code,{children:\"index.ts\"}),\" file is the node shebang at the top. This will allow this file to act as a binary/entry point for the server.\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"I also added a strict tsconfig that outputs to \",(0,l.jsx)(e.code,{children:\"./dist\"}),\" and a package.json that looks like\"]}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"package.json\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"json\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"{\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"name\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"example-node-nix\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"version\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"1.0.0\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"main\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"dist/index.js\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"bin\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"example-node-nix\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"dist/index.js\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  },\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"scripts\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"build\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"tsc -p tsconfig.json\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"start\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"node dist/index.js\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  },\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"license\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"MIT\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"dependencies\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"fastify\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"^4.5.3\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  },\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"devDependencies\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"@tsconfig/node16\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"^1.0.1\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"@tsconfig/node16-strictest\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"^1.0.0\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"@types/node\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"^18.7.14\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"typescript\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FE\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"^4.8.2\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"I made a simple \",(0,l.jsx)(e.code,{children:\"flake.nix\"}),\" to set up node then ran\"]}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"sh\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"$ npm run build\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"$ npm run start\"})})]})})]}),`\n`,(0,l.jsx)(e.p,{children:\"The sever is up and is responding.\"}),`\n`,(0,l.jsxs)(e.h2,{id:\"nix-builds\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#nix-builds\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Nix Builds\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Like usual with nix I first try to see if other people have figured this out already, looking at the \",(0,l.jsx)(e.a,{href:\"https://nixos.org/manual/nixpkgs/stable/#language-javascript\",children:\"nixpkgs JS docs\"}),\", it mentions a few builders like \",(0,l.jsx)(e.code,{children:\"mkYarnPackage\"}),\", \",(0,l.jsx)(e.a,{href:\"https://github.com/svanderburg/node2nix\",children:\"node2nix\"}),\", \",(0,l.jsx)(e.a,{href:\"https://github.com/nix-community/npmlock2nix\",children:\"npmlock2nix\"}),\", and \",(0,l.jsx)(e.a,{href:\"https://github.com/serokell/nix-npm-buildpackage\",children:\"nix-npm-buildpackage\"}),\". These all seemed fine but I couldnt find any good typescript example, or the docs were a little lacking to get started. So I figured why not just do it the dumb way to start and do it manually, what's the worst that can happen?\"]}),`\n`,(0,l.jsxs)(e.h3,{id:\"the-standard-environment\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#the-standard-environment\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"The Standard Environment\"]}),`\n`,(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.a,{href:\"https://nixos.org/manual/nixpkgs/stable/#sec-using-stdenv\",children:\"stdenv.mkDerivation\"}),' is what most \"high level\" builders wrap. It provides you a sandbox environment with some common programs like ',(0,l.jsx)(e.code,{children:\"coreutils\"}),\", \",(0,l.jsx)(e.code,{children:\"grep\"}),\", \",(0,l.jsx)(e.code,{children:\"awk\"}),\", \",(0,l.jsx)(e.code,{children:\"make\"}),\", etc., to build a program. It is very versatile and surprisingly easy to use once you get comfortable with its ideas. I was hopeful I could throw something together, so to start I just focused on the \",(0,l.jsx)(e.code,{children:\"buildPhase\"}),\" and a very basic \",(0,l.jsx)(e.code,{children:\"installPhase\"}),\" to verify everything was built, I would deal with running it later.\"]}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"flake.nix\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"nix\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"{\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"description\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"Sample Nix ts-node build\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"inputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"nixpkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"url\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"github:nixos/nixpkgs/nixos-unstable\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"flake-utils\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"url\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"github:numtide/flake-utils\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"gitignore\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"url\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"github:hercules-ci/gitignore.nix\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"inputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"nixpkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"follows\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"nixpkgs\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    };\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  };\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"outputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nixpkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"flake-utils\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"gitignore\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"... \"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}:\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"flake-utils\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"lib\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"eachDefaultSystem\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" (\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"system\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\":\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"pkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"import\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nixpkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"inherit\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"system\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"; };\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"nodejs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"pkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nodejs-16_x\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# NOTE: this does not work\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"appBuild\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"pkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"stdenv\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"mkDerivation\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"name\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"example-ts-node\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"version\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"0.1.0\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"src\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"gitignore\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"lib\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"gitignoreSource\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"./.\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"; \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# uses the gitignore in the repo to only copy files git would see\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"buildInputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" [ \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nodejs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" ];\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# https://nixos.org/manual/nixpkgs/stable/#sec-stdenv-phases\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"buildPhase\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"''\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            # each phase has pre/postHooks. When you make your own phase be sure to still call the hooks\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            runHook preBuild\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            npm ci\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            npm run build\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            runHook postBuild\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"          ''\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"installPhase\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"''\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            runHook preInstall\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            cp -r node_modules $out/node_modules\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            cp package.json $out/package.json\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            cp -r dist $out/dist\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            runHook postInstall\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"          ''\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        };\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"in\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"with\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"pkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"; {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"defaultPackage\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"appBuild\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"devShell\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"mkShell\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"buildInputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" [ \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nodejs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" ]; };\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      });\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"I tried \",(0,l.jsx)(e.code,{children:\"nix build\"}),\" but I got this error\"]}),`\n`,(0,l.jsx)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsx)(e.code,{children:(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"undefined\"},children:`error: builder for '/nix/store/7lis43p7zj10y2cf6inzicjdgzc3b5qs-example-ts-node.drv' failed with exit code 1;\n       last 10 log lines:\n       > no configure script, doing nothing\n       > building\n       > npm ERR! code EAI_AGAINler: sill audit bulk request {[0m\n       > npm ERR! syscall getaddrinfo\n       > npm ERR! errno EAI_AGAIN\n       > npm ERR! request to https://registry.npmjs.org/yallist/-/yallist-4.0.0.tgz failed, reason: getaddrinfo EAI_AGAIN registry.npmjs.org\n       >\n       > npm ERR! Log files were not written due to an error writing to the directory: /homeless-shelter/.npm/_logs\n       > npm ERR! You can rerun the command with \\`--loglevel=verbose\\` to see the logs in your terminal\n       >\n       For full logs, run 'nix log /nix/store/7lis43p7zj10y2cf6inzicjdgzc3b5qs-example-ts-node.drv'.`})})})})}),`\n`,(0,l.jsxs)(e.p,{children:[\"The error \",(0,l.jsx)(e.code,{children:\"getaddrinfo EAI_AGAIN registry.npmjs.org\"}),\" is a failure to connect to the NPM registry to install the dependencies. What I failed to realize is that the nix sandbox would block outside requests in the builder since they are not fully reproducible. You can disable the nix sandbox, but that would be gross. So time to try one of these builders.\"]}),`\n`,(0,l.jsxs)(e.h3,{id:\"node2nix\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#node2nix\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"node2nix\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Of all the builders I've seen so far \",(0,l.jsx)(e.a,{href:\"https://github.com/svanderburg/node2nix\",children:\"node2nix\"}),\" seemed like the most mature. It's actually used in the \",(0,l.jsx)(e.a,{href:\"https://github.com/NixOS/nixpkgs/tree/master/pkgs/development/node-packages\",children:\"official nixpkgs repo\"}),\". At a high level \",(0,l.jsx)(e.code,{children:\"node2nix\"}),\" will parse your \",(0,l.jsx)(e.code,{children:\"package.json\"}),\" or \",(0,l.jsx)(e.code,{children:\"package-lock.json\"}),\" and do code-gen to give you nix files that use \",(0,l.jsx)(e.a,{href:\"https://ryantm.github.io/nixpkgs/builders/fetchers/\",children:\"fetchers\"}),\" to download all \",(0,l.jsx)(e.code,{children:\"node_modules\"}),\" and build your node app.\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"You can install \",(0,l.jsx)(e.code,{children:\"node2nix\"}),\" from \",(0,l.jsx)(e.code,{children:\"nixpkgs\"}),\" as \",(0,l.jsx)(e.code,{children:\"pkgs.node2nix\"}),\". To run it I have this script\"]}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"runNode2Nix.sh\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"sh\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"#!/usr/bin/env bash\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# You need to re-run this file anytime your package/package-lock.json changes\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"node2nix -16 --development \\\\\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    --input package.json \\\\\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    --lock package-lock.json \\\\\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# Put all generated code in the `./nix` directory\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    --node-env ./nix/node-env.nix \\\\\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    --composition ./nix/default.nix \\\\\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    --output ./nix/node-package.nix\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"While node2nix does have helpers in \",(0,l.jsx)(e.code,{children:\"node-env.nix\"}),\" to build a node package, those only really run \",(0,l.jsx)(e.code,{children:\"npm install\"}),\", to call our \",(0,l.jsx)(e.code,{children:\"npm run build\"}),\" step. Thankfully as described \",(0,l.jsx)(e.a,{href:\"https://github.com/svanderburg/node2nix#using-the-nodejs-environment-in-other-nix-derivations\",children:\"here\"}),\" \",(0,l.jsx)(e.code,{children:\"node2nix\"}),\" exposes an output of just the \",(0,l.jsx)(e.code,{children:\"node_modules\"}),\" of the dependencies, allowing us to make our own derivation.\"]}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"flake.nix\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"nix\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"{\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"description\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"Sample Nix ts-node build\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"inputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"nixpkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"url\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"github:nixos/nixpkgs/nixos-unstable\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"flake-utils\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"url\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"github:numtide/flake-utils\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"gitignore\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"url\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"github:hercules-ci/gitignore.nix\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"inputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"nixpkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"follows\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"nixpkgs\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    };\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  };\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"outputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nixpkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"flake-utils\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"gitignore\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"... \"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}:\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"flake-utils\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"lib\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"eachDefaultSystem\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" (\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"system\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\":\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"pkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"import\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nixpkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"inherit\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"system\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"; };\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"nodejs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"pkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nodejs-16_x\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"node2nixOutput\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"import\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"./nix\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"inherit\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"pkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"nodejs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"system\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"; };\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# NOTE: may want to try https://github.com/svanderburg/node2nix/issues/301 to limit rebuilds\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"nodeDeps\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"node2nixOutput\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nodeDependencies\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"app\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"pkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"stdenv\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"mkDerivation\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"name\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"example-ts-node\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"version\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"0.1.0\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"src\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"gitignore\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"lib\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"gitignoreSource\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"./.\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"buildInputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" [ \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nodejs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" ];\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"buildPhase\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"''\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            runHook preBuild\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            # symlink the generated node deps to the current directory for building\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            ln -sf \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"${\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nodeDeps\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"/lib/node_modules ./node_modules\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'            export PATH=\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"${\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nodeDeps\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'/bin:$PATH\"'})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            npm run build\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            runHook postBuild\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"          ''\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"installPhase\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"''\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            runHook preInstall\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            # Note: you need some sort of `mkdir` on $out for any of the following commands to work\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            mkdir -p $out/bin\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            # copy only whats needed for running the built app\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            cp package.json $out/package.json\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            cp -r dist $out/dist\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            ln -sf \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"${\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nodeDeps\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"/lib/node_modules $out/node_modules\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            # copy entry point, in this case our index.ts has the node shebang\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            # nix will patch the shebang to be the node version specified in buildInputs\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            # you could also copy in a script that is basically `npm run start`\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            cp dist/index.js $out/bin/example-ts-nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            chmod a+x $out/bin/example-ts-nix\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            runHook postInstall\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"          ''\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        };\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"in\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"with\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"pkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"; {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"defaultPackage\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"app\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"devShell\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"mkShell\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"buildInputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" [ \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nodejs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"node2nix\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" ]; };\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      });\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})}),(0,l.jsx)(e.div,{className:\"line\"})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"After running \",(0,l.jsx)(e.code,{children:\"nix build\"}),\", the output will be symlinked to \",(0,l.jsx)(e.code,{children:\"./result\"}),\" in my case it looks like\"]}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"sh\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"$ exa --tree --level 3 ./result/\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"./result\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u251C\\u2500\\u2500 bin\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u2514\\u2500\\u2500 example-ts-nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u251C\\u2500\\u2500 dist\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u2514\\u2500\\u2500 index.js\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u251C\\u2500\\u2500 node_modules -\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\">\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" /nix/store/fdzk00z6bmw50mfqv124lgn9fzjhd7yw-node-dependencies-example-node-nix-1.0.0/lib/node_modules\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2514\\u2500\\u2500 package.json\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"To verify the app worked you can run \",(0,l.jsx)(e.code,{children:\"./result/bin/example-ts-nix\"}),\".\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"While at first this looks like a lot It's pretty straightforward. \",(0,l.jsx)(e.code,{children:\"node2nixOutput = import ./nix { inherit pkgs nodejs system; };\"}),\" calls the generated \",(0,l.jsx)(e.code,{children:\"default.nix\"}),\" which exposes many outputs for building. In our case we only use \",(0,l.jsx)(e.code,{children:\"nodeDeps = node2nixOutput.nodeDependencies;\"}),\".\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"The \",(0,l.jsx)(e.code,{children:\"buildPhase\"}),\" just symlinks the generated \",(0,l.jsx)(e.code,{children:\"nodeDependencies\"}),\" and builds the app. The \",(0,l.jsx)(e.code,{children:\"installPhase\"}),` copies the built output into the final derivation. If your familiar with docker files this is sorta like having a build layer than a final layer to copy the outputs to.\nOne thing nix does for you is patch shebangs to reference the `,(0,l.jsx)(e.code,{children:\"buildInputs\"}),\" of the derivation, in this case if you run\"]}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"sh\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"$ cat ./result/bin/example-ts-nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"#!/nix/store/6cdccplrjwga5rd3b2s7xb8zd25hnsix-nodejs-16.17.0/bin/node\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"use strict\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"...\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"It changed \",(0,l.jsx)(e.code,{children:\"#!/usr/bin/env node\"}),\" to \",(0,l.jsx)(e.code,{children:\"#!/nix/store/6cdccplrjwga5rd3b2s7xb8zd25hnsix-nodejs-16.17.0/bin/node\"}),\" for us automatically.\"]}),`\n`,(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:\"node2nix Pros\"})}),`\n`,(0,l.jsxs)(e.ul,{children:[`\n`,(0,l.jsx)(e.li,{children:\"Simple to follow build process\"}),`\n`,(0,l.jsx)(e.li,{children:\"Somewhat easy to customize\"}),`\n`,(0,l.jsx)(e.li,{children:\"Has support for custom registries/private git repos\"}),`\n`]}),`\n`,(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:\"node2nix Cons\"})}),`\n`,(0,l.jsxs)(e.ul,{children:[`\n`,(0,l.jsxs)(e.li,{children:[\"Having to re-run \",(0,l.jsx)(e.code,{children:\"node2nix\"}),\" on package.json changes is annoying\"]}),`\n`,(0,l.jsxs)(e.li,{children:[\"The generated outputs seem to re-build too often, see \",(0,l.jsx)(e.a,{href:\"https://github.com/svanderburg/node2nix/issues/301\",children:\"here\"})]}),`\n`,(0,l.jsxs)(e.li,{children:[\"With the current setup the final build is still using the development \",(0,l.jsx)(e.code,{children:\"node_modules\"}),\" which is wasteful\"]}),`\n`]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Overall I think \",(0,l.jsx)(e.code,{children:\"node2nix\"}),\" is a good start for most node apps. Since its all mostly code-gen It's easy to follow what's going on. I've come across \",(0,l.jsx)(e.a,{href:\"https://github.com/MatrixAI/TypeScript-Demo-Lib-Native\",children:\"this template\"}),\" which seems to have figured out to work around some cons listed, but I have not tried it yet so your mileage may vary.\"]}),`\n`,(0,l.jsxs)(e.h3,{id:\"dream2nix\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#dream2nix\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"dream2nix\"]}),`\n`,(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.a,{href:\"https://github.com/nix-community/dream2nix\",children:\"dream2nix\"}),' says its \"A framework for automated nix packaging\" by mostly standardizing the many \"2nix\" tools. The ',(0,l.jsx)(e.a,{href:\"https://nix-community.github.io/dream2nix/\",children:\"docs\"}),` list Rust, Haskell, Python, and Node builders.\nFor whatever reason I have been skeptical of dream2nix. It looked \"too good to be true\" so I never really gave it a fair shake. Better late than never, let's try it`]}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"flake.nix\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"nix\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"{\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"description\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"Sample Nix ts-node build\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"inputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"nixpkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"url\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"github:nixos/nixpkgs/nixos-unstable\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"flake-utils\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"url\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"github:numtide/flake-utils\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"gitignore\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"url\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"github:hercules-ci/gitignore.nix\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"inputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"nixpkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"follows\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"nixpkgs\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    };\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"dream2nix\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"url\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"github:nix-community/dream2nix\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  };\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"outputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nixpkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"flake-utils\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"gitignore\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"dream2nix\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"... \"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}:\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# Note: no need for flake-utils.lib.eachDefaultSystem, dream2nix does it for us\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"dream2nix\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"lib\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"makeFlakeOutputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"systems\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"flake-utils\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"lib\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"defaultSystems\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"config\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"projectRoot\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"./.\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"source\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"gitignore\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"lib\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"gitignoreSource\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"./.\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    };\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"The core idea of dream2nix is that it will find you package.json/package-lock.json to figure out what node deps you need and how to build \",(0,l.jsx)(e.code,{children:\"npm run build\"}),' or w/e else. You can customize it but for most apps this should \"just work\".']}),`\n`,(0,l.jsxs)(e.p,{children:[\"Running \",(0,l.jsx)(e.code,{children:\"nix flake show\"}),\" returns\"]}),`\n`,(0,l.jsx)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsx)(e.code,{children:(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"undefined\"},children:`git+file:///home/jr/code/node/example-node-nix\n\\u251C\\u2500\\u2500\\u2500devShell\n\\u2502   \\u251C\\u2500\\u2500\\u2500aarch64-darwin: development environment 'nix-shell'\n\\u2502   \\u251C\\u2500\\u2500\\u2500aarch64-linux: development environment 'nix-shell'\n\\u2502   \\u251C\\u2500\\u2500\\u2500i686-linux: development environment 'nix-shell'\n\\u2502   \\u251C\\u2500\\u2500\\u2500x86_64-darwin: development environment 'nix-shell'\n\\u2502   \\u2514\\u2500\\u2500\\u2500x86_64-linux: development environment 'nix-shell'\n\\u251C\\u2500\\u2500\\u2500devShells\n\\u2502   \\u251C\\u2500\\u2500\\u2500aarch64-darwin\n\\u2502   \\u2502   \\u251C\\u2500\\u2500\\u2500default: development environment 'nix-shell'\n\\u2502   \\u2502   \\u2514\\u2500\\u2500\\u2500example-node-nix: development environment 'nix-shell'\n\\u2502   \\u251C\\u2500\\u2500\\u2500aarch64-linux\n\\u2502   \\u2502   \\u251C\\u2500\\u2500\\u2500default: development environment 'nix-shell'\n\\u2502   \\u2502   \\u2514\\u2500\\u2500\\u2500example-node-nix: development environment 'nix-shell'\n\\u2502   \\u251C\\u2500\\u2500\\u2500i686-linux\n\\u2502   \\u2502   \\u251C\\u2500\\u2500\\u2500default: development environment 'nix-shell'\n\\u2502   \\u2502   \\u2514\\u2500\\u2500\\u2500example-node-nix: development environment 'nix-shell'\n\\u2502   \\u251C\\u2500\\u2500\\u2500x86_64-darwin\n\\u2502   \\u2502   \\u251C\\u2500\\u2500\\u2500default: development environment 'nix-shell'\n\\u2502   \\u2502   \\u2514\\u2500\\u2500\\u2500example-node-nix: development environment 'nix-shell'\n\\u2502   \\u2514\\u2500\\u2500\\u2500x86_64-linux\n\\u2502       \\u251C\\u2500\\u2500\\u2500default: development environment 'nix-shell'\n\\u2502       \\u2514\\u2500\\u2500\\u2500example-node-nix: development environment 'nix-shell'\n\\u251C\\u2500\\u2500\\u2500packages\n\\u2502   \\u251C\\u2500\\u2500\\u2500aarch64-darwin\n\\u2502   \\u2502   \\u251C\\u2500\\u2500\\u2500default: package 'example-node-nix-1.0.0'\n\\u2502   \\u2502   \\u251C\\u2500\\u2500\\u2500example-node-nix: package 'example-node-nix-1.0.0'\n\\u2502   \\u2502   \\u2514\\u2500\\u2500\\u2500resolveImpure: package 'resolve'\n\\u2502   \\u251C\\u2500\\u2500\\u2500aarch64-linux\n\\u2502   \\u2502   \\u251C\\u2500\\u2500\\u2500default: package 'example-node-nix-1.0.0'\n\\u2502   \\u2502   \\u251C\\u2500\\u2500\\u2500example-node-nix: package 'example-node-nix-1.0.0'\n\\u2502   \\u2502   \\u2514\\u2500\\u2500\\u2500resolveImpure: package 'resolve'\n\\u2502   \\u251C\\u2500\\u2500\\u2500i686-linux\n\\u2502   \\u2502   \\u251C\\u2500\\u2500\\u2500default: package 'example-node-nix-1.0.0'\n\\u2502   \\u2502   \\u251C\\u2500\\u2500\\u2500example-node-nix: package 'example-node-nix-1.0.0'\n\\u2502   \\u2502   \\u2514\\u2500\\u2500\\u2500resolveImpure: package 'resolve'\n\\u2502   \\u251C\\u2500\\u2500\\u2500x86_64-darwin\n\\u2502   \\u2502   \\u251C\\u2500\\u2500\\u2500default: package 'example-node-nix-1.0.0'\n\\u2502   \\u2502   \\u251C\\u2500\\u2500\\u2500example-node-nix: package 'example-node-nix-1.0.0'\n\\u2502   \\u2502   \\u2514\\u2500\\u2500\\u2500resolveImpure: package 'resolve'\n\\u2502   \\u2514\\u2500\\u2500\\u2500x86_64-linux\n\\u2502       \\u251C\\u2500\\u2500\\u2500default: package 'example-node-nix-1.0.0'\n\\u2502       \\u251C\\u2500\\u2500\\u2500example-node-nix: package 'example-node-nix-1.0.0'\n\\u2502       \\u2514\\u2500\\u2500\\u2500resolveImpure: package 'resolve'\n\\u2514\\u2500\\u2500\\u2500projectsJson: unknown`})})})})}),`\n`,(0,l.jsxs)(e.p,{children:[\"dream2nix gave us a dev shell and package build for us, neat. Expecting something to break I ran \",(0,l.jsx)(e.code,{children:\"nix build\"}),\" to build the app and got no errors. Looking at \",(0,l.jsx)(e.code,{children:\"./result\"}),\" gives\"]}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"sh\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"$ exa --tree --level 3 ./result/\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"./result\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u251C\\u2500\\u2500 bin\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u2514\\u2500\\u2500 ts-node-nix -\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\">\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" ../lib/node_modules/example-node-nix/dist/index.js\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2514\\u2500\\u2500 lib\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"   \\u2514\\u2500\\u2500 node_modules\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \\u2514\\u2500\\u2500 example-node-nix\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:\"ts-node-nix\"}),\" is a compiled javascript file with the right shebang. Still somewhat shocked running \",(0,l.jsx)(e.code,{children:\"./result/bin/ts-node-nix\"}),\" ran the server, and it worked!\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"This is simply wild, I really expected something to break here and require a manual build step of some kind. One nice thing to note is the \",(0,l.jsx)(e.a,{href:\"https://nix-community.github.io/dream2nix/guides/getting-started-nodejs.html#development-shell\",children:\"node dev shell\"}),\" it gives will copy over the \",(0,l.jsx)(e.code,{children:\"node_modules\"}),\" folder for you so you don't need to manually run \",(0,l.jsx)(e.code,{children:\"npm install\"}),\".\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"To limit my excitement a bit this is a simple build. I need to investigate how well it works with more complicated builds with native node add-ons, mono repo tools like NX, etc. Though the examples in the \",(0,l.jsx)(e.a,{href:\"https://github.com/nix-community/dream2nix#test-the-experimental-version-of-dream2nix\",children:\"README\"}),\" seem promising to allow for easily overriding the builds.\"]}),`\n`,(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:\"dream2nix Pros\"})}),`\n`,(0,l.jsxs)(e.ul,{children:[`\n`,(0,l.jsx)(e.li,{children:\"very little code to set up\"}),`\n`,(0,l.jsx)(e.li,{children:\"generated dev shell is really nice\"}),`\n`]}),`\n`,(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:\"dream2nix Cons\"})}),`\n`,(0,l.jsxs)(e.ul,{children:[`\n`,(0,l.jsx)(e.li,{children:'A bit of a \"black box\" which could make debugging harder'}),`\n`,(0,l.jsx)(e.li,{children:\"It seems to include the full development dependencies in the output\"}),`\n`]}),`\n`,(0,l.jsxs)(e.h2,{id:\"conclusion\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#conclusion\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Conclusion\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"I came into this thinking building ts node apps with nix would be a pain, and I'm happily surprised it is not. While \",(0,l.jsx)(e.code,{children:\"node2nix\"}),\" may be good for highly customizable builds, \",(0,l.jsx)(e.code,{children:\"dream2nix\"}),\" is just a delight. I haven't come across a nix utility that just worked like that with minimal messing around.\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"I've been meaning to give \",(0,l.jsx)(e.a,{href:\"https://napi.rs/\",children:\"napi-rs\"}),\" a shot, so maybe that will be a good test case to see how well \",(0,l.jsx)(e.code,{children:\"dream2nix\"}),\" builds rust projects and native node add-ons all in one.\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Since you made it to the end here's a \",(0,l.jsx)(e.code,{children:\"dream2nix\"}),\" example with a docker build\"]}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"flake.nix\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"nix\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"{\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"description\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"Sample Nix ts-node build\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"inputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"nixpkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"url\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"github:nixos/nixpkgs/nixos-unstable\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"flake-utils\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"url\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"github:numtide/flake-utils\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"gitignore\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"url\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"github:hercules-ci/gitignore.nix\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"inputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"nixpkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"follows\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"nixpkgs\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    };\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"dream2nix\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"url\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"github:nix-community/dream2nix\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  };\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"outputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nixpkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"flake-utils\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"gitignore\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"dream2nix\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"... \"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}:\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"dream2nixOutputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"dream2nix\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"lib\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"makeFlakeOutputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"systems\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"flake-utils\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"lib\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"defaultSystems\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"config\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"projectRoot\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"./.\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"source\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"gitignore\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"lib\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"gitignoreSource\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"./.\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      };\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"customOutput\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"flake-utils\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"lib\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"eachDefaultSystem\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" (\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"system\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\":\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"pkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"import\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nixpkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"inherit\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"system\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"; };\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# the dream2nix output for this system\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"app\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"dream2nixOutputs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"packages\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"${\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"system\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"example-node-nix\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"in\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"with\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"pkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"; {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"packages\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"docker\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"dockerTools\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"buildImage\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"name\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"app\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"packageName\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"copyToRoot\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"pkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"buildEnv\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"              \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"name\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"app\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"packageName\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"              \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"paths\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" [ \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"app\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" ];\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"              \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"pathsToLink\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" [ \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"/bin\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"/lib\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" ];\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            };\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# This ensures symlinks to directories are preserved in the image\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"keepContentsDirlinks\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"true\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"config\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"Cmd\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" [ \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"/bin/ts-node-nix\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" ]; };\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          };\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        });\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# deep merge outputs together\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"in\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nixpkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"lib\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"recursiveUpdate\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"dream2nixOutputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"customOutput\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"You can then run \",(0,l.jsx)(e.code,{children:\"nix build .#docker\"}),\" and then run \",(0,l.jsx)(e.code,{children:\"docker load < result\"}),\" to load the image into docker. See \",(0,l.jsx)(e.a,{href:\"/blog/rust-enviorment-and-docker-build-with-nix-flakes\",children:\"here\"}),\" for some more info on nix docker builds.\"]})]})}}var N=x;function B(n,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+n+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return k;})();\n;return Component;","toc":[{"value":"Being a Nix Stan","url":"#being-a-nix-stan","depth":2},{"value":"The APP","url":"#the-app","depth":2},{"value":"Nix Builds","url":"#nix-builds","depth":2},{"value":"The Standard Environment","url":"#the-standard-environment","depth":3},{"value":"node2nix","url":"#node2nix","depth":3},{"value":"dream2nix","url":"#dream2nix","depth":3},{"value":"Conclusion","url":"#conclusion","depth":2}],"frontMatter":{"readingTime":{"text":"13 min read","minutes":12.42,"time":745200,"words":2484},"slug":"building-typescript-node-apps-with-nix","fileName":"building-typescript-node-apps-with-nix.md","title":"Building Typescript Node Apps With Nix","date":"2022-09-06T23:57:55.477Z","tags":["nix","typescript","node"],"draft":false,"summary":"Trying some different nix builders for typescript node apps","images":[],"layout":"PostLayout"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.215,"time":12900,"words":43},"slug":["default"],"fileName":"default.md","name":"John Murray","avatar":"/static/images/me.jpg","occupation":"Software Engineer","github":"https://github.com/JRMurr","twitter":"https://twitter.com/JRMurrCodes","date":null}],"prev":{"title":"Making a PR to Nixpkgs","date":"2022-08-02T03:43:05.229Z","tags":["nix","rust"],"draft":false,"summary":"My rough ramblings on how to contribute a small pr to Nixpkgs","images":[],"layout":"PostLayout","slug":"updating-a-package-in-nixpkgs"},"next":null},"__N_SSG":true}