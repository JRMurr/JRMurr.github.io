<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" content="#000000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>Type Safe GroupBy In TypeScript</title><meta name="robots" content="follow, index"/><meta name="description" content="Create a better groupBy function that only allows valid keys to be grouped on"/><meta property="og:url" content="https://johns.codes/blog/type-safe-groupby-in-typescript"/><meta property="og:type" content="article"/><meta property="og:site_name" content="John&#x27;s Codes"/><meta property="og:description" content="Create a better groupBy function that only allows valid keys to be grouped on"/><meta property="og:title" content="Type Safe GroupBy In TypeScript"/><meta property="og:image" content="https://johns.codes/static/images/twitter-card.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="Type Safe GroupBy In TypeScript"/><meta name="twitter:description" content="Create a better groupBy function that only allows valid keys to be grouped on"/><meta name="twitter:image" content="https://johns.codes/static/images/twitter-card.png"/><meta property="article:published_time" content="2022-05-25T00:00:00.000Z"/><link rel="canonical" href="https://johns.codes/blog/type-safe-groupby-in-typescript"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://johns.codes/blog/type-safe-groupby-in-typescript"
  },
  "headline": "Type Safe GroupBy In TypeScript",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://johns.codes/static/images/twitter-card.png"
    }
  ],
  "datePublished": "2022-05-25T00:00:00.000Z",
  "dateModified": "2022-05-25T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "John Murray"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "John Murray",
    "logo": {
      "@type": "ImageObject",
      "url": "https://johns.codes/static/images/logo.png"
    }
  },
  "description": "Create a better groupBy function that only allows valid keys to be grouped on"
}</script><meta name="next-head-count" content="20"/><link rel="preload" href="/_next/static/css/2e58abc06d36574f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2e58abc06d36574f.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-c2b0a8f63e48fa58.js" defer=""></script><script src="/_next/static/chunks/main-a7322035af9d7f3c.js" defer=""></script><script src="/_next/static/chunks/pages/_app-22a535a3d4895e02.js" defer=""></script><script src="/_next/static/chunks/framework-327e104994690a53.js" defer=""></script><script src="/_next/static/chunks/675-374a5a75205d32da.js" defer=""></script><script src="/_next/static/chunks/545-6f26effa25ffb86c.js" defer=""></script><script src="/_next/static/chunks/460-214305b33b8337b4.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-5212da19635dab25.js" defer=""></script><script src="/_next/static/HJTizoWw6Yzbu-BQqJstJ/_buildManifest.js" defer=""></script><script src="/_next/static/HJTizoWw6Yzbu-BQqJstJ/_ssgManifest.js" defer=""></script><script src="/_next/static/HJTizoWw6Yzbu-BQqJstJ/_middlewareManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap">@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuFuYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body class="antialiased text-black bg-white dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex flex-col justify-between h-screen"><header class="flex items-center justify-between py-10"><div><a aria-label="John&#x27;s Codes" href="/"><div class="flex items-center justify-between"><div class="hidden h-6 text-2xl font-semibold sm:block">John&#x27;s Codes</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/projects">Projects</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="w-8 h-8 p-1 ml-1 mr-1 rounded sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="w-8 h-8 py-1 ml-1 mr-1 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed w-full h-full top-24 right-0 bg-gray-200 dark:bg-gray-800 opacity-95 z-10 transform ease-in-out duration-300 translate-x-full"><button type="button" aria-label="toggle modal" class="fixed w-full h-full cursor-auto focus:outline-none"></button><nav class="fixed h-full mt-8"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/projects">Projects</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed flex-col hidden gap-3 right-8 bottom-8 md:hidden"><button aria-label="Scroll To Comment" type="button" class="p-2 text-gray-500 transition-all bg-gray-200 rounded-full dark:text-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 hover:bg-gray-300"><svg class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="p-2 text-gray-500 transition-all bg-gray-200 rounded-full dark:text-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 hover:bg-gray-300"><svg class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-4 md:space-y-2 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="flex justify-center items-center text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2022-05-25T00:00:00.000Z">Wednesday, May 25, 2022</time><span class="mx-2">-</span><div class="flex items-center"><span class="ml-1">14 min read</span></div></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Type Safe GroupBy In TypeScript</h1></div></div></header><div class="pb-8 divide-y divide-gray-200 xl:divide-y-0 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6" style="grid-template-rows:auto 1fr"><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:pb-0 xl:col-span-4 xl:row-span-2"><div class="pt-10 pb-8 prose dark:prose-dark max-w-none"><details open=""><summary class="pt-2 pb-2 ml-6 text-xl font-bold">Table of Contents</summary><div class="ml-6"><ul><li class="false"><a href="#lodashs-groupby">Lodash&#x27;s groupBy</a></li><li class="false"><a href="#making-our-own-groupby">Making our own groupBy</a></li><li class="false"><a href="#putting-it-all-together">Putting it all together</a></li><li class="false"><a href="#possible-improvements">Possible improvements</a></li></ul></div></details>
<h2 id="lodashs-groupby"><a href="#lodashs-groupby" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Lodash&#x27;s groupBy</h2>
<p>I would bet if you have a sizeable Javascript/Typescript codebase you most likely are using <a target="_blank" rel="noopener noreferrer" href="https://lodash.com/">lodash</a> somewhere in there.
While Javascript has gotten more &quot;batteries included&quot; over the last few years, lodash still has many nice functions for manipulating arrays/objects.
One such function is <a target="_blank" rel="noopener noreferrer" href="https://lodash.com/docs/4.17.15#groupBy">groupBy</a>. It groups a list by some predicate, in the simplest case it can just be a key in the objects of the array.</p>
<div class="relative"><pre><code class="language-typescript code-highlight"><span class="code-line"><span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">&#x27;lodash&#x27;</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">interface</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
</span><span class="code-line">  num<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
</span><span class="code-line">  someLiteral<span class="token operator">:</span> <span class="token string">&#x27;a&#x27;</span> <span class="token operator">|</span> <span class="token string">&#x27;b&#x27;</span> <span class="token operator">|</span> <span class="token string">&#x27;c&#x27;</span><span class="token punctuation">;</span>
</span><span class="code-line">  object<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> vals<span class="token operator">:</span> Foo<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
</span><span class="code-line">  <span class="token punctuation">{</span> num<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> someLiteral<span class="token operator">:</span> <span class="token string">&#x27;a&#x27;</span><span class="token punctuation">,</span> object<span class="token operator">:</span> <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">&#x27;value&#x27;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">{</span> num<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> someLiteral<span class="token operator">:</span> <span class="token string">&#x27;a&#x27;</span><span class="token punctuation">,</span> object<span class="token operator">:</span> <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">&#x27;diffValue&#x27;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">{</span> num<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> someLiteral<span class="token operator">:</span> <span class="token string">&#x27;b&#x27;</span><span class="token punctuation">,</span> object<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">groupBy</span><span class="token punctuation">(</span>vals<span class="token punctuation">,</span> <span class="token string">&#x27;num&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token comment">/*
</span></span><span class="code-line"><span class="token comment">{
</span></span><span class="code-line"><span class="token comment">  &#x27;1&#x27;: [ { num: 1, someLiteral: &#x27;a&#x27; }, { num: 1, someLiteral: &#x27;b&#x27; } ],
</span></span><span class="code-line"><span class="token comment">  &#x27;2&#x27;: [ { num: 2, someLiteral: &#x27;a&#x27; } ]
</span></span><span class="code-line"><span class="token comment">}
</span></span><span class="code-line"><span class="token comment">*/</span>
</span><span class="code-line"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">groupBy</span><span class="token punctuation">(</span>vals<span class="token punctuation">,</span> <span class="token string">&#x27;someLiteral&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token comment">/*
</span></span><span class="code-line"><span class="token comment">{
</span></span><span class="code-line"><span class="token comment">  a:[
</span></span><span class="code-line"><span class="token comment">      { num: 1, someLiteral: &#x27;a&#x27;, object: [Object] },
</span></span><span class="code-line"><span class="token comment">      { num: 2, someLiteral: &#x27;a&#x27;, object: [Object] }
</span></span><span class="code-line"><span class="token comment">  ],
</span></span><span class="code-line"><span class="token comment">  b: [ { num: 1, someLiteral: &#x27;b&#x27;, object: {} } ]
</span></span><span class="code-line"><span class="token comment">}
</span></span><span class="code-line"><span class="token comment">*/</span>
</span></code></pre></div>
<p>This all seems to make sense, you can set what key you want to group on, and you get back an object whose keys are the values for found in the input array of objects.</p>
<p>Now if you&#x27;re in a TypeScript code base I hope you are using the <a target="_blank" rel="noopener noreferrer" href="https://www.npmjs.com/package/@types/lodash">definitely typed lodash types</a> to add some types to the lodash functions.
In this case the <code>_.groupBy</code> type looks roughly like (simplified from the actual code)</p>
<div class="relative"><pre><code class="language-typescript code-highlight"><span class="code-line"><span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">groupBy</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>collection<span class="token operator">:</span> List<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> Dictionary<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">interface</span> <span class="token class-name">Dictionary<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token punctuation">[</span>index<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div>
<p>So a few things stick out here. First, the <code>key</code> type is just string, so there&#x27;s nothing stopping me from doing <code>_.groupBy(vals, &quot;someKeyThatDoesNotExist&quot;)</code>.
Second, we have no restrictions at the type level of me grouping on a key whose value is not a valid object key (the value must be a subset of <code>string | number | symbol</code>). For example in <code>Foo</code> the <code>object</code> key&#x27;s value was a record. Here&#x27;s what happens when you try to group on that key.</p>
<div class="relative"><pre><code class="language-typescript code-highlight"><span class="code-line"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">groupBy</span><span class="token punctuation">(</span>vals<span class="token punctuation">,</span> <span class="token string">&#x27;object&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token comment">/*
</span></span><span class="code-line"><span class="token comment">{
</span></span><span class="code-line"><span class="token comment">  &#x27;[object Object]&#x27;: [
</span></span><span class="code-line"><span class="token comment">    { num: 1, someLiteral: &#x27;a&#x27;, object: [Object] },
</span></span><span class="code-line"><span class="token comment">    { num: 2, someLiteral: &#x27;a&#x27;, object: [Object] },
</span></span><span class="code-line"><span class="token comment">    { num: 1, someLiteral: &#x27;b&#x27;, object: {} }
</span></span><span class="code-line"><span class="token comment">  ]
</span></span><span class="code-line"><span class="token comment">}
</span></span><span class="code-line"><span class="token comment">*/</span>
</span></code></pre></div>
<p>In this case the objects where coerced to string values so all elements of <code>vals</code> where grouped under the same weird <code>[object Object]</code> key. While this does not throw an error there is almost 0 chance you want this to happen in your code.</p>
<p>Finally, the return type of this function is <code>Dictionary</code>, while its &quot;right&quot; it could be &quot;more right&quot; by encoding that the returning object&#x27;s keys would be the values of the grouping key in the input object.</p>
<h2 id="making-our-own-groupby"><a href="#making-our-own-groupby" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Making our own groupBy</h2>
<p><em>insert Bender joke here</em></p>
<p>To start making our own type safe <code>groupBy</code>, we first need some code that actually does the grouping logic. Let&#x27;s start with that and some basic types.</p>
<div class="relative"><pre><code class="language-typescript code-highlight"><span class="code-line"><span class="token comment">// Note: PropertyKey is a builtIn type alias of</span>
</span><span class="code-line"><span class="token comment">// type PropertyKey = string | number | symbol</span>
</span><span class="code-line"><span class="token comment">// This lets us use &quot;Record&lt;PropertyKey, any&gt;&quot; to represent any object</span>
</span><span class="code-line"><span class="token comment">// but is slightly nicer to use than the &quot;object&quot; type</span>
</span><span class="code-line"><span class="token class-name"><span class="token keyword">function</span></span> <span class="token generic-function"><span class="token function">simpleGroupBy</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> Record<span class="token operator">&lt;</span>PropertyKey<span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>arr<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>accumulator<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">const</span> groupedKey <span class="token operator">=</span> val<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>accumulator<span class="token punctuation">[</span>groupedKey<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      accumulator<span class="token punctuation">[</span>groupedKey<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    accumulator<span class="token punctuation">[</span>groupedKey<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">return</span> accumulator<span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span><span class="token function">simpleGroupBy</span><span class="token punctuation">(</span>vals<span class="token punctuation">,</span> <span class="token string">&#x27;num&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token comment">/*
</span></span><span class="code-line"><span class="token comment">{
</span></span><span class="code-line"><span class="token comment">  &#x27;1&#x27;: [
</span></span><span class="code-line"><span class="token comment">    { num: 1, someLiteral: &#x27;a&#x27;, object: [Object] },
</span></span><span class="code-line"><span class="token comment">    { num: 1, someLiteral: &#x27;b&#x27;, object: {} }
</span></span><span class="code-line"><span class="token comment">  ],
</span></span><span class="code-line"><span class="token comment">  &#x27;2&#x27;: [ { num: 2, someLiteral: &#x27;a&#x27;, object: [Object] } ]
</span></span><span class="code-line"><span class="token comment">}
</span></span><span class="code-line"><span class="token comment">*/</span>
</span></code></pre></div>
<p>Cool the logic here seems to work, but obviously the types could use some love.</p>
<p>Let&#x27;s start by adding a few more generics, so we can type the output correctly.
Your first change might be to make the return type <code>Record&lt;string, T[]&gt;</code> since the keys will be coerced to strings by JavaScript and the values will be the same values in the array.
This will unfortunately make typescript sad.</p>
<div class="relative"><pre><code class="language-typescript code-highlight"><span class="code-line"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">sadAttempt</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> object<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>arr<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>accumulator<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">const</span> groupedKey <span class="token operator">=</span> val<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>accumulator<span class="token punctuation">[</span>groupedKey<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      accumulator<span class="token punctuation">[</span>groupedKey<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line highlight-line">    accumulator<span class="token punctuation">[</span>groupedKey<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line highlight-line">    <span class="token keyword">return</span> accumulator<span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">as</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line highlight-line"><span class="token punctuation">}</span>
</span></code></pre></div>
<p>The lines with <code>accumulator[groupedKey]</code> will error with <code>Type &#x27;T[keyof T]&#x27; cannot be used to index type &#x27;Record&lt;string, T&gt;&#x27;</code>. Here the <code>keyof T</code> could be any key in <code>T</code> so since not every key&#x27;s value in <code>T</code> is a string typescript will not let you treat <code>groupedKey</code> as a string.</p>
<p>We can almost fix this by adding some more information on the input key by binding it to a new generic parameter, though there will still be some issues.</p>
<div class="relative"><pre><code class="language-typescript code-highlight"><span class="code-line highlight-line"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">betterSadAttempt</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> Record<span class="token operator">&lt;</span>PropertyKey<span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> Key <span class="token keyword">extends</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
</span><span class="code-line">  arr<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">  key<span class="token operator">:</span> Key
</span><span class="code-line highlight-line"><span class="token punctuation">)</span><span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span>Key<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>accumulator<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">const</span> groupedKey <span class="token operator">=</span> val<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>accumulator<span class="token punctuation">[</span>groupedKey<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      accumulator<span class="token punctuation">[</span>groupedKey<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    accumulator<span class="token punctuation">[</span>groupedKey<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">return</span> accumulator<span class="token punctuation">;</span>
</span><span class="code-line highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">as</span> Record<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span>Key<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div>
<p>Here we added a new generic <code>Key extends keyof T</code> so when we supply a specific key to the function, the Key generic will be narrowed to that value. For example if we did <code>betterSadAttempt(vals, &#x27;someLiteral&#x27;)</code>, <code>Key</code> would exactly be <code>&#x27;someLiteral&#x27;</code> instead of <code>keyof Foo = &#x27;someLiteral&#x27; | &#x27;num&#x27; | &#x27;object&#x27;</code></p>
<p>However, typescript is still sad on the <code>Record&lt;T[Key], T[]&gt;</code> lines with <code>Type &#x27;T[Key]&#x27; does not satisfy the constraint &#x27;string | number | symbol&#x27;</code>.
This error is similar to the error before, basically <code>T[Key]</code> can not be a key for the <code>Record</code> since it could be some weird value.</p>
<p>To accomplish this we need to make a helper type that filters down the allowed keys to only keys whose values are <code>string | number | symbol</code>.
We can use a <a target="_blank" rel="noopener noreferrer" href="https://www.typescriptlang.org/docs/handbook/2/mapped-types.html">mapped type</a> to do just that</p>
<div class="relative"><pre><code class="language-typescript code-highlight"><span class="code-line"><span class="token keyword">type</span> <span class="token class-name">MapValuesToKeysIfAllowed<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token class-name">PropertyKey</span> <span class="token operator">?</span> <span class="token constant">K</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">type</span> <span class="token class-name">Filter<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> MapValuesToKeysIfAllowed<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span></code></pre></div>
<p>This type helper does a few things. First it maps over all the values in <code>T</code> (<code>[K in keyof T]</code>) and makes the value the key if it is a subset of <code>string | number | symbol</code> (<code>T[K] extends PropertyKey ? K</code>), if it&#x27;s not a subset its value will bethe <code>never</code> type. Finally, we use an <a target="_blank" rel="noopener noreferrer" href="https://www.typescriptlang.org/docs/handbook/2/indexed-access-types.html">index access type</a> to get all values of the transformed object as a union. This step will drop all the <code>never</code> values automatically for us since adding <code>never</code> to a union is like saying <code>or false</code> its basically is a no op.</p>
<p>That was a mouthful so let&#x27;s see an example</p>
<div class="relative"><pre><code class="language-typescript code-highlight"><span class="code-line"><span class="token comment">// from above</span>
</span><span class="code-line"><span class="token keyword">interface</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
</span><span class="code-line">  num<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
</span><span class="code-line">  someLiteral<span class="token operator">:</span> <span class="token string">&#x27;a&#x27;</span> <span class="token operator">|</span> <span class="token string">&#x27;b&#x27;</span> <span class="token operator">|</span> <span class="token string">&#x27;c&#x27;</span><span class="token punctuation">;</span>
</span><span class="code-line">  object<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">type</span> <span class="token class-name">MappedFoo</span> <span class="token operator">=</span> MapValuesToKeysIfAllowed<span class="token operator">&lt;</span>Foo<span class="token operator">&gt;</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token comment">/*
</span></span><span class="code-line"><span class="token comment">{
</span></span><span class="code-line"><span class="token comment">  num: &quot;num&quot;;
</span></span><span class="code-line"><span class="token comment">  someLiteral: &quot;someLiteral&quot;;
</span></span><span class="code-line"><span class="token comment">  object: never;
</span></span><span class="code-line"><span class="token comment">}
</span></span><span class="code-line"><span class="token comment">*/</span>
</span><span class="code-line"><span class="token comment">// we replace the values of this object with just the key as a string literal or never</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">type</span> <span class="token class-name">FooKeys</span> <span class="token operator">=</span> Filter<span class="token operator">&lt;</span>Foo<span class="token operator">&gt;</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token comment">// =&gt; &quot;num&quot; | &quot;someLiteral&quot;</span>
</span><span class="code-line"><span class="token comment">// notice the never does not show up in the union</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">interface</span> <span class="token class-name">AllObjects</span> <span class="token punctuation">{</span>
</span><span class="code-line">  object<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</span><span class="code-line">  diffObject<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">type</span> <span class="token class-name">MappedAllObjects</span> <span class="token operator">=</span> MapValuesToKeysIfAllowed<span class="token operator">&lt;</span>AllObjects<span class="token operator">&gt;</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token comment">/*
</span></span><span class="code-line"><span class="token comment">{ 
</span></span><span class="code-line"><span class="token comment">  object: never;
</span></span><span class="code-line"><span class="token comment">  diffObject: never;
</span></span><span class="code-line"><span class="token comment">}
</span></span><span class="code-line"><span class="token comment">*/</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">type</span> <span class="token class-name">AllObjectsKeys</span> <span class="token operator">=</span> Filter<span class="token operator">&lt;</span>AllObjects<span class="token operator">&gt;</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token comment">// =&gt; never</span>
</span><span class="code-line"><span class="token comment">// the output is only never. Think of this like saying &quot;false or false&quot;, the output will just be false</span>
</span></code></pre></div>
<p>With this filter type helper function we can now properly limit the <code>Key</code> generic by replacing <code>Key extends keyof T</code> with <code>Key extends Filter&lt;T&gt;</code>.</p>
<h2 id="putting-it-all-together"><a href="#putting-it-all-together" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Putting it all together</h2>
<div class="relative"><pre><code class="language-typescript code-highlight"><span class="code-line"><span class="token keyword">type</span> <span class="token class-name">MapValuesToKeysIfAllowed<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token class-name">PropertyKey</span> <span class="token operator">?</span> <span class="token constant">K</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">type</span> <span class="token class-name">Filter<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> MapValuesToKeysIfAllowed<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">groupBy</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> Record<span class="token operator">&lt;</span>PropertyKey<span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> Key <span class="token keyword">extends</span> Filter<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>
</span><span class="code-line">  arr<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">  key<span class="token operator">:</span> Key
</span><span class="code-line"><span class="token punctuation">)</span><span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span>Key<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>accumulator<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">const</span> groupedKey <span class="token operator">=</span> val<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>accumulator<span class="token punctuation">[</span>groupedKey<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      accumulator<span class="token punctuation">[</span>groupedKey<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    accumulator<span class="token punctuation">[</span>groupedKey<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">return</span> accumulator<span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">as</span> Record<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span>Key<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> nums <span class="token operator">=</span> <span class="token function">groupBy</span><span class="token punctuation">(</span>vals<span class="token punctuation">,</span> <span class="token string">&#x27;num&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token comment">// nums = Record&lt;number, Foo[]&gt;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> literals <span class="token operator">=</span> <span class="token function">groupBy</span><span class="token punctuation">(</span>vals<span class="token punctuation">,</span> <span class="token string">&#x27;someLiteral&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token comment">// literals = Record&lt;&quot;a&quot; | &quot;b&quot; | &quot;c&quot;, Foo[]&gt;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> sad <span class="token operator">=</span> <span class="token function">groupBy</span><span class="token punctuation">(</span>vals<span class="token punctuation">,</span> <span class="token string">&#x27;object&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token comment">// error: Argument of type &#x27;&quot;object&quot;&#x27; is not assignable to parameter of type &#x27;Filter&lt;Foo&gt;&#x27;</span>
</span></code></pre></div>
<p>Now this works great, we can only pass in keys that have valid values, and we even get autocomplete on it! However, one thing that bothers me is the error message in the last case.
While it&#x27;s correct, saying <code>not assignable to parameter of type &#x27;Filter&lt;Foo&gt;&#x27;</code> is not very useful to a user. This pops up sometimes with typescript where it won&#x27;t show the underlying type and instead just show the higher level type helper instead.</p>
<p>To make the error message show the valid keys we can use a modified version of <a target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/a/57683652">this &quot;hack&quot;</a>. Here instead of creating the <code>Expand</code> type in the post, we can make our own <code>ValuesOf</code> to replace the <code>[keyof T]</code> at the end of <code>Filter</code></p>
<div class="relative"><pre><code class="language-typescript code-highlight"><span class="code-line"><span class="token keyword">type</span> <span class="token class-name">ValuesOf<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token constant">A</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token keyword">infer</span></span> <span class="token constant">O</span> <span class="token operator">?</span> <span class="token constant">A</span><span class="token punctuation">[</span><span class="token keyword">keyof</span> <span class="token constant">A</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">type</span> <span class="token class-name">Filter<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> ValuesOf<span class="token operator">&lt;</span>MapValuesToKeysIfAllowed<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token comment">// was Filter&lt;T&gt; = MapValuesToKeysIfAllowed&lt;T&gt;[keyof T]</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> sad <span class="token operator">=</span> <span class="token function">groupBy</span><span class="token punctuation">(</span>vals<span class="token punctuation">,</span> <span class="token string">&#x27;object&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token comment">// error: Argument of type &#x27;&quot;object&quot;&#x27; is not assignable to parameter of type &#x27;&quot;num&quot; | &quot;someLiteral&quot;&#x27;</span>
</span></code></pre></div>
<p>Now we have type safety and good error messages!</p>
<h2 id="possible-improvements"><a href="#possible-improvements" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Possible improvements</h2>
<p>One thing this <code>groupBy</code> function lacks that the lodash <code>groupBy</code> gives is we do not allow you to pass a function instead of a key to group on.
The example in the lodash docs is</p>
<div class="relative"><pre><code class="language-typescript code-highlight"><span class="code-line">_<span class="token punctuation">.</span><span class="token function">groupBy</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">6.1</span><span class="token punctuation">,</span> <span class="token number">4.2</span><span class="token punctuation">,</span> <span class="token number">6.3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span>floor<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token comment">// { &#x27;4&#x27;: [4.2], &#x27;6&#x27;: [6.1, 6.3] }</span>
</span></code></pre></div>
<p>While this is not perfect this mostly works</p>
<div class="relative"><pre><code class="language-typescript code-highlight"><span class="code-line"><span class="token keyword">function</span> groupByFunc<span class="token operator">&lt;</span>
</span><span class="code-line">  RetType <span class="token keyword">extends</span> <span class="token class-name">PropertyKey</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token constant">T</span><span class="token punctuation">,</span> <span class="token comment">// no longer need any requirements on T since the grouper can do w/e it wants</span>
</span><span class="code-line">  Func <span class="token keyword">extends</span> <span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> RetType
</span><span class="code-line"><span class="token operator">&gt;</span><span class="token punctuation">(</span>arr<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mapper<span class="token operator">:</span> Func<span class="token punctuation">)</span><span class="token operator">:</span> Record<span class="token operator">&lt;</span>RetType<span class="token punctuation">,</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>accumulator<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">const</span> groupedKey <span class="token operator">=</span> <span class="token function">mapper</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>accumulator<span class="token punctuation">[</span>groupedKey<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      accumulator<span class="token punctuation">[</span>groupedKey<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    accumulator<span class="token punctuation">[</span>groupedKey<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">return</span> accumulator<span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">as</span> Record<span class="token operator">&lt;</span>RetType<span class="token punctuation">,</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> test <span class="token operator">=</span> <span class="token function">groupByFunc</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">6.1</span><span class="token punctuation">,</span> <span class="token number">4.2</span><span class="token punctuation">,</span> <span class="token number">6.3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span>floor<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token comment">// test = Record&lt;PropertyKey, Foo[]&gt;</span>
</span></code></pre></div>
<p>This works by only letting you pass in functions that return <code>PropertyKey</code>, but typescript does not seem to narrow the types. In this case <code>test</code> should be <code>Record&lt;number, Foo[]&gt;</code> since TS <em>should</em> infer the return type of the grouping function. If you know how to improve this function to make the return type narrow properly feel free to leave an issue/pr on my <a target="_blank" rel="noopener noreferrer" href="https://github.com/JRMurr/JRMurr.github.io">blog&#x27;s GitHub</a>!</p></div></div></div></div></article></div></main><footer><div class="flex flex-col items-center mt-16"><div class="flex mb-3 space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/JRMurr"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div><div class="flex mb-2 space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>John Murray</div><div> • </div><div>© 2022</div><div> • </div><a href="/">John&#x27;s Codes</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var p=Object.create;var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var o=a=\u003el(a,\"__esModule\",{value:!0});var N=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=\u003e{o(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},y=(a,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let e of h(s))!u.call(a,e)\u0026\u0026e!==\"default\"\u0026\u0026l(a,e,{get:()=\u003es[e],enumerable:!(c=d(s,e))||c.enumerable});return a},g=a=\u003ey(o(l(a!=null?p(m(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=N((K,i)=\u003e{i.exports=_jsx_runtime});var v={};k(v,{default:()=\u003eb,frontmatter:()=\u003ef});var n=g(r()),f={title:\"Type Safe GroupBy In TypeScript\",date:\"2022-05-25\",tags:[\"typescript\",\"types\",\"code\",\"guide\"],draft:!1,summary:\"Create a better groupBy function that only allows valid keys to be grouped on\",images:[],layout:\"PostLayout\"};function w(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(c,{})})):c();function c(){let e=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",pre:\"pre\",code:\"code\",em:\"em\"},a.components),{TOCInline:t}=e;return t||T(\"TOCInline\",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t,{toc:a.toc,asDisclosure:!0}),`\n`,(0,n.jsxs)(e.h2,{id:\"lodashs-groupby\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#lodashs-groupby\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Lodash's groupBy\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"I would bet if you have a sizeable Javascript/Typescript codebase you most likely are using \",(0,n.jsx)(e.a,{href:\"https://lodash.com/\",children:\"lodash\"}),` somewhere in there.\nWhile Javascript has gotten more \"batteries included\" over the last few years, lodash still has many nice functions for manipulating arrays/objects.\nOne such function is `,(0,n.jsx)(e.a,{href:\"https://lodash.com/docs/4.17.15#groupBy\",children:\"groupBy\"}),\". It groups a list by some predicate, in the simplest case it can just be a key in the objects of the array.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-typescript\",children:(0,n.jsxs)(e.code,{className:\"language-typescript code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" _ \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'lodash'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Foo\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  num\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"number\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  someLiteral\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'a'\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'b'\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'c'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  object\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Record\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"any\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" vals\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Foo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" num\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" someLiteral\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'a'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" object\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" key\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'value'\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" num\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" someLiteral\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'a'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" object\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" key\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'diffValue'\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" num\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" someLiteral\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'b'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" object\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token builtin\",children:\"console\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"dir\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"_\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"groupBy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"vals\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'num'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`/*\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`{\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`  '1': [ { num: 1, someLiteral: 'a' }, { num: 1, someLiteral: 'b' } ],\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`  '2': [ { num: 2, someLiteral: 'a' } ]\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`}\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"*/\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token builtin\",children:\"console\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"dir\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"_\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"groupBy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"vals\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'someLiteral'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`/*\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`{\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`  a:[\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`      { num: 1, someLiteral: 'a', object: [Object] },\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`      { num: 2, someLiteral: 'a', object: [Object] }\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`  ],\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`  b: [ { num: 1, someLiteral: 'b', object: {} } ]\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`}\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"*/\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"This all seems to make sense, you can set what key you want to group on, and you get back an object whose keys are the values for found in the input array of objects.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Now if you're in a TypeScript code base I hope you are using the \",(0,n.jsx)(e.a,{href:\"https://www.npmjs.com/package/@types/lodash\",children:\"definitely typed lodash types\"}),` to add some types to the lodash functions.\nIn this case the `,(0,n.jsx)(e.code,{children:\"_.groupBy\"}),\" type looks roughly like (simplified from the actual code)\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-typescript\",children:(0,n.jsxs)(e.code,{className:\"language-typescript code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"declare\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsxs)(e.span,{className:\"token generic-function\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"groupBy\"}),(0,n.jsxs)(e.span,{className:\"token generic class-name\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"})]})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"collection\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" List\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" key\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Dictionary\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"Dictionary\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"index\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"So a few things stick out here. First, the \",(0,n.jsx)(e.code,{children:\"key\"}),\" type is just string, so there's nothing stopping me from doing \",(0,n.jsx)(e.code,{children:'_.groupBy(vals, \"someKeyThatDoesNotExist\")'}),`.\nSecond, we have no restrictions at the type level of me grouping on a key whose value is not a valid object key (the value must be a subset of `,(0,n.jsx)(e.code,{children:\"string | number | symbol\"}),\"). For example in \",(0,n.jsx)(e.code,{children:\"Foo\"}),\" the \",(0,n.jsx)(e.code,{children:\"object\"}),\" key's value was a record. Here's what happens when you try to group on that key.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-typescript\",children:(0,n.jsxs)(e.code,{className:\"language-typescript code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token builtin\",children:\"console\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"dir\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"_\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"groupBy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"vals\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'object'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`/*\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`{\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`  '[object Object]': [\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`    { num: 1, someLiteral: 'a', object: [Object] },\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`    { num: 2, someLiteral: 'a', object: [Object] },\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`    { num: 1, someLiteral: 'b', object: {} }\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`  ]\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`}\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"*/\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"In this case the objects where coerced to string values so all elements of \",(0,n.jsx)(e.code,{children:\"vals\"}),\" where grouped under the same weird \",(0,n.jsx)(e.code,{children:\"[object Object]\"}),\" key. While this does not throw an error there is almost 0 chance you want this to happen in your code.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Finally, the return type of this function is \",(0,n.jsx)(e.code,{children:\"Dictionary\"}),`, while its \"right\" it could be \"more right\" by encoding that the returning object's keys would be the values of the grouping key in the input object.`]}),`\n`,(0,n.jsxs)(e.h2,{id:\"making-our-own-groupby\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#making-our-own-groupby\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Making our own groupBy\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.em,{children:\"insert Bender joke here\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"To start making our own type safe \",(0,n.jsx)(e.code,{children:\"groupBy\"}),\", we first need some code that actually does the grouping logic. Let's start with that and some basic types.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-typescript\",children:(0,n.jsxs)(e.code,{className:\"language-typescript code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Note: PropertyKey is a builtIn type alias of\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// type PropertyKey = string | number | symbol\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:'// This lets us use \"Record\u003cPropertyKey, any\u003e\" to represent any object'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:'// but is slightly nicer to use than the \"object\" type'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token class-name\",children:(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"})}),\" \",(0,n.jsxs)(e.span,{className:\"token generic-function\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"simpleGroupBy\"}),(0,n.jsxs)(e.span,{className:\"token generic class-name\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"extends\"}),\" Record\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"PropertyKey\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"any\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\u003e\"})]})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"arr\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" key\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"keyof\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"any\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" arr\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"reduce\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"accumulator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" val\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" groupedKey \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" val\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"key\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"!\"}),\"accumulator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"groupedKey\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      accumulator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"groupedKey\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    accumulator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"groupedKey\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"push\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"val\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" accumulator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"any\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token builtin\",children:\"console\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"dir\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"simpleGroupBy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"vals\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'num'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`/*\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`{\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`  '1': [\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`    { num: 1, someLiteral: 'a', object: [Object] },\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`    { num: 1, someLiteral: 'b', object: {} }\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`  ],\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`  '2': [ { num: 2, someLiteral: 'a', object: [Object] } ]\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`}\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"*/\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Cool the logic here seems to work, but obviously the types could use some love.\"}),`\n`,(0,n.jsxs)(e.p,{children:[`Let's start by adding a few more generics, so we can type the output correctly.\nYour first change might be to make the return type `,(0,n.jsx)(e.code,{children:\"Record\u003cstring, T[]\u003e\"}),` since the keys will be coerced to strings by JavaScript and the values will be the same values in the array.\nThis will unfortunately make typescript sad.`]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-typescript\",children:(0,n.jsxs)(e.code,{className:\"language-typescript code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsxs)(e.span,{className:\"token generic-function\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"sadAttempt\"}),(0,n.jsxs)(e.span,{className:\"token generic class-name\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"extends\"}),\" object\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"})]})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"arr\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" key\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"keyof\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Record\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" arr\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"reduce\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"accumulator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" val\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" groupedKey \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" val\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"key\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"!\"}),\"accumulator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"groupedKey\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      accumulator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"groupedKey\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line highlight-line\",children:[\"    accumulator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"groupedKey\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"push\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"val\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line highlight-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" accumulator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" Record\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line highlight-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"The lines with \",(0,n.jsx)(e.code,{children:\"accumulator[groupedKey]\"}),\" will error with \",(0,n.jsx)(e.code,{children:\"Type 'T[keyof T]' cannot be used to index type 'Record\u003cstring, T\u003e'\"}),\". Here the \",(0,n.jsx)(e.code,{children:\"keyof T\"}),\" could be any key in \",(0,n.jsx)(e.code,{children:\"T\"}),\" so since not every key's value in \",(0,n.jsx)(e.code,{children:\"T\"}),\" is a string typescript will not let you treat \",(0,n.jsx)(e.code,{children:\"groupedKey\"}),\" as a string.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"We can almost fix this by adding some more information on the input key by binding it to a new generic parameter, though there will still be some issues.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-typescript\",children:(0,n.jsxs)(e.code,{className:\"language-typescript code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line highlight-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsxs)(e.span,{className:\"token generic-function\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"betterSadAttempt\"}),(0,n.jsxs)(e.span,{className:\"token generic class-name\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"extends\"}),\" Record\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"PropertyKey\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"any\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" Key \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"extends\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"keyof\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"})]})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  arr\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  key\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),` Key\n`]}),(0,n.jsxs)(e.span,{className:\"code-line highlight-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Record\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"Key\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" arr\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"reduce\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"accumulator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" val\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" groupedKey \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" val\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"key\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"!\"}),\"accumulator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"groupedKey\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      accumulator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"groupedKey\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    accumulator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"groupedKey\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"push\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"val\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" accumulator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line highlight-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" Record\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"Key\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Here we added a new generic \",(0,n.jsx)(e.code,{children:\"Key extends keyof T\"}),\" so when we supply a specific key to the function, the Key generic will be narrowed to that value. For example if we did \",(0,n.jsx)(e.code,{children:\"betterSadAttempt(vals, 'someLiteral')\"}),\", \",(0,n.jsx)(e.code,{children:\"Key\"}),\" would exactly be \",(0,n.jsx)(e.code,{children:\"'someLiteral'\"}),\" instead of \",(0,n.jsx)(e.code,{children:\"keyof Foo = 'someLiteral' | 'num' | 'object'\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"However, typescript is still sad on the \",(0,n.jsx)(e.code,{children:\"Record\u003cT[Key], T[]\u003e\"}),\" lines with \",(0,n.jsx)(e.code,{children:\"Type 'T[Key]' does not satisfy the constraint 'string | number | symbol'\"}),`.\nThis error is similar to the error before, basically `,(0,n.jsx)(e.code,{children:\"T[Key]\"}),\" can not be a key for the \",(0,n.jsx)(e.code,{children:\"Record\"}),\" since it could be some weird value.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"To accomplish this we need to make a helper type that filters down the allowed keys to only keys whose values are \",(0,n.jsx)(e.code,{children:\"string | number | symbol\"}),`.\nWe can use a `,(0,n.jsx)(e.a,{href:\"https://www.typescriptlang.org/docs/handbook/2/mapped-types.html\",children:\"mapped type\"}),\" to do just that\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-typescript\",children:(0,n.jsxs)(e.code,{className:\"language-typescript code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"MapValuesToKeysIfAllowed\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"K\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"keyof\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"K\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"extends\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PropertyKey\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"K\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"never\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"Filter\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" MapValuesToKeysIfAllowed\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"keyof\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"This type helper does a few things. First it maps over all the values in \",(0,n.jsx)(e.code,{children:\"T\"}),\" (\",(0,n.jsx)(e.code,{children:\"[K in keyof T]\"}),\") and makes the value the key if it is a subset of \",(0,n.jsx)(e.code,{children:\"string | number | symbol\"}),\" (\",(0,n.jsx)(e.code,{children:\"T[K] extends PropertyKey ? K\"}),\"), if it's not a subset its value will bethe \",(0,n.jsx)(e.code,{children:\"never\"}),\" type. Finally, we use an \",(0,n.jsx)(e.a,{href:\"https://www.typescriptlang.org/docs/handbook/2/indexed-access-types.html\",children:\"index access type\"}),\" to get all values of the transformed object as a union. This step will drop all the \",(0,n.jsx)(e.code,{children:\"never\"}),\" values automatically for us since adding \",(0,n.jsx)(e.code,{children:\"never\"}),\" to a union is like saying \",(0,n.jsx)(e.code,{children:\"or false\"}),\" its basically is a no op.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"That was a mouthful so let's see an example\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-typescript\",children:(0,n.jsxs)(e.code,{className:\"language-typescript code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// from above\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Foo\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  num\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"number\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  someLiteral\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'a'\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'b'\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'c'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  object\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Record\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"any\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MappedFoo\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" MapValuesToKeysIfAllowed\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"Foo\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`/*\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`{\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`  num: \"num\";\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`  someLiteral: \"someLiteral\";\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`  object: never;\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`}\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"*/\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// we replace the values of this object with just the key as a string literal or never\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"FooKeys\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" Filter\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"Foo\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:'// =\u003e \"num\" | \"someLiteral\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// notice the never does not show up in the union\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"AllObjects\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  object\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Record\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"any\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  diffObject\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Record\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"number\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"any\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"MappedAllObjects\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" MapValuesToKeysIfAllowed\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"AllObjects\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`/*\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`{ \n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`  object: never;\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`  diffObject: never;\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`}\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"*/\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"AllObjectsKeys\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" Filter\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"AllObjects\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// =\u003e never\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:'// the output is only never. Think of this like saying \"false or false\", the output will just be false'}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"With this filter type helper function we can now properly limit the \",(0,n.jsx)(e.code,{children:\"Key\"}),\" generic by replacing \",(0,n.jsx)(e.code,{children:\"Key extends keyof T\"}),\" with \",(0,n.jsx)(e.code,{children:\"Key extends Filter\u003cT\u003e\"}),\".\"]}),`\n`,(0,n.jsxs)(e.h2,{id:\"putting-it-all-together\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#putting-it-all-together\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Putting it all together\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-typescript\",children:(0,n.jsxs)(e.code,{className:\"language-typescript code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"MapValuesToKeysIfAllowed\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"K\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"keyof\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"K\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"extends\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PropertyKey\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"K\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"never\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"Filter\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" MapValuesToKeysIfAllowed\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"keyof\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsxs)(e.span,{className:\"token generic-function\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"groupBy\"}),(0,n.jsxs)(e.span,{className:\"token generic class-name\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"extends\"}),\" Record\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"PropertyKey\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"any\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" Key \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"extends\"}),\" Filter\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\u003e\"})]})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  arr\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  key\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),` Key\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Record\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"Key\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" arr\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"reduce\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"accumulator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" val\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" groupedKey \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" val\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"key\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"!\"}),\"accumulator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"groupedKey\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      accumulator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"groupedKey\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    accumulator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"groupedKey\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"push\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"val\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" accumulator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" Record\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"Key\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" nums \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"groupBy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"vals\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'num'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// nums = Record\u003cnumber, Foo[]\u003e\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" literals \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"groupBy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"vals\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'someLiteral'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:'// literals = Record\u003c\"a\" | \"b\" | \"c\", Foo[]\u003e'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" sad \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"groupBy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"vals\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'object'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:`// error: Argument of type '\"object\"' is not assignable to parameter of type 'Filter\u003cFoo\u003e'`}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[`Now this works great, we can only pass in keys that have valid values, and we even get autocomplete on it! However, one thing that bothers me is the error message in the last case.\nWhile it's correct, saying `,(0,n.jsx)(e.code,{children:\"not assignable to parameter of type 'Filter\u003cFoo\u003e'\"}),\" is not very useful to a user. This pops up sometimes with typescript where it won't show the underlying type and instead just show the higher level type helper instead.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"To make the error message show the valid keys we can use a modified version of \",(0,n.jsx)(e.a,{href:\"https://stackoverflow.com/a/57683652\",children:'this \"hack\"'}),\". Here instead of creating the \",(0,n.jsx)(e.code,{children:\"Expand\"}),\" type in the post, we can make our own \",(0,n.jsx)(e.code,{children:\"ValuesOf\"}),\" to replace the \",(0,n.jsx)(e.code,{children:\"[keyof T]\"}),\" at the end of \",(0,n.jsx)(e.code,{children:\"Filter\"})]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-typescript\",children:(0,n.jsxs)(e.code,{className:\"language-typescript code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"ValuesOf\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"A\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"A\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"extends\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:(0,n.jsx)(e.span,{className:\"token keyword\",children:\"infer\"})}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"O\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"A\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"keyof\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"A\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"never\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"Filter\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" ValuesOf\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"MapValuesToKeysIfAllowed\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// was Filter\u003cT\u003e = MapValuesToKeysIfAllowed\u003cT\u003e[keyof T]\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" sad \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"groupBy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"vals\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'object'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:`// error: Argument of type '\"object\"' is not assignable to parameter of type '\"num\" | \"someLiteral\"'`}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Now we have type safety and good error messages!\"}),`\n`,(0,n.jsxs)(e.h2,{id:\"possible-improvements\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#possible-improvements\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Possible improvements\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"One thing this \",(0,n.jsx)(e.code,{children:\"groupBy\"}),\" function lacks that the lodash \",(0,n.jsx)(e.code,{children:\"groupBy\"}),` gives is we do not allow you to pass a function instead of a key to group on.\nThe example in the lodash docs is`]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-typescript\",children:(0,n.jsxs)(e.code,{className:\"language-typescript code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"_\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"groupBy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"6.1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"4.2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"6.3\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" Math\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"floor\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// { '4': [4.2], '6': [6.1, 6.3] }\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"While this is not perfect this mostly works\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-typescript\",children:(0,n.jsxs)(e.code,{className:\"language-typescript code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" groupByFunc\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  RetType \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"extends\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PropertyKey\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// no longer need any requirements on T since the grouper can do w/e it wants\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  Func \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"extends\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"arg\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\u003e\"}),` RetType\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"arr\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" mapper\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Func\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" Record\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"RetType\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" arr\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"reduce\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"accumulator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" val\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" groupedKey \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"mapper\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"val\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"!\"}),\"accumulator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"groupedKey\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      accumulator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"groupedKey\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    accumulator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"groupedKey\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"push\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"val\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" accumulator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" Record\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"RetType\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token constant\",children:\"T\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" test \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"groupByFunc\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"6.1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"4.2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"6.3\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" Math\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"floor\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// test = Record\u003cPropertyKey, Foo[]\u003e\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"This works by only letting you pass in functions that return \",(0,n.jsx)(e.code,{children:\"PropertyKey\"}),\", but typescript does not seem to narrow the types. In this case \",(0,n.jsx)(e.code,{children:\"test\"}),\" should be \",(0,n.jsx)(e.code,{children:\"Record\u003cnumber, Foo[]\u003e\"}),\" since TS \",(0,n.jsx)(e.em,{children:\"should\"}),\" infer the return type of the grouping function. If you know how to improve this function to make the return type narrow properly feel free to leave an issue/pr on my \",(0,n.jsx)(e.a,{href:\"https://github.com/JRMurr/JRMurr.github.io\",children:\"blog's GitHub\"}),\"!\"]})]})}}var b=w;function T(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return v;})();\n;return Component;","toc":[{"value":"Lodash's groupBy","url":"#lodashs-groupby","depth":2},{"value":"Making our own groupBy","url":"#making-our-own-groupby","depth":2},{"value":"Putting it all together","url":"#putting-it-all-together","depth":2},{"value":"Possible improvements","url":"#possible-improvements","depth":2}],"frontMatter":{"readingTime":{"text":"14 min read","minutes":14,"time":840000,"words":2800},"slug":"type-safe-groupby-in-typescript","fileName":"type-safe-groupby-in-typescript.md","title":"Type Safe GroupBy In TypeScript","date":"2022-05-25T00:00:00.000Z","tags":["typescript","types","code","guide"],"draft":false,"summary":"Create a better groupBy function that only allows valid keys to be grouped on","images":[],"layout":"PostLayout"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.215,"time":12900,"words":43},"slug":["default"],"fileName":"default.md","name":"John Murray","avatar":"/static/images/me.jpg","occupation":"Software Engineer","github":"https://github.com/JRMurr","date":null}],"prev":{"title":"Rust Environment and Docker Build with Nix Flakes","date":"2022-05-19T00:00:00.000Z","tags":["rust","nix","docker"],"draft":false,"summary":"Reproducible dev environments and builds with Nix","images":[],"layout":"PostLayout","slug":"rust-enviorment-and-docker-build-with-nix-flakes"},"next":null},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["type-safe-groupby-in-typescript"]},"buildId":"HJTizoWw6Yzbu-BQqJstJ","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>