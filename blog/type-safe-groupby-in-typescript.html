<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" content="#000000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>Type Safe GroupBy In TypeScript</title><meta name="robots" content="follow, index"/><meta name="description" content="Create a better groupBy function that only allows valid keys to be grouped on"/><meta property="og:url" content="https://johns.codes/blog/type-safe-groupby-in-typescript"/><meta property="og:type" content="article"/><meta property="og:site_name" content="John&#x27;s Codes"/><meta property="og:description" content="Create a better groupBy function that only allows valid keys to be grouped on"/><meta property="og:title" content="Type Safe GroupBy In TypeScript"/><meta property="og:image" content="https://johns.codes/static/images/twitter-card.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://twitter.com/JRMurrCodes"/><meta name="twitter:title" content="Type Safe GroupBy In TypeScript"/><meta name="twitter:description" content="Create a better groupBy function that only allows valid keys to be grouped on"/><meta name="twitter:image" content="https://johns.codes/static/images/twitter-card.png"/><meta property="article:published_time" content="2022-05-25T00:00:00.000Z"/><link rel="canonical" href="https://johns.codes/blog/type-safe-groupby-in-typescript"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://johns.codes/blog/type-safe-groupby-in-typescript"
  },
  "headline": "Type Safe GroupBy In TypeScript",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://johns.codes/static/images/twitter-card.png"
    }
  ],
  "datePublished": "2022-05-25T00:00:00.000Z",
  "dateModified": "2022-05-25T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "John Murray"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "John Murray",
    "logo": {
      "@type": "ImageObject",
      "url": "https://johns.codes/static/images/logo.png"
    }
  },
  "description": "Create a better groupBy function that only allows valid keys to be grouped on"
}</script><meta name="next-head-count" content="20"/><link rel="preload" href="/_next/static/css/ff7a91e18d57a2d6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ff7a91e18d57a2d6.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-a0fb203be75c9eb6.js" defer=""></script><script src="/_next/static/chunks/main-b77bb48dcc3828e6.js" defer=""></script><script src="/_next/static/chunks/pages/_app-861f57e6bedfde14.js" defer=""></script><script src="/_next/static/chunks/framework-327e104994690a53.js" defer=""></script><script src="/_next/static/chunks/675-374a5a75205d32da.js" defer=""></script><script src="/_next/static/chunks/266-365d5fff0af19ac8.js" defer=""></script><script src="/_next/static/chunks/545-446f5effbf4e5f11.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-c8a468ed53b4c5d2.js" defer=""></script><script src="/_next/static/s10FPnTlL5cwtRs3HC583/_buildManifest.js" defer=""></script><script src="/_next/static/s10FPnTlL5cwtRs3HC583/_ssgManifest.js" defer=""></script><script src="/_next/static/s10FPnTlL5cwtRs3HC583/_middlewareManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap">@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuFuYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body class="antialiased text-black bg-white dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex flex-col justify-between h-screen"><header class="flex items-center justify-between py-10"><div><a aria-label="John&#x27;s Codes" href="/"><div class="flex items-center justify-between"><div class="hidden h-6 text-2xl font-semibold sm:block">John&#x27;s Codes</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/projects">Projects</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="w-8 h-8 p-1 ml-1 mr-1 rounded sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="w-8 h-8 py-1 ml-1 mr-1 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed w-full h-full top-24 right-0 bg-gray-200 dark:bg-gray-800 opacity-95 z-10 transform ease-in-out duration-300 translate-x-full"><button type="button" aria-label="toggle modal" class="fixed w-full h-full cursor-auto focus:outline-none"></button><nav class="fixed h-full mt-8"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/projects">Projects</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed flex-col hidden gap-3 right-8 bottom-8 md:hidden"><button aria-label="Scroll To Comment" type="button" class="p-2 text-gray-500 transition-all bg-gray-200 rounded-full dark:text-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 hover:bg-gray-300"><svg class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="p-2 text-gray-500 transition-all bg-gray-200 rounded-full dark:text-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 hover:bg-gray-300"><svg class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-4 md:space-y-2 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="flex justify-center items-center text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2022-05-25T00:00:00.000Z">Wednesday, May 25, 2022</time><span class="mx-2">-</span><div class="flex items-center"><span class="ml-1">20 min read</span></div></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Type Safe GroupBy In TypeScript</h1></div></div></header><div class="pb-8 divide-y divide-gray-200 xl:divide-y-0 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6" style="grid-template-rows:auto 1fr"><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:pb-0 xl:col-span-4 xl:row-span-2"><div class="pt-10 pb-8 prose dark:prose-dark max-w-none"><details open=""><summary class="pt-2 pb-2 ml-6 text-xl font-bold">Table of Contents</summary><div class="ml-6"><ul><li class="false"><a href="#lodashs-groupby">Lodash&#x27;s groupBy</a></li><li class="false"><a href="#making-our-own-groupby">Making our own groupBy</a></li><li class="false"><a href="#putting-it-all-together">Putting it all together</a></li><li class="false"><a href="#possible-improvements">Possible improvements</a></li></ul></div></details>
<h2 id="lodashs-groupby"><a href="#lodashs-groupby" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Lodash&#x27;s groupBy</h2>
<p>I would bet if you have a sizeable Javascript/Typescript codebase you most likely are using <a target="_blank" rel="noopener noreferrer" href="https://lodash.com/">lodash</a> somewhere in there.
While Javascript has gotten more &quot;batteries included&quot; over the last few years, lodash still has many nice functions for manipulating arrays/objects.
One such function is <a target="_blank" rel="noopener noreferrer" href="https://lodash.com/docs/4.17.15#groupBy">groupBy</a>. It groups a list by some predicate, in the simplest case it can just be a key in the objects of the array.</p>

<div class="relative"><pre class="shiki dracula twoslash lsp"><div class="language-id">ts</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">import</span><span style="color:#F8F8F2"> <data-lsp lsp="(alias) namespace _
(alias) const _: import(&quot;/home/runner/work/JRMurr.github.io/JRMurr.github.io/node_modules/@types/lodash/index.d.ts&quot;).LoDashStatic
import _">_</data-lsp> </span><span style="color:#FF79C6">from</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">lodash</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2">;</span></div><div class="line"> </div><div class="line"><span style="color:#FF79C6">interface</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="interface Foo">Foo</data-lsp></span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">  <data-lsp lsp="(property) Foo.num: number">num</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">number</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">  <data-lsp lsp="(property) Foo.someLiteral: &quot;a&quot; | &quot;b&quot; | &quot;c&quot;">someLiteral</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">a</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">b</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">c</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">  <data-lsp lsp="(property) Foo.object: Record&lt;string, any&gt;">object</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type Record&lt;K extends string | number | symbol, T&gt; = { [P in K]: T; }">Record</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">string</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">any</span><span style="color:#F8F8F2">&gt;;</span></div><div class="line"><span style="color:#F8F8F2">}</span></div><div class="line"> </div><div class="line"><span style="color:#FF79C6">const</span><span style="color:#F8F8F2"> <data-lsp lsp="const vals: Foo[]">vals</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="interface Foo">Foo</data-lsp></span><span style="color:#F8F8F2">[] </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [</span></div><div class="line"><span style="color:#F8F8F2">  { <data-lsp lsp="(property) Foo.num: number">num</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">1</span><span style="color:#F8F8F2">, <data-lsp lsp="(property) Foo.someLiteral: &quot;a&quot; | &quot;b&quot; | &quot;c&quot;">someLiteral</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">a</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2">, <data-lsp lsp="(property) Foo.object: Record&lt;string, any&gt;">object</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> { <data-lsp lsp="(property) key: string">key</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">value</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2"> } },</span></div><div class="line"><span style="color:#F8F8F2">  { <data-lsp lsp="(property) Foo.num: number">num</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">2</span><span style="color:#F8F8F2">, <data-lsp lsp="(property) Foo.someLiteral: &quot;a&quot; | &quot;b&quot; | &quot;c&quot;">someLiteral</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">a</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2">, <data-lsp lsp="(property) Foo.object: Record&lt;string, any&gt;">object</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> { <data-lsp lsp="(property) key: string">key</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">diffValue</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2"> } },</span></div><div class="line"><span style="color:#F8F8F2">  { <data-lsp lsp="(property) Foo.num: number">num</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">1</span><span style="color:#F8F8F2">, <data-lsp lsp="(property) Foo.someLiteral: &quot;a&quot; | &quot;b&quot; | &quot;c&quot;">someLiteral</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">b</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2">, <data-lsp lsp="(property) Foo.object: Record&lt;string, any&gt;">object</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> {} },</span></div><div class="line"><span style="color:#F8F8F2">];</span></div><div class="line"> </div><div class="line"><span style="color:#F8F8F2"><data-lsp lsp="var console: Console">console</data-lsp>.</span><span style="color:#50FA7B"><data-lsp lsp="(method) Console.dir(item?: any, options?: any): void">dir</data-lsp></span><span style="color:#F8F8F2">(<data-lsp lsp="(alias) namespace _
(alias) const _: import(&quot;/home/runner/work/JRMurr.github.io/JRMurr.github.io/node_modules/@types/lodash/index.d.ts&quot;).LoDashStatic
import _">_</data-lsp>.</span><span style="color:#50FA7B"><data-lsp lsp="(method) LoDashStatic.groupBy&lt;Foo&gt;(collection: _.List&lt;Foo&gt; | null | undefined, iteratee?: _.ValueIteratee&lt;Foo&gt; | undefined): _.Dictionary&lt;Foo[]&gt; (+1 overload)">groupBy</data-lsp></span><span style="color:#F8F8F2">(<data-lsp lsp="const vals: Foo[]">vals</data-lsp>, </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">num</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2">));</span></div><div class="line"><span style="color:#6272A4">/*</span></div><div class="line"><span style="color:#6272A4">{</span></div><div class="line"><span style="color:#6272A4">  &#x27;1&#x27;: [ { num: 1, someLiteral: &#x27;a&#x27; }, { num: 1, someLiteral: &#x27;b&#x27; } ],</span></div><div class="line"><span style="color:#6272A4">  &#x27;2&#x27;: [ { num: 2, someLiteral: &#x27;a&#x27; } ]</span></div><div class="line"><span style="color:#6272A4">}</span></div><div class="line"><span style="color:#6272A4">*/</span></div><div class="line"><span style="color:#F8F8F2"><data-lsp lsp="var console: Console">console</data-lsp>.</span><span style="color:#50FA7B"><data-lsp lsp="(method) Console.dir(item?: any, options?: any): void">dir</data-lsp></span><span style="color:#F8F8F2">(<data-lsp lsp="(alias) namespace _
(alias) const _: import(&quot;/home/runner/work/JRMurr.github.io/JRMurr.github.io/node_modules/@types/lodash/index.d.ts&quot;).LoDashStatic
import _">_</data-lsp>.</span><span style="color:#50FA7B"><data-lsp lsp="(method) LoDashStatic.groupBy&lt;Foo&gt;(collection: _.List&lt;Foo&gt; | null | undefined, iteratee?: _.ValueIteratee&lt;Foo&gt; | undefined): _.Dictionary&lt;Foo[]&gt; (+1 overload)">groupBy</data-lsp></span><span style="color:#F8F8F2">(<data-lsp lsp="const vals: Foo[]">vals</data-lsp>, </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">someLiteral</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2">));</span></div><div class="line"><span style="color:#6272A4">/*</span></div><div class="line"><span style="color:#6272A4">{</span></div><div class="line"><span style="color:#6272A4">  a:[</span></div><div class="line"><span style="color:#6272A4">      { num: 1, someLiteral: &#x27;a&#x27;, object: [Object] },</span></div><div class="line"><span style="color:#6272A4">      { num: 2, someLiteral: &#x27;a&#x27;, object: [Object] }</span></div><div class="line"><span style="color:#6272A4">  ],</span></div><div class="line"><span style="color:#6272A4">  b: [ { num: 1, someLiteral: &#x27;b&#x27;, object: {} } ]</span></div><div class="line"><span style="color:#6272A4">}</span></div><div class="line"><span style="color:#6272A4">*/</span></div></code></div></pre></div>
<p>This all seems to make sense, you can set what key you want to group on, and you get back an object whose keys are the values for found in the input array of objects.</p>
<p>Now if you&#x27;re in a TypeScript code base I hope you are using the <a target="_blank" rel="noopener noreferrer" href="https://www.npmjs.com/package/@types/lodash">definitely typed lodash types</a> to add some types to the lodash functions.
In this case the <code>_.groupBy</code> type looks roughly like (simplified from the actual code)</p>
<div class="relative"><pre class="shiki dracula twoslash lsp"><div class="language-id">ts</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">declare</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">function</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B"><data-lsp lsp="function groupBy&lt;T&gt;(collection: Array&lt;T&gt;, key: string): Dictionary&lt;T[]&gt;">groupBy</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in groupBy&lt;T&gt;(collection: T[], key: string): Dictionary&lt;T[]&gt;">T</data-lsp></span><span style="color:#F8F8F2">&gt;(</span><span style="color:#FFB86C"><data-lsp lsp="(parameter) collection: T[]">collection</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="interface Array&lt;T&gt;">Array</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in groupBy&lt;T&gt;(collection: T[], key: string): Dictionary&lt;T[]&gt;">T</data-lsp></span><span style="color:#F8F8F2">&gt;, </span><span style="color:#FFB86C"><data-lsp lsp="(parameter) key: string">key</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">string</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="interface Dictionary&lt;T&gt;">Dictionary</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in groupBy&lt;T&gt;(collection: T[], key: string): Dictionary&lt;T[]&gt;">T</data-lsp></span><span style="color:#F8F8F2">[]&gt;;</span></div><div class="line"> </div><div class="line"><span style="color:#FF79C6">interface</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="interface Dictionary&lt;T&gt;">Dictionary</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in Dictionary&lt;T&gt;">T</data-lsp></span><span style="color:#F8F8F2">&gt; {</span></div><div class="line"><span style="color:#F8F8F2">  [</span><span style="color:#FFB86C"><data-lsp lsp="(parameter) index: string">index</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">string</span><span style="color:#F8F8F2">]</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="(type parameter) T in Dictionary&lt;T&gt;">T</data-lsp></span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>So a few things stick out here. First, the <code>key</code> type is just string, so there&#x27;s nothing stopping me from doing <code>_.groupBy(vals, &quot;someKeyThatDoesNotExist&quot;)</code>.
Second, we have no restrictions at the type level of me grouping on a key whose value is not a valid object key (the value must be a subset of <code>string | number | symbol</code>). For example in <code>Foo</code> the <code>object</code> key&#x27;s value was a record. Here&#x27;s what happens when you try to group on that key.</p>
<div class="relative"><pre class="shiki dracula twoslash lsp"><div class="language-id">ts</div><div class="code-container"><code><div class="line"><span style="color:#F8F8F2"><data-lsp lsp="var console: Console">console</data-lsp>.</span><span style="color:#50FA7B"><data-lsp lsp="(method) Console.dir(item?: any, options?: any): void">dir</data-lsp></span><span style="color:#F8F8F2">(<data-lsp lsp="(alias) namespace _
(alias) const _: import(&quot;/home/runner/work/JRMurr.github.io/JRMurr.github.io/node_modules/@types/lodash/index.d.ts&quot;).LoDashStatic
import _">_</data-lsp>.</span><span style="color:#50FA7B"><data-lsp lsp="(method) LoDashStatic.groupBy&lt;Foo&gt;(collection: _.List&lt;Foo&gt; | null | undefined, iteratee?: _.ValueIteratee&lt;Foo&gt; | undefined): _.Dictionary&lt;Foo[]&gt; (+1 overload)">groupBy</data-lsp></span><span style="color:#F8F8F2">(<data-lsp lsp="const vals: Foo[]">vals</data-lsp>, </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">object</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2">));</span></div><div class="line"><span style="color:#6272A4">/*</span></div><div class="line"><span style="color:#6272A4">{</span></div><div class="line"><span style="color:#6272A4">  &#x27;[object Object]&#x27;: [</span></div><div class="line"><span style="color:#6272A4">    { num: 1, someLiteral: &#x27;a&#x27;, object: [Object] },</span></div><div class="line"><span style="color:#6272A4">    { num: 2, someLiteral: &#x27;a&#x27;, object: [Object] },</span></div><div class="line"><span style="color:#6272A4">    { num: 1, someLiteral: &#x27;b&#x27;, object: {} }</span></div><div class="line"><span style="color:#6272A4">  ]</span></div><div class="line"><span style="color:#6272A4">}</span></div><div class="line"><span style="color:#6272A4">*/</span></div></code></div></pre></div>
<p>In this case the objects where coerced to string values so all elements of <code>vals</code> where grouped under the same weird <code>[object Object]</code> key. While this does not throw an error there is almost 0 chance you want this to happen in your code.</p>
<p>Finally, the return type of this function is <code>Dictionary</code>, while its &quot;right&quot; it could be &quot;more right&quot; by encoding that the returning object&#x27;s keys would be the values of the grouping key in the input object.</p>
<h2 id="making-our-own-groupby"><a href="#making-our-own-groupby" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Making our own groupBy</h2>
<p><em>insert Bender joke here</em></p>
<p>To start making our own type safe <code>groupBy</code>, we first need some code that actually does the grouping logic. Let&#x27;s start with that and some basic types.</p>
<div class="relative"><pre class="shiki dracula twoslash lsp"><div class="language-id">ts</div><div class="code-container"><code><div class="line"><span style="color:#6272A4">// Note: PropertyKey is a builtIn type alias of</span></div><div class="line"><span style="color:#6272A4">// type PropertyKey = string | number | symbol</span></div><div class="line"><span style="color:#6272A4">// This lets us use &quot;Record&lt;PropertyKey, any&gt;&quot; to represent any object</span></div><div class="line"><span style="color:#6272A4">// but is slightly nicer to use than the &quot;object&quot; type</span></div><div class="line"><span style="color:#FF79C6">function</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B"><data-lsp lsp="function simpleGroupBy&lt;T extends Record&lt;PropertyKey, any&gt;&gt;(arr: T[], key: keyof T): any">simpleGroupBy</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in simpleGroupBy&lt;T extends Record&lt;PropertyKey, any&gt;&gt;(arr: T[], key: keyof T): any">T</data-lsp></span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">extends</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C"><data-lsp lsp="type Record&lt;K extends string | number | symbol, T&gt; = { [P in K]: T; }">Record</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="type PropertyKey = string | number | symbol">PropertyKey</data-lsp></span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">any</span><span style="color:#F8F8F2">&gt;&gt;(</span><span style="color:#FFB86C"><data-lsp lsp="(parameter) arr: T[]">arr</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="(type parameter) T in simpleGroupBy&lt;T extends Record&lt;PropertyKey, any&gt;&gt;(arr: T[], key: keyof T): any">T</data-lsp></span><span style="color:#F8F8F2">[], </span><span style="color:#FFB86C"><data-lsp lsp="(parameter) key: keyof T">key</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">keyof</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="(type parameter) T in simpleGroupBy&lt;T extends Record&lt;PropertyKey, any&gt;&gt;(arr: T[], key: keyof T): any">T</data-lsp></span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">any</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#FF79C6">return</span><span style="color:#F8F8F2"> <data-lsp lsp="(parameter) arr: T[]">arr</data-lsp>.</span><span style="color:#50FA7B"><data-lsp lsp="(method) Array&lt;T&gt;.reduce&lt;any&gt;(callbackfn: (previousValue: any, currentValue: T, currentIndex: number, array: T[]) =&gt; any, initialValue: any): any (+2 overloads)">reduce</data-lsp></span><span style="color:#F8F8F2">((</span><span style="color:#FFB86C"><data-lsp lsp="(parameter) accumulator: any">accumulator</data-lsp></span><span style="color:#F8F8F2">, </span><span style="color:#FFB86C"><data-lsp lsp="(parameter) val: T extends Record&lt;PropertyKey, any&gt;">val</data-lsp></span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">const</span><span style="color:#F8F8F2"> <data-lsp lsp="const groupedKey: T[keyof T]">groupedKey</data-lsp> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> <data-lsp lsp="(parameter) val: T extends Record&lt;PropertyKey, any&gt;">val</data-lsp>[<data-lsp lsp="(parameter) key: keyof T">key</data-lsp>];</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">if</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">!</span><span style="color:#F8F8F2"><data-lsp lsp="(parameter) accumulator: any">accumulator</data-lsp>[<data-lsp lsp="const groupedKey: T[keyof T]">groupedKey</data-lsp>]) {</span></div><div class="line"><span style="color:#F8F8F2">      <data-lsp lsp="(parameter) accumulator: any">accumulator</data-lsp>[<data-lsp lsp="const groupedKey: T[keyof T]">groupedKey</data-lsp>] </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [];</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"><span style="color:#F8F8F2">    <data-lsp lsp="(parameter) accumulator: any">accumulator</data-lsp>[<data-lsp lsp="const groupedKey: T[keyof T]">groupedKey</data-lsp>].</span><span style="color:#50FA7B"><data-lsp lsp="any">push</data-lsp></span><span style="color:#F8F8F2">(<data-lsp lsp="(parameter) val: T extends Record&lt;PropertyKey, any&gt;">val</data-lsp>);</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">return</span><span style="color:#F8F8F2"> <data-lsp lsp="(parameter) accumulator: any">accumulator</data-lsp>;</span></div><div class="line"><span style="color:#F8F8F2">  }, {} </span><span style="color:#FF79C6">as</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">any</span><span style="color:#F8F8F2">);</span></div><div class="line"><span style="color:#F8F8F2">}</span></div><div class="line"> </div><div class="line"><span style="color:#F8F8F2"><data-lsp lsp="var console: Console">console</data-lsp>.</span><span style="color:#50FA7B"><data-lsp lsp="(method) Console.dir(item?: any, options?: any): void">dir</data-lsp></span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B"><data-lsp lsp="function simpleGroupBy&lt;Foo&gt;(arr: Foo[], key: keyof Foo): any">simpleGroupBy</data-lsp></span><span style="color:#F8F8F2">(<data-lsp lsp="const vals: Foo[]">vals</data-lsp>, </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">num</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2">));</span></div><div class="line"><span style="color:#6272A4">/*</span></div><div class="line"><span style="color:#6272A4">{</span></div><div class="line"><span style="color:#6272A4">  &#x27;1&#x27;: [</span></div><div class="line"><span style="color:#6272A4">    { num: 1, someLiteral: &#x27;a&#x27;, object: [Object] },</span></div><div class="line"><span style="color:#6272A4">    { num: 1, someLiteral: &#x27;b&#x27;, object: {} }</span></div><div class="line"><span style="color:#6272A4">  ],</span></div><div class="line"><span style="color:#6272A4">  &#x27;2&#x27;: [ { num: 2, someLiteral: &#x27;a&#x27;, object: [Object] } ]</span></div><div class="line"><span style="color:#6272A4">}</span></div><div class="line"><span style="color:#6272A4">*/</span></div></code></div></pre></div>
<p>Cool the logic here seems to work, but obviously the types could use some love.</p>
<p>Let&#x27;s start by adding a few more generics, so we can type the output correctly.
Your first change might be to make the return type <code>Record&lt;string, T[]&gt;</code> since the keys will be coerced to strings by JavaScript and the values will be the same values in the array.
This will unfortunately make typescript sad.</p>
<div class="relative"><pre class="shiki dracula twoslash lsp"><div class="language-id">ts</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">function</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B"><data-lsp lsp="function sadAttempt&lt;T extends object&gt;(arr: T[], key: keyof T): Record&lt;string, T[]&gt;">sadAttempt</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in sadAttempt&lt;T extends object&gt;(arr: T[], key: keyof T): Record&lt;string, T[]&gt;">T</data-lsp></span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">extends</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">object</span><span style="color:#F8F8F2">&gt;(</span><span style="color:#FFB86C"><data-lsp lsp="(parameter) arr: T[]">arr</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="(type parameter) T in sadAttempt&lt;T extends object&gt;(arr: T[], key: keyof T): Record&lt;string, T[]&gt;">T</data-lsp></span><span style="color:#F8F8F2">[], </span><span style="color:#FFB86C"><data-lsp lsp="(parameter) key: keyof T">key</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">keyof</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="(type parameter) T in sadAttempt&lt;T extends object&gt;(arr: T[], key: keyof T): Record&lt;string, T[]&gt;">T</data-lsp></span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type Record&lt;K extends string | number | symbol, T&gt; = { [P in K]: T; }">Record</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">string</span><span style="color:#F8F8F2">, </span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in sadAttempt&lt;T extends object&gt;(arr: T[], key: keyof T): Record&lt;string, T[]&gt;">T</data-lsp></span><span style="color:#F8F8F2">[]&gt; {</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#FF79C6">return</span><span style="color:#F8F8F2"> <data-lsp lsp="(parameter) arr: T[]">arr</data-lsp>.</span><span style="color:#50FA7B"><data-lsp lsp="(method) Array&lt;T&gt;.reduce&lt;Record&lt;string, T[]&gt;&gt;(callbackfn: (previousValue: Record&lt;string, T[]&gt;, currentValue: T, currentIndex: number, array: T[]) =&gt; Record&lt;string, T[]&gt;, initialValue: Record&lt;...&gt;): Record&lt;...&gt; (+2 overloads)">reduce</data-lsp></span><span style="color:#F8F8F2">((</span><span style="color:#FFB86C"><data-lsp lsp="(parameter) accumulator: Record&lt;string, T[]&gt;">accumulator</data-lsp></span><span style="color:#F8F8F2">, </span><span style="color:#FFB86C"><data-lsp lsp="(parameter) val: T extends object">val</data-lsp></span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">const</span><span style="color:#F8F8F2"> <data-lsp lsp="const groupedKey: T[keyof T]">groupedKey</data-lsp> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> <data-lsp lsp="(parameter) val: T extends object">val</data-lsp>[<data-lsp lsp="(parameter) key: keyof T">key</data-lsp>];</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">if</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">!</span><span style="color:#F8F8F2"><data-err><data-lsp lsp="(parameter) accumulator: Record&lt;string, T[]&gt;">accumulator</data-lsp>[<data-lsp lsp="const groupedKey: T[keyof T]">groupedKey</data-lsp></data-err>]) {</span></div><span class="error"><span>Type &#x27;T[keyof T]&#x27; cannot be used to index type &#x27;Record&lt;string, T[]&gt;&#x27;.</span><span class="code">2536</span></span><span class="error-behind">Type &#x27;T[keyof T]&#x27; cannot be used to index type &#x27;Record&lt;string, T[]&gt;&#x27;.</span><div class="line"><span style="color:#F8F8F2">      <data-err><data-lsp lsp="(parameter) accumulator: Record&lt;string, T[]&gt;">accumulator</data-lsp>[<data-lsp lsp="const groupedKey: T[keyof T]">groupedKey</data-lsp></data-err>] </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [];</span></div><span class="error"><span>Type &#x27;T[keyof T]&#x27; cannot be used to index type &#x27;Record&lt;string, T[]&gt;&#x27;.</span><span class="code">2536</span></span><span class="error-behind">Type &#x27;T[keyof T]&#x27; cannot be used to index type &#x27;Record&lt;string, T[]&gt;&#x27;.</span><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"><span style="color:#F8F8F2">    <data-err><data-lsp lsp="(parameter) accumulator: Record&lt;string, T[]&gt;">accumulator</data-lsp>[<data-lsp lsp="const groupedKey: T[keyof T]">groupedKey</data-lsp></data-err>].</span><span style="color:#50FA7B"><data-lsp lsp="any">push</data-lsp></span><span style="color:#F8F8F2">(<data-lsp lsp="(parameter) val: T extends object">val</data-lsp>);</span></div><span class="error"><span>Type &#x27;T[keyof T]&#x27; cannot be used to index type &#x27;Record&lt;string, T[]&gt;&#x27;.</span><span class="code">2536</span></span><span class="error-behind">Type &#x27;T[keyof T]&#x27; cannot be used to index type &#x27;Record&lt;string, T[]&gt;&#x27;.</span><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">return</span><span style="color:#F8F8F2"> <data-lsp lsp="(parameter) accumulator: Record&lt;string, T[]&gt;">accumulator</data-lsp>;</span></div><div class="line"><span style="color:#F8F8F2">  }, {} </span><span style="color:#FF79C6">as</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type Record&lt;K extends string | number | symbol, T&gt; = { [P in K]: T; }">Record</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">string</span><span style="color:#F8F8F2">, </span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in sadAttempt&lt;T extends object&gt;(arr: T[], key: keyof T): Record&lt;string, T[]&gt;">T</data-lsp></span><span style="color:#F8F8F2">[]&gt;);</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>The lines with <code>accumulator[groupedKey]</code> will error with <code>Type &#x27;T[keyof T]&#x27; cannot be used to index type &#x27;Record&lt;string, T&gt;&#x27;</code>. Here the <code>keyof T</code> could be any key in <code>T</code> so since not every key&#x27;s value in <code>T</code> is a string typescript will not let you treat <code>groupedKey</code> as a string.</p>
<p>We can almost fix this by adding some more information on the input key by binding it to a new generic parameter, though there will still be some issues.</p>
<div class="relative"><pre class="shiki dracula twoslash lsp"><div class="language-id">ts</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">function</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B"><data-lsp lsp="function betterSadAttempt&lt;T extends Record&lt;PropertyKey, any&gt;, Key extends keyof T&gt;(arr: T[], key: Key): Record&lt;T[Key], T[]&gt;">betterSadAttempt</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in betterSadAttempt&lt;T extends Record&lt;PropertyKey, any&gt;, Key extends keyof T&gt;(arr: T[], key: Key): Record&lt;T[Key], T[]&gt;">T</data-lsp></span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">extends</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C"><data-lsp lsp="type Record&lt;K extends string | number | symbol, T&gt; = { [P in K]: T; }">Record</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="type PropertyKey = string | number | symbol">PropertyKey</data-lsp></span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">any</span><span style="color:#F8F8F2">&gt;, </span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) Key in betterSadAttempt&lt;T extends Record&lt;PropertyKey, any&gt;, Key extends keyof T&gt;(arr: T[], key: Key): Record&lt;T[Key], T[]&gt;">Key</data-lsp></span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">extends</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">keyof</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in betterSadAttempt&lt;T extends Record&lt;PropertyKey, any&gt;, Key extends keyof T&gt;(arr: T[], key: Key): Record&lt;T[Key], T[]&gt;">T</data-lsp></span><span style="color:#F8F8F2">&gt;(</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#FFB86C"><data-lsp lsp="(parameter) arr: T[]">arr</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="(type parameter) T in betterSadAttempt&lt;T extends Record&lt;PropertyKey, any&gt;, Key extends keyof T&gt;(arr: T[], key: Key): Record&lt;T[Key], T[]&gt;">T</data-lsp></span><span style="color:#F8F8F2">[],</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#FFB86C"><data-lsp lsp="(parameter) key: Key extends keyof T">key</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="(type parameter) Key in betterSadAttempt&lt;T extends Record&lt;PropertyKey, any&gt;, Key extends keyof T&gt;(arr: T[], key: Key): Record&lt;T[Key], T[]&gt;">Key</data-lsp></span></div><div class="line"><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type Record&lt;K extends string | number | symbol, T&gt; = { [P in K]: T; }">Record</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in betterSadAttempt&lt;T extends Record&lt;PropertyKey, any&gt;, Key extends keyof T&gt;(arr: T[], key: Key): Record&lt;T[Key], T[]&gt;">T</data-lsp></span><span style="color:#F8F8F2">[</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) Key in betterSadAttempt&lt;T extends Record&lt;PropertyKey, any&gt;, Key extends keyof T&gt;(arr: T[], key: Key): Record&lt;T[Key], T[]&gt;">Key</data-lsp></span><span style="color:#F8F8F2">], </span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in betterSadAttempt&lt;T extends Record&lt;PropertyKey, any&gt;, Key extends keyof T&gt;(arr: T[], key: Key): Record&lt;T[Key], T[]&gt;">T</data-lsp></span><span style="color:#F8F8F2">[]&gt; {</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#FF79C6">return</span><span style="color:#F8F8F2"> <data-lsp lsp="(parameter) arr: T[]">arr</data-lsp>.</span><span style="color:#50FA7B"><data-lsp lsp="(method) Array&lt;T&gt;.reduce&lt;Record&lt;T[Key], T[]&gt;&gt;(callbackfn: (previousValue: Record&lt;T[Key], T[]&gt;, currentValue: T, currentIndex: number, array: T[]) =&gt; Record&lt;T[Key], T[]&gt;, initialValue: Record&lt;...&gt;): Record&lt;...&gt; (+2 overloads)">reduce</data-lsp></span><span style="color:#F8F8F2">((</span><span style="color:#FFB86C"><data-lsp lsp="(parameter) accumulator: Record&lt;T[Key], T[]&gt;">accumulator</data-lsp></span><span style="color:#F8F8F2">, </span><span style="color:#FFB86C"><data-lsp lsp="(parameter) val: T extends Record&lt;PropertyKey, any&gt;">val</data-lsp></span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">const</span><span style="color:#F8F8F2"> <data-lsp lsp="const groupedKey: T[Key]">groupedKey</data-lsp> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> <data-lsp lsp="(parameter) val: T extends Record&lt;PropertyKey, any&gt;">val</data-lsp>[<data-lsp lsp="(parameter) key: Key extends keyof T">key</data-lsp>];</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">if</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">!</span><span style="color:#F8F8F2"><data-lsp lsp="(parameter) accumulator: Record&lt;T[Key], T[]&gt;">accumulator</data-lsp>[<data-lsp lsp="const groupedKey: T[Key]">groupedKey</data-lsp>]) {</span></div><div class="line"><span style="color:#F8F8F2">      <data-lsp lsp="(parameter) accumulator: Record&lt;T[Key], T[]&gt;">accumulator</data-lsp>[<data-lsp lsp="const groupedKey: T[Key]">groupedKey</data-lsp>] </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [];</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"><span style="color:#F8F8F2">    <data-lsp lsp="(parameter) accumulator: Record&lt;T[Key], T[]&gt;">accumulator</data-lsp>[<data-lsp lsp="const groupedKey: T[Key]">groupedKey</data-lsp>].</span><span style="color:#50FA7B"><data-lsp lsp="(method) Array&lt;T&gt;.push(...items: T[]): number">push</data-lsp></span><span style="color:#F8F8F2">(<data-lsp lsp="(parameter) val: T extends Record&lt;PropertyKey, any&gt;">val</data-lsp>);</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">return</span><span style="color:#F8F8F2"> <data-lsp lsp="(parameter) accumulator: Record&lt;T[Key], T[]&gt;">accumulator</data-lsp>;</span></div><div class="line"><span style="color:#F8F8F2">  }, {} </span><span style="color:#FF79C6">as</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type Record&lt;K extends string | number | symbol, T&gt; = { [P in K]: T; }">Record</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in betterSadAttempt&lt;T extends Record&lt;PropertyKey, any&gt;, Key extends keyof T&gt;(arr: T[], key: Key): Record&lt;T[Key], T[]&gt;">T</data-lsp></span><span style="color:#F8F8F2">[</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) Key in betterSadAttempt&lt;T extends Record&lt;PropertyKey, any&gt;, Key extends keyof T&gt;(arr: T[], key: Key): Record&lt;T[Key], T[]&gt;">Key</data-lsp></span><span style="color:#F8F8F2">], </span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in betterSadAttempt&lt;T extends Record&lt;PropertyKey, any&gt;, Key extends keyof T&gt;(arr: T[], key: Key): Record&lt;T[Key], T[]&gt;">T</data-lsp></span><span style="color:#F8F8F2">[]&gt;);</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>Here we added a new generic <code>Key extends keyof T</code> so when we supply a specific key to the function, the Key generic will be narrowed to that value. For example if we did <code>betterSadAttempt(vals, &#x27;someLiteral&#x27;)</code>, <code>Key</code> would exactly be <code>&#x27;someLiteral&#x27;</code> instead of <code>keyof Foo = &#x27;someLiteral&#x27; | &#x27;num&#x27; | &#x27;object&#x27;</code></p>
<p>However, typescript is still sad on the <code>Record&lt;T[Key], T[]&gt;</code> lines with <code>Type &#x27;T[Key]&#x27; does not satisfy the constraint &#x27;string | number | symbol&#x27;</code>.
This error is similar to the error before, basically <code>T[Key]</code> can not be a key for the <code>Record</code> since it could be some weird value.</p>
<p>To accomplish this we need to make a helper type that filters down the allowed keys to only keys whose values are <code>string | number | symbol</code>.
We can use a <a target="_blank" rel="noopener noreferrer" href="https://www.typescriptlang.org/docs/handbook/2/mapped-types.html">mapped type</a> to do just that</p>
<div class="relative"><pre class="shiki dracula twoslash lsp"><div class="language-id">ts</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">type</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type MapValuesToKeysIfAllowed&lt;T&gt; = { [K in keyof T]: T[K] extends PropertyKey ? K : never; }">MapValuesToKeysIfAllowed</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in type MapValuesToKeysIfAllowed&lt;T&gt;">T</data-lsp></span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">  [</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) K">K</data-lsp></span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">in</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">keyof</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in type MapValuesToKeysIfAllowed&lt;T&gt;">T</data-lsp></span><span style="color:#F8F8F2">]</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="(type parameter) T in type MapValuesToKeysIfAllowed&lt;T&gt;">T</data-lsp></span><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD"><data-lsp lsp="(type parameter) K">K</data-lsp></span><span style="color:#F8F8F2">] </span><span style="color:#FF79C6">extends</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type PropertyKey = string | number | symbol">PropertyKey</data-lsp></span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="(type parameter) K">K</data-lsp></span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">never</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">};</span></div><div class="line"><span style="color:#FF79C6">type</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type Filter&lt;T&gt; = MapValuesToKeysIfAllowed&lt;T&gt;[keyof T]">Filter</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in type Filter&lt;T&gt;">T</data-lsp></span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type MapValuesToKeysIfAllowed&lt;T&gt; = { [K in keyof T]: T[K] extends PropertyKey ? K : never; }">MapValuesToKeysIfAllowed</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in type Filter&lt;T&gt;">T</data-lsp></span><span style="color:#F8F8F2">&gt;[</span><span style="color:#FF79C6">keyof</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="(type parameter) T in type Filter&lt;T&gt;">T</data-lsp></span><span style="color:#F8F8F2">];</span></div></code></div></pre></div>
<p>This type helper does a few things. First it maps over all the values in <code>T</code> (<code>[K in keyof T]</code>) and makes the value the key if it is a subset of <code>string | number | symbol</code> (<code>T[K] extends PropertyKey ? K</code>), if it&#x27;s not a subset its value will be the <code>never</code> type. Finally, we use an <a target="_blank" rel="noopener noreferrer" href="https://www.typescriptlang.org/docs/handbook/2/indexed-access-types.html">index access type</a> to get all values of the transformed object as a union. This step will drop all the <code>never</code> values automatically for us since adding <code>never</code> to a union is like saying <code>or false</code> its basically is a no op.</p>
<p>That was a mouthful so let&#x27;s see an example</p>
<div class="relative"><pre class="shiki dracula twoslash lsp"><div class="language-id">ts</div><div class="code-container"><code><div class="line"><span style="color:#6272A4">// from above</span></div><div class="line"><span style="color:#FF79C6">interface</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="interface Foo">Foo</data-lsp></span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">  <data-lsp lsp="(property) Foo.num: number">num</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">number</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">  <data-lsp lsp="(property) Foo.someLiteral: &quot;a&quot; | &quot;b&quot; | &quot;c&quot;">someLiteral</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">a</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">b</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">c</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">  <data-lsp lsp="(property) Foo.object: Record&lt;string, any&gt;">object</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type Record&lt;K extends string | number | symbol, T&gt; = { [P in K]: T; }">Record</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">string</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">any</span><span style="color:#F8F8F2">&gt;;</span></div><div class="line"><span style="color:#F8F8F2">}</span></div><div class="line"> </div><div class="line"><span style="color:#FF79C6">type</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type MappedFoo = {
    num: &quot;num&quot;;
    someLiteral: &quot;someLiteral&quot;;
    object: never;
}">MappedFoo</data-lsp></span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type MapValuesToKeysIfAllowed&lt;T&gt; = { [K in keyof T]: T[K] extends PropertyKey ? K : never; }">MapValuesToKeysIfAllowed</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="interface Foo">Foo</data-lsp></span><span style="color:#F8F8F2">&gt;;</span></div><div class="line"><span style="color:#6272A4">/*</span></div><div class="line"><span style="color:#6272A4">{</span></div><div class="line"><span style="color:#6272A4">  num: &quot;num&quot;;</span></div><div class="line"><span style="color:#6272A4">  someLiteral: &quot;someLiteral&quot;;</span></div><div class="line"><span style="color:#6272A4">  object: never;</span></div><div class="line"><span style="color:#6272A4">}</span></div><div class="line"><span style="color:#6272A4">*/</span></div><div class="line"><span style="color:#6272A4">// we replace the values of this object with just the key as a string literal or never</span></div><div class="line"> </div><div class="line"><span style="color:#FF79C6">type</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type FooKeys = &quot;num&quot; | &quot;someLiteral&quot;">FooKeys</data-lsp></span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type Filter&lt;T&gt; = MapValuesToKeysIfAllowed&lt;T&gt;[keyof T]">Filter</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="interface Foo">Foo</data-lsp></span><span style="color:#F8F8F2">&gt;;</span></div><div class="line"><span style="color:#6272A4">// =&gt; &quot;num&quot; | &quot;someLiteral&quot;</span></div><div class="line"><span style="color:#6272A4">// notice the never does not show up in the union</span></div><div class="line"> </div><div class="line"><span style="color:#FF79C6">interface</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="interface AllObjects">AllObjects</data-lsp></span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">  <data-lsp lsp="(property) AllObjects.object: Record&lt;string, any&gt;">object</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type Record&lt;K extends string | number | symbol, T&gt; = { [P in K]: T; }">Record</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">string</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">any</span><span style="color:#F8F8F2">&gt;;</span></div><div class="line"><span style="color:#F8F8F2">  <data-lsp lsp="(property) AllObjects.diffObject: Record&lt;number, any&gt;">diffObject</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type Record&lt;K extends string | number | symbol, T&gt; = { [P in K]: T; }">Record</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">number</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">any</span><span style="color:#F8F8F2">&gt;;</span></div><div class="line"><span style="color:#F8F8F2">}</span></div><div class="line"> </div><div class="line"><span style="color:#FF79C6">type</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type MappedAllObjects = {
    object: never;
    diffObject: never;
}">MappedAllObjects</data-lsp></span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type MapValuesToKeysIfAllowed&lt;T&gt; = { [K in keyof T]: T[K] extends PropertyKey ? K : never; }">MapValuesToKeysIfAllowed</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="interface AllObjects">AllObjects</data-lsp></span><span style="color:#F8F8F2">&gt;;</span></div><div class="line"><span style="color:#6272A4">/*</span></div><div class="line"><span style="color:#6272A4">{ </span></div><div class="line"><span style="color:#6272A4">  object: never;</span></div><div class="line"><span style="color:#6272A4">  diffObject: never;</span></div><div class="line"><span style="color:#6272A4">}</span></div><div class="line"><span style="color:#6272A4">*/</span></div><div class="line"> </div><div class="line"><span style="color:#FF79C6">type</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type AllObjectsKeys = never">AllObjectsKeys</data-lsp></span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type Filter&lt;T&gt; = MapValuesToKeysIfAllowed&lt;T&gt;[keyof T]">Filter</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="interface AllObjects">AllObjects</data-lsp></span><span style="color:#F8F8F2">&gt;;</span></div><div class="line"><span style="color:#6272A4">// =&gt; never</span></div><div class="line"><span style="color:#6272A4">// the output is only never. Think of this like saying &quot;false or false&quot;, the output will just be false</span></div></code></div></pre></div>
<p>With this filter type helper function we can now properly limit the <code>Key</code> generic by replacing <code>Key extends keyof T</code> with <code>Key extends Filter&lt;T&gt;</code>.</p>
<h2 id="putting-it-all-together"><a href="#putting-it-all-together" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Putting it all together</h2>
<div class="relative"><pre class="shiki dracula twoslash lsp"><div class="language-id">ts</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">type</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type MapValuesToKeysIfAllowed&lt;T&gt; = { [K in keyof T]: T[K] extends PropertyKey ? K : never; }">MapValuesToKeysIfAllowed</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in type MapValuesToKeysIfAllowed&lt;T&gt;">T</data-lsp></span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">  [</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) K">K</data-lsp></span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">in</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">keyof</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in type MapValuesToKeysIfAllowed&lt;T&gt;">T</data-lsp></span><span style="color:#F8F8F2">]</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="(type parameter) T in type MapValuesToKeysIfAllowed&lt;T&gt;">T</data-lsp></span><span style="color:#F8F8F2">[</span><span style="color:#8BE9FD"><data-lsp lsp="(type parameter) K">K</data-lsp></span><span style="color:#F8F8F2">] </span><span style="color:#FF79C6">extends</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type PropertyKey = string | number | symbol">PropertyKey</data-lsp></span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="(type parameter) K">K</data-lsp></span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">never</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">};</span></div><div class="line"><span style="color:#FF79C6">type</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type Filter&lt;T&gt; = MapValuesToKeysIfAllowed&lt;T&gt;[keyof T]">Filter</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in type Filter&lt;T&gt;">T</data-lsp></span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type MapValuesToKeysIfAllowed&lt;T&gt; = { [K in keyof T]: T[K] extends PropertyKey ? K : never; }">MapValuesToKeysIfAllowed</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in type Filter&lt;T&gt;">T</data-lsp></span><span style="color:#F8F8F2">&gt;[</span><span style="color:#FF79C6">keyof</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="(type parameter) T in type Filter&lt;T&gt;">T</data-lsp></span><span style="color:#F8F8F2">];</span></div><div class="line"> </div><div class="line"><span style="color:#FF79C6">function</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B"><data-lsp lsp="function groupBy&lt;T extends Record&lt;PropertyKey, any&gt;, Key extends Filter&lt;T&gt;&gt;(arr: T[], key: Key): Record&lt;T[Key], T[]&gt;">groupBy</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in groupBy&lt;T extends Record&lt;PropertyKey, any&gt;, Key extends Filter&lt;T&gt;&gt;(arr: T[], key: Key): Record&lt;T[Key], T[]&gt;">T</data-lsp></span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">extends</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C"><data-lsp lsp="type Record&lt;K extends string | number | symbol, T&gt; = { [P in K]: T; }">Record</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="type PropertyKey = string | number | symbol">PropertyKey</data-lsp></span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">any</span><span style="color:#F8F8F2">&gt;, </span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) Key in groupBy&lt;T extends Record&lt;PropertyKey, any&gt;, Key extends Filter&lt;T&gt;&gt;(arr: T[], key: Key): Record&lt;T[Key], T[]&gt;">Key</data-lsp></span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">extends</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C"><data-lsp lsp="type Filter&lt;T&gt; = MapValuesToKeysIfAllowed&lt;T&gt;[keyof T]">Filter</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in groupBy&lt;T extends Record&lt;PropertyKey, any&gt;, Key extends Filter&lt;T&gt;&gt;(arr: T[], key: Key): Record&lt;T[Key], T[]&gt;">T</data-lsp></span><span style="color:#F8F8F2">&gt;&gt;(</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#FFB86C"><data-lsp lsp="(parameter) arr: T[]">arr</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="(type parameter) T in groupBy&lt;T extends Record&lt;PropertyKey, any&gt;, Key extends Filter&lt;T&gt;&gt;(arr: T[], key: Key): Record&lt;T[Key], T[]&gt;">T</data-lsp></span><span style="color:#F8F8F2">[],</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#FFB86C"><data-lsp lsp="(parameter) key: Key extends Filter&lt;T&gt;">key</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="(type parameter) Key in groupBy&lt;T extends Record&lt;PropertyKey, any&gt;, Key extends Filter&lt;T&gt;&gt;(arr: T[], key: Key): Record&lt;T[Key], T[]&gt;">Key</data-lsp></span></div><div class="line"><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type Record&lt;K extends string | number | symbol, T&gt; = { [P in K]: T; }">Record</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in groupBy&lt;T extends Record&lt;PropertyKey, any&gt;, Key extends Filter&lt;T&gt;&gt;(arr: T[], key: Key): Record&lt;T[Key], T[]&gt;">T</data-lsp></span><span style="color:#F8F8F2">[</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) Key in groupBy&lt;T extends Record&lt;PropertyKey, any&gt;, Key extends Filter&lt;T&gt;&gt;(arr: T[], key: Key): Record&lt;T[Key], T[]&gt;">Key</data-lsp></span><span style="color:#F8F8F2">], </span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in groupBy&lt;T extends Record&lt;PropertyKey, any&gt;, Key extends Filter&lt;T&gt;&gt;(arr: T[], key: Key): Record&lt;T[Key], T[]&gt;">T</data-lsp></span><span style="color:#F8F8F2">[]&gt; {</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#FF79C6">return</span><span style="color:#F8F8F2"> <data-lsp lsp="(parameter) arr: T[]">arr</data-lsp>.</span><span style="color:#50FA7B"><data-lsp lsp="(method) Array&lt;T&gt;.reduce&lt;Record&lt;T[Key], T[]&gt;&gt;(callbackfn: (previousValue: Record&lt;T[Key], T[]&gt;, currentValue: T, currentIndex: number, array: T[]) =&gt; Record&lt;T[Key], T[]&gt;, initialValue: Record&lt;...&gt;): Record&lt;...&gt; (+2 overloads)">reduce</data-lsp></span><span style="color:#F8F8F2">((</span><span style="color:#FFB86C"><data-lsp lsp="(parameter) accumulator: Record&lt;T[Key], T[]&gt;">accumulator</data-lsp></span><span style="color:#F8F8F2">, </span><span style="color:#FFB86C"><data-lsp lsp="(parameter) val: T extends Record&lt;PropertyKey, any&gt;">val</data-lsp></span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">const</span><span style="color:#F8F8F2"> <data-lsp lsp="const groupedKey: T[Key]">groupedKey</data-lsp> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> <data-lsp lsp="(parameter) val: T extends Record&lt;PropertyKey, any&gt;">val</data-lsp>[<data-lsp lsp="(parameter) key: Key extends Filter&lt;T&gt;">key</data-lsp>];</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">if</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">!</span><span style="color:#F8F8F2"><data-lsp lsp="(parameter) accumulator: Record&lt;T[Key], T[]&gt;">accumulator</data-lsp>[<data-lsp lsp="const groupedKey: T[Key]">groupedKey</data-lsp>]) {</span></div><div class="line"><span style="color:#F8F8F2">      <data-lsp lsp="(parameter) accumulator: Record&lt;T[Key], T[]&gt;">accumulator</data-lsp>[<data-lsp lsp="const groupedKey: T[Key]">groupedKey</data-lsp>] </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [];</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"><span style="color:#F8F8F2">    <data-lsp lsp="(parameter) accumulator: Record&lt;T[Key], T[]&gt;">accumulator</data-lsp>[<data-lsp lsp="const groupedKey: T[Key]">groupedKey</data-lsp>].</span><span style="color:#50FA7B"><data-lsp lsp="(method) Array&lt;T&gt;.push(...items: T[]): number">push</data-lsp></span><span style="color:#F8F8F2">(<data-lsp lsp="(parameter) val: T extends Record&lt;PropertyKey, any&gt;">val</data-lsp>);</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">return</span><span style="color:#F8F8F2"> <data-lsp lsp="(parameter) accumulator: Record&lt;T[Key], T[]&gt;">accumulator</data-lsp>;</span></div><div class="line"><span style="color:#F8F8F2">  }, {} </span><span style="color:#FF79C6">as</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type Record&lt;K extends string | number | symbol, T&gt; = { [P in K]: T; }">Record</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in groupBy&lt;T extends Record&lt;PropertyKey, any&gt;, Key extends Filter&lt;T&gt;&gt;(arr: T[], key: Key): Record&lt;T[Key], T[]&gt;">T</data-lsp></span><span style="color:#F8F8F2">[</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) Key in groupBy&lt;T extends Record&lt;PropertyKey, any&gt;, Key extends Filter&lt;T&gt;&gt;(arr: T[], key: Key): Record&lt;T[Key], T[]&gt;">Key</data-lsp></span><span style="color:#F8F8F2">], </span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in groupBy&lt;T extends Record&lt;PropertyKey, any&gt;, Key extends Filter&lt;T&gt;&gt;(arr: T[], key: Key): Record&lt;T[Key], T[]&gt;">T</data-lsp></span><span style="color:#F8F8F2">[]&gt;);</span></div><div class="line"><span style="color:#F8F8F2">}</span></div><div class="line"> </div><div class="line"><span style="color:#FF79C6">const</span><span style="color:#F8F8F2"> <data-lsp lsp="const nums: Record&lt;number, Foo[]&gt;">nums</data-lsp> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B"><data-lsp lsp="function groupBy&lt;Foo, &quot;num&quot;&gt;(arr: Foo[], key: &quot;num&quot;): Record&lt;number, Foo[]&gt;">groupBy</data-lsp></span><span style="color:#F8F8F2">(<data-lsp lsp="const vals: Foo[]">vals</data-lsp>, </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">num</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2">);</span></div><div class="line"><span style="color:#6272A4">// nums = Record&lt;number, Foo[]&gt;</span></div><div class="line"> </div><div class="line"><span style="color:#FF79C6">const</span><span style="color:#F8F8F2"> <data-lsp lsp="const literals: Record&lt;&quot;a&quot; | &quot;b&quot; | &quot;c&quot;, Foo[]&gt;">literals</data-lsp> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B"><data-lsp lsp="function groupBy&lt;Foo, &quot;someLiteral&quot;&gt;(arr: Foo[], key: &quot;someLiteral&quot;): Record&lt;&quot;a&quot; | &quot;b&quot; | &quot;c&quot;, Foo[]&gt;">groupBy</data-lsp></span><span style="color:#F8F8F2">(<data-lsp lsp="const vals: Foo[]">vals</data-lsp>, </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">someLiteral</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2">);</span></div><div class="line"><span style="color:#6272A4">// literals = Record&lt;&quot;a&quot; | &quot;b&quot; | &quot;c&quot;, Foo[]&gt;</span></div><div class="line"> </div><div class="line"><span style="color:#FF79C6">const</span><span style="color:#F8F8F2"> <data-lsp lsp="const sad: Record&lt;number | &quot;a&quot; | &quot;b&quot; | &quot;c&quot;, Foo[]&gt;">sad</data-lsp> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B"><data-lsp lsp="function groupBy&lt;Foo, Filter&lt;Foo&gt;&gt;(arr: Foo[], key: Filter&lt;Foo&gt;): Record&lt;number | &quot;a&quot; | &quot;b&quot; | &quot;c&quot;, Foo[]&gt;">groupBy</data-lsp></span><span style="color:#F8F8F2">(<data-lsp lsp="const vals: Foo[]">vals</data-lsp>, </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">object</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2">);</span></div><span class="error"><span>Argument of type &#x27;&quot;object&quot;&#x27; is not assignable to parameter of type &#x27;Filter&lt;Foo&gt;&#x27;.</span><span class="code">2345</span></span><span class="error-behind">Argument of type &#x27;&quot;object&quot;&#x27; is not assignable to parameter of type &#x27;Filter&lt;Foo&gt;&#x27;.</span></code></div></pre></div>
<p>Now this works great, we can only pass in keys that have valid values, and we even get autocomplete on it! However, one thing that bothers me is the error message in the last case.
While it&#x27;s correct, saying <code>not assignable to parameter of type &#x27;Filter&lt;Foo&gt;&#x27;</code> is not very useful to a user. This pops up sometimes with typescript where it won&#x27;t show the underlying type and instead just show the higher level type helper instead.</p>
<p>To make the error message show the valid keys we can use a modified version of <a target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/a/57683652">this &quot;hack&quot;</a>. Here instead of creating the <code>Expand</code> type in the post, we can make our own <code>ValuesOf</code> to replace the <code>[keyof T]</code> at the end of <code>Filter</code></p>
<div class="relative"><pre class="shiki dracula twoslash lsp"><div class="language-id">ts</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">type</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type ValuesOf&lt;A&gt; = A extends infer O ? A[keyof A] : never">ValuesOf</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) A in type ValuesOf&lt;A&gt;">A</data-lsp></span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="(type parameter) A in type ValuesOf&lt;A&gt;">A</data-lsp></span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">extends</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">infer</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="(type parameter) O">O</data-lsp></span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="(type parameter) A in type ValuesOf&lt;A&gt;">A</data-lsp></span><span style="color:#F8F8F2">[</span><span style="color:#FF79C6">keyof</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="(type parameter) A in type ValuesOf&lt;A&gt;">A</data-lsp></span><span style="color:#F8F8F2">] </span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">never</span><span style="color:#F8F8F2">;</span></div><div class="line"> </div><div class="line"><span style="color:#FF79C6">type</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type Filter&lt;T&gt; = MapValuesToKeysIfAllowed&lt;T&gt; extends infer O ? (O &amp; MapValuesToKeysIfAllowed&lt;T&gt;)[keyof T | keyof O] : never">Filter</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in type Filter&lt;T&gt;">T</data-lsp></span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type ValuesOf&lt;A&gt; = A extends infer O ? A[keyof A] : never">ValuesOf</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="type MapValuesToKeysIfAllowed&lt;T&gt; = { [K in keyof T]: T[K] extends PropertyKey ? K : never; }">MapValuesToKeysIfAllowed</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in type Filter&lt;T&gt;">T</data-lsp></span><span style="color:#F8F8F2">&gt;&gt;;</span></div><div class="line"><span style="color:#6272A4">// was Filter&lt;T&gt; = MapValuesToKeysIfAllowed&lt;T&gt;[keyof T]</span></div><div class="line"> </div><div class="line"><span style="color:#FF79C6">const</span><span style="color:#F8F8F2"> <data-lsp lsp="const sad: Record&lt;number | &quot;a&quot; | &quot;b&quot; | &quot;c&quot;, Foo[]&gt;">sad</data-lsp> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B"><data-lsp lsp="function groupBy&lt;Foo, &quot;num&quot; | &quot;someLiteral&quot;&gt;(arr: Foo[], key: &quot;num&quot; | &quot;someLiteral&quot;): Record&lt;number | &quot;a&quot; | &quot;b&quot; | &quot;c&quot;, Foo[]&gt;">groupBy</data-lsp></span><span style="color:#F8F8F2">(<data-lsp lsp="const vals: Foo[]">vals</data-lsp>, </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">object</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2">);</span></div><span class="error"><span>Argument of type &#x27;&quot;object&quot;&#x27; is not assignable to parameter of type &#x27;&quot;num&quot; | &quot;someLiteral&quot;&#x27;.</span><span class="code">2345</span></span><span class="error-behind">Argument of type &#x27;&quot;object&quot;&#x27; is not assignable to parameter of type &#x27;&quot;num&quot; | &quot;someLiteral&quot;&#x27;.</span></code></div></pre></div>
<p>Now we have type safety and good error messages!</p>
<h2 id="possible-improvements"><a href="#possible-improvements" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Possible improvements</h2>
<p>One thing this <code>groupBy</code> function lacks that the lodash <code>groupBy</code> gives is we do not allow you to pass a function instead of a key to group on.
The example in the lodash docs is</p>
<div class="relative"><pre class="shiki dracula twoslash lsp"><div class="language-id">ts</div><div class="code-container"><code><div class="line"><span style="color:#F8F8F2"><data-lsp lsp="(alias) namespace _
(alias) const _: import(&quot;/home/runner/work/JRMurr.github.io/JRMurr.github.io/node_modules/@types/lodash/index.d.ts&quot;).LoDashStatic
import _">_</data-lsp>.</span><span style="color:#50FA7B"><data-lsp lsp="(method) LoDashStatic.groupBy&lt;number&gt;(collection: _.List&lt;number&gt; | null | undefined, iteratee?: _.ValueIteratee&lt;number&gt; | undefined): _.Dictionary&lt;number[]&gt; (+1 overload)">groupBy</data-lsp></span><span style="color:#F8F8F2">([</span><span style="color:#BD93F9">6.1</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">4.2</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">6.3</span><span style="color:#F8F8F2">], </span><span style="color:#BD93F9"><data-lsp lsp="var Math: Math">Math</data-lsp></span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD"><data-lsp lsp="(method) Math.floor(x: number): number">floor</data-lsp></span><span style="color:#F8F8F2">);</span></div><div class="line"><span style="color:#6272A4">// { &#x27;4&#x27;: [4.2], &#x27;6&#x27;: [6.1, 6.3] }</span></div></code></div></pre></div>
<p>While this is not perfect this mostly works</p>
<div class="relative"><pre class="shiki dracula twoslash lsp"><div class="language-id">ts</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">function</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B"><data-lsp lsp="function groupByFunc&lt;RetType extends PropertyKey, T, Func extends (arg: T) =&gt; RetType&gt;(arr: T[], mapper: Func): Record&lt;RetType, T[]&gt;">groupByFunc</data-lsp></span><span style="color:#F8F8F2">&lt;</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) RetType in groupByFunc&lt;RetType extends PropertyKey, T, Func extends (arg: T) =&gt; RetType&gt;(arr: T[], mapper: Func): Record&lt;RetType, T[]&gt;">RetType</data-lsp></span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">extends</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C"><data-lsp lsp="type PropertyKey = string | number | symbol">PropertyKey</data-lsp></span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in groupByFunc&lt;RetType extends PropertyKey, T, Func extends (arg: T) =&gt; RetType&gt;(arr: T[], mapper: Func): Record&lt;RetType, T[]&gt;">T</data-lsp></span><span style="color:#F8F8F2">, </span><span style="color:#6272A4">// no longer need any requirements on T since the grouper can do w/e it wants</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) Func in groupByFunc&lt;RetType extends PropertyKey, T, Func extends (arg: T) =&gt; RetType&gt;(arr: T[], mapper: Func): Record&lt;RetType, T[]&gt;">Func</data-lsp></span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">extends</span><span style="color:#F8F8F2"> (</span><span style="color:#FFB86C"><data-lsp lsp="(parameter) arg: T">arg</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in groupByFunc&lt;RetType extends PropertyKey, T, Func extends (arg: T) =&gt; RetType&gt;(arr: T[], mapper: Func): Record&lt;RetType, T[]&gt;">T</data-lsp></span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) RetType in groupByFunc&lt;RetType extends PropertyKey, T, Func extends (arg: T) =&gt; RetType&gt;(arr: T[], mapper: Func): Record&lt;RetType, T[]&gt;">RetType</data-lsp></span></div><div class="line"><span style="color:#F8F8F2">&gt;(</span><span style="color:#FFB86C"><data-lsp lsp="(parameter) arr: T[]">arr</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="(type parameter) T in groupByFunc&lt;RetType extends PropertyKey, T, Func extends (arg: T) =&gt; RetType&gt;(arr: T[], mapper: Func): Record&lt;RetType, T[]&gt;">T</data-lsp></span><span style="color:#F8F8F2">[], </span><span style="color:#FFB86C"><data-lsp lsp="(parameter) mapper: Func extends (arg: T) =&gt; RetType">mapper</data-lsp></span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="(type parameter) Func in groupByFunc&lt;RetType extends PropertyKey, T, Func extends (arg: T) =&gt; RetType&gt;(arr: T[], mapper: Func): Record&lt;RetType, T[]&gt;">Func</data-lsp></span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type Record&lt;K extends string | number | symbol, T&gt; = { [P in K]: T; }">Record</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) RetType in groupByFunc&lt;RetType extends PropertyKey, T, Func extends (arg: T) =&gt; RetType&gt;(arr: T[], mapper: Func): Record&lt;RetType, T[]&gt;">RetType</data-lsp></span><span style="color:#F8F8F2">, </span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in groupByFunc&lt;RetType extends PropertyKey, T, Func extends (arg: T) =&gt; RetType&gt;(arr: T[], mapper: Func): Record&lt;RetType, T[]&gt;">T</data-lsp></span><span style="color:#F8F8F2">[]&gt; {</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#FF79C6">return</span><span style="color:#F8F8F2"> <data-lsp lsp="(parameter) arr: T[]">arr</data-lsp>.</span><span style="color:#50FA7B"><data-lsp lsp="(method) Array&lt;T&gt;.reduce&lt;Record&lt;RetType, T[]&gt;&gt;(callbackfn: (previousValue: Record&lt;RetType, T[]&gt;, currentValue: T, currentIndex: number, array: T[]) =&gt; Record&lt;RetType, T[]&gt;, initialValue: Record&lt;...&gt;): Record&lt;...&gt; (+2 overloads)">reduce</data-lsp></span><span style="color:#F8F8F2">((</span><span style="color:#FFB86C"><data-lsp lsp="(parameter) accumulator: Record&lt;RetType, T[]&gt;">accumulator</data-lsp></span><span style="color:#F8F8F2">, </span><span style="color:#FFB86C"><data-lsp lsp="(parameter) val: T">val</data-lsp></span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">const</span><span style="color:#F8F8F2"> <data-lsp lsp="const groupedKey: RetType extends PropertyKey">groupedKey</data-lsp> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B"><data-lsp lsp="(parameter) mapper: Func
(arg: T) =&gt; RetType">mapper</data-lsp></span><span style="color:#F8F8F2">(<data-lsp lsp="(parameter) val: T">val</data-lsp>);</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">if</span><span style="color:#F8F8F2"> (</span><span style="color:#FF79C6">!</span><span style="color:#F8F8F2"><data-lsp lsp="(parameter) accumulator: Record&lt;RetType, T[]&gt;">accumulator</data-lsp>[<data-lsp lsp="const groupedKey: RetType extends PropertyKey">groupedKey</data-lsp>]) {</span></div><div class="line"><span style="color:#F8F8F2">      <data-lsp lsp="(parameter) accumulator: Record&lt;RetType, T[]&gt;">accumulator</data-lsp>[<data-lsp lsp="const groupedKey: RetType extends PropertyKey">groupedKey</data-lsp>] </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [];</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"><span style="color:#F8F8F2">    <data-lsp lsp="(parameter) accumulator: Record&lt;RetType, T[]&gt;">accumulator</data-lsp>[<data-lsp lsp="const groupedKey: RetType extends PropertyKey">groupedKey</data-lsp>].</span><span style="color:#50FA7B"><data-lsp lsp="(method) Array&lt;T&gt;.push(...items: T[]): number">push</data-lsp></span><span style="color:#F8F8F2">(<data-lsp lsp="(parameter) val: T">val</data-lsp>);</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">return</span><span style="color:#F8F8F2"> <data-lsp lsp="(parameter) accumulator: Record&lt;RetType, T[]&gt;">accumulator</data-lsp>;</span></div><div class="line"><span style="color:#F8F8F2">  }, {} </span><span style="color:#FF79C6">as</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD"><data-lsp lsp="type Record&lt;K extends string | number | symbol, T&gt; = { [P in K]: T; }">Record</data-lsp></span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) RetType in groupByFunc&lt;RetType extends PropertyKey, T, Func extends (arg: T) =&gt; RetType&gt;(arr: T[], mapper: Func): Record&lt;RetType, T[]&gt;">RetType</data-lsp></span><span style="color:#F8F8F2">, </span><span style="color:#FFB86C"><data-lsp lsp="(type parameter) T in groupByFunc&lt;RetType extends PropertyKey, T, Func extends (arg: T) =&gt; RetType&gt;(arr: T[], mapper: Func): Record&lt;RetType, T[]&gt;">T</data-lsp></span><span style="color:#F8F8F2">[]&gt;);</span></div><div class="line"><span style="color:#F8F8F2">}</span></div><div class="line"> </div><div class="line"><span style="color:#FF79C6">const</span><span style="color:#F8F8F2"> <data-lsp lsp="const test: Record&lt;PropertyKey, number[]&gt;">test</data-lsp> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B"><data-lsp lsp="function groupByFunc&lt;PropertyKey, number, (x: number) =&gt; number&gt;(arr: number[], mapper: (x: number) =&gt; number): Record&lt;PropertyKey, number[]&gt;">groupByFunc</data-lsp></span><span style="color:#F8F8F2">([</span><span style="color:#BD93F9">6.1</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">4.2</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">6.3</span><span style="color:#F8F8F2">], </span><span style="color:#BD93F9"><data-lsp lsp="var Math: Math">Math</data-lsp></span><span style="color:#F8F8F2">.</span><span style="color:#8BE9FD"><data-lsp lsp="(method) Math.floor(x: number): number">floor</data-lsp></span><span style="color:#F8F8F2">);</span></div><div class="line"><span style="color:#6272A4">// test = Record&lt;PropertyKey, Foo[]&gt;</span></div></code></div></pre></div>
<p>This works by only letting you pass in functions that return <code>PropertyKey</code>, but typescript does not seem to narrow the types. In this case <code>test</code> should be <code>Record&lt;number, Foo[]&gt;</code> since TS <em>should</em> infer the return type of the grouping function. If you know how to improve this function to make the return type narrow properly feel free to leave an issue/pr on my <a target="_blank" rel="noopener noreferrer" href="https://github.com/JRMurr/JRMurr.github.io">blog&#x27;s GitHub</a>!</p></div></div></div></div></article></div></main><footer><div class="flex flex-col items-center mt-16"><div class="flex mb-3 space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer me" href="https://github.com/JRMurr"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer me" href="https://twitter.com/JRMurrCodes"><span class="sr-only">twitter</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M23.953 4.57a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.06a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.936 4.936 0 0 0 4.604 3.417 9.867 9.867 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0 0 24 4.59z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer me" href="https://hachyderm.io/@jrmurr"><span class="sr-only">mastodon</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-8 w-8"><path d="M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer me" href="/feed.xml"><span class="sr-only">rss</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24.912 24.912" style="enable-background:new 0 0 24.912 24.912" xml:space="preserve" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M3.692 17.517A3.696 3.696 0 0 0 0 21.211C0 23.244 1.656 24.9 3.692 24.9s3.694-1.657 3.694-3.689a3.697 3.697 0 0 0-3.694-3.694z"></path><path d="M.384 8.142A.386.386 0 0 0 0 8.527v4.688c0 .211.173.383.384.383 6.02 0 10.919 4.898 10.919 10.92 0 .209.171.383.384.383h4.705a.385.385 0 0 0 .387-.383l-.018-.121C16.692 15.423 9.37 8.142.384 8.142z"></path><path d="M24.89 24.397C24.825 10.936 13.854.011.384.011A.385.385 0 0 0 0 .397v4.824c0 .212.173.383.384.383 10.429 0 18.913 8.486 18.913 18.914 0 .209.172.383.382.383h4.845a.39.39 0 0 0 .388-.383l-.022-.121z"></path></svg></a></div><div class="flex mb-2 space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>John Murray</div><div> • </div><div>© 2023</div><div> • </div><a href="/">John&#x27;s Codes</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var i=Object.create;var c=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var y=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty;var a=r=\u003ec(r,\"__esModule\",{value:!0});var m=(r,n)=\u003e()=\u003e(n||r((n={exports:{}}).exports,n),n.exports),u=(r,n)=\u003e{a(r);for(var s in n)c(r,s,{get:n[s],enumerable:!0})},T=(r,n,s)=\u003e{if(n\u0026\u0026typeof n==\"object\"||typeof n==\"function\")for(let l of F(n))!h.call(r,l)\u0026\u0026l!==\"default\"\u0026\u0026c(r,l,{get:()=\u003en[l],enumerable:!(s=p(n,l))||s.enumerable});return r},v=r=\u003eT(a(c(r!=null?i(y(r)):{},\"default\",r\u0026\u0026r.__esModule\u0026\u0026\"default\"in r?{get:()=\u003er.default,enumerable:!0}:{value:r,enumerable:!0})),r);var d=m((R,t)=\u003e{t.exports=_jsx_runtime});var f={};u(f,{default:()=\u003eb,frontmatter:()=\u003eK});var e=v(d()),K={title:\"Type Safe GroupBy In TypeScript\",date:\"2022-05-25\",tags:[\"typescript\",\"types\",\"code\",\"guide\"],draft:!1,summary:\"Create a better groupBy function that only allows valid keys to be grouped on\",images:[],layout:\"PostLayout\"};function g(r={}){let{wrapper:n}=r.components||{};return n?(0,e.jsx)(n,Object.assign({},r,{children:(0,e.jsx)(s,{})})):s();function s(){let l=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",pre:\"pre\",div:\"div\",code:\"code\",\"data-lsp\":\"data-lsp\",em:\"em\",\"data-err\":\"data-err\"},r.components),{TOCInline:o}=l;return o||C(\"TOCInline\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(o,{toc:r.toc,asDisclosure:!0}),`\n`,(0,e.jsxs)(l.h2,{id:\"lodashs-groupby\",children:[(0,e.jsx)(l.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#lodashs-groupby\",children:(0,e.jsx)(l.span,{className:\"icon icon-link\"})}),\"Lodash's groupBy\"]}),`\n`,(0,e.jsxs)(l.p,{children:[\"I would bet if you have a sizeable Javascript/Typescript codebase you most likely are using \",(0,e.jsx)(l.a,{href:\"https://lodash.com/\",children:\"lodash\"}),` somewhere in there.\nWhile Javascript has gotten more \"batteries included\" over the last few years, lodash still has many nice functions for manipulating arrays/objects.\nOne such function is `,(0,e.jsx)(l.a,{href:\"https://lodash.com/docs/4.17.15#groupBy\",children:\"groupBy\"}),\". It groups a list by some predicate, in the simplest case it can just be a key in the objects of the array.\"]}),`\n\n`,(0,e.jsxs)(l.pre,{className:\"shiki dracula twoslash lsp\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,e.jsx)(l.div,{className:\"language-id\",children:\"ts\"}),(0,e.jsx)(l.div,{className:\"code-container\",children:(0,e.jsxs)(l.code,{children:[(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"import\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\" \",(0,e.jsx)(l[\"data-lsp\"],{lsp:`(alias) namespace _\n(alias) const _: import(\"/home/runner/work/JRMurr.github.io/JRMurr.github.io/node_modules/@types/lodash/index.d.ts\").LoDashStatic\nimport _`,children:\"_\"}),\" \"]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"from\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F1FA8C\"},children:\"lodash\"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:\"\\xA0\"}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"interface\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"interface Foo\",children:\"Foo\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"  \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(property) Foo.num: number\",children:\"num\"})]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:\"number\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"  \",(0,e.jsx)(l[\"data-lsp\"],{lsp:'(property) Foo.someLiteral: \"a\" | \"b\" | \"c\"',children:\"someLiteral\"})]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F1FA8C\"},children:\"a\"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F1FA8C\"},children:\"b\"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F1FA8C\"},children:\"c\"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"  \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(property) Foo.object: Record\u003cstring, any\u003e\",children:\"object\"})]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type Record\u003cK extends string | number | symbol, T\u003e = { [P in K]: T; }\",children:\"Record\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:\"string\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:\"any\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003e;\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"}\"})}),(0,e.jsx)(l.div,{className:\"line\",children:\"\\xA0\"}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"const\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\" \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const vals: Foo[]\",children:\"vals\"})]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"interface Foo\",children:\"Foo\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"[] \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" [\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"  { \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(property) Foo.num: number\",children:\"num\"})]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#BD93F9\"},children:\"1\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\", \",(0,e.jsx)(l[\"data-lsp\"],{lsp:'(property) Foo.someLiteral: \"a\" | \"b\" | \"c\"',children:\"someLiteral\"})]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F1FA8C\"},children:\"a\"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\", \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(property) Foo.object: Record\u003cstring, any\u003e\",children:\"object\"})]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\" { \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(property) key: string\",children:\"key\"})]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F1FA8C\"},children:\"value\"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" } },\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"  { \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(property) Foo.num: number\",children:\"num\"})]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#BD93F9\"},children:\"2\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\", \",(0,e.jsx)(l[\"data-lsp\"],{lsp:'(property) Foo.someLiteral: \"a\" | \"b\" | \"c\"',children:\"someLiteral\"})]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F1FA8C\"},children:\"a\"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\", \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(property) Foo.object: Record\u003cstring, any\u003e\",children:\"object\"})]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\" { \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(property) key: string\",children:\"key\"})]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F1FA8C\"},children:\"diffValue\"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" } },\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"  { \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(property) Foo.num: number\",children:\"num\"})]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#BD93F9\"},children:\"1\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\", \",(0,e.jsx)(l[\"data-lsp\"],{lsp:'(property) Foo.someLiteral: \"a\" | \"b\" | \"c\"',children:\"someLiteral\"})]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F1FA8C\"},children:\"b\"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\", \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(property) Foo.object: Record\u003cstring, any\u003e\",children:\"object\"})]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" {} },\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"];\"})}),(0,e.jsx)(l.div,{className:\"line\",children:\"\\xA0\"}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[(0,e.jsx)(l[\"data-lsp\"],{lsp:\"var console: Console\",children:\"console\"}),\".\"]}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(method) Console.dir(item?: any, options?: any): void\",children:\"dir\"})}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"(\",(0,e.jsx)(l[\"data-lsp\"],{lsp:`(alias) namespace _\n(alias) const _: import(\"/home/runner/work/JRMurr.github.io/JRMurr.github.io/node_modules/@types/lodash/index.d.ts\").LoDashStatic\nimport _`,children:\"_\"}),\".\"]}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(method) LoDashStatic.groupBy\u003cFoo\u003e(collection: _.List\u003cFoo\u003e | null | undefined, iteratee?: _.ValueIteratee\u003cFoo\u003e | undefined): _.Dictionary\u003cFoo[]\u003e (+1 overload)\",children:\"groupBy\"})}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"(\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const vals: Foo[]\",children:\"vals\"}),\", \"]}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F1FA8C\"},children:\"num\"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"));\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"/*\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"{\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"  '1': [ { num: 1, someLiteral: 'a' }, { num: 1, someLiteral: 'b' } ],\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"  '2': [ { num: 2, someLiteral: 'a' } ]\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"}\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"*/\"})}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[(0,e.jsx)(l[\"data-lsp\"],{lsp:\"var console: Console\",children:\"console\"}),\".\"]}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(method) Console.dir(item?: any, options?: any): void\",children:\"dir\"})}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"(\",(0,e.jsx)(l[\"data-lsp\"],{lsp:`(alias) namespace _\n(alias) const _: import(\"/home/runner/work/JRMurr.github.io/JRMurr.github.io/node_modules/@types/lodash/index.d.ts\").LoDashStatic\nimport _`,children:\"_\"}),\".\"]}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(method) LoDashStatic.groupBy\u003cFoo\u003e(collection: _.List\u003cFoo\u003e | null | undefined, iteratee?: _.ValueIteratee\u003cFoo\u003e | undefined): _.Dictionary\u003cFoo[]\u003e (+1 overload)\",children:\"groupBy\"})}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"(\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const vals: Foo[]\",children:\"vals\"}),\", \"]}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F1FA8C\"},children:\"someLiteral\"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"));\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"/*\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"{\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"  a:[\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"      { num: 1, someLiteral: 'a', object: [Object] },\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"      { num: 2, someLiteral: 'a', object: [Object] }\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"  ],\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"  b: [ { num: 1, someLiteral: 'b', object: {} } ]\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"}\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"*/\"})})]})})]}),`\n`,(0,e.jsx)(l.p,{children:\"This all seems to make sense, you can set what key you want to group on, and you get back an object whose keys are the values for found in the input array of objects.\"}),`\n`,(0,e.jsxs)(l.p,{children:[\"Now if you're in a TypeScript code base I hope you are using the \",(0,e.jsx)(l.a,{href:\"https://www.npmjs.com/package/@types/lodash\",children:\"definitely typed lodash types\"}),` to add some types to the lodash functions.\nIn this case the `,(0,e.jsx)(l.code,{children:\"_.groupBy\"}),\" type looks roughly like (simplified from the actual code)\"]}),`\n`,(0,e.jsxs)(l.pre,{className:\"shiki dracula twoslash lsp\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,e.jsx)(l.div,{className:\"language-id\",children:\"ts\"}),(0,e.jsx)(l.div,{className:\"code-container\",children:(0,e.jsxs)(l.code,{children:[(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"declare\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"function\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"function groupBy\u003cT\u003e(collection: Array\u003cT\u003e, key: string): Dictionary\u003cT[]\u003e\",children:\"groupBy\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in groupBy\u003cT\u003e(collection: T[], key: string): Dictionary\u003cT[]\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003e(\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) collection: T[]\",children:\"collection\"})}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"interface Array\u003cT\u003e\",children:\"Array\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in groupBy\u003cT\u003e(collection: T[], key: string): Dictionary\u003cT[]\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003e, \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) key: string\",children:\"key\"})}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:\"string\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"interface Dictionary\u003cT\u003e\",children:\"Dictionary\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in groupBy\u003cT\u003e(collection: T[], key: string): Dictionary\u003cT[]\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"[]\u003e;\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:\"\\xA0\"}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"interface\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"interface Dictionary\u003cT\u003e\",children:\"Dictionary\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in Dictionary\u003cT\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003e {\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"  [\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) index: string\",children:\"index\"})}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:\"string\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"]\"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in Dictionary\u003cT\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,e.jsxs)(l.p,{children:[\"So a few things stick out here. First, the \",(0,e.jsx)(l.code,{children:\"key\"}),\" type is just string, so there's nothing stopping me from doing \",(0,e.jsx)(l.code,{children:'_.groupBy(vals, \"someKeyThatDoesNotExist\")'}),`.\nSecond, we have no restrictions at the type level of me grouping on a key whose value is not a valid object key (the value must be a subset of `,(0,e.jsx)(l.code,{children:\"string | number | symbol\"}),\"). For example in \",(0,e.jsx)(l.code,{children:\"Foo\"}),\" the \",(0,e.jsx)(l.code,{children:\"object\"}),\" key's value was a record. Here's what happens when you try to group on that key.\"]}),`\n`,(0,e.jsxs)(l.pre,{className:\"shiki dracula twoslash lsp\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,e.jsx)(l.div,{className:\"language-id\",children:\"ts\"}),(0,e.jsx)(l.div,{className:\"code-container\",children:(0,e.jsxs)(l.code,{children:[(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[(0,e.jsx)(l[\"data-lsp\"],{lsp:\"var console: Console\",children:\"console\"}),\".\"]}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(method) Console.dir(item?: any, options?: any): void\",children:\"dir\"})}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"(\",(0,e.jsx)(l[\"data-lsp\"],{lsp:`(alias) namespace _\n(alias) const _: import(\"/home/runner/work/JRMurr.github.io/JRMurr.github.io/node_modules/@types/lodash/index.d.ts\").LoDashStatic\nimport _`,children:\"_\"}),\".\"]}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(method) LoDashStatic.groupBy\u003cFoo\u003e(collection: _.List\u003cFoo\u003e | null | undefined, iteratee?: _.ValueIteratee\u003cFoo\u003e | undefined): _.Dictionary\u003cFoo[]\u003e (+1 overload)\",children:\"groupBy\"})}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"(\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const vals: Foo[]\",children:\"vals\"}),\", \"]}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F1FA8C\"},children:\"object\"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"));\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"/*\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"{\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"  '[object Object]': [\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"    { num: 1, someLiteral: 'a', object: [Object] },\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"    { num: 2, someLiteral: 'a', object: [Object] },\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"    { num: 1, someLiteral: 'b', object: {} }\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"  ]\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"}\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"*/\"})})]})})]}),`\n`,(0,e.jsxs)(l.p,{children:[\"In this case the objects where coerced to string values so all elements of \",(0,e.jsx)(l.code,{children:\"vals\"}),\" where grouped under the same weird \",(0,e.jsx)(l.code,{children:\"[object Object]\"}),\" key. While this does not throw an error there is almost 0 chance you want this to happen in your code.\"]}),`\n`,(0,e.jsxs)(l.p,{children:[\"Finally, the return type of this function is \",(0,e.jsx)(l.code,{children:\"Dictionary\"}),`, while its \"right\" it could be \"more right\" by encoding that the returning object's keys would be the values of the grouping key in the input object.`]}),`\n`,(0,e.jsxs)(l.h2,{id:\"making-our-own-groupby\",children:[(0,e.jsx)(l.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#making-our-own-groupby\",children:(0,e.jsx)(l.span,{className:\"icon icon-link\"})}),\"Making our own groupBy\"]}),`\n`,(0,e.jsx)(l.p,{children:(0,e.jsx)(l.em,{children:\"insert Bender joke here\"})}),`\n`,(0,e.jsxs)(l.p,{children:[\"To start making our own type safe \",(0,e.jsx)(l.code,{children:\"groupBy\"}),\", we first need some code that actually does the grouping logic. Let's start with that and some basic types.\"]}),`\n`,(0,e.jsxs)(l.pre,{className:\"shiki dracula twoslash lsp\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,e.jsx)(l.div,{className:\"language-id\",children:\"ts\"}),(0,e.jsx)(l.div,{className:\"code-container\",children:(0,e.jsxs)(l.code,{children:[(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"// Note: PropertyKey is a builtIn type alias of\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"// type PropertyKey = string | number | symbol\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:'// This lets us use \"Record\u003cPropertyKey, any\u003e\" to represent any object'})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:'// but is slightly nicer to use than the \"object\" type'})}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"function\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"function simpleGroupBy\u003cT extends Record\u003cPropertyKey, any\u003e\u003e(arr: T[], key: keyof T): any\",children:\"simpleGroupBy\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in simpleGroupBy\u003cT extends Record\u003cPropertyKey, any\u003e\u003e(arr: T[], key: keyof T): any\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"extends\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type Record\u003cK extends string | number | symbol, T\u003e = { [P in K]: T; }\",children:\"Record\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type PropertyKey = string | number | symbol\",children:\"PropertyKey\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:\"any\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003e\u003e(\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) arr: T[]\",children:\"arr\"})}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in simpleGroupBy\u003cT extends Record\u003cPropertyKey, any\u003e\u003e(arr: T[], key: keyof T): any\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"[], \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) key: keyof T\",children:\"key\"})}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"keyof\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in simpleGroupBy\u003cT extends Record\u003cPropertyKey, any\u003e\u003e(arr: T[], key: keyof T): any\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:\"any\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"return\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\" \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) arr: T[]\",children:\"arr\"}),\".\"]}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(method) Array\u003cT\u003e.reduce\u003cany\u003e(callbackfn: (previousValue: any, currentValue: T, currentIndex: number, array: T[]) =\u003e any, initialValue: any): any (+2 overloads)\",children:\"reduce\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"((\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) accumulator: any\",children:\"accumulator\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) val: T extends Record\u003cPropertyKey, any\u003e\",children:\"val\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"const\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\" \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const groupedKey: T[keyof T]\",children:\"groupedKey\"}),\" \"]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\" \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) val: T extends Record\u003cPropertyKey, any\u003e\",children:\"val\"}),\"[\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) key: keyof T\",children:\"key\"}),\"];\"]})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"if\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" (\"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"!\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) accumulator: any\",children:\"accumulator\"}),\"[\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const groupedKey: T[keyof T]\",children:\"groupedKey\"}),\"]) {\"]})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"      \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) accumulator: any\",children:\"accumulator\"}),\"[\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const groupedKey: T[keyof T]\",children:\"groupedKey\"}),\"] \"]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" [];\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"    \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) accumulator: any\",children:\"accumulator\"}),\"[\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const groupedKey: T[keyof T]\",children:\"groupedKey\"}),\"].\"]}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"any\",children:\"push\"})}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"(\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) val: T extends Record\u003cPropertyKey, any\u003e\",children:\"val\"}),\");\"]})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"return\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\" \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) accumulator: any\",children:\"accumulator\"}),\";\"]})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"  }, {} \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"as\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:\"any\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\");\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"}\"})}),(0,e.jsx)(l.div,{className:\"line\",children:\"\\xA0\"}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[(0,e.jsx)(l[\"data-lsp\"],{lsp:\"var console: Console\",children:\"console\"}),\".\"]}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(method) Console.dir(item?: any, options?: any): void\",children:\"dir\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"function simpleGroupBy\u003cFoo\u003e(arr: Foo[], key: keyof Foo): any\",children:\"simpleGroupBy\"})}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"(\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const vals: Foo[]\",children:\"vals\"}),\", \"]}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F1FA8C\"},children:\"num\"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"));\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"/*\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"{\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"  '1': [\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"    { num: 1, someLiteral: 'a', object: [Object] },\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"    { num: 1, someLiteral: 'b', object: {} }\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"  ],\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"  '2': [ { num: 2, someLiteral: 'a', object: [Object] } ]\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"}\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"*/\"})})]})})]}),`\n`,(0,e.jsx)(l.p,{children:\"Cool the logic here seems to work, but obviously the types could use some love.\"}),`\n`,(0,e.jsxs)(l.p,{children:[`Let's start by adding a few more generics, so we can type the output correctly.\nYour first change might be to make the return type `,(0,e.jsx)(l.code,{children:\"Record\u003cstring, T[]\u003e\"}),` since the keys will be coerced to strings by JavaScript and the values will be the same values in the array.\nThis will unfortunately make typescript sad.`]}),`\n`,(0,e.jsxs)(l.pre,{className:\"shiki dracula twoslash lsp\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,e.jsx)(l.div,{className:\"language-id\",children:\"ts\"}),(0,e.jsx)(l.div,{className:\"code-container\",children:(0,e.jsxs)(l.code,{children:[(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"function\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"function sadAttempt\u003cT extends object\u003e(arr: T[], key: keyof T): Record\u003cstring, T[]\u003e\",children:\"sadAttempt\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in sadAttempt\u003cT extends object\u003e(arr: T[], key: keyof T): Record\u003cstring, T[]\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"extends\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:\"object\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003e(\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) arr: T[]\",children:\"arr\"})}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in sadAttempt\u003cT extends object\u003e(arr: T[], key: keyof T): Record\u003cstring, T[]\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"[], \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) key: keyof T\",children:\"key\"})}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"keyof\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in sadAttempt\u003cT extends object\u003e(arr: T[], key: keyof T): Record\u003cstring, T[]\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type Record\u003cK extends string | number | symbol, T\u003e = { [P in K]: T; }\",children:\"Record\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:\"string\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in sadAttempt\u003cT extends object\u003e(arr: T[], key: keyof T): Record\u003cstring, T[]\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"[]\u003e {\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"return\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\" \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) arr: T[]\",children:\"arr\"}),\".\"]}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(method) Array\u003cT\u003e.reduce\u003cRecord\u003cstring, T[]\u003e\u003e(callbackfn: (previousValue: Record\u003cstring, T[]\u003e, currentValue: T, currentIndex: number, array: T[]) =\u003e Record\u003cstring, T[]\u003e, initialValue: Record\u003c...\u003e): Record\u003c...\u003e (+2 overloads)\",children:\"reduce\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"((\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) accumulator: Record\u003cstring, T[]\u003e\",children:\"accumulator\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) val: T extends object\",children:\"val\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"const\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\" \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const groupedKey: T[keyof T]\",children:\"groupedKey\"}),\" \"]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\" \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) val: T extends object\",children:\"val\"}),\"[\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) key: keyof T\",children:\"key\"}),\"];\"]})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"if\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" (\"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"!\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[(0,e.jsxs)(l[\"data-err\"],{children:[(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) accumulator: Record\u003cstring, T[]\u003e\",children:\"accumulator\"}),\"[\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const groupedKey: T[keyof T]\",children:\"groupedKey\"})]}),\"]) {\"]})]}),(0,e.jsxs)(l.span,{className:\"error\",children:[(0,e.jsx)(l.span,{children:\"Type 'T[keyof T]' cannot be used to index type 'Record\u003cstring, T[]\u003e'.\"}),(0,e.jsx)(l.span,{className:\"code\",children:\"2536\"})]}),(0,e.jsx)(l.span,{className:\"error-behind\",children:\"Type 'T[keyof T]' cannot be used to index type 'Record\u003cstring, T[]\u003e'.\"}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"      \",(0,e.jsxs)(l[\"data-err\"],{children:[(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) accumulator: Record\u003cstring, T[]\u003e\",children:\"accumulator\"}),\"[\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const groupedKey: T[keyof T]\",children:\"groupedKey\"})]}),\"] \"]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" [];\"})]}),(0,e.jsxs)(l.span,{className:\"error\",children:[(0,e.jsx)(l.span,{children:\"Type 'T[keyof T]' cannot be used to index type 'Record\u003cstring, T[]\u003e'.\"}),(0,e.jsx)(l.span,{className:\"code\",children:\"2536\"})]}),(0,e.jsx)(l.span,{className:\"error-behind\",children:\"Type 'T[keyof T]' cannot be used to index type 'Record\u003cstring, T[]\u003e'.\"}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"    \",(0,e.jsxs)(l[\"data-err\"],{children:[(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) accumulator: Record\u003cstring, T[]\u003e\",children:\"accumulator\"}),\"[\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const groupedKey: T[keyof T]\",children:\"groupedKey\"})]}),\"].\"]}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"any\",children:\"push\"})}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"(\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) val: T extends object\",children:\"val\"}),\");\"]})]}),(0,e.jsxs)(l.span,{className:\"error\",children:[(0,e.jsx)(l.span,{children:\"Type 'T[keyof T]' cannot be used to index type 'Record\u003cstring, T[]\u003e'.\"}),(0,e.jsx)(l.span,{className:\"code\",children:\"2536\"})]}),(0,e.jsx)(l.span,{className:\"error-behind\",children:\"Type 'T[keyof T]' cannot be used to index type 'Record\u003cstring, T[]\u003e'.\"}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"return\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\" \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) accumulator: Record\u003cstring, T[]\u003e\",children:\"accumulator\"}),\";\"]})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"  }, {} \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"as\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type Record\u003cK extends string | number | symbol, T\u003e = { [P in K]: T; }\",children:\"Record\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:\"string\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in sadAttempt\u003cT extends object\u003e(arr: T[], key: keyof T): Record\u003cstring, T[]\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"[]\u003e);\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,e.jsxs)(l.p,{children:[\"The lines with \",(0,e.jsx)(l.code,{children:\"accumulator[groupedKey]\"}),\" will error with \",(0,e.jsx)(l.code,{children:\"Type 'T[keyof T]' cannot be used to index type 'Record\u003cstring, T\u003e'\"}),\". Here the \",(0,e.jsx)(l.code,{children:\"keyof T\"}),\" could be any key in \",(0,e.jsx)(l.code,{children:\"T\"}),\" so since not every key's value in \",(0,e.jsx)(l.code,{children:\"T\"}),\" is a string typescript will not let you treat \",(0,e.jsx)(l.code,{children:\"groupedKey\"}),\" as a string.\"]}),`\n`,(0,e.jsx)(l.p,{children:\"We can almost fix this by adding some more information on the input key by binding it to a new generic parameter, though there will still be some issues.\"}),`\n`,(0,e.jsxs)(l.pre,{className:\"shiki dracula twoslash lsp\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,e.jsx)(l.div,{className:\"language-id\",children:\"ts\"}),(0,e.jsx)(l.div,{className:\"code-container\",children:(0,e.jsxs)(l.code,{children:[(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"function\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"function betterSadAttempt\u003cT extends Record\u003cPropertyKey, any\u003e, Key extends keyof T\u003e(arr: T[], key: Key): Record\u003cT[Key], T[]\u003e\",children:\"betterSadAttempt\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in betterSadAttempt\u003cT extends Record\u003cPropertyKey, any\u003e, Key extends keyof T\u003e(arr: T[], key: Key): Record\u003cT[Key], T[]\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"extends\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type Record\u003cK extends string | number | symbol, T\u003e = { [P in K]: T; }\",children:\"Record\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type PropertyKey = string | number | symbol\",children:\"PropertyKey\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:\"any\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003e, \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) Key in betterSadAttempt\u003cT extends Record\u003cPropertyKey, any\u003e, Key extends keyof T\u003e(arr: T[], key: Key): Record\u003cT[Key], T[]\u003e\",children:\"Key\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"extends\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"keyof\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in betterSadAttempt\u003cT extends Record\u003cPropertyKey, any\u003e, Key extends keyof T\u003e(arr: T[], key: Key): Record\u003cT[Key], T[]\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003e(\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) arr: T[]\",children:\"arr\"})}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in betterSadAttempt\u003cT extends Record\u003cPropertyKey, any\u003e, Key extends keyof T\u003e(arr: T[], key: Key): Record\u003cT[Key], T[]\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"[],\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) key: Key extends keyof T\",children:\"key\"})}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) Key in betterSadAttempt\u003cT extends Record\u003cPropertyKey, any\u003e, Key extends keyof T\u003e(arr: T[], key: Key): Record\u003cT[Key], T[]\u003e\",children:\"Key\"})})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type Record\u003cK extends string | number | symbol, T\u003e = { [P in K]: T; }\",children:\"Record\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in betterSadAttempt\u003cT extends Record\u003cPropertyKey, any\u003e, Key extends keyof T\u003e(arr: T[], key: Key): Record\u003cT[Key], T[]\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"[\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) Key in betterSadAttempt\u003cT extends Record\u003cPropertyKey, any\u003e, Key extends keyof T\u003e(arr: T[], key: Key): Record\u003cT[Key], T[]\u003e\",children:\"Key\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"], \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in betterSadAttempt\u003cT extends Record\u003cPropertyKey, any\u003e, Key extends keyof T\u003e(arr: T[], key: Key): Record\u003cT[Key], T[]\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"[]\u003e {\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"return\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\" \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) arr: T[]\",children:\"arr\"}),\".\"]}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(method) Array\u003cT\u003e.reduce\u003cRecord\u003cT[Key], T[]\u003e\u003e(callbackfn: (previousValue: Record\u003cT[Key], T[]\u003e, currentValue: T, currentIndex: number, array: T[]) =\u003e Record\u003cT[Key], T[]\u003e, initialValue: Record\u003c...\u003e): Record\u003c...\u003e (+2 overloads)\",children:\"reduce\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"((\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) accumulator: Record\u003cT[Key], T[]\u003e\",children:\"accumulator\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) val: T extends Record\u003cPropertyKey, any\u003e\",children:\"val\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"const\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\" \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const groupedKey: T[Key]\",children:\"groupedKey\"}),\" \"]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\" \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) val: T extends Record\u003cPropertyKey, any\u003e\",children:\"val\"}),\"[\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) key: Key extends keyof T\",children:\"key\"}),\"];\"]})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"if\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" (\"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"!\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) accumulator: Record\u003cT[Key], T[]\u003e\",children:\"accumulator\"}),\"[\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const groupedKey: T[Key]\",children:\"groupedKey\"}),\"]) {\"]})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"      \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) accumulator: Record\u003cT[Key], T[]\u003e\",children:\"accumulator\"}),\"[\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const groupedKey: T[Key]\",children:\"groupedKey\"}),\"] \"]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" [];\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"    \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) accumulator: Record\u003cT[Key], T[]\u003e\",children:\"accumulator\"}),\"[\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const groupedKey: T[Key]\",children:\"groupedKey\"}),\"].\"]}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(method) Array\u003cT\u003e.push(...items: T[]): number\",children:\"push\"})}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"(\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) val: T extends Record\u003cPropertyKey, any\u003e\",children:\"val\"}),\");\"]})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"return\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\" \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) accumulator: Record\u003cT[Key], T[]\u003e\",children:\"accumulator\"}),\";\"]})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"  }, {} \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"as\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type Record\u003cK extends string | number | symbol, T\u003e = { [P in K]: T; }\",children:\"Record\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in betterSadAttempt\u003cT extends Record\u003cPropertyKey, any\u003e, Key extends keyof T\u003e(arr: T[], key: Key): Record\u003cT[Key], T[]\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"[\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) Key in betterSadAttempt\u003cT extends Record\u003cPropertyKey, any\u003e, Key extends keyof T\u003e(arr: T[], key: Key): Record\u003cT[Key], T[]\u003e\",children:\"Key\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"], \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in betterSadAttempt\u003cT extends Record\u003cPropertyKey, any\u003e, Key extends keyof T\u003e(arr: T[], key: Key): Record\u003cT[Key], T[]\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"[]\u003e);\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,e.jsxs)(l.p,{children:[\"Here we added a new generic \",(0,e.jsx)(l.code,{children:\"Key extends keyof T\"}),\" so when we supply a specific key to the function, the Key generic will be narrowed to that value. For example if we did \",(0,e.jsx)(l.code,{children:\"betterSadAttempt(vals, 'someLiteral')\"}),\", \",(0,e.jsx)(l.code,{children:\"Key\"}),\" would exactly be \",(0,e.jsx)(l.code,{children:\"'someLiteral'\"}),\" instead of \",(0,e.jsx)(l.code,{children:\"keyof Foo = 'someLiteral' | 'num' | 'object'\"})]}),`\n`,(0,e.jsxs)(l.p,{children:[\"However, typescript is still sad on the \",(0,e.jsx)(l.code,{children:\"Record\u003cT[Key], T[]\u003e\"}),\" lines with \",(0,e.jsx)(l.code,{children:\"Type 'T[Key]' does not satisfy the constraint 'string | number | symbol'\"}),`.\nThis error is similar to the error before, basically `,(0,e.jsx)(l.code,{children:\"T[Key]\"}),\" can not be a key for the \",(0,e.jsx)(l.code,{children:\"Record\"}),\" since it could be some weird value.\"]}),`\n`,(0,e.jsxs)(l.p,{children:[\"To accomplish this we need to make a helper type that filters down the allowed keys to only keys whose values are \",(0,e.jsx)(l.code,{children:\"string | number | symbol\"}),`.\nWe can use a `,(0,e.jsx)(l.a,{href:\"https://www.typescriptlang.org/docs/handbook/2/mapped-types.html\",children:\"mapped type\"}),\" to do just that\"]}),`\n`,(0,e.jsxs)(l.pre,{className:\"shiki dracula twoslash lsp\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,e.jsx)(l.div,{className:\"language-id\",children:\"ts\"}),(0,e.jsx)(l.div,{className:\"code-container\",children:(0,e.jsxs)(l.code,{children:[(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"type\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type MapValuesToKeysIfAllowed\u003cT\u003e = { [K in keyof T]: T[K] extends PropertyKey ? K : never; }\",children:\"MapValuesToKeysIfAllowed\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in type MapValuesToKeysIfAllowed\u003cT\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003e \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"  [\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) K\",children:\"K\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"in\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"keyof\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in type MapValuesToKeysIfAllowed\u003cT\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"]\"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in type MapValuesToKeysIfAllowed\u003cT\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"[\"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) K\",children:\"K\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"] \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"extends\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type PropertyKey = string | number | symbol\",children:\"PropertyKey\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"?\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) K\",children:\"K\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:\"never\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"};\"})}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"type\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type Filter\u003cT\u003e = MapValuesToKeysIfAllowed\u003cT\u003e[keyof T]\",children:\"Filter\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in type Filter\u003cT\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003e \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type MapValuesToKeysIfAllowed\u003cT\u003e = { [K in keyof T]: T[K] extends PropertyKey ? K : never; }\",children:\"MapValuesToKeysIfAllowed\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in type Filter\u003cT\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003e[\"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"keyof\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in type Filter\u003cT\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"];\"})]})]})})]}),`\n`,(0,e.jsxs)(l.p,{children:[\"This type helper does a few things. First it maps over all the values in \",(0,e.jsx)(l.code,{children:\"T\"}),\" (\",(0,e.jsx)(l.code,{children:\"[K in keyof T]\"}),\") and makes the value the key if it is a subset of \",(0,e.jsx)(l.code,{children:\"string | number | symbol\"}),\" (\",(0,e.jsx)(l.code,{children:\"T[K] extends PropertyKey ? K\"}),\"), if it's not a subset its value will be the \",(0,e.jsx)(l.code,{children:\"never\"}),\" type. Finally, we use an \",(0,e.jsx)(l.a,{href:\"https://www.typescriptlang.org/docs/handbook/2/indexed-access-types.html\",children:\"index access type\"}),\" to get all values of the transformed object as a union. This step will drop all the \",(0,e.jsx)(l.code,{children:\"never\"}),\" values automatically for us since adding \",(0,e.jsx)(l.code,{children:\"never\"}),\" to a union is like saying \",(0,e.jsx)(l.code,{children:\"or false\"}),\" its basically is a no op.\"]}),`\n`,(0,e.jsx)(l.p,{children:\"That was a mouthful so let's see an example\"}),`\n`,(0,e.jsxs)(l.pre,{className:\"shiki dracula twoslash lsp\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,e.jsx)(l.div,{className:\"language-id\",children:\"ts\"}),(0,e.jsx)(l.div,{className:\"code-container\",children:(0,e.jsxs)(l.code,{children:[(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"// from above\"})}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"interface\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"interface Foo\",children:\"Foo\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"  \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(property) Foo.num: number\",children:\"num\"})]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:\"number\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"  \",(0,e.jsx)(l[\"data-lsp\"],{lsp:'(property) Foo.someLiteral: \"a\" | \"b\" | \"c\"',children:\"someLiteral\"})]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F1FA8C\"},children:\"a\"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F1FA8C\"},children:\"b\"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F1FA8C\"},children:\"c\"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"  \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(property) Foo.object: Record\u003cstring, any\u003e\",children:\"object\"})]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type Record\u003cK extends string | number | symbol, T\u003e = { [P in K]: T; }\",children:\"Record\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:\"string\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:\"any\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003e;\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"}\"})}),(0,e.jsx)(l.div,{className:\"line\",children:\"\\xA0\"}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"type\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:`type MappedFoo = {\n    num: \"num\";\n    someLiteral: \"someLiteral\";\n    object: never;\n}`,children:\"MappedFoo\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type MapValuesToKeysIfAllowed\u003cT\u003e = { [K in keyof T]: T[K] extends PropertyKey ? K : never; }\",children:\"MapValuesToKeysIfAllowed\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"interface Foo\",children:\"Foo\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003e;\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"/*\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"{\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:'  num: \"num\";'})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:'  someLiteral: \"someLiteral\";'})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"  object: never;\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"}\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"*/\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"// we replace the values of this object with just the key as a string literal or never\"})}),(0,e.jsx)(l.div,{className:\"line\",children:\"\\xA0\"}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"type\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:'type FooKeys = \"num\" | \"someLiteral\"',children:\"FooKeys\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type Filter\u003cT\u003e = MapValuesToKeysIfAllowed\u003cT\u003e[keyof T]\",children:\"Filter\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"interface Foo\",children:\"Foo\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003e;\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:'// =\u003e \"num\" | \"someLiteral\"'})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"// notice the never does not show up in the union\"})}),(0,e.jsx)(l.div,{className:\"line\",children:\"\\xA0\"}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"interface\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"interface AllObjects\",children:\"AllObjects\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"  \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(property) AllObjects.object: Record\u003cstring, any\u003e\",children:\"object\"})]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type Record\u003cK extends string | number | symbol, T\u003e = { [P in K]: T; }\",children:\"Record\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:\"string\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:\"any\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003e;\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"  \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(property) AllObjects.diffObject: Record\u003cnumber, any\u003e\",children:\"diffObject\"})]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type Record\u003cK extends string | number | symbol, T\u003e = { [P in K]: T; }\",children:\"Record\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:\"number\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:\"any\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003e;\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"}\"})}),(0,e.jsx)(l.div,{className:\"line\",children:\"\\xA0\"}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"type\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:`type MappedAllObjects = {\n    object: never;\n    diffObject: never;\n}`,children:\"MappedAllObjects\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type MapValuesToKeysIfAllowed\u003cT\u003e = { [K in keyof T]: T[K] extends PropertyKey ? K : never; }\",children:\"MapValuesToKeysIfAllowed\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"interface AllObjects\",children:\"AllObjects\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003e;\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"/*\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"{ \"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"  object: never;\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"  diffObject: never;\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"}\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"*/\"})}),(0,e.jsx)(l.div,{className:\"line\",children:\"\\xA0\"}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"type\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type AllObjectsKeys = never\",children:\"AllObjectsKeys\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type Filter\u003cT\u003e = MapValuesToKeysIfAllowed\u003cT\u003e[keyof T]\",children:\"Filter\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"interface AllObjects\",children:\"AllObjects\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003e;\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"// =\u003e never\"})}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:'// the output is only never. Think of this like saying \"false or false\", the output will just be false'})})]})})]}),`\n`,(0,e.jsxs)(l.p,{children:[\"With this filter type helper function we can now properly limit the \",(0,e.jsx)(l.code,{children:\"Key\"}),\" generic by replacing \",(0,e.jsx)(l.code,{children:\"Key extends keyof T\"}),\" with \",(0,e.jsx)(l.code,{children:\"Key extends Filter\u003cT\u003e\"}),\".\"]}),`\n`,(0,e.jsxs)(l.h2,{id:\"putting-it-all-together\",children:[(0,e.jsx)(l.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#putting-it-all-together\",children:(0,e.jsx)(l.span,{className:\"icon icon-link\"})}),\"Putting it all together\"]}),`\n`,(0,e.jsxs)(l.pre,{className:\"shiki dracula twoslash lsp\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,e.jsx)(l.div,{className:\"language-id\",children:\"ts\"}),(0,e.jsx)(l.div,{className:\"code-container\",children:(0,e.jsxs)(l.code,{children:[(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"type\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type MapValuesToKeysIfAllowed\u003cT\u003e = { [K in keyof T]: T[K] extends PropertyKey ? K : never; }\",children:\"MapValuesToKeysIfAllowed\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in type MapValuesToKeysIfAllowed\u003cT\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003e \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"  [\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) K\",children:\"K\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"in\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"keyof\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in type MapValuesToKeysIfAllowed\u003cT\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"]\"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in type MapValuesToKeysIfAllowed\u003cT\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"[\"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) K\",children:\"K\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"] \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"extends\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type PropertyKey = string | number | symbol\",children:\"PropertyKey\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"?\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) K\",children:\"K\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:\"never\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"};\"})}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"type\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type Filter\u003cT\u003e = MapValuesToKeysIfAllowed\u003cT\u003e[keyof T]\",children:\"Filter\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in type Filter\u003cT\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003e \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type MapValuesToKeysIfAllowed\u003cT\u003e = { [K in keyof T]: T[K] extends PropertyKey ? K : never; }\",children:\"MapValuesToKeysIfAllowed\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in type Filter\u003cT\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003e[\"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"keyof\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in type Filter\u003cT\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"];\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:\"\\xA0\"}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"function\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"function groupBy\u003cT extends Record\u003cPropertyKey, any\u003e, Key extends Filter\u003cT\u003e\u003e(arr: T[], key: Key): Record\u003cT[Key], T[]\u003e\",children:\"groupBy\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in groupBy\u003cT extends Record\u003cPropertyKey, any\u003e, Key extends Filter\u003cT\u003e\u003e(arr: T[], key: Key): Record\u003cT[Key], T[]\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"extends\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type Record\u003cK extends string | number | symbol, T\u003e = { [P in K]: T; }\",children:\"Record\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type PropertyKey = string | number | symbol\",children:\"PropertyKey\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:\"any\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003e, \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) Key in groupBy\u003cT extends Record\u003cPropertyKey, any\u003e, Key extends Filter\u003cT\u003e\u003e(arr: T[], key: Key): Record\u003cT[Key], T[]\u003e\",children:\"Key\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"extends\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type Filter\u003cT\u003e = MapValuesToKeysIfAllowed\u003cT\u003e[keyof T]\",children:\"Filter\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in groupBy\u003cT extends Record\u003cPropertyKey, any\u003e, Key extends Filter\u003cT\u003e\u003e(arr: T[], key: Key): Record\u003cT[Key], T[]\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003e\u003e(\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) arr: T[]\",children:\"arr\"})}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in groupBy\u003cT extends Record\u003cPropertyKey, any\u003e, Key extends Filter\u003cT\u003e\u003e(arr: T[], key: Key): Record\u003cT[Key], T[]\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"[],\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) key: Key extends Filter\u003cT\u003e\",children:\"key\"})}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) Key in groupBy\u003cT extends Record\u003cPropertyKey, any\u003e, Key extends Filter\u003cT\u003e\u003e(arr: T[], key: Key): Record\u003cT[Key], T[]\u003e\",children:\"Key\"})})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type Record\u003cK extends string | number | symbol, T\u003e = { [P in K]: T; }\",children:\"Record\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in groupBy\u003cT extends Record\u003cPropertyKey, any\u003e, Key extends Filter\u003cT\u003e\u003e(arr: T[], key: Key): Record\u003cT[Key], T[]\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"[\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) Key in groupBy\u003cT extends Record\u003cPropertyKey, any\u003e, Key extends Filter\u003cT\u003e\u003e(arr: T[], key: Key): Record\u003cT[Key], T[]\u003e\",children:\"Key\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"], \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in groupBy\u003cT extends Record\u003cPropertyKey, any\u003e, Key extends Filter\u003cT\u003e\u003e(arr: T[], key: Key): Record\u003cT[Key], T[]\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"[]\u003e {\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"return\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\" \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) arr: T[]\",children:\"arr\"}),\".\"]}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(method) Array\u003cT\u003e.reduce\u003cRecord\u003cT[Key], T[]\u003e\u003e(callbackfn: (previousValue: Record\u003cT[Key], T[]\u003e, currentValue: T, currentIndex: number, array: T[]) =\u003e Record\u003cT[Key], T[]\u003e, initialValue: Record\u003c...\u003e): Record\u003c...\u003e (+2 overloads)\",children:\"reduce\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"((\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) accumulator: Record\u003cT[Key], T[]\u003e\",children:\"accumulator\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) val: T extends Record\u003cPropertyKey, any\u003e\",children:\"val\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"const\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\" \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const groupedKey: T[Key]\",children:\"groupedKey\"}),\" \"]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\" \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) val: T extends Record\u003cPropertyKey, any\u003e\",children:\"val\"}),\"[\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) key: Key extends Filter\u003cT\u003e\",children:\"key\"}),\"];\"]})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"if\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" (\"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"!\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) accumulator: Record\u003cT[Key], T[]\u003e\",children:\"accumulator\"}),\"[\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const groupedKey: T[Key]\",children:\"groupedKey\"}),\"]) {\"]})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"      \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) accumulator: Record\u003cT[Key], T[]\u003e\",children:\"accumulator\"}),\"[\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const groupedKey: T[Key]\",children:\"groupedKey\"}),\"] \"]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" [];\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"    \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) accumulator: Record\u003cT[Key], T[]\u003e\",children:\"accumulator\"}),\"[\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const groupedKey: T[Key]\",children:\"groupedKey\"}),\"].\"]}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(method) Array\u003cT\u003e.push(...items: T[]): number\",children:\"push\"})}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"(\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) val: T extends Record\u003cPropertyKey, any\u003e\",children:\"val\"}),\");\"]})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"return\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\" \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) accumulator: Record\u003cT[Key], T[]\u003e\",children:\"accumulator\"}),\";\"]})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"  }, {} \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"as\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type Record\u003cK extends string | number | symbol, T\u003e = { [P in K]: T; }\",children:\"Record\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in groupBy\u003cT extends Record\u003cPropertyKey, any\u003e, Key extends Filter\u003cT\u003e\u003e(arr: T[], key: Key): Record\u003cT[Key], T[]\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"[\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) Key in groupBy\u003cT extends Record\u003cPropertyKey, any\u003e, Key extends Filter\u003cT\u003e\u003e(arr: T[], key: Key): Record\u003cT[Key], T[]\u003e\",children:\"Key\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"], \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in groupBy\u003cT extends Record\u003cPropertyKey, any\u003e, Key extends Filter\u003cT\u003e\u003e(arr: T[], key: Key): Record\u003cT[Key], T[]\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"[]\u003e);\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"}\"})}),(0,e.jsx)(l.div,{className:\"line\",children:\"\\xA0\"}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"const\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\" \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const nums: Record\u003cnumber, Foo[]\u003e\",children:\"nums\"}),\" \"]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:'function groupBy\u003cFoo, \"num\"\u003e(arr: Foo[], key: \"num\"): Record\u003cnumber, Foo[]\u003e',children:\"groupBy\"})}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"(\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const vals: Foo[]\",children:\"vals\"}),\", \"]}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F1FA8C\"},children:\"num\"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\");\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"// nums = Record\u003cnumber, Foo[]\u003e\"})}),(0,e.jsx)(l.div,{className:\"line\",children:\"\\xA0\"}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"const\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\" \",(0,e.jsx)(l[\"data-lsp\"],{lsp:'const literals: Record\u003c\"a\" | \"b\" | \"c\", Foo[]\u003e',children:\"literals\"}),\" \"]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:'function groupBy\u003cFoo, \"someLiteral\"\u003e(arr: Foo[], key: \"someLiteral\"): Record\u003c\"a\" | \"b\" | \"c\", Foo[]\u003e',children:\"groupBy\"})}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"(\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const vals: Foo[]\",children:\"vals\"}),\", \"]}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F1FA8C\"},children:\"someLiteral\"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\");\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:'// literals = Record\u003c\"a\" | \"b\" | \"c\", Foo[]\u003e'})}),(0,e.jsx)(l.div,{className:\"line\",children:\"\\xA0\"}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"const\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\" \",(0,e.jsx)(l[\"data-lsp\"],{lsp:'const sad: Record\u003cnumber | \"a\" | \"b\" | \"c\", Foo[]\u003e',children:\"sad\"}),\" \"]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:'function groupBy\u003cFoo, Filter\u003cFoo\u003e\u003e(arr: Foo[], key: Filter\u003cFoo\u003e): Record\u003cnumber | \"a\" | \"b\" | \"c\", Foo[]\u003e',children:\"groupBy\"})}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"(\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const vals: Foo[]\",children:\"vals\"}),\", \"]}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F1FA8C\"},children:\"object\"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\");\"})]}),(0,e.jsxs)(l.span,{className:\"error\",children:[(0,e.jsx)(l.span,{children:`Argument of type '\"object\"' is not assignable to parameter of type 'Filter\u003cFoo\u003e'.`}),(0,e.jsx)(l.span,{className:\"code\",children:\"2345\"})]}),(0,e.jsx)(l.span,{className:\"error-behind\",children:`Argument of type '\"object\"' is not assignable to parameter of type 'Filter\u003cFoo\u003e'.`})]})})]}),`\n`,(0,e.jsxs)(l.p,{children:[`Now this works great, we can only pass in keys that have valid values, and we even get autocomplete on it! However, one thing that bothers me is the error message in the last case.\nWhile it's correct, saying `,(0,e.jsx)(l.code,{children:\"not assignable to parameter of type 'Filter\u003cFoo\u003e'\"}),\" is not very useful to a user. This pops up sometimes with typescript where it won't show the underlying type and instead just show the higher level type helper instead.\"]}),`\n`,(0,e.jsxs)(l.p,{children:[\"To make the error message show the valid keys we can use a modified version of \",(0,e.jsx)(l.a,{href:\"https://stackoverflow.com/a/57683652\",children:'this \"hack\"'}),\". Here instead of creating the \",(0,e.jsx)(l.code,{children:\"Expand\"}),\" type in the post, we can make our own \",(0,e.jsx)(l.code,{children:\"ValuesOf\"}),\" to replace the \",(0,e.jsx)(l.code,{children:\"[keyof T]\"}),\" at the end of \",(0,e.jsx)(l.code,{children:\"Filter\"})]}),`\n`,(0,e.jsxs)(l.pre,{className:\"shiki dracula twoslash lsp\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,e.jsx)(l.div,{className:\"language-id\",children:\"ts\"}),(0,e.jsx)(l.div,{className:\"code-container\",children:(0,e.jsxs)(l.code,{children:[(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"type\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type ValuesOf\u003cA\u003e = A extends infer O ? A[keyof A] : never\",children:\"ValuesOf\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) A in type ValuesOf\u003cA\u003e\",children:\"A\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003e \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) A in type ValuesOf\u003cA\u003e\",children:\"A\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"extends\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"infer\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) O\",children:\"O\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"?\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) A in type ValuesOf\u003cA\u003e\",children:\"A\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"[\"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"keyof\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) A in type ValuesOf\u003cA\u003e\",children:\"A\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"] \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:\"never\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:\"\\xA0\"}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"type\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type Filter\u003cT\u003e = MapValuesToKeysIfAllowed\u003cT\u003e extends infer O ? (O \u0026 MapValuesToKeysIfAllowed\u003cT\u003e)[keyof T | keyof O] : never\",children:\"Filter\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in type Filter\u003cT\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003e \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type ValuesOf\u003cA\u003e = A extends infer O ? A[keyof A] : never\",children:\"ValuesOf\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type MapValuesToKeysIfAllowed\u003cT\u003e = { [K in keyof T]: T[K] extends PropertyKey ? K : never; }\",children:\"MapValuesToKeysIfAllowed\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in type Filter\u003cT\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003e\u003e;\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"// was Filter\u003cT\u003e = MapValuesToKeysIfAllowed\u003cT\u003e[keyof T]\"})}),(0,e.jsx)(l.div,{className:\"line\",children:\"\\xA0\"}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"const\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\" \",(0,e.jsx)(l[\"data-lsp\"],{lsp:'const sad: Record\u003cnumber | \"a\" | \"b\" | \"c\", Foo[]\u003e',children:\"sad\"}),\" \"]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:'function groupBy\u003cFoo, \"num\" | \"someLiteral\"\u003e(arr: Foo[], key: \"num\" | \"someLiteral\"): Record\u003cnumber | \"a\" | \"b\" | \"c\", Foo[]\u003e',children:\"groupBy\"})}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"(\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const vals: Foo[]\",children:\"vals\"}),\", \"]}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F1FA8C\"},children:\"object\"}),(0,e.jsx)(l.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\");\"})]}),(0,e.jsxs)(l.span,{className:\"error\",children:[(0,e.jsx)(l.span,{children:`Argument of type '\"object\"' is not assignable to parameter of type '\"num\" | \"someLiteral\"'.`}),(0,e.jsx)(l.span,{className:\"code\",children:\"2345\"})]}),(0,e.jsx)(l.span,{className:\"error-behind\",children:`Argument of type '\"object\"' is not assignable to parameter of type '\"num\" | \"someLiteral\"'.`})]})})]}),`\n`,(0,e.jsx)(l.p,{children:\"Now we have type safety and good error messages!\"}),`\n`,(0,e.jsxs)(l.h2,{id:\"possible-improvements\",children:[(0,e.jsx)(l.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#possible-improvements\",children:(0,e.jsx)(l.span,{className:\"icon icon-link\"})}),\"Possible improvements\"]}),`\n`,(0,e.jsxs)(l.p,{children:[\"One thing this \",(0,e.jsx)(l.code,{children:\"groupBy\"}),\" function lacks that the lodash \",(0,e.jsx)(l.code,{children:\"groupBy\"}),` gives is we do not allow you to pass a function instead of a key to group on.\nThe example in the lodash docs is`]}),`\n`,(0,e.jsxs)(l.pre,{className:\"shiki dracula twoslash lsp\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,e.jsx)(l.div,{className:\"language-id\",children:\"ts\"}),(0,e.jsx)(l.div,{className:\"code-container\",children:(0,e.jsxs)(l.code,{children:[(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[(0,e.jsx)(l[\"data-lsp\"],{lsp:`(alias) namespace _\n(alias) const _: import(\"/home/runner/work/JRMurr.github.io/JRMurr.github.io/node_modules/@types/lodash/index.d.ts\").LoDashStatic\nimport _`,children:\"_\"}),\".\"]}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(method) LoDashStatic.groupBy\u003cnumber\u003e(collection: _.List\u003cnumber\u003e | null | undefined, iteratee?: _.ValueIteratee\u003cnumber\u003e | undefined): _.Dictionary\u003cnumber[]\u003e (+1 overload)\",children:\"groupBy\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"([\"}),(0,e.jsx)(l.span,{style:{color:\"#BD93F9\"},children:\"6.1\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#BD93F9\"},children:\"4.2\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#BD93F9\"},children:\"6.3\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"], \"}),(0,e.jsx)(l.span,{style:{color:\"#BD93F9\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"var Math: Math\",children:\"Math\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(method) Math.floor(x: number): number\",children:\"floor\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\");\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"// { '4': [4.2], '6': [6.1, 6.3] }\"})})]})})]}),`\n`,(0,e.jsx)(l.p,{children:\"While this is not perfect this mostly works\"}),`\n`,(0,e.jsxs)(l.pre,{className:\"shiki dracula twoslash lsp\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,e.jsx)(l.div,{className:\"language-id\",children:\"ts\"}),(0,e.jsx)(l.div,{className:\"code-container\",children:(0,e.jsxs)(l.code,{children:[(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"function\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"function groupByFunc\u003cRetType extends PropertyKey, T, Func extends (arg: T) =\u003e RetType\u003e(arr: T[], mapper: Func): Record\u003cRetType, T[]\u003e\",children:\"groupByFunc\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) RetType in groupByFunc\u003cRetType extends PropertyKey, T, Func extends (arg: T) =\u003e RetType\u003e(arr: T[], mapper: Func): Record\u003cRetType, T[]\u003e\",children:\"RetType\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"extends\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type PropertyKey = string | number | symbol\",children:\"PropertyKey\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in groupByFunc\u003cRetType extends PropertyKey, T, Func extends (arg: T) =\u003e RetType\u003e(arr: T[], mapper: Func): Record\u003cRetType, T[]\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"// no longer need any requirements on T since the grouper can do w/e it wants\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) Func in groupByFunc\u003cRetType extends PropertyKey, T, Func extends (arg: T) =\u003e RetType\u003e(arr: T[], mapper: Func): Record\u003cRetType, T[]\u003e\",children:\"Func\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"extends\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" (\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) arg: T\",children:\"arg\"})}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in groupByFunc\u003cRetType extends PropertyKey, T, Func extends (arg: T) =\u003e RetType\u003e(arr: T[], mapper: Func): Record\u003cRetType, T[]\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) RetType in groupByFunc\u003cRetType extends PropertyKey, T, Func extends (arg: T) =\u003e RetType\u003e(arr: T[], mapper: Func): Record\u003cRetType, T[]\u003e\",children:\"RetType\"})})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003e(\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) arr: T[]\",children:\"arr\"})}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in groupByFunc\u003cRetType extends PropertyKey, T, Func extends (arg: T) =\u003e RetType\u003e(arr: T[], mapper: Func): Record\u003cRetType, T[]\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"[], \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) mapper: Func extends (arg: T) =\u003e RetType\",children:\"mapper\"})}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) Func in groupByFunc\u003cRetType extends PropertyKey, T, Func extends (arg: T) =\u003e RetType\u003e(arr: T[], mapper: Func): Record\u003cRetType, T[]\u003e\",children:\"Func\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\")\"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type Record\u003cK extends string | number | symbol, T\u003e = { [P in K]: T; }\",children:\"Record\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) RetType in groupByFunc\u003cRetType extends PropertyKey, T, Func extends (arg: T) =\u003e RetType\u003e(arr: T[], mapper: Func): Record\u003cRetType, T[]\u003e\",children:\"RetType\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in groupByFunc\u003cRetType extends PropertyKey, T, Func extends (arg: T) =\u003e RetType\u003e(arr: T[], mapper: Func): Record\u003cRetType, T[]\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"[]\u003e {\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"return\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\" \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) arr: T[]\",children:\"arr\"}),\".\"]}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(method) Array\u003cT\u003e.reduce\u003cRecord\u003cRetType, T[]\u003e\u003e(callbackfn: (previousValue: Record\u003cRetType, T[]\u003e, currentValue: T, currentIndex: number, array: T[]) =\u003e Record\u003cRetType, T[]\u003e, initialValue: Record\u003c...\u003e): Record\u003c...\u003e (+2 overloads)\",children:\"reduce\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"((\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) accumulator: Record\u003cRetType, T[]\u003e\",children:\"accumulator\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) val: T\",children:\"val\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"const\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\" \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const groupedKey: RetType extends PropertyKey\",children:\"groupedKey\"}),\" \"]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:`(parameter) mapper: Func\n(arg: T) =\u003e RetType`,children:\"mapper\"})}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"(\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) val: T\",children:\"val\"}),\");\"]})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"if\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" (\"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"!\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) accumulator: Record\u003cRetType, T[]\u003e\",children:\"accumulator\"}),\"[\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const groupedKey: RetType extends PropertyKey\",children:\"groupedKey\"}),\"]) {\"]})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"      \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) accumulator: Record\u003cRetType, T[]\u003e\",children:\"accumulator\"}),\"[\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const groupedKey: RetType extends PropertyKey\",children:\"groupedKey\"}),\"] \"]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" [];\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"    \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) accumulator: Record\u003cRetType, T[]\u003e\",children:\"accumulator\"}),\"[\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const groupedKey: RetType extends PropertyKey\",children:\"groupedKey\"}),\"].\"]}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(method) Array\u003cT\u003e.push(...items: T[]): number\",children:\"push\"})}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\"(\",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) val: T\",children:\"val\"}),\");\"]})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"return\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\" \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(parameter) accumulator: Record\u003cRetType, T[]\u003e\",children:\"accumulator\"}),\";\"]})]}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"  }, {} \"}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"as\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"type Record\u003cK extends string | number | symbol, T\u003e = { [P in K]: T; }\",children:\"Record\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) RetType in groupByFunc\u003cRetType extends PropertyKey, T, Func extends (arg: T) =\u003e RetType\u003e(arr: T[], mapper: Func): Record\u003cRetType, T[]\u003e\",children:\"RetType\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#FFB86C\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(type parameter) T in groupByFunc\u003cRetType extends PropertyKey, T, Func extends (arg: T) =\u003e RetType\u003e(arr: T[], mapper: Func): Record\u003cRetType, T[]\u003e\",children:\"T\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"[]\u003e);\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"}\"})}),(0,e.jsx)(l.div,{className:\"line\",children:\"\\xA0\"}),(0,e.jsxs)(l.div,{className:\"line\",children:[(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"const\"}),(0,e.jsxs)(l.span,{style:{color:\"#F8F8F2\"},children:[\" \",(0,e.jsx)(l[\"data-lsp\"],{lsp:\"const test: Record\u003cPropertyKey, number[]\u003e\",children:\"test\"}),\" \"]}),(0,e.jsx)(l.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,e.jsx)(l.span,{style:{color:\"#50FA7B\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"function groupByFunc\u003cPropertyKey, number, (x: number) =\u003e number\u003e(arr: number[], mapper: (x: number) =\u003e number): Record\u003cPropertyKey, number[]\u003e\",children:\"groupByFunc\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"([\"}),(0,e.jsx)(l.span,{style:{color:\"#BD93F9\"},children:\"6.1\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#BD93F9\"},children:\"4.2\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,e.jsx)(l.span,{style:{color:\"#BD93F9\"},children:\"6.3\"}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\"], \"}),(0,e.jsx)(l.span,{style:{color:\"#BD93F9\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"var Math: Math\",children:\"Math\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,e.jsx)(l.span,{style:{color:\"#8BE9FD\"},children:(0,e.jsx)(l[\"data-lsp\"],{lsp:\"(method) Math.floor(x: number): number\",children:\"floor\"})}),(0,e.jsx)(l.span,{style:{color:\"#F8F8F2\"},children:\");\"})]}),(0,e.jsx)(l.div,{className:\"line\",children:(0,e.jsx)(l.span,{style:{color:\"#6272A4\"},children:\"// test = Record\u003cPropertyKey, Foo[]\u003e\"})})]})})]}),`\n`,(0,e.jsxs)(l.p,{children:[\"This works by only letting you pass in functions that return \",(0,e.jsx)(l.code,{children:\"PropertyKey\"}),\", but typescript does not seem to narrow the types. In this case \",(0,e.jsx)(l.code,{children:\"test\"}),\" should be \",(0,e.jsx)(l.code,{children:\"Record\u003cnumber, Foo[]\u003e\"}),\" since TS \",(0,e.jsx)(l.em,{children:\"should\"}),\" infer the return type of the grouping function. If you know how to improve this function to make the return type narrow properly feel free to leave an issue/pr on my \",(0,e.jsx)(l.a,{href:\"https://github.com/JRMurr/JRMurr.github.io\",children:\"blog's GitHub\"}),\"!\"]})]})}}var b=g;function C(r,n){throw new Error(\"Expected \"+(n?\"component\":\"object\")+\" `\"+r+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return f;})();\n;return Component;","toc":[{"value":"Lodash's groupBy","url":"#lodashs-groupby","depth":2},{"value":"Making our own groupBy","url":"#making-our-own-groupby","depth":2},{"value":"Putting it all together","url":"#putting-it-all-together","depth":2},{"value":"Possible improvements","url":"#possible-improvements","depth":2}],"frontMatter":{"readingTime":{"text":"20 min read","minutes":19.06,"time":1143600,"words":3812},"slug":"type-safe-groupby-in-typescript","fileName":"type-safe-groupby-in-typescript.md","title":"Type Safe GroupBy In TypeScript","date":"2022-05-25T00:00:00.000Z","tags":["typescript","types","code","guide"],"draft":false,"summary":"Create a better groupBy function that only allows valid keys to be grouped on","images":[],"layout":"PostLayout"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.215,"time":12900,"words":43},"slug":["default"],"fileName":"default.md","name":"John Murray","avatar":"/static/images/me.jpg","occupation":"Software Engineer","github":"https://github.com/JRMurr","twitter":"https://twitter.com/JRMurrCodes","mastodon":"https://hachyderm.io/@jrmurr","email":"johnreillymurray@gmail.com","date":null}],"series":null},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["type-safe-groupby-in-typescript"]},"buildId":"s10FPnTlL5cwtRs3HC583","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>