<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" content="#000000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>Organizing system configs with NixOS</title><meta name="robots" content="follow, index"/><meta name="description" content="How I organize and manage my system and user configs with NixOS and homemanager"/><meta property="og:url" content="https://johns.codes/blog/organizing-system-configs-with-nixos"/><meta property="og:type" content="article"/><meta property="og:site_name" content="John&#x27;s Codes"/><meta property="og:description" content="How I organize and manage my system and user configs with NixOS and homemanager"/><meta property="og:title" content="Organizing system configs with NixOS"/><meta property="og:image" content="https://johns.codes/static/images/twitter-card.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://twitter.com/JRMurrCodes"/><meta name="twitter:title" content="Organizing system configs with NixOS"/><meta name="twitter:description" content="How I organize and manage my system and user configs with NixOS and homemanager"/><meta name="twitter:image" content="https://johns.codes/static/images/twitter-card.png"/><meta property="article:published_time" content="2023-10-09T07:14:19.315Z"/><link rel="canonical" href="https://johns.codes/blog/organizing-system-configs-with-nixos"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://johns.codes/blog/organizing-system-configs-with-nixos"
  },
  "headline": "Organizing system configs with NixOS",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://johns.codes/static/images/twitter-card.png"
    }
  ],
  "datePublished": "2023-10-09T07:14:19.315Z",
  "dateModified": "2023-10-09T07:14:19.315Z",
  "author": [
    {
      "@type": "Person",
      "name": "John Murray"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "John Murray",
    "logo": {
      "@type": "ImageObject",
      "url": "https://johns.codes/static/images/logo.png"
    }
  },
  "description": "How I organize and manage my system and user configs with NixOS and homemanager"
}</script><meta name="next-head-count" content="20"/><link rel="preload" href="/_next/static/css/ff7a91e18d57a2d6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ff7a91e18d57a2d6.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-a0fb203be75c9eb6.js" defer=""></script><script src="/_next/static/chunks/main-b77bb48dcc3828e6.js" defer=""></script><script src="/_next/static/chunks/pages/_app-861f57e6bedfde14.js" defer=""></script><script src="/_next/static/chunks/framework-327e104994690a53.js" defer=""></script><script src="/_next/static/chunks/675-374a5a75205d32da.js" defer=""></script><script src="/_next/static/chunks/266-365d5fff0af19ac8.js" defer=""></script><script src="/_next/static/chunks/545-446f5effbf4e5f11.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-c8a468ed53b4c5d2.js" defer=""></script><script src="/_next/static/VjYh7k8e50Akk-SVaYPII/_buildManifest.js" defer=""></script><script src="/_next/static/VjYh7k8e50Akk-SVaYPII/_ssgManifest.js" defer=""></script><script src="/_next/static/VjYh7k8e50Akk-SVaYPII/_middlewareManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap">@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuFuYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body class="antialiased text-black bg-white dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex flex-col justify-between h-screen"><header class="flex items-center justify-between py-10"><div><a aria-label="John&#x27;s Codes" href="/"><div class="flex items-center justify-between"><div class="hidden h-6 text-2xl font-semibold sm:block">John&#x27;s Codes</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/projects">Projects</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="w-8 h-8 p-1 ml-1 mr-1 rounded sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="w-8 h-8 py-1 ml-1 mr-1 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed w-full h-full top-24 right-0 bg-gray-200 dark:bg-gray-800 opacity-95 z-10 transform ease-in-out duration-300 translate-x-full"><button type="button" aria-label="toggle modal" class="fixed w-full h-full cursor-auto focus:outline-none"></button><nav class="fixed h-full mt-8"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/projects">Projects</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed flex-col hidden gap-3 right-8 bottom-8 md:hidden"><button aria-label="Scroll To Comment" type="button" class="p-2 text-gray-500 transition-all bg-gray-200 rounded-full dark:text-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 hover:bg-gray-300"><svg class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="p-2 text-gray-500 transition-all bg-gray-200 rounded-full dark:text-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 hover:bg-gray-300"><svg class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-4 md:space-y-2 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="flex justify-center items-center text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2023-10-09T07:14:19.315Z">Monday, October 9, 2023</time><span class="mx-2">-</span><div class="flex items-center"><span class="ml-1">15 min read</span></div></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Organizing system configs with NixOS</h1></div></div></header><div class="pb-8 divide-y divide-gray-200 xl:divide-y-0 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6" style="grid-template-rows:auto 1fr"><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:pb-0 xl:col-span-4 xl:row-span-2"><div class="pt-10 pb-8 prose dark:prose-dark max-w-none"><details open=""><summary class="pt-2 pb-2 ml-6 text-xl font-bold">Table of Contents</summary><div class="ml-6"><ul><li class="false"><a href="#what-is-nixos">What is NixOS</a></li><li class="ml-6"><a href="#quick-nixlang-overview">Quick NixLang overview</a></li><li class="ml-6"><a href="#a-basic-module">A Basic Module</a></li><li class="ml-6"><a href="#using-nixos">Using NixOS</a></li><li class="false"><a href="#diving-into-my-server-config">Diving into my Server Config</a></li><li class="ml-6"><a href="#managing-complex-services">Managing complex services</a></li><li class="false"><a href="#managing-secrets">Managing secrets</a></li><li class="ml-6"><a href="#the-secret-repo">The Secret Repo</a></li><li class="false"><a href="#managing-dotfiles-with-home-manager">Managing Dotfiles with Home Manager</a></li><li class="ml-6"><a href="#home-manager-on-mac">Home Manager on Mac</a></li><li class="false"><a href="#wrap-up">Wrap up</a></li></ul></div></details>
<p>Nix and NixOS has been the technology I&#x27;ve been the most excited about in the last few years.
While I have used Linux on my personal desktop and home server in the past, I never did anything complicated.
It was so hard to remember what I did to my system to get it to work the way I wanted.
This led to me keeping my systems very basic and eventually just using windows + docker for everything.
While that setup worked fine, it was hard to customize things... I wanted to rice out my config like everyone on <a target="_blank" rel="noopener noreferrer" href="https://www.reddit.com/r/unixporn/">r/unixporn</a></p>
<p>When I found NixOS it was like a lightbulb went off. Now I can feel free to change my config as I please,
not be scared if I break something, and be able to reproduce my system if I need to reinstall or got a new machine.</p>
<p>This post will be going over the &quot;vibe&quot; of using NixOS, I will explain how I set up my NixOS config and explain things in broad strokes as I go.
I will link out to other posts/code to go into greater detail. I may get some things wrong as I explain so if you catch something please comment!</p>
<p>My hope is for people who don&#x27;t know NixOS this will get you to give it a try.
If you are using NixOS but feel lost, give you a path forward for feeling more comfortable using it.</p>
<h2 id="what-is-nixos"><a href="#what-is-nixos" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>What is NixOS</h2>
<p>A big point of confusion when using Nix is the difference between Nix, NixPkgs, and NixOS.
<a target="_blank" rel="noopener noreferrer" href="https://www.haskellforall.com/2022/08/stop-calling-everything-nix.html">This post</a> by <a target="_blank" rel="noopener noreferrer" href="https://twitter.com/GabriellaG439">Gabriella Gonzalez</a> does a great break down on the differences.
For a high level TLDR, <a target="_blank" rel="noopener noreferrer" href="https://NixOS.org/">NixOS</a> is a Linux distro built on top of <a target="_blank" rel="noopener noreferrer" href="https://github.com/NixOS/nixpkgs">NixPkgs</a>.
NixPkgs uses the <a target="_blank" rel="noopener noreferrer" href="https://nix.dev/tutorials/first-steps/nix-language">Nix language</a> to define how to build packages.</p>
<p>There is more nuance than that, but it will be good enough to get started and for googling the right things.</p>
<h3 id="quick-nixlang-overview"><a href="#quick-nixlang-overview" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Quick NixLang overview</h3>
<p>For people new to nix I will go over the basics so the NixOS examples aren&#x27;t completely foreign, if you know a little nix or other functional languages you can probably skip this part.</p>
<p>I like this quote from <a target="_blank" rel="noopener noreferrer" href="https://zero-to-nix.com/concepts/nix-language">zero to nix</a> to describe the language</p>
<blockquote>
<p>Nix is a pure, functional, lazy, declarative, and reproducible programming language.</p>
</blockquote>
<p>NixLang is a lot like Haskell in that it is pure, functional, and lazy.</p>
<p>This example should give a decent vibe of what programming in nix is like</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">nix</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">let</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">foo</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">x</span><span style="color:#F8F8F2">: </span><span style="color:#FFB86C">y</span><span style="color:#F8F8F2">: </span><span style="color:#FFB86C">x</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#FF79C6">in</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#FFB86C">foo</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;a&quot;</span><span style="color:#F8F8F2"> (</span><span style="color:#8BE9FD">throw</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;sad&quot;</span><span style="color:#F8F8F2">)</span></div><div class="line"><span style="color:#6272A4"># evals to &quot;a&quot;</span></div></code></div></pre></div>
<p>That example defines a function <code>(x: y: x;)</code> which takes two arguments and returns the first, and binds it to the variable <code>foo</code> with <code>let foo =...; in</code>. This means the variable <code>foo</code> is only in scope after the <code>in</code>. Finally, we call foo with <code>foo &quot;a&quot; (throw &quot;sad&quot;)</code>. This resolves to &quot;a&quot;. Notice the error is not thrown because nix is lazy, that means if we never &quot;need&quot; to use a variable or expression, it will never be evaluated.</p>
<p>If we swap the order of the arguments to the function like <code>foo (throw &quot;sad&quot;) &quot;b&quot;</code>, we will get</p>
<div class="relative"><pre class="shiki dracula"><div class="code-container"><code><div class="line"><span style="color:undefined">error:
       … while calling the &#x27;throw&#x27; builtin

         at «string»:1:29:

            1| (let foo = x: y: x; in foo (throw &quot;sad&quot;) &quot;b&quot;)
             |                             ^

       error: sad</span></div></code></div></pre></div>
<p>The laziness helps us right very declarative code, describe what you want and if you don&#x27;t reference something, no worries, it won&#x27;t affect performance.</p>
<p>One of my favorite features of the nix language is how you can use <code>attrsets</code> (objects, hash maps, dicts, etc.). You can create one like</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">nix</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">let</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">foo</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">key1</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;bar&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">key2</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">      </span><span style="color:#50FA7B">nested1</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">1</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">      </span><span style="color:#50FA7B">nested2</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">2</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">    };</span></div><div class="line"><span style="color:#F8F8F2">  };</span></div><div class="line"><span style="color:#FF79C6">in</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#FFB86C">foo</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">key2</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">nested1</span></div><div class="line"><span style="color:#6272A4"># resolves to 1</span></div></code></div></pre></div>
<p>at first, they look like normal objects from something like python or JS but my favorite feature of them is the syntax sugar for dealing with nested <code>attrsets</code></p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">nix</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">foo</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">key1</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;bar&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">key2</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">nested1</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">1</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">key2</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">nested2</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">2</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">};</span></div><div class="line"><span style="color:#FF79C6">in</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#FFB86C">foo</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">key2</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">nested1</span></div><div class="line"><span style="color:#6272A4"># resolves to 1</span></div></code></div></pre></div>
<p>That snippet creates the same <code>attrset</code> as the example above but lets you use &quot;path notation&quot; to create the nested object.
While a basic syntax sugar it makes it very easy to override 1 nested option when merging things together. Without it NixOS would be a big PITA to manage IMO.</p>
<p>The last language feature I&#x27;ll cover is the <code>with</code> block.</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">nix</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">with</span><span style="color:#F8F8F2"> { </span><span style="color:#50FA7B">a</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">1</span><span style="color:#F8F8F2">; </span><span style="color:#50FA7B">b</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">2</span><span style="color:#F8F8F2">; };</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#FFB86C">a</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">b</span></div><div class="line"><span style="color:#6272A4"># evals to 3</span></div></code></div></pre></div>
<p>The with block will put all of an <code>attrset</code>&#x27;s key value pairs as variable in scope. This makes it easier to access library functions with something like <code>with builtins</code> or <code>with lib</code>, so you don&#x27;t need to prefix everything.</p>
<h3 id="a-basic-module"><a href="#a-basic-module" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>A Basic Module</h3>
<p>NixOS lets you organize your system into many <a target="_blank" rel="noopener noreferrer" href="https://NixOS.wiki/wiki/NixOS_modules">modules</a>.
A module is a file or function that either declares options for other modules to use, or sets options defined in other modules.</p>
<p>For example</p>
<div class="remark-code-title">hello.nix</div>
<div class="relative"><pre class="shiki dracula"><div class="language-id">nix</div><div class="code-container"><code><div class="line"><span style="color:#6272A4"># Taken from https://NixOS.wiki/wiki/NixOS_modules#Example</span></div><div class="line"><span style="color:#F8F8F2">{ </span><span style="color:#FFB86C">lib</span><span style="color:#FF79C6">,</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">pkgs</span><span style="color:#FF79C6">,</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">config</span><span style="color:#FF79C6">,</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">... </span><span style="color:#F8F8F2">}:</span></div><div class="line"><span style="color:#FF79C6">with</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">lib</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#FF79C6">let</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#6272A4"># Shorter name to access final settings a</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#6272A4"># user of hello.nix module HAS ACTUALLY SET.</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#6272A4"># cfg is a typical convention.</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">cfg</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">config</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">services</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">hello</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#FF79C6">in</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#6272A4"># Declare what settings a user of this &quot;hello.nix&quot; module CAN SET.</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">options</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">services</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">hello</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">enable</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">mkEnableOption</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;hello service&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">greeter</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">mkOption</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">      </span><span style="color:#50FA7B">type</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">types</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">str</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">      </span><span style="color:#50FA7B">default</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;world&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">    };</span></div><div class="line"><span style="color:#F8F8F2">  };</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#6272A4"># Define what other settings, services and resources should be active IF</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#6272A4"># a user of this &quot;hello.nix&quot; module ENABLED this module</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#6272A4"># by setting &quot;services.hello.enable = true;&quot;.</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">config</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">mkIf</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">cfg</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">enable</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">systemd</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">services</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">hello</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">      </span><span style="color:#50FA7B">wantedBy</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [ </span><span style="color:#F1FA8C">&quot;multi-user.target&quot;</span><span style="color:#F8F8F2"> ];</span></div><div class="line"><span style="color:#F8F8F2">      </span><span style="color:#50FA7B">serviceConfig</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">ExecStart</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;</span><span style="color:#FF79C6">${</span><span style="color:#FFB86C">pkgs</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">hello</span><span style="color:#FF79C6">}</span><span style="color:#F1FA8C">/bin/hello -g&#x27;Hello, </span><span style="color:#FF79C6">${</span><span style="color:#FFB86C">escapeShellArg</span><span style="color:#F1FA8C"> </span><span style="color:#FFB86C">cfg</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">greeter</span><span style="color:#FF79C6">}</span><span style="color:#F1FA8C">!&#x27;&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">    };</span></div><div class="line"><span style="color:#F8F8F2">  };</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>The file above adds the <code>services.hello</code> option. When enabled NixOS will make a system service called <code>hello.service</code> which will log <code>Hello &lt;greeter&gt;!</code>.
The module/options it defined can be used like this</p>
<div class="remark-code-title">configuration.nix</div>
<div class="relative"><pre class="shiki dracula"><div class="language-id">nix</div><div class="code-container"><code><div class="line"><span style="color:#F8F8F2">{</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">imports</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [ </span><span style="color:#F1FA8C">./hello.nix</span><span style="color:#F8F8F2"> ];</span></div><div class="line"><span style="color:#F8F8F2">  ...</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">services</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">hello</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">enable</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">true</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">greeter</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;Bob&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">  };</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>this file imports the module so the <code>services.hello</code> exists and can be used. It also set the <code>greeter</code> option we defined so the <code>hello.service</code> will log <code>Hello Bob!</code></p>
<p>There are many options defined in the NixOS <a target="_blank" rel="noopener noreferrer" href="https://nixos.org/manual/nixos/stable/options">standard library</a>.
Many programs can be installed and configured with NixOS options people have put together. For example to install steam I can add</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">nix</div><div class="code-container"><code><div class="line"><span style="color:#F8F8F2">{</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">programs</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">steam</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">enable</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">true</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>That single line will do a lot of work for you as you can see <a target="_blank" rel="noopener noreferrer" href="https://github.com/NixOS/nixpkgs/blob/9075cba53e86dc318d159aee55dc9a7c9a4829c1/nixos/modules/programs/steam.nix#L112">here</a>.
Enabling steam will also make sure you have OpenGL enabled, open firewall ports, and can be further configured if other steam options are set.</p>
<p>That is the magic of NixOS to me, many people have spent time figuring out all the edge cases/things you would normally need to do if you just installed a package and automates it all away for you.</p>
<p>The <a target="_blank" rel="noopener noreferrer" href="https://search.nixos.org/options">search page</a> is a great reference to find options defined in the standard library.</p>
<h3 id="using-nixos"><a href="#using-nixos" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Using NixOS</h3>
<p>That example is fine, but what do I actually do? My <a target="_blank" rel="noopener noreferrer" href="https://github.com/JRMurr/NixOsConfig">NixOS config repo</a> is organized as follows</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">shell</div><div class="code-container"><code><div class="line"><span style="color:#F8F8F2">❯ exa --tree --level 2</span></div><div class="line"><span style="color:#F8F8F2">├── common</span></div><div class="line"><span style="color:#F8F8F2">│  ├── audio.nix</span></div><div class="line"><span style="color:#F8F8F2">│  ├── autorandr.nix</span></div><div class="line"><span style="color:#F8F8F2">│  ├── containers.nix</span></div><div class="line"><span style="color:#F8F8F2">│  ├── default.nix</span></div><div class="line"><span style="color:#F8F8F2">│  ├── devlopment.nix</span></div><div class="line"><span style="color:#F8F8F2">│  ├── essentials.nix</span></div><div class="line"><span style="color:#F8F8F2">│  ├── fonts.nix</span></div><div class="line"><span style="color:#F8F8F2">│  ├── gestures</span></div><div class="line"><span style="color:#F8F8F2">│  ├── homemanager</span></div><div class="line"><span style="color:#F8F8F2">│  ├── kernel.nix</span></div><div class="line"><span style="color:#F8F8F2">│  ├── myOptions</span></div><div class="line"><span style="color:#F8F8F2">│  ├── network-shares.nix</span></div><div class="line"><span style="color:#F8F8F2">│  ├── plymouth.nix</span></div><div class="line"><span style="color:#F8F8F2">│  ├── programs.nix</span></div><div class="line"><span style="color:#F8F8F2">│  ├── ssh.nix</span></div><div class="line"><span style="color:#F8F8F2">│  ├── sudo.nix</span></div><div class="line"><span style="color:#F8F8F2">│  ├── tailscale.nix</span></div><div class="line"><span style="color:#F8F8F2">│  ├── users</span></div><div class="line"><span style="color:#F8F8F2">│  └── xserver.nix</span></div><div class="line"><span style="color:#F8F8F2">├── default.nix</span></div><div class="line"><span style="color:#F8F8F2">├── flake.lock</span></div><div class="line"><span style="color:#F8F8F2">├── flake.nix</span></div><div class="line"><span style="color:#F8F8F2">├── hosts</span></div><div class="line"><span style="color:#F8F8F2">│  ├── desktop</span></div><div class="line"><span style="color:#F8F8F2">│  ├── framework</span></div><div class="line"><span style="color:#F8F8F2">│  ├── thicc-server</span></div><div class="line"><span style="color:#F8F8F2">│  └── wsl</span></div><div class="line"><span style="color:#F8F8F2">├── legacyCommon.nix</span></div><div class="line"><span style="color:#F8F8F2">├── pkgs</span></div><div class="line"><span style="color:#F8F8F2">│  ├── caddy-with-plugins</span></div><div class="line"><span style="color:#F8F8F2">│  ├── default.nix</span></div><div class="line"><span style="color:#F8F8F2">│  └── overlay.nix</span></div><div class="line"><span style="color:#F8F8F2">└── README.md</span></div></code></div></pre></div>
<p>The <code>flake.nix</code> file is the entry point for everything, it roughly looks like this</p>
<div class="remark-code-title">flake.nix</div>
<div class="relative"><pre class="shiki dracula"><div class="language-id">nix</div><div class="code-container"><code><div class="line"><span style="color:#F8F8F2">{</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">inputs</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#6272A4"># ommited</span></div><div class="line"><span style="color:#F8F8F2">  };</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">outputs</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> { </span><span style="color:#FFB86C">self</span><span style="color:#FF79C6">,</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">nixpkgs</span><span style="color:#FF79C6">,</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">home-manager</span><span style="color:#FF79C6">,</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">wsl</span><span style="color:#FF79C6">,</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">flake-utils</span><span style="color:#FF79C6">,</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">... </span><span style="color:#F8F8F2">}@</span><span style="color:#FFB86C">inputs</span><span style="color:#F8F8F2">:</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">let</span></div><div class="line"><span style="color:#F8F8F2">      </span><span style="color:#50FA7B">overlays</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#FFB86C">inputs</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">attic</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">overlays</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">default</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#FFB86C">inputs</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">agenix</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">overlays</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">default</span></div><div class="line"><span style="color:#F8F8F2">        (</span><span style="color:#8BE9FD">import</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">./pkgs/overlay.nix</span><span style="color:#F8F8F2">)</span></div><div class="line"><span style="color:#F8F8F2">      ];</span></div><div class="line"><span style="color:#F8F8F2">      </span><span style="color:#50FA7B">defaultModules</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [</span></div><div class="line"><span style="color:#F8F8F2">        { </span><span style="color:#50FA7B">_module</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">args</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> { </span><span style="color:#FF79C6">inherit</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">inputs</span><span style="color:#F8F8F2">; }; }</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#FFB86C">inputs</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">agenix</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">nixosModules</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">default</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#FFB86C">home-manager</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">nixosModules</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">home-manager</span></div><div class="line"><span style="color:#F8F8F2">        {</span></div><div class="line"><span style="color:#F8F8F2">          </span><span style="color:#50FA7B">home-manager</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">useGlobalPkgs</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">true</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">          </span><span style="color:#50FA7B">home-manager</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">useUserPackages</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">true</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">        }</span></div><div class="line"><span style="color:#F8F8F2">      ];</span></div><div class="line"><span style="color:#F8F8F2">      </span><span style="color:#50FA7B">mkPkgs</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">system</span><span style="color:#F8F8F2">:</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#8BE9FD">import</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">nixpkgs</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">          </span><span style="color:#FF79C6">inherit</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">system</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">overlays</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">          </span><span style="color:#50FA7B">config</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">allowUnfree</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">true</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">        };</span></div><div class="line"><span style="color:#F8F8F2">      </span><span style="color:#50FA7B">mkSystem</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">extraModules</span><span style="color:#F8F8F2">:</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#FFB86C">nixpkgs</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">lib</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">nixosSystem</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">rec</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">          </span><span style="color:#50FA7B">pkgs</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">mkPkgs</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;x86_64-linux&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">          </span><span style="color:#50FA7B">system</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;x86_64-linux&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">          </span><span style="color:#50FA7B">modules</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">defaultModules</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">++</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">extraModules</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">        };</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">in</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">      </span><span style="color:#50FA7B">nixosConfigurations</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">nixos-john</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">mkSystem</span><span style="color:#F8F8F2"> [ </span><span style="color:#F1FA8C">./hosts/desktop</span><span style="color:#F8F8F2"> ];</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">wsl</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">mkSystem</span><span style="color:#F8F8F2"> [ </span><span style="color:#FFB86C">wsl</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">nixosModules</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">wsl</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">./hosts/wsl</span><span style="color:#F8F8F2"> ];</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">framework</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">mkSystem</span><span style="color:#F8F8F2"> [</span></div><div class="line"><span style="color:#F8F8F2">          </span><span style="color:#FFB86C">inputs</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">nixos-hardware</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">nixosModules</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">framework</span></div><div class="line"><span style="color:#F8F8F2">          </span><span style="color:#F1FA8C">./hosts/framework</span></div><div class="line"><span style="color:#F8F8F2">        ];</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">thicc-server</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">mkSystem</span><span style="color:#F8F8F2"> [</span></div><div class="line"><span style="color:#F8F8F2">          </span><span style="color:#F1FA8C">./hosts/thicc-server</span></div><div class="line"><span style="color:#F8F8F2">          </span><span style="color:#FFB86C">inputs</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">vscode-server</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">nixosModule</span></div><div class="line"><span style="color:#F8F8F2">          </span><span style="color:#FFB86C">inputs</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">attic</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">nixosModules</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">atticd</span></div><div class="line"><span style="color:#F8F8F2">          ({ </span><span style="color:#FFB86C">config</span><span style="color:#FF79C6">,</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">pkgs</span><span style="color:#FF79C6">,</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">... </span><span style="color:#F8F8F2">}: { </span><span style="color:#50FA7B">services</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">vscode-server</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">enable</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">true</span><span style="color:#F8F8F2">; })</span></div><div class="line"><span style="color:#F8F8F2">        ];</span></div><div class="line"><span style="color:#F8F8F2">      };</span></div><div class="line"><span style="color:#F8F8F2">    };</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>I trimmed this file down to just the most important bit of the <code>nixosConfigurations</code> section in the <code>outputs</code>.
That section is a mapping of <code>hostname =&gt; nixosConfigOptions</code>, so the <code>framework</code> key is for my laptop, <code>thicc-server</code> is my server, and so on.
The <code>mkSystem</code> function will add some default modules for setting up <a target="_blank" rel="noopener noreferrer" href="https://github.com/nix-community/home-manager">Home Manager</a> and <a target="_blank" rel="noopener noreferrer" href="https://github.com/ryantm/agenix">agenix</a> (will explain those later), and adds in the specified modules for that host.</p>
<p>You may have noticed in the list of modules some elements are file paths like <code>./hosts/thicc-server</code>, some are just variables like <code>inputs.nixos-hardware.nixosModules.framework</code>, and some are inline functions like <code>({ config, pkgs, ... }: { services.vscode-server.enable = true; })</code>.
Each is functionally the same, they all will turn into a module function like I showed at the beginning of this post.</p>
<h2 id="diving-into-my-server-config"><a href="#diving-into-my-server-config" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Diving into my Server Config</h2>
<p>I briefly covered how NixOS modules works and how you might organize your systems, but what does a single system look like? So now lets dive into my server (<code>thicc-server</code>) config.</p>
<p>The main part of the config lives in the <code>./hosts/thicc-server</code> folder, which looks like this</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">shell</div><div class="code-container"><code><div class="line"><span style="color:#F8F8F2">❯ exa --tree --level 2 ./hosts/thicc-server/</span></div><div class="line"><span style="color:#F8F8F2">./hosts/thicc-server</span></div><div class="line"><span style="color:#F8F8F2">├── attic.nix</span></div><div class="line"><span style="color:#F8F8F2">├── blocky</span></div><div class="line"><span style="color:#F8F8F2">│  ├── default.nix</span></div><div class="line"><span style="color:#F8F8F2">│  └── whitelist.txt</span></div><div class="line"><span style="color:#F8F8F2">├── caddy</span></div><div class="line"><span style="color:#F8F8F2">│  ├── default.nix</span></div><div class="line"><span style="color:#F8F8F2">│  ├── options.nix</span></div><div class="line"><span style="color:#F8F8F2">│  └── reverse-proxies.nix</span></div><div class="line"><span style="color:#F8F8F2">├── dashy.nix</span></div><div class="line"><span style="color:#F8F8F2">├── default.nix</span></div><div class="line"><span style="color:#F8F8F2">├── freshrss.nix</span></div><div class="line"><span style="color:#F8F8F2">├── hardware-configuration.nix</span></div><div class="line"><span style="color:#F8F8F2">├── it-tools.nix</span></div><div class="line"><span style="color:#F8F8F2">├── linkding.nix</span></div><div class="line"><span style="color:#F8F8F2">├── monitoring</span></div><div class="line"><span style="color:#F8F8F2">│  ├── default.nix</span></div><div class="line"><span style="color:#F8F8F2">│  ├── grafana.nix</span></div><div class="line"><span style="color:#F8F8F2">│  ├── loki.nix</span></div><div class="line"><span style="color:#F8F8F2">│  └── prometheus.nix</span></div><div class="line"><span style="color:#F8F8F2">├── mopidy.nix</span></div><div class="line"><span style="color:#F8F8F2">└── postgres.nix</span></div></code></div></pre></div>
<p>When you reference a folder in nix import, nix will read from the <code>default.nix</code> (similar to how JS will import a <code>index.js</code> file if you import from a folder).</p>
<div class="remark-code-title">hosts/thicc-server/default.nix</div>
<div class="relative"><pre class="shiki dracula"><div class="language-id">nix</div><div class="code-container"><code><div class="line"><span style="color:#F8F8F2">{ </span><span style="color:#FFB86C">config</span><span style="color:#FF79C6">,</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">pkgs</span><span style="color:#FF79C6">,</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">... </span><span style="color:#F8F8F2">}: {</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">imports</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#F1FA8C">./hardware-configuration.nix</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#F1FA8C">../../common</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#F1FA8C">./attic.nix</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#F1FA8C">./blocky</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#F1FA8C">./caddy</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#F1FA8C">./dashy.nix</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#F1FA8C">./freshrss.nix</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#F1FA8C">./it-tools.nix</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#F1FA8C">./monitoring</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#F1FA8C">./linkding.nix</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#F1FA8C">./mopidy.nix</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#F1FA8C">./postgres.nix</span></div><div class="line"><span style="color:#F8F8F2">  ];</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">time</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">timeZone</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;America/New_York&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">networking</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">hostName</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;thicc-server&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">myOptions</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">graphics</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">enable</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">false</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">networkShares</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">enable</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">true</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">containers</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">enable</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">true</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">  };</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">boot</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">loader</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">systemd-boot</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">enable</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">true</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">efi</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">canTouchEfiVariables</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">true</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">  };</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">services</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">openssh</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">enable</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">true</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">settings</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">PermitRootLogin</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;yes&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">  };</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">virtualisation</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">docker</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">enable</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">true</span><span style="color:#F8F8F2">;</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">system</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">stateVersion</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;21.11&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>So this file does some &quot;core&quot; options like hostname, timezone, enabling some of my custom options (in the <code>myOptions</code> section), and it imports the other files in this folder and from <code>common</code></p>
<h3 id="managing-complex-services"><a href="#managing-complex-services" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Managing complex services</h3>
<p>Where NixOS really shines is how you manage services that need a lot of configuration like Grafana or Prometheus.
People have either done a lot of groundwork for you and exposed a simple interface to get something spun up.
If not, it&#x27;s easy to make your own abstraction.</p>
<p>For example here is my config to set up Grafana</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">nix</div><div class="code-container"><code><div class="line"><span style="color:#F8F8F2">{ </span><span style="color:#FFB86C">config</span><span style="color:#FF79C6">,</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">... </span><span style="color:#F8F8F2">}:</span></div><div class="line"><span style="color:#FF79C6">let</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">myDomain</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">config</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">myCaddy</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">domain</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">grafanaDomain</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;grafana.</span><span style="color:#FF79C6">${</span><span style="color:#FFB86C">myDomain</span><span style="color:#FF79C6">}</span><span style="color:#F1FA8C">&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">port</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">3030</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#FF79C6">in</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">services</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">grafana</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">enable</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">true</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">settings</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">      </span><span style="color:#50FA7B">server</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">http_addr</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;0.0.0.0&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">http_port</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">port</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">domain</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">grafanaDomain</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">      };</span></div><div class="line"><span style="color:#F8F8F2">    };</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">provision</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">enable</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">true</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">  };</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">myCaddy</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">reverseProxies</span><span style="color:#F8F8F2">.</span><span style="color:#F1FA8C">&quot;grafana&quot;</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">upstream</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;:</span><span style="color:#FF79C6">${</span><span style="color:#BD93F9">builtins</span><span style="color:#FF79C6">.</span><span style="color:#8BE9FD">toString</span><span style="color:#F1FA8C"> </span><span style="color:#FFB86C">port</span><span style="color:#FF79C6">}</span><span style="color:#F1FA8C">&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>This file is almost like a docker compose where you set some env vars for ports and listening addresses, but I have the benefit of reading from other NixOS options to set variables (and it won&#x27;t run in a container).</p>
<p>For example at the top I read in <code>myDomain = config.myCaddy.domain;</code>, this is an option I set <a target="_blank" rel="noopener noreferrer" href="https://github.com/JRMurr/NixOsConfig/blob/main/hosts/thicc-server/caddy/options.nix#L51">here</a> that is just a variable holding the domain for my home lab. This way the Grafana domain will change automatically if I decide to change my domain (unlikely but DRY, so it makes me feel good).</p>
<p>I also use <code>myCaddy.reverseProxies.&quot;grafana&quot;.upstream</code> which is another custom option of mine to generate a reverse proxy config in caddy. This will make a URL for Grafana at <code>https://grafana.&lt;mydomain&gt;</code>.</p>
<p>To me this is magic, one file has all the config needed to spin up Grafana and set the necessary caddy options for me. If I decide to stop using Grafana, I can delete this file, and It&#x27;s as if it never existed with no dangling reverse proxies going to nowhere.</p>
<p>For some slightly more involved config, see my <a target="_blank" rel="noopener noreferrer" href="https://github.com/JRMurr/NixOsConfig/blob/main/hosts/thicc-server/monitoring/prometheus.nix#L4">Prometheus config</a>, it references some Grafana options to auto register data sources for me.</p>
<h2 id="managing-secrets"><a href="#managing-secrets" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Managing secrets</h2>
<p>When configuring services you will eventually need to manage secrets somehow. Some services will need an API key or password to function and leaving that in plain text in git or the nix store is a no-no (since they can be read easily). Up until recently I didn&#x27;t really care, I didn&#x27;t configure too many services that needed it, so I would either not care or use some hacky workaround.</p>
<p>Now I use <a target="_blank" rel="noopener noreferrer" href="https://github.com/ryantm/agenix">agenix</a> to encrypt my secrets. At a high level agenix is a wrapper around <a target="_blank" rel="noopener noreferrer" href="https://github.com/FiloSottile/age">age</a> which uses ssh keys to encrypt and decrypt files. The nice part is you can specify multiple keys to use as encryption and decryption. So for example I can list my user ssh key and the root ssh key for my server. So when adding/editing secrets I just need my private ssh key to decrypt, then using my public keys I can encrypt the updated secret.</p>
<p>agenix adds NixOS options like</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">nix</div><div class="code-container"><code><div class="line"><span style="color:#F8F8F2">{</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#6272A4"># register the secret</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">age</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">secrets</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">caddy-cloudflare</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">file</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;</span><span style="color:#FF79C6">${</span><span style="color:#FFB86C">inputs</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">secrets</span><span style="color:#FF79C6">}</span><span style="color:#F1FA8C">/secrets/caddy-cloudflare.age&quot;</span><span style="color:#F8F8F2">; </span><span style="color:#6272A4"># path to encrpyted secret file</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#6272A4"># let the caddy user read the secret</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">owner</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">config</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">services</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">caddy</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">user</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">group</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">config</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">services</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">caddy</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">group</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">  };</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">systemd</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">services</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">caddy</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">serviceConfig</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#6272A4"># read the secret</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">EnvironmentFile</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">config</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">age</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">secrets</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">caddy-cloudflare</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">path</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">  };</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>The first option will tell agenix to decrypt the secret file <code>caddy-cloudflare.age</code> when building the system config, and it will put the decrypted file at a path only readable by root (or in this case the caddy user since I set those options).</p>
<p>Then you need to use the file, most services in NixOS will have some option to read secrets set at a path, so in this case <code>systemd.services.caddy.serviceConfig.EnvironmentFile</code> will have systemd read the path specified on startup.</p>
<h3 id="the-secret-repo"><a href="#the-secret-repo" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The Secret Repo</h3>
<p>In my nix config I keep my secrets in a separate private repo, It&#x27;s not necessary since the age encrypted files will exist in the nix store anyway but gives me a little piece of mind just in case I mess up somehow.</p>
<p>That repo looks like this</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">shell</div><div class="code-container"><code><div class="line"><span style="color:#F8F8F2">❯ exa --tree --level 2</span></div><div class="line"><span style="color:#8BE9FD">.</span></div><div class="line"><span style="color:#F8F8F2">├── flake.lock</span></div><div class="line"><span style="color:#F8F8F2">├── flake.nix</span></div><div class="line"><span style="color:#F8F8F2">└── secrets</span></div><div class="line"><span style="color:#F8F8F2">   ├── attic-admin-token.age</span></div><div class="line"><span style="color:#F8F8F2">   ├── attic-creds.age</span></div><div class="line"><span style="color:#F8F8F2">    ...</span></div><div class="line"><span style="color:#F8F8F2">   └── secrets.nix</span></div></code></div></pre></div>
<p>where the flake is</p>
<div class="remark-code-title">flake.nix</div>
<div class="relative"><pre class="shiki dracula"><div class="language-id">nix</div><div class="code-container"><code><div class="line"><span style="color:#F8F8F2">{</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">inputs</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">nixpkgs</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">url</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;github:nixos/nixpkgs/nixos-unstable&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">flake-utils</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">url</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;github:numtide/flake-utils&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">agenix</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">url</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;github:ryantm/agenix&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">  };</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">outputs</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> { </span><span style="color:#FFB86C">self</span><span style="color:#FF79C6">,</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">nixpkgs</span><span style="color:#FF79C6">,</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">flake-utils</span><span style="color:#FF79C6">,</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">... </span><span style="color:#F8F8F2">}@</span><span style="color:#FFB86C">inputs</span><span style="color:#F8F8F2">:</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">overlays</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [ </span><span style="color:#FFB86C">inputs</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">agenix</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">overlays</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">default</span><span style="color:#F8F8F2"> ];</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">in</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">flake-utils</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">lib</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">eachDefaultSystem</span><span style="color:#F8F8F2"> (</span><span style="color:#FFB86C">system</span><span style="color:#F8F8F2">:</span></div><div class="line"><span style="color:#F8F8F2">      </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">pkgs</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">import</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">nixpkgs</span><span style="color:#F8F8F2"> { </span><span style="color:#FF79C6">inherit</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">system</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">overlays</span><span style="color:#F8F8F2">; };</span></div><div class="line"><span style="color:#F8F8F2">      </span><span style="color:#FF79C6">in</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">devShells</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">          </span><span style="color:#50FA7B">default</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">pkgs</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">mkShell</span><span style="color:#F8F8F2"> { </span><span style="color:#50FA7B">buildInputs</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">with</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">pkgs</span><span style="color:#F8F8F2">; [ </span><span style="color:#FFB86C">agenix</span><span style="color:#F8F8F2"> ]; };</span></div><div class="line"><span style="color:#F8F8F2">        };</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">secrets</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">./secrets</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">      });</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>So TLDR just exposes a flake output of <code>secrets</code> which is a directory containing all my age encrypted files. This lets me reference the encrypted files like <code>&quot;${inputs.secrets}/secrets/caddy-cloudflare.age&quot;;</code> in my main nix config repo.</p>
<p>This is the main file that does the magic for what keys are valid for each secret</p>
<div class="remark-code-title">secrets.nix</div>
<div class="relative"><pre class="shiki dracula"><div class="language-id">nix</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">let</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#6272A4"># all public keys in this file</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">githubKeys</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#6272A4"># https://github.com/jrmurr.keys</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF5555">...</span></div><div class="line"><span style="color:#F8F8F2">  ];</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#6272A4"># ssh-keyscan &lt;ip&gt; or sudo cat /etc/ssh/ssh_host_ed25519_key.pub for root keys</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">linux-desktop</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">root</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;ssh-ed25519 ...&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">user</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;ssh-ed25519 ...&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">  };</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">thicc-server</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">root</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;ssh-ed25519 ...&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">user</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;ssh-ed25519 ..&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">  };</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">framework</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">root</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;ssh-ed25519 ...&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">user</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;ssh-ed25519 ...&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">  };</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">hosts</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [ </span><span style="color:#FFB86C">linux-desktop</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">thicc-server</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">framework</span><span style="color:#F8F8F2"> ];</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">getUser</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">host</span><span style="color:#F8F8F2">: </span><span style="color:#FFB86C">host</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">user</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">getRoot</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">host</span><span style="color:#F8F8F2">: </span><span style="color:#FFB86C">host</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">root</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">getAllKeysForHost</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">host</span><span style="color:#F8F8F2">: [ (</span><span style="color:#FFB86C">getUser</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">host</span><span style="color:#F8F8F2">) (</span><span style="color:#FFB86C">getRoot</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">host</span><span style="color:#F8F8F2">) ];</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">knownUsers</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> (</span><span style="color:#BD93F9">builtins</span><span style="color:#FF79C6">.</span><span style="color:#8BE9FD">map</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">getUser</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">hosts</span><span style="color:#F8F8F2">);</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">users</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">githubKeys</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">++</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">knownUsers</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">systems</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> (</span><span style="color:#BD93F9">builtins</span><span style="color:#FF79C6">.</span><span style="color:#8BE9FD">map</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">getRoot</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">hosts</span><span style="color:#F8F8F2">);</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">allKeys</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">users</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">++</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">systems</span><span style="color:#F8F8F2">;</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">serverSecretKeys</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">knownUsers</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">++</span><span style="color:#F8F8F2"> [</span></div><div class="line"><span style="color:#F8F8F2">    (</span><span style="color:#FFB86C">getRoot</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">thicc-server</span><span style="color:#F8F8F2">)</span></div><div class="line"><span style="color:#F8F8F2">  ]; </span><span style="color:#6272A4"># allow all user keys to modify the thicc server secrets</span></div><div class="line"><span style="color:#FF79C6">in</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#F1FA8C">&quot;jr-pass.age&quot;</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">publicKeys</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">allKeys</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#F1FA8C">&quot;mopidy-spotify.age&quot;</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">publicKeys</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">allKeys</span><span style="color:#F8F8F2">;</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#F1FA8C">&quot;freshrss-user-pass.age&quot;</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">publicKeys</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">serverSecretKeys</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#F1FA8C">&quot;caddy-cloudflare.age&quot;</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">publicKeys</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">serverSecretKeys</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#6272A4"># other stuff ...</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>so in the let block I define all my systems with their user keys and root system keys.
Then some helper functions for getting a key I want from a host.
Finally, I make a list of <code>allKeys</code> so every one of my user and root keys and encrypt/decrypt some common secrets like my user password and some API keys.
The other list is <code>serverSecretKeys</code> which is the root key for my server (which has the most secrets) and all user keys. This lets me modify the secret on all my system, but the only root account to encrypt/decrypt is my server.</p>
<p>When I want to add a new secret I add a new file name in the <code>attrset</code> at the bottom of the file with the list of keys which are valid to encrypt/decrypt and run <code>agenix -e &lt;filename&gt;</code>, once my editor closes the file will be created.</p>
<h2 id="managing-dotfiles-with-home-manager"><a href="#managing-dotfiles-with-home-manager" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Managing Dotfiles with Home Manager</h2>
<p>Everything I showed is dope for complex services you would run on a server, but what about dotfiles like my fish, git, and i3 config?</p>
<p>This is where <a target="_blank" rel="noopener noreferrer" href="https://github.com/nix-community/home-manager">Home Manager</a> comes in. Home Manger gives you the NixOS module system for things that are configured in your user&#x27;s home directory.</p>
<p>For example this</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">nix</div><div class="code-container"><code><div class="line"><span style="color:#F8F8F2">{</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">home-manager</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">users</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">jr</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">programs</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">kitty</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">      </span><span style="color:#50FA7B">enable</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">true</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">      </span><span style="color:#50FA7B">shellIntegration</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">enableFishIntegration</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">true</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">      </span><span style="color:#50FA7B">settings</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">font_family</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;FiraCode Nerd Font&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">bold_font</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;auto&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">italic_font</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;auto&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">bold_italic_font</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;auto&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">enable_audio_bell</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">false</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">scrollback_lines</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">-</span><span style="color:#BD93F9">1</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">tab_bar_edge</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;top&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">allow_remote_control</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;yes&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">shell_integration</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;enabled&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">macos_option_as_alt</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;yes&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">shell</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;fish&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">      };</span></div><div class="line"><span style="color:#F8F8F2">      </span><span style="color:#50FA7B">theme</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;Dracula&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">    };</span></div><div class="line"><span style="color:#F8F8F2">  };</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>When home manager is run (as a NixOS module or stand alone), it will install <a target="_blank" rel="noopener noreferrer" href="https://sw.kovidgoyal.net/kitty/">kitty</a> if we don&#x27;t have it, and generate the kitty config file at <code>~/.config/kitty/kitty.conf</code> (for the user <code>jr</code> in this example), and since I set <code>shellIntegration.enableFishIntegration</code>, it will add lines to my fish config to add kitty completions.</p>
<p>Personally I found Home Manager to be much more useful than &quot;normal&quot; NixOS at first, I had an annoying way of managing my dot files across machines and Home Manager simplified it greatly. It also works for macOS, so you can share cross-platform config easily.</p>
<p>I put most of my Home Manager config into a separate <a target="_blank" rel="noopener noreferrer" href="https://github.com/JRMurr/NixOsConfig/tree/main/common/homemanager">home manager folder/module</a>, I then don&#x27;t reference the <code>home-manager.users.&lt;username&gt;</code> prefix in any of those files. So for example in the kitty config above I only export <code> programs.kitty = { ... }</code> and not <code>home-manager.users.jr.programs.kitty = {...}</code>. This lets me share the same home manager config for multiple NixOS users (if I wanted) and standalone home manager on macOS.</p>
<p>For example, my NixOS user has something like</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">nix</div><div class="code-container"><code><div class="line"><span style="color:#F8F8F2">{</span></div><div class="line"><span style="color:#50FA7B">home-manager</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">users</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">jr</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> (</span><span style="color:#8BE9FD">import</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">./hm.nix</span><span style="color:#F8F8F2"> {});</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>this will add all the options in <code>jr-hm.nix</code> under <code>home-manager.users.jr</code></p>
<p>and the <code>hm.nix</code> file will import my home manager module like so</p>
<div class="remark-code-title">hm.nix</div>
<div class="relative"><pre class="shiki dracula"><div class="language-id">nix</div><div class="code-container"><code><div class="line"><span style="color:#F8F8F2">{ </span><span style="color:#FF79C6">... </span><span style="color:#F8F8F2">}: {</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">imports</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [ </span><span style="color:#F1FA8C">../../homemanager</span><span style="color:#F8F8F2"> ];</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#6272A4"># Everything in this file will be under home-manager.users.&lt;name&gt;</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#6272A4"># https://rycee.gitlab.io/home-manager/options.html</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">xdg</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">enable</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">true</span><span style="color:#F8F8F2">;</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#6272A4"># https://nix-community.github.io/home-manager/release-notes.html#sec-release-22.11-highlights</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">home</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">stateVersion</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;18.09&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>To see the real example see <a target="_blank" rel="noopener noreferrer" href="https://github.com/JRMurr/NixOsConfig/blob/main/common/users/jr.nix">here</a></p>
<h3 id="home-manager-on-mac"><a href="#home-manager-on-mac" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Home Manager on Mac</h3>
<p>For macOS once you have nix installed you can follow <a target="_blank" rel="noopener noreferrer" href="https://nix-community.github.io/home-manager/index.html#ch-nix-flakes">this guide</a> to enable flakes and do some home manager init if you don&#x27;t have a config already.</p>
<p>For my case since I already had my NixOS flake, I just needed to add a new flake output <code>homeConfiguration.&lt;macOSUserName&gt;</code>, see <a target="_blank" rel="noopener noreferrer" href="https://github.com/JRMurr/NixOsConfig/blob/556f48bfa290185b595b71c4a8d2124efd0d851f/flake.nix#L170">here</a> for my setup.</p>
<p>Then you can run <code>home-manager switch --flake &lt;pathToFlake&gt;#&lt;macOSUserName&gt;</code> to install/update your config.</p>
<p>One thing to note when sharing config cross-platform is certain programs/options might not work on macOS, to gate that in your config you can use <code>pkgs.stdenv.isDarwin</code> which will be true on macOS and false elsewhere. The <code>lib.mkIf</code> function will let you conditionally add settings based on a condition. So for example to disable i3 on macOS you could do</p>
<div class="remark-code-title">i3.nix</div>
<div class="relative"><pre class="shiki dracula"><div class="language-id">nix</div><div class="code-container"><code><div class="line"><span style="color:#F8F8F2">{</span><span style="color:#FFB86C">pkgs</span><span style="color:#FF79C6">,...</span><span style="color:#F8F8F2">}: {</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">config</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">lib</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">mkIf</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">!</span><span style="color:#FFB86C">pkgs</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">stdenv</span><span style="color:#FF79C6">.</span><span style="color:#FFB86C">isDarwin</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">xsession</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">windowManager</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">i3</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> { </span><span style="color:#50FA7B">enable</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#BD93F9">true</span><span style="color:#F8F8F2">; ...}</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#FF5555">}</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<h2 id="wrap-up"><a href="#wrap-up" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Wrap up</h2>
<p>NixOS + Home Manager feels like something from the future (even though nix is like 20 years old....). The freedom you have to change and experiment is amazing. I didn&#x27;t even go into some other awesome features like system rollback, distributed builds, and making your own configuration options.</p>
<p>If you want to give NixOS a shot I think <a target="_blank" rel="noopener noreferrer" href="https://github.com/JRMurr/NixOsConfig/tree/main">my config</a> is hopefully easy to follow. Leave a comment if you want any help!</p></div></div></div></div></article></div></main><footer><div class="flex flex-col items-center mt-16"><div class="flex mb-3 space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer me" href="https://github.com/JRMurr"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer me" href="https://twitter.com/JRMurrCodes"><span class="sr-only">twitter</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M23.953 4.57a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.06a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.936 4.936 0 0 0 4.604 3.417 9.867 9.867 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0 0 24 4.59z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer me" href="https://hachyderm.io/@jrmurr"><span class="sr-only">mastodon</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-8 w-8"><path d="M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer me" href="/feed.xml"><span class="sr-only">rss</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24.912 24.912" style="enable-background:new 0 0 24.912 24.912" xml:space="preserve" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M3.692 17.517A3.696 3.696 0 0 0 0 21.211C0 23.244 1.656 24.9 3.692 24.9s3.694-1.657 3.694-3.689a3.697 3.697 0 0 0-3.694-3.694z"></path><path d="M.384 8.142A.386.386 0 0 0 0 8.527v4.688c0 .211.173.383.384.383 6.02 0 10.919 4.898 10.919 10.92 0 .209.171.383.384.383h4.705a.385.385 0 0 0 .387-.383l-.018-.121C16.692 15.423 9.37 8.142.384 8.142z"></path><path d="M24.89 24.397C24.825 10.936 13.854.011.384.011A.385.385 0 0 0 0 .397v4.824c0 .212.173.383.384.383 10.429 0 18.913 8.486 18.913 18.914 0 .209.172.383.382.383h4.845a.39.39 0 0 0 .388-.383l-.022-.121z"></path></svg></a></div><div class="flex mb-2 space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>John Murray</div><div> • </div><div>© 2023</div><div> • </div><a href="/">John&#x27;s Codes</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var d=Object.create;var r=Object.defineProperty;var t=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,y=Object.prototype.hasOwnProperty;var i=n=\u003er(n,\"__esModule\",{value:!0});var m=(n,s)=\u003e()=\u003e(s||n((s={exports:{}}).exports,s),s.exports),v=(n,s)=\u003e{i(n);for(var c in s)r(n,c,{get:s[c],enumerable:!0})},u=(n,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let e of h(s))!y.call(n,e)\u0026\u0026e!==\"default\"\u0026\u0026r(n,e,{get:()=\u003es[e],enumerable:!(c=t(s,e))||c.enumerable});return n},C=n=\u003eu(i(r(n!=null?d(p(n)):{},\"default\",n\u0026\u0026n.__esModule\u0026\u0026\"default\"in n?{get:()=\u003en.default,enumerable:!0}:{value:n,enumerable:!0})),n);var a=m((k,F)=\u003e{F.exports=_jsx_runtime});var A={};v(A,{default:()=\u003ef,frontmatter:()=\u003eg});var l=C(a()),g={title:\"Organizing system configs with NixOS\",date:new Date(1696835659315),tags:[\"NixOS\",\"nix\",\"guide\",\"dotfiles\"],draft:!1,summary:\"How I organize and manage my system and user configs with NixOS and homemanager\",images:[],layout:\"PostLayout\"};function N(n={}){let{wrapper:s}=n.components||{};return s?(0,l.jsx)(s,Object.assign({},n,{children:(0,l.jsx)(c,{})})):c();function c(){let e=Object.assign({p:\"p\",a:\"a\",h2:\"h2\",span:\"span\",h3:\"h3\",blockquote:\"blockquote\",pre:\"pre\",div:\"div\",code:\"code\"},n.components),{TOCInline:o}=e;return o||B(\"TOCInline\",!0),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o,{toc:n.toc,asDisclosure:!0}),`\n`,(0,l.jsxs)(e.p,{children:[`Nix and NixOS has been the technology I've been the most excited about in the last few years.\nWhile I have used Linux on my personal desktop and home server in the past, I never did anything complicated.\nIt was so hard to remember what I did to my system to get it to work the way I wanted.\nThis led to me keeping my systems very basic and eventually just using windows + docker for everything.\nWhile that setup worked fine, it was hard to customize things... I wanted to rice out my config like everyone on `,(0,l.jsx)(e.a,{href:\"https://www.reddit.com/r/unixporn/\",children:\"r/unixporn\"})]}),`\n`,(0,l.jsx)(e.p,{children:`When I found NixOS it was like a lightbulb went off. Now I can feel free to change my config as I please,\nnot be scared if I break something, and be able to reproduce my system if I need to reinstall or got a new machine.`}),`\n`,(0,l.jsx)(e.p,{children:`This post will be going over the \"vibe\" of using NixOS, I will explain how I set up my NixOS config and explain things in broad strokes as I go.\nI will link out to other posts/code to go into greater detail. I may get some things wrong as I explain so if you catch something please comment!`}),`\n`,(0,l.jsx)(e.p,{children:`My hope is for people who don't know NixOS this will get you to give it a try.\nIf you are using NixOS but feel lost, give you a path forward for feeling more comfortable using it.`}),`\n`,(0,l.jsxs)(e.h2,{id:\"what-is-nixos\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#what-is-nixos\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"What is NixOS\"]}),`\n`,(0,l.jsxs)(e.p,{children:[`A big point of confusion when using Nix is the difference between Nix, NixPkgs, and NixOS.\n`,(0,l.jsx)(e.a,{href:\"https://www.haskellforall.com/2022/08/stop-calling-everything-nix.html\",children:\"This post\"}),\" by \",(0,l.jsx)(e.a,{href:\"https://twitter.com/GabriellaG439\",children:\"Gabriella Gonzalez\"}),` does a great break down on the differences.\nFor a high level TLDR, `,(0,l.jsx)(e.a,{href:\"https://NixOS.org/\",children:\"NixOS\"}),\" is a Linux distro built on top of \",(0,l.jsx)(e.a,{href:\"https://github.com/NixOS/nixpkgs\",children:\"NixPkgs\"}),`.\nNixPkgs uses the `,(0,l.jsx)(e.a,{href:\"https://nix.dev/tutorials/first-steps/nix-language\",children:\"Nix language\"}),\" to define how to build packages.\"]}),`\n`,(0,l.jsx)(e.p,{children:\"There is more nuance than that, but it will be good enough to get started and for googling the right things.\"}),`\n`,(0,l.jsxs)(e.h3,{id:\"quick-nixlang-overview\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#quick-nixlang-overview\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Quick NixLang overview\"]}),`\n`,(0,l.jsx)(e.p,{children:\"For people new to nix I will go over the basics so the NixOS examples aren't completely foreign, if you know a little nix or other functional languages you can probably skip this part.\"}),`\n`,(0,l.jsxs)(e.p,{children:[\"I like this quote from \",(0,l.jsx)(e.a,{href:\"https://zero-to-nix.com/concepts/nix-language\",children:\"zero to nix\"}),\" to describe the language\"]}),`\n`,(0,l.jsxs)(e.blockquote,{children:[`\n`,(0,l.jsx)(e.p,{children:\"Nix is a pure, functional, lazy, declarative, and reproducible programming language.\"}),`\n`]}),`\n`,(0,l.jsx)(e.p,{children:\"NixLang is a lot like Haskell in that it is pure, functional, and lazy.\"}),`\n`,(0,l.jsx)(e.p,{children:\"This example should give a decent vibe of what programming in nix is like\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"nix\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"foo\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"x\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\": \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"y\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\": \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"x\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"in\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"foo\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"a\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" (\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"throw\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"sad\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:'# evals to \"a\"'})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"That example defines a function \",(0,l.jsx)(e.code,{children:\"(x: y: x;)\"}),\" which takes two arguments and returns the first, and binds it to the variable \",(0,l.jsx)(e.code,{children:\"foo\"}),\" with \",(0,l.jsx)(e.code,{children:\"let foo =...; in\"}),\". This means the variable \",(0,l.jsx)(e.code,{children:\"foo\"}),\" is only in scope after the \",(0,l.jsx)(e.code,{children:\"in\"}),\". Finally, we call foo with \",(0,l.jsx)(e.code,{children:'foo \"a\" (throw \"sad\")'}),'. This resolves to \"a\". Notice the error is not thrown because nix is lazy, that means if we never \"need\" to use a variable or expression, it will never be evaluated.']}),`\n`,(0,l.jsxs)(e.p,{children:[\"If we swap the order of the arguments to the function like \",(0,l.jsx)(e.code,{children:'foo (throw \"sad\") \"b\"'}),\", we will get\"]}),`\n`,(0,l.jsx)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsx)(e.code,{children:(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"undefined\"},children:`error:\n       \\u2026 while calling the 'throw' builtin\n\n         at \\xABstring\\xBB:1:29:\n\n            1| (let foo = x: y: x; in foo (throw \"sad\") \"b\")\n             |                             ^\n\n       error: sad`})})})})}),`\n`,(0,l.jsx)(e.p,{children:\"The laziness helps us right very declarative code, describe what you want and if you don't reference something, no worries, it won't affect performance.\"}),`\n`,(0,l.jsxs)(e.p,{children:[\"One of my favorite features of the nix language is how you can use \",(0,l.jsx)(e.code,{children:\"attrsets\"}),\" (objects, hash maps, dicts, etc.). You can create one like\"]}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"nix\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"foo\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"key1\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"bar\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"key2\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"nested1\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"1\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"nested2\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"2\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    };\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  };\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"in\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"foo\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"key2\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nested1\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# resolves to 1\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"at first, they look like normal objects from something like python or JS but my favorite feature of them is the syntax sugar for dealing with nested \",(0,l.jsx)(e.code,{children:\"attrsets\"})]}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"nix\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"foo\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"key1\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"bar\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"key2\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"nested1\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"1\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"key2\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"nested2\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"2\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"};\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"in\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"foo\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"key2\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nested1\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# resolves to 1\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"That snippet creates the same \",(0,l.jsx)(e.code,{children:\"attrset\"}),` as the example above but lets you use \"path notation\" to create the nested object.\nWhile a basic syntax sugar it makes it very easy to override 1 nested option when merging things together. Without it NixOS would be a big PITA to manage IMO.`]}),`\n`,(0,l.jsxs)(e.p,{children:[\"The last language feature I'll cover is the \",(0,l.jsx)(e.code,{children:\"with\"}),\" block.\"]}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"nix\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"with\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"1\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"; \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"b\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"2\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"; };\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"+\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"b\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# evals to 3\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"The with block will put all of an \",(0,l.jsx)(e.code,{children:\"attrset\"}),\"'s key value pairs as variable in scope. This makes it easier to access library functions with something like \",(0,l.jsx)(e.code,{children:\"with builtins\"}),\" or \",(0,l.jsx)(e.code,{children:\"with lib\"}),\", so you don't need to prefix everything.\"]}),`\n`,(0,l.jsxs)(e.h3,{id:\"a-basic-module\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#a-basic-module\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"A Basic Module\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"NixOS lets you organize your system into many \",(0,l.jsx)(e.a,{href:\"https://NixOS.wiki/wiki/NixOS_modules\",children:\"modules\"}),`.\nA module is a file or function that either declares options for other modules to use, or sets options defined in other modules.`]}),`\n`,(0,l.jsx)(e.p,{children:\"For example\"}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"hello.nix\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"nix\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# Taken from https://NixOS.wiki/wiki/NixOS_modules#Example\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"{ \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"lib\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"pkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"config\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"... \"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}:\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"with\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"lib\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# Shorter name to access final settings a\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# user of hello.nix module HAS ACTUALLY SET.\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# cfg is a typical convention.\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"cfg\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"config\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"services\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"hello\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"in\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:'# Declare what settings a user of this \"hello.nix\" module CAN SET.'})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"options\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"services\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"hello\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"enable\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"mkEnableOption\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"hello service\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"greeter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"mkOption\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"type\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"types\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"str\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"default\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"world\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    };\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  };\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# Define what other settings, services and resources should be active IF\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:'# a user of this \"hello.nix\" module ENABLED this module'})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:'# by setting \"services.hello.enable = true;\".'})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"config\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"mkIf\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"cfg\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"enable\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"systemd\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"services\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"hello\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"wantedBy\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" [ \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"multi-user.target\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" ];\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"serviceConfig\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"ExecStart\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"${\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"pkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"hello\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"/bin/hello -g'Hello, \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"${\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"escapeShellArg\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"cfg\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"greeter\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:`!'\"`}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    };\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  };\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"The file above adds the \",(0,l.jsx)(e.code,{children:\"services.hello\"}),\" option. When enabled NixOS will make a system service called \",(0,l.jsx)(e.code,{children:\"hello.service\"}),\" which will log \",(0,l.jsx)(e.code,{children:\"Hello \u003cgreeter\u003e!\"}),`.\nThe module/options it defined can be used like this`]}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"configuration.nix\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"nix\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"{\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"imports\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" [ \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"./hello.nix\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" ];\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  ...\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"services\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"hello\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"enable\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"true\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"greeter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"Bob\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  };\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"this file imports the module so the \",(0,l.jsx)(e.code,{children:\"services.hello\"}),\" exists and can be used. It also set the \",(0,l.jsx)(e.code,{children:\"greeter\"}),\" option we defined so the \",(0,l.jsx)(e.code,{children:\"hello.service\"}),\" will log \",(0,l.jsx)(e.code,{children:\"Hello Bob!\"})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"There are many options defined in the NixOS \",(0,l.jsx)(e.a,{href:\"https://nixos.org/manual/nixos/stable/options\",children:\"standard library\"}),`.\nMany programs can be installed and configured with NixOS options people have put together. For example to install steam I can add`]}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"nix\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"{\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"programs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"steam\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"enable\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"true\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"That single line will do a lot of work for you as you can see \",(0,l.jsx)(e.a,{href:\"https://github.com/NixOS/nixpkgs/blob/9075cba53e86dc318d159aee55dc9a7c9a4829c1/nixos/modules/programs/steam.nix#L112\",children:\"here\"}),`.\nEnabling steam will also make sure you have OpenGL enabled, open firewall ports, and can be further configured if other steam options are set.`]}),`\n`,(0,l.jsx)(e.p,{children:\"That is the magic of NixOS to me, many people have spent time figuring out all the edge cases/things you would normally need to do if you just installed a package and automates it all away for you.\"}),`\n`,(0,l.jsxs)(e.p,{children:[\"The \",(0,l.jsx)(e.a,{href:\"https://search.nixos.org/options\",children:\"search page\"}),\" is a great reference to find options defined in the standard library.\"]}),`\n`,(0,l.jsxs)(e.h3,{id:\"using-nixos\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#using-nixos\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Using NixOS\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"That example is fine, but what do I actually do? My \",(0,l.jsx)(e.a,{href:\"https://github.com/JRMurr/NixOsConfig\",children:\"NixOS config repo\"}),\" is organized as follows\"]}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"shell\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u276F exa --tree --level 2\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u251C\\u2500\\u2500 common\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 audio.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 autorandr.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 containers.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 default.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 devlopment.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 essentials.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 fonts.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 gestures\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 homemanager\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 kernel.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 myOptions\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 network-shares.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 plymouth.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 programs.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 ssh.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 sudo.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 tailscale.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 users\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u2514\\u2500\\u2500 xserver.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u251C\\u2500\\u2500 default.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u251C\\u2500\\u2500 flake.lock\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u251C\\u2500\\u2500 flake.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u251C\\u2500\\u2500 hosts\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 desktop\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 framework\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 thicc-server\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u2514\\u2500\\u2500 wsl\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u251C\\u2500\\u2500 legacyCommon.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u251C\\u2500\\u2500 pkgs\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 caddy-with-plugins\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 default.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u2514\\u2500\\u2500 overlay.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2514\\u2500\\u2500 README.md\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"The \",(0,l.jsx)(e.code,{children:\"flake.nix\"}),\" file is the entry point for everything, it roughly looks like this\"]}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"flake.nix\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"nix\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"{\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"inputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# ommited\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  };\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"outputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nixpkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"home-manager\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"wsl\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"flake-utils\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"... \"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}@\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"inputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\":\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"overlays\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" [\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"inputs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"attic\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"overlays\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"default\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"inputs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"agenix\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"overlays\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"default\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        (\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"import\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"./pkgs/overlay.nix\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      ];\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"defaultModules\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" [\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        { \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"_module\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"args\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"inherit\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"inputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"; }; }\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"inputs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"agenix\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nixosModules\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"default\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"home-manager\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nixosModules\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"home-manager\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        {\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"home-manager\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"useGlobalPkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"true\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"home-manager\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"useUserPackages\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"true\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      ];\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"mkPkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"system\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\":\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"import\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nixpkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"inherit\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"system\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"overlays\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"config\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"allowUnfree\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"true\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        };\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"mkSystem\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"extraModules\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\":\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nixpkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"lib\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nixosSystem\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"rec\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"pkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"mkPkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"x86_64-linux\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"system\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"x86_64-linux\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"modules\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"defaultModules\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"++\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"extraModules\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        };\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"in\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"nixosConfigurations\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"nixos-john\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"mkSystem\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" [ \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"./hosts/desktop\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" ];\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"wsl\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"mkSystem\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" [ \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"wsl\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nixosModules\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"wsl\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"./hosts/wsl\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" ];\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"framework\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"mkSystem\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" [\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"inputs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nixos-hardware\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nixosModules\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"framework\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"./hosts/framework\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        ];\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"thicc-server\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"mkSystem\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" [\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"./hosts/thicc-server\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"inputs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"vscode-server\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nixosModule\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"inputs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"attic\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nixosModules\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"atticd\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          ({ \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"config\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"pkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"... \"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}: { \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"services\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"vscode-server\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"enable\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"true\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"; })\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        ];\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      };\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    };\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"I trimmed this file down to just the most important bit of the \",(0,l.jsx)(e.code,{children:\"nixosConfigurations\"}),\" section in the \",(0,l.jsx)(e.code,{children:\"outputs\"}),`.\nThat section is a mapping of `,(0,l.jsx)(e.code,{children:\"hostname =\u003e nixosConfigOptions\"}),\", so the \",(0,l.jsx)(e.code,{children:\"framework\"}),\" key is for my laptop, \",(0,l.jsx)(e.code,{children:\"thicc-server\"}),` is my server, and so on.\nThe `,(0,l.jsx)(e.code,{children:\"mkSystem\"}),\" function will add some default modules for setting up \",(0,l.jsx)(e.a,{href:\"https://github.com/nix-community/home-manager\",children:\"Home Manager\"}),\" and \",(0,l.jsx)(e.a,{href:\"https://github.com/ryantm/agenix\",children:\"agenix\"}),\" (will explain those later), and adds in the specified modules for that host.\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"You may have noticed in the list of modules some elements are file paths like \",(0,l.jsx)(e.code,{children:\"./hosts/thicc-server\"}),\", some are just variables like \",(0,l.jsx)(e.code,{children:\"inputs.nixos-hardware.nixosModules.framework\"}),\", and some are inline functions like \",(0,l.jsx)(e.code,{children:\"({ config, pkgs, ... }: { services.vscode-server.enable = true; })\"}),`.\nEach is functionally the same, they all will turn into a module function like I showed at the beginning of this post.`]}),`\n`,(0,l.jsxs)(e.h2,{id:\"diving-into-my-server-config\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#diving-into-my-server-config\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Diving into my Server Config\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"I briefly covered how NixOS modules works and how you might organize your systems, but what does a single system look like? So now lets dive into my server (\",(0,l.jsx)(e.code,{children:\"thicc-server\"}),\") config.\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"The main part of the config lives in the \",(0,l.jsx)(e.code,{children:\"./hosts/thicc-server\"}),\" folder, which looks like this\"]}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"shell\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u276F exa --tree --level 2 ./hosts/thicc-server/\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"./hosts/thicc-server\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u251C\\u2500\\u2500 attic.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u251C\\u2500\\u2500 blocky\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 default.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u2514\\u2500\\u2500 whitelist.txt\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u251C\\u2500\\u2500 caddy\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 default.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 options.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u2514\\u2500\\u2500 reverse-proxies.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u251C\\u2500\\u2500 dashy.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u251C\\u2500\\u2500 default.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u251C\\u2500\\u2500 freshrss.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u251C\\u2500\\u2500 hardware-configuration.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u251C\\u2500\\u2500 it-tools.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u251C\\u2500\\u2500 linkding.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u251C\\u2500\\u2500 monitoring\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 default.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 grafana.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u251C\\u2500\\u2500 loki.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2502  \\u2514\\u2500\\u2500 prometheus.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u251C\\u2500\\u2500 mopidy.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2514\\u2500\\u2500 postgres.nix\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"When you reference a folder in nix import, nix will read from the \",(0,l.jsx)(e.code,{children:\"default.nix\"}),\" (similar to how JS will import a \",(0,l.jsx)(e.code,{children:\"index.js\"}),\" file if you import from a folder).\"]}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"hosts/thicc-server/default.nix\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"nix\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"{ \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"config\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"pkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"... \"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}: {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"imports\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" [\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"./hardware-configuration.nix\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"../../common\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"./attic.nix\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"./blocky\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"./caddy\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"./dashy.nix\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"./freshrss.nix\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"./it-tools.nix\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"./monitoring\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"./linkding.nix\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"./mopidy.nix\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"./postgres.nix\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  ];\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"time\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"timeZone\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"America/New_York\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"networking\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"hostName\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"thicc-server\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"myOptions\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"graphics\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"enable\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"false\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"networkShares\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"enable\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"true\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"containers\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"enable\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"true\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  };\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"boot\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"loader\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"systemd-boot\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"enable\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"true\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"efi\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"canTouchEfiVariables\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"true\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  };\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"services\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"openssh\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"enable\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"true\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"settings\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"PermitRootLogin\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"yes\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  };\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"virtualisation\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"docker\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"enable\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"true\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"system\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"stateVersion\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"21.11\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:['So this file does some \"core\" options like hostname, timezone, enabling some of my custom options (in the ',(0,l.jsx)(e.code,{children:\"myOptions\"}),\" section), and it imports the other files in this folder and from \",(0,l.jsx)(e.code,{children:\"common\"})]}),`\n`,(0,l.jsxs)(e.h3,{id:\"managing-complex-services\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#managing-complex-services\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Managing complex services\"]}),`\n`,(0,l.jsx)(e.p,{children:`Where NixOS really shines is how you manage services that need a lot of configuration like Grafana or Prometheus.\nPeople have either done a lot of groundwork for you and exposed a simple interface to get something spun up.\nIf not, it's easy to make your own abstraction.`}),`\n`,(0,l.jsx)(e.p,{children:\"For example here is my config to set up Grafana\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"nix\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"{ \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"config\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"... \"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}:\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"myDomain\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"config\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"myCaddy\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"domain\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"grafanaDomain\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"grafana.'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"${\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"myDomain\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"port\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"3030\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"in\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"services\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"grafana\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"enable\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"true\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"settings\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"server\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"http_addr\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"0.0.0.0\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"http_port\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"port\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"domain\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"grafanaDomain\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      };\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    };\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"provision\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"enable\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"true\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  };\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"myCaddy\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"reverseProxies\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"grafana\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"upstream\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\":'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"${\"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"builtins\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"toString\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"port\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsx)(e.p,{children:\"This file is almost like a docker compose where you set some env vars for ports and listening addresses, but I have the benefit of reading from other NixOS options to set variables (and it won't run in a container).\"}),`\n`,(0,l.jsxs)(e.p,{children:[\"For example at the top I read in \",(0,l.jsx)(e.code,{children:\"myDomain = config.myCaddy.domain;\"}),\", this is an option I set \",(0,l.jsx)(e.a,{href:\"https://github.com/JRMurr/NixOsConfig/blob/main/hosts/thicc-server/caddy/options.nix#L51\",children:\"here\"}),\" that is just a variable holding the domain for my home lab. This way the Grafana domain will change automatically if I decide to change my domain (unlikely but DRY, so it makes me feel good).\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"I also use \",(0,l.jsx)(e.code,{children:'myCaddy.reverseProxies.\"grafana\".upstream'}),\" which is another custom option of mine to generate a reverse proxy config in caddy. This will make a URL for Grafana at \",(0,l.jsx)(e.code,{children:\"https://grafana.\u003cmydomain\u003e\"}),\".\"]}),`\n`,(0,l.jsx)(e.p,{children:\"To me this is magic, one file has all the config needed to spin up Grafana and set the necessary caddy options for me. If I decide to stop using Grafana, I can delete this file, and It's as if it never existed with no dangling reverse proxies going to nowhere.\"}),`\n`,(0,l.jsxs)(e.p,{children:[\"For some slightly more involved config, see my \",(0,l.jsx)(e.a,{href:\"https://github.com/JRMurr/NixOsConfig/blob/main/hosts/thicc-server/monitoring/prometheus.nix#L4\",children:\"Prometheus config\"}),\", it references some Grafana options to auto register data sources for me.\"]}),`\n`,(0,l.jsxs)(e.h2,{id:\"managing-secrets\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#managing-secrets\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Managing secrets\"]}),`\n`,(0,l.jsx)(e.p,{children:\"When configuring services you will eventually need to manage secrets somehow. Some services will need an API key or password to function and leaving that in plain text in git or the nix store is a no-no (since they can be read easily). Up until recently I didn't really care, I didn't configure too many services that needed it, so I would either not care or use some hacky workaround.\"}),`\n`,(0,l.jsxs)(e.p,{children:[\"Now I use \",(0,l.jsx)(e.a,{href:\"https://github.com/ryantm/agenix\",children:\"agenix\"}),\" to encrypt my secrets. At a high level agenix is a wrapper around \",(0,l.jsx)(e.a,{href:\"https://github.com/FiloSottile/age\",children:\"age\"}),\" which uses ssh keys to encrypt and decrypt files. The nice part is you can specify multiple keys to use as encryption and decryption. So for example I can list my user ssh key and the root ssh key for my server. So when adding/editing secrets I just need my private ssh key to decrypt, then using my public keys I can encrypt the updated secret.\"]}),`\n`,(0,l.jsx)(e.p,{children:\"agenix adds NixOS options like\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"nix\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"{\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# register the secret\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"age\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"secrets\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"caddy-cloudflare\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"file\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"${\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"inputs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"secrets\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'/secrets/caddy-cloudflare.age\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"; \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# path to encrpyted secret file\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# let the caddy user read the secret\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"owner\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"config\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"services\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"caddy\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"user\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"group\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"config\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"services\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"caddy\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"group\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  };\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"systemd\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"services\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"caddy\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"serviceConfig\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# read the secret\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"EnvironmentFile\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"config\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"age\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"secrets\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"caddy-cloudflare\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"path\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  };\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"The first option will tell agenix to decrypt the secret file \",(0,l.jsx)(e.code,{children:\"caddy-cloudflare.age\"}),\" when building the system config, and it will put the decrypted file at a path only readable by root (or in this case the caddy user since I set those options).\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Then you need to use the file, most services in NixOS will have some option to read secrets set at a path, so in this case \",(0,l.jsx)(e.code,{children:\"systemd.services.caddy.serviceConfig.EnvironmentFile\"}),\" will have systemd read the path specified on startup.\"]}),`\n`,(0,l.jsxs)(e.h3,{id:\"the-secret-repo\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#the-secret-repo\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"The Secret Repo\"]}),`\n`,(0,l.jsx)(e.p,{children:\"In my nix config I keep my secrets in a separate private repo, It's not necessary since the age encrypted files will exist in the nix store anyway but gives me a little piece of mind just in case I mess up somehow.\"}),`\n`,(0,l.jsx)(e.p,{children:\"That repo looks like this\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"shell\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u276F exa --tree --level 2\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\".\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u251C\\u2500\\u2500 flake.lock\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u251C\\u2500\\u2500 flake.nix\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\\u2514\\u2500\\u2500 secrets\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"   \\u251C\\u2500\\u2500 attic-admin-token.age\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"   \\u251C\\u2500\\u2500 attic-creds.age\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    ...\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"   \\u2514\\u2500\\u2500 secrets.nix\"})})]})})]}),`\n`,(0,l.jsx)(e.p,{children:\"where the flake is\"}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"flake.nix\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"nix\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"{\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"inputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"nixpkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"url\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"github:nixos/nixpkgs/nixos-unstable\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"flake-utils\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"url\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"github:numtide/flake-utils\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"agenix\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"url\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"github:ryantm/agenix\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  };\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"outputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nixpkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"flake-utils\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"... \"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}@\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"inputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\":\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"overlays\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" [ \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"inputs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"agenix\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"overlays\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"default\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" ];\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"in\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"flake-utils\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"lib\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"eachDefaultSystem\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" (\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"system\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\":\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"pkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"import\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"nixpkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"inherit\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"system\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"overlays\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"; };\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"in\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"devShells\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"default\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"pkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"mkShell\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"buildInputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"with\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"pkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"; [ \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"agenix\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" ]; };\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        };\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"secrets\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"./secrets\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      });\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"So TLDR just exposes a flake output of \",(0,l.jsx)(e.code,{children:\"secrets\"}),\" which is a directory containing all my age encrypted files. This lets me reference the encrypted files like \",(0,l.jsx)(e.code,{children:'\"${inputs.secrets}/secrets/caddy-cloudflare.age\";'}),\" in my main nix config repo.\"]}),`\n`,(0,l.jsx)(e.p,{children:\"This is the main file that does the magic for what keys are valid for each secret\"}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"secrets.nix\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"nix\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# all public keys in this file\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"githubKeys\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" [\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# https://github.com/jrmurr.keys\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF5555\"},children:\"...\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  ];\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# ssh-keyscan \u003cip\u003e or sudo cat /etc/ssh/ssh_host_ed25519_key.pub for root keys\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"linux-desktop\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"root\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"ssh-ed25519 ...\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"user\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"ssh-ed25519 ...\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  };\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"thicc-server\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"root\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"ssh-ed25519 ...\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"user\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"ssh-ed25519 ..\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  };\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"framework\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"root\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"ssh-ed25519 ...\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"user\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"ssh-ed25519 ...\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  };\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"hosts\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" [ \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"linux-desktop\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"thicc-server\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"framework\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" ];\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"getUser\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"host\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\": \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"host\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"user\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"getRoot\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"host\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\": \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"host\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"root\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"getAllKeysForHost\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"host\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\": [ (\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"getUser\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"host\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") (\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"getRoot\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"host\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") ];\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"knownUsers\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" (\"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"builtins\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"map\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"getUser\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"hosts\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\");\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"users\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"githubKeys\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"++\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"knownUsers\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"systems\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" (\"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"builtins\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"map\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"getRoot\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"hosts\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\");\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"allKeys\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"users\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"++\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"systems\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"serverSecretKeys\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"knownUsers\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"++\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" [\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    (\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"getRoot\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"thicc-server\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  ]; \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# allow all user keys to modify the thicc server secrets\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"in\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"jr-pass.age\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"publicKeys\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"allKeys\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"mopidy-spotify.age\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"publicKeys\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"allKeys\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"freshrss-user-pass.age\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"publicKeys\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"serverSecretKeys\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"caddy-cloudflare.age\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"publicKeys\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"serverSecretKeys\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# other stuff ...\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[`so in the let block I define all my systems with their user keys and root system keys.\nThen some helper functions for getting a key I want from a host.\nFinally, I make a list of `,(0,l.jsx)(e.code,{children:\"allKeys\"}),` so every one of my user and root keys and encrypt/decrypt some common secrets like my user password and some API keys.\nThe other list is `,(0,l.jsx)(e.code,{children:\"serverSecretKeys\"}),\" which is the root key for my server (which has the most secrets) and all user keys. This lets me modify the secret on all my system, but the only root account to encrypt/decrypt is my server.\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"When I want to add a new secret I add a new file name in the \",(0,l.jsx)(e.code,{children:\"attrset\"}),\" at the bottom of the file with the list of keys which are valid to encrypt/decrypt and run \",(0,l.jsx)(e.code,{children:\"agenix -e \u003cfilename\u003e\"}),\", once my editor closes the file will be created.\"]}),`\n`,(0,l.jsxs)(e.h2,{id:\"managing-dotfiles-with-home-manager\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#managing-dotfiles-with-home-manager\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Managing Dotfiles with Home Manager\"]}),`\n`,(0,l.jsx)(e.p,{children:\"Everything I showed is dope for complex services you would run on a server, but what about dotfiles like my fish, git, and i3 config?\"}),`\n`,(0,l.jsxs)(e.p,{children:[\"This is where \",(0,l.jsx)(e.a,{href:\"https://github.com/nix-community/home-manager\",children:\"Home Manager\"}),\" comes in. Home Manger gives you the NixOS module system for things that are configured in your user's home directory.\"]}),`\n`,(0,l.jsx)(e.p,{children:\"For example this\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"nix\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"{\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"home-manager\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"users\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"jr\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"programs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"kitty\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"enable\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"true\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"shellIntegration\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"enableFishIntegration\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"true\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"settings\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"font_family\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"FiraCode Nerd Font\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"bold_font\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"auto\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"italic_font\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"auto\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"bold_italic_font\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"auto\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"enable_audio_bell\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"false\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"scrollback_lines\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"1\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"tab_bar_edge\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"top\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"allow_remote_control\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"yes\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"shell_integration\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"enabled\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"macos_option_as_alt\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"yes\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"shell\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"fish\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      };\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"theme\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"Dracula\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    };\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  };\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"When home manager is run (as a NixOS module or stand alone), it will install \",(0,l.jsx)(e.a,{href:\"https://sw.kovidgoyal.net/kitty/\",children:\"kitty\"}),\" if we don't have it, and generate the kitty config file at \",(0,l.jsx)(e.code,{children:\"~/.config/kitty/kitty.conf\"}),\" (for the user \",(0,l.jsx)(e.code,{children:\"jr\"}),\" in this example), and since I set \",(0,l.jsx)(e.code,{children:\"shellIntegration.enableFishIntegration\"}),\", it will add lines to my fish config to add kitty completions.\"]}),`\n`,(0,l.jsx)(e.p,{children:'Personally I found Home Manager to be much more useful than \"normal\" NixOS at first, I had an annoying way of managing my dot files across machines and Home Manager simplified it greatly. It also works for macOS, so you can share cross-platform config easily.'}),`\n`,(0,l.jsxs)(e.p,{children:[\"I put most of my Home Manager config into a separate \",(0,l.jsx)(e.a,{href:\"https://github.com/JRMurr/NixOsConfig/tree/main/common/homemanager\",children:\"home manager folder/module\"}),\", I then don't reference the \",(0,l.jsx)(e.code,{children:\"home-manager.users.\u003cusername\u003e\"}),\" prefix in any of those files. So for example in the kitty config above I only export \",(0,l.jsx)(e.code,{children:\" programs.kitty = { ... }\"}),\" and not \",(0,l.jsx)(e.code,{children:\"home-manager.users.jr.programs.kitty = {...}\"}),\". This lets me share the same home manager config for multiple NixOS users (if I wanted) and standalone home manager on macOS.\"]}),`\n`,(0,l.jsx)(e.p,{children:\"For example, my NixOS user has something like\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"nix\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"{\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"home-manager\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"users\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"jr\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" (\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"import\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"./hm.nix\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {});\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"this will add all the options in \",(0,l.jsx)(e.code,{children:\"jr-hm.nix\"}),\" under \",(0,l.jsx)(e.code,{children:\"home-manager.users.jr\"})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"and the \",(0,l.jsx)(e.code,{children:\"hm.nix\"}),\" file will import my home manager module like so\"]}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"hm.nix\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"nix\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"{ \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"... \"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}: {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"imports\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" [ \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"../../homemanager\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" ];\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# Everything in this file will be under home-manager.users.\u003cname\u003e\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# https://rycee.gitlab.io/home-manager/options.html\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"xdg\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"enable\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"true\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# https://nix-community.github.io/home-manager/release-notes.html#sec-release-22.11-highlights\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"home\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"stateVersion\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"18.09\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"To see the real example see \",(0,l.jsx)(e.a,{href:\"https://github.com/JRMurr/NixOsConfig/blob/main/common/users/jr.nix\",children:\"here\"})]}),`\n`,(0,l.jsxs)(e.h3,{id:\"home-manager-on-mac\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#home-manager-on-mac\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Home Manager on Mac\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"For macOS once you have nix installed you can follow \",(0,l.jsx)(e.a,{href:\"https://nix-community.github.io/home-manager/index.html#ch-nix-flakes\",children:\"this guide\"}),\" to enable flakes and do some home manager init if you don't have a config already.\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"For my case since I already had my NixOS flake, I just needed to add a new flake output \",(0,l.jsx)(e.code,{children:\"homeConfiguration.\u003cmacOSUserName\u003e\"}),\", see \",(0,l.jsx)(e.a,{href:\"https://github.com/JRMurr/NixOsConfig/blob/556f48bfa290185b595b71c4a8d2124efd0d851f/flake.nix#L170\",children:\"here\"}),\" for my setup.\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Then you can run \",(0,l.jsx)(e.code,{children:\"home-manager switch --flake \u003cpathToFlake\u003e#\u003cmacOSUserName\u003e\"}),\" to install/update your config.\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"One thing to note when sharing config cross-platform is certain programs/options might not work on macOS, to gate that in your config you can use \",(0,l.jsx)(e.code,{children:\"pkgs.stdenv.isDarwin\"}),\" which will be true on macOS and false elsewhere. The \",(0,l.jsx)(e.code,{children:\"lib.mkIf\"}),\" function will let you conditionally add settings based on a condition. So for example to disable i3 on macOS you could do\"]}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"i3.nix\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"nix\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"{\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"pkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\",...\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}: {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"config\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"lib\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"mkIf\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"!\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"pkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"stdenv\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"isDarwin\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"xsession\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"windowManager\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"i3\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"enable\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"true\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"; ...}\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#FF5555\"},children:\"}\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.h2,{id:\"wrap-up\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#wrap-up\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Wrap up\"]}),`\n`,(0,l.jsx)(e.p,{children:\"NixOS + Home Manager feels like something from the future (even though nix is like 20 years old....). The freedom you have to change and experiment is amazing. I didn't even go into some other awesome features like system rollback, distributed builds, and making your own configuration options.\"}),`\n`,(0,l.jsxs)(e.p,{children:[\"If you want to give NixOS a shot I think \",(0,l.jsx)(e.a,{href:\"https://github.com/JRMurr/NixOsConfig/tree/main\",children:\"my config\"}),\" is hopefully easy to follow. Leave a comment if you want any help!\"]})]})}}var f=N;function B(n,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+n+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return A;})();\n;return Component;","toc":[{"value":"What is NixOS","url":"#what-is-nixos","depth":2},{"value":"Quick NixLang overview","url":"#quick-nixlang-overview","depth":3},{"value":"A Basic Module","url":"#a-basic-module","depth":3},{"value":"Using NixOS","url":"#using-nixos","depth":3},{"value":"Diving into my Server Config","url":"#diving-into-my-server-config","depth":2},{"value":"Managing complex services","url":"#managing-complex-services","depth":3},{"value":"Managing secrets","url":"#managing-secrets","depth":2},{"value":"The Secret Repo","url":"#the-secret-repo","depth":3},{"value":"Managing Dotfiles with Home Manager","url":"#managing-dotfiles-with-home-manager","depth":2},{"value":"Home Manager on Mac","url":"#home-manager-on-mac","depth":3},{"value":"Wrap up","url":"#wrap-up","depth":2}],"frontMatter":{"readingTime":{"text":"15 min read","minutes":14.333333333333334,"time":860000,"words":3440},"slug":"organizing-system-configs-with-nixos","fileName":"organizing-system-configs-with-nixos.md","title":"Organizing system configs with NixOS","date":"2023-10-09T07:14:19.315Z","tags":["NixOS","nix","guide","dotfiles"],"draft":false,"summary":"How I organize and manage my system and user configs with NixOS and homemanager","images":[],"layout":"PostLayout"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.17916666666666667,"time":10750,"words":43},"slug":["default"],"fileName":"default.md","name":"John Murray","avatar":"/static/images/me.jpg","occupation":"Software Engineer","github":"https://github.com/JRMurr","twitter":"https://twitter.com/JRMurrCodes","mastodon":"https://hachyderm.io/@jrmurr","email":"johnreillymurray@gmail.com","date":null}],"series":null},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["organizing-system-configs-with-nixos"]},"buildId":"VjYh7k8e50Akk-SVaYPII","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>