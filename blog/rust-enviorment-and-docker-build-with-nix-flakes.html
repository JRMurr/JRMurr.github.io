<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" content="#000000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/1916f81add1b139f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1916f81add1b139f.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-500a71d0f3d8c7e5.js" defer=""></script><script src="/_next/static/chunks/main-a7322035af9d7f3c.js" defer=""></script><script src="/_next/static/chunks/pages/_app-22a535a3d4895e02.js" defer=""></script><script src="/_next/static/chunks/framework-327e104994690a53.js" defer=""></script><script src="/_next/static/chunks/675-374a5a75205d32da.js" defer=""></script><script src="/_next/static/chunks/545-6f26effa25ffb86c.js" defer=""></script><script src="/_next/static/chunks/460-214305b33b8337b4.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-5212da19635dab25.js" defer=""></script><script src="/_next/static/Nke94bfJilfmmTtDnSOIs/_buildManifest.js" defer=""></script><script src="/_next/static/Nke94bfJilfmmTtDnSOIs/_ssgManifest.js" defer=""></script><script src="/_next/static/Nke94bfJilfmmTtDnSOIs/_middlewareManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap">@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuFuYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v11/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body class="antialiased text-black bg-white dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex flex-col justify-between h-screen"><header class="flex items-center justify-between py-10"><div><a aria-label="John&#x27;s Codes" href="/"><div class="flex items-center justify-between"><div class="hidden h-6 text-2xl font-semibold sm:block">John&#x27;s Codes</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/projects">Projects</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="w-8 h-8 p-1 ml-1 mr-1 rounded sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="w-8 h-8 py-1 ml-1 mr-1 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed w-full h-full top-24 right-0 bg-gray-200 dark:bg-gray-800 opacity-95 z-10 transform ease-in-out duration-300 translate-x-full"><button type="button" aria-label="toggle modal" class="fixed w-full h-full cursor-auto focus:outline-none"></button><nav class="fixed h-full mt-8"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/projects">Projects</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mt-24 text-center"><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Under Construction<!-- --> <span role="img" aria-label="roadwork sign">🚧</span></h1></div></main><footer><div class="flex flex-col items-center mt-16"><div class="flex mb-3 space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/JRMurr"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div><div class="flex mb-2 space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>John Murray</div><div> • </div><div>© 2022</div><div> • </div><a href="/">John&#x27;s Codes</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var r=Object.create;var i=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var c=a=\u003ei(a,\"__esModule\",{value:!0});var m=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=\u003e{c(a);for(var l in s)i(a,l,{get:s[l],enumerable:!0})},N=(a,s,l)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let e of p(s))!u.call(a,e)\u0026\u0026e!==\"default\"\u0026\u0026i(a,e,{get:()=\u003es[e],enumerable:!(l=d(s,e))||l.enumerable});return a},g=a=\u003eN(c(i(a!=null?r(h(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=m((b,t)=\u003e{t.exports=_jsx_runtime});var w={};k(w,{default:()=\u003ey,frontmatter:()=\u003ex});var n=g(o()),x={title:\"Rust Environment and Docker Build with Nix Flakes\",date:\"2022-05-17\",tags:[\"rust\",\"nix\",\"docker\"],draft:!0,summary:\"Reproducible dev environments and build with nix\",images:[],layout:\"PostLayout\"};function f(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(l,{})})):l();function l(){let e=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",ul:\"ul\",li:\"li\",code:\"code\",pre:\"pre\"},a.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.h2,{id:\"why-nix\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#why-nix\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Why Nix\"]}),`\n`,(0,n.jsxs)(e.p,{children:[`Getting a dev environment setup with rust is usually pretty simple, just use rustup then you're good to go.\nUsing a build tool like `,(0,n.jsx)(e.a,{href:\"https://nixos.org/\",children:\"nix\"}),\" can buy you much more for not much extra work. Nix lets you\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"Specify non rust project dependencies in code\"}),`\n`,(0,n.jsxs)(e.li,{children:[\"Automatically add all your projects tools/dependencies to your path with \",(0,n.jsx)(e.a,{href:\"https://direnv.net/\",children:\"direnv\"})]}),`\n`,(0,n.jsx)(e.li,{children:\"Easily build slim docker containers\"}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:`Once you start working in a repo with nix you never want to go back.\nNo more READMEs with a list of Homebrew, apt, pacman, etc. commands you need to run.\nBuilding slim docker containers is a breeze without needing to manually handle multiple layers to copy build artifacts from.`}),`\n`,(0,n.jsxs)(e.h2,{id:\"the-dev-environment\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#the-dev-environment\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"The Dev environment\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"We will use \",(0,n.jsx)(e.a,{href:\"https://nixos.wiki/wiki/Flakes\",children:\"nix flakes\"}),` to setup nix for our project.\nFlakes are nix's newish way to make nix builds more reproudible by adding a lock file concept to the project.\nEach flake can have `,(0,n.jsx)(e.code,{children:\"inputs\"}),\" which are other flakes/nix files and many \",(0,n.jsx)(e.a,{href:\"https://nixos.wiki/wiki/Flakes#Output_schema\",children:\"outputs\"}),`.\nOne thing to note, all files referenced in your flake (including itself) must be added to git.\nIf you run into any file not found errors make sure you `,(0,n.jsx)(e.code,{children:\"git add\"}),\" everything you need.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"To get started in the root of your project run\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-sh code-highlight\",children:(0,n.jsx)(e.span,{className:\"code-line\",children:`nix flake init\n`})})}),`\n`,(0,n.jsxs)(e.p,{children:[\"This will give you a \",(0,n.jsx)(e.code,{children:\"flake.nix\"}),\" file that looks like\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-nix\",children:(0,n.jsxs)(e.code,{className:\"language-nix code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  description \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"A very basic flake\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  outputs \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" nixpkgs \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    packages\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"x86_64\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\"linux\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"hello \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" nixpkgs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"legacyPackages\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"x86_64\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\"linux\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"hello\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    defaultPackage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"x86_64\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\"linux \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"packages\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"x86_64\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\"linux\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"hello\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"This starter flake will build a hello world binary with \",(0,n.jsx)(e.code,{children:\"nix build .#hello\"}),\" which calls the first line or with just \",(0,n.jsx)(e.code,{children:\"nix build\"}),\" to call the \",(0,n.jsx)(e.code,{children:\"defaultPackage\"}),` line.\nThe downside is this only builds the package on x86/64 linux, lets add some inputs to generalize this to more systems.`]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-nix\",children:(0,n.jsxs)(e.code,{className:\"language-nix code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  inputs \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    nixpkgs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"url \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"github:nixos/nixpkgs/nixos-unstable\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    flake\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\"utils\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"url \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"github:numtide/flake-utils\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  outputs \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" nixpkgs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" flake\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\"utils\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    flake\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\"utils\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"lib\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"eachDefaultSystem \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"system\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"let\"}),\" pkgs \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"import\"}),\" nixpkgs \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"inherit\"}),\" system\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        packages\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"hello \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" pkgs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"hello\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        defaultPackage \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" pkgs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"hello\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"We added two inputs, the first is \",(0,n.jsx)(e.code,{children:\"nixpkgs\"}),` which lets us specify which version of nixpkgs we should use.\nThere are many `,(0,n.jsx)(e.a,{href:\"https://search.nixos.org/packages\",children:\"thousands of packages\"}),` in the nixpkg repository and they are updated often so here will use the unstable branch.\nWe also added `,(0,n.jsx)(e.a,{href:\"https://github.com/numtide/flake-utils\",children:\"flake-utils\"}),\" which helps us generalize the flake to support multiple systems, not just linux.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Now on linux and mac the hello package will build. Now run \",(0,n.jsx)(e.code,{children:\"nix build\"}),\", you should see a \",(0,n.jsx)(e.code,{children:\"result\"}),\" folder which contains the \",(0,n.jsx)(e.code,{children:\"hello\"}),` package,\nyou can run it with `,(0,n.jsx)(e.code,{children:\"./result/bin/hello\"}),\".\"]}),`\n`,(0,n.jsxs)(e.h2,{id:\"rust-in-nix\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#rust-in-nix\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Rust in nix\"]}),`\n`,(0,n.jsx)(e.p,{children:'To move on from \"hello world\" to rust lets add another input'}),`\n`,(0,n.jsx)(e.pre,{className:\"language-nix\",children:(0,n.jsxs)(e.code,{className:\"language-nix code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"inputs \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    nixpkgs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"url \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"github:nixos/nixpkgs/nixos-unstable\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    flake\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\"utils\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"url \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"github:numtide/flake-utils\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    rust\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\"overlay\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"url \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"github:oxalica/rust-overlay\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  outputs \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" self\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" nixpkgs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" flake\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\"utils\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" rust\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\"overlay\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    flake\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\"utils\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"lib\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"eachDefaultSystem \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"system\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"let\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        overlays \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"import\"}),\" rust\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\"overlay\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        pkgs \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"import\"}),\" nixpkgs \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"inherit\"}),\" system overlays\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        rustVersion \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" pkgs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"rust\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\"bin\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"stable\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"latest\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"default\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" devShell \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" pkgs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"mkShell \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" buildInputs \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\" rustVersion \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Now we added \",(0,n.jsx)(e.a,{href:\"https://github.com/oxalica/rust-overlay\",children:\"rust-overlay\"}),` so we can easily specify different rust versions\nwithout relying on `,(0,n.jsx)(e.code,{children:\"nixpkgs\"}),\" to give us what ever rust version in there.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"We also switched the \",(0,n.jsx)(e.code,{children:\"outyputs\"}),\" to only have \",(0,n.jsx)(e.code,{children:\"devShell\"}),\". Now when you run \",(0,n.jsx)(e.code,{children:\"nix develop\"}),\" you will get a new sandboxed shell with the stable rust version.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[`If you want to use a specific version/nightly build you can use\n`,(0,n.jsx)(e.code,{children:\"rustVersion = (pkgs.rust-bin.fromRustupToolchainFile ./rust-toolchain.toml);\"}),\" to read a rust toolchain file and use the version specificed in there.\"]}),`\n`,(0,n.jsxs)(e.h2,{id:\"automatically-load-the-nix-environment\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#automatically-load-the-nix-environment\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Automatically load the nix environment\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Now that we have the rust version we want lets make the \",(0,n.jsx)(e.code,{children:\"nix develop\"}),\" step automatic.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Install \",(0,n.jsx)(e.a,{href:\"https://direnv.net/\",children:\"direnv\"}),\" and \",(0,n.jsx)(e.a,{href:\"https://github.com/nix-community/nix-direnv\",children:\"nix-direnv\"}),`.\nThe second is optional but helps with chaching so I reccomend it.`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Direnv will add hooks to your shell so when you cd into your project it will auto load the nix enviorment for you without needing to run \",(0,n.jsx)(e.code,{children:\"nix develop\"}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:\"In the root of your project run\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"language-sh code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`echo \"use flake\" \u003e\u003e .envrc\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`direnv allow\n`})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"The \",(0,n.jsx)(e.code,{children:\".envrc\"}),\" file will be loaded by direnv and it will use the flake's \",(0,n.jsx)(e.code,{children:\"devShell\"}),` output to setup your enviorment.\nOn changes to your flake direnv will reload only what has changed.`]}),`\n`,(0,n.jsxs)(e.h2,{id:\"making-docker-containers\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#making-docker-containers\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Making docker containers\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Now that nix knows about our rust version we can use nix to build our rust project and make a slim container with it\"}),`\n`,(0,n.jsx)(e.p,{children:\"TODO:......\"})]})}}var y=f;return w;})();\n;return Component;","toc":[{"value":"Why Nix","url":"#why-nix","depth":2},{"value":"The Dev environment","url":"#the-dev-environment","depth":2},{"value":"Rust in nix","url":"#rust-in-nix","depth":2},{"value":"Automatically load the nix environment","url":"#automatically-load-the-nix-environment","depth":2},{"value":"Making docker containers","url":"#making-docker-containers","depth":2}],"frontMatter":{"readingTime":{"text":"5 min read","minutes":4.785,"time":287100,"words":957},"slug":"rust-enviorment-and-docker-build-with-nix-flakes","fileName":"rust-enviorment-and-docker-build-with-nix-flakes.mdx","title":"Rust Environment and Docker Build with Nix Flakes","date":"2022-05-17T00:00:00.000Z","tags":["rust","nix","docker"],"draft":true,"summary":"Reproducible dev environments and build with nix","images":[],"layout":"PostLayout"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.215,"time":12900,"words":43},"slug":["default"],"fileName":"default.md","name":"John Murray","avatar":"/static/images/me.jpg","occupation":"Software Engineer","github":"https://github.com/JRMurr","date":null}],"prev":{"title":"Intermediate Typescript: Generics and Mapped Types","date":"2022-01-31T00:00:00.000Z","tags":["Typescript","code","types","guide"],"draft":false,"summary":"Useful applications of generics and mapped types","images":[],"layout":"PostLayout","slug":"intermediate-typescript-generics-and-mapped-types"},"next":null},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["rust-enviorment-and-docker-build-with-nix-flakes"]},"buildId":"Nke94bfJilfmmTtDnSOIs","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>