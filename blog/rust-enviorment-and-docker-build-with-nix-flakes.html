<!DOCTYPE html><html lang="en-us" class="__variable_587f35 scroll-smooth"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/2d141e1a38819612-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/895662d5d095c22a.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/14fb540b7a3ad639.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-278bcb5a0daf8917.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-28d8581e6e02654e.js" async="" crossorigin=""></script><script src="/_next/static/chunks/69-dbeadf5c9f0cdabc.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-bef4f1fcfc072c84.js" async="" crossorigin=""></script><script src="/_next/static/chunks/250-a30085ccab20449f.js" async=""></script><script src="/_next/static/chunks/781-9238b26c3a132736.js" async=""></script><script src="/_next/static/chunks/app/layout-bdf5ad57b961fc92.js" async=""></script><script src="/_next/static/chunks/749-ed776d54eb5c7205.js" async=""></script><script src="/_next/static/chunks/app/blog/%5B...slug%5D/page-04bc103f80b6f059.js" async=""></script><title>Rust Environment and Docker Build with Nix Flakes | John&#x27;s Codes</title><meta name="description" content="Reproducible dev environments and builds with Nix"/><meta name="robots" content="index, follow"/><meta name="googlebot" content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"/><link rel="canonical" href="https://johns.codes/blog/rust-enviorment-and-docker-build-with-nix-flakes"/><link rel="alternate" type="application/rss+xml" href="https://johns.codes/feed.xml"/><meta property="og:title" content="Rust Environment and Docker Build with Nix Flakes"/><meta property="og:description" content="Reproducible dev environments and builds with Nix"/><meta property="og:url" content="https://johns.codes/blog/rust-enviorment-and-docker-build-with-nix-flakes"/><meta property="og:site_name" content="John&#x27;s Codes"/><meta property="og:locale" content="en_US"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2022-05-19T00:00:00.000Z"/><meta property="article:modified_time" content="2022-05-19T00:00:00.000Z"/><meta property="article:author" content="John Murray"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Rust Environment and Docker Build with Nix Flakes"/><meta name="twitter:description" content="Reproducible dev environments and builds with Nix"/><meta name="next-size-adjust"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-950 dark:text-white"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><section class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between font-sans"><header class="flex items-center justify-between py-10"><div><a aria-label="John&#x27;s Codes" href="/"><div class="flex items-center justify-between"><div class="hidden h-6 text-2xl font-semibold sm:block">John&#x27;s Codes</div></div></a></div><div class="flex items-center space-x-4 leading-5 sm:space-x-6"><a class="hidden font-medium text-gray-900 dark:text-gray-100 sm:block" href="/blog">Blog</a><a class="hidden font-medium text-gray-900 dark:text-gray-100 sm:block" href="/tags">Tags</a><a class="hidden font-medium text-gray-900 dark:text-gray-100 sm:block" href="/projects">Projects</a><a class="hidden font-medium text-gray-900 dark:text-gray-100 sm:block" href="/about">About</a><button aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6 text-gray-900 dark:text-gray-100"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path></svg></button><button aria-label="Toggle Menu" class="sm:hidden"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-8 w-8 text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed left-0 top-0 z-10 h-full w-full transform bg-white opacity-95 duration-300 ease-in-out dark:bg-gray-950 dark:opacity-[0.98] translate-x-full"><div class="flex justify-end"><button class="mr-8 mt-11 h-8 w-8" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/">Home</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/projects">Projects</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></header><main class="mb-auto"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Rust Environment and Docker Build with Nix Flakes","datePublished":"2022-05-19T00:00:00.000Z","dateModified":"2022-05-19T00:00:00.000Z","description":"Reproducible dev environments and builds with Nix","author":[{"@type":"Person","name":"John Murray"}]}</script><section class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed bottom-8 right-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div><header><div class="space-y-1 border-b border-gray-200 pb-10 text-center dark:border-gray-700"><dl><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2022-05-19T00:00:00.000Z">May 19, 2022</time><span class="mx-2">-</span><span class="ml-1">6<!-- --> min read</span></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Rust Environment and Docker Build with Nix Flakes</h1></div></div></header><div class="grid-rows-[auto_1fr] divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:divide-y-0"><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pb-8 pt-10 dark:prose-invert"><details open=""><summary class="ml-6 pb-2 pt-2 text-xl font-bold">Table of Contents</summary><div class="ml-6"><ul class=""><li><a href="#why-nix">Why Nix</a></li><li><a href="#the-dev-environment">The Dev Environment</a></li><li><a href="#rust-in-nix">Rust in Nix</a></li><li><a href="#automatically-load-the-nix-environment">Automatically Load the Nix Environment</a></li><li><a href="#build-rust-project">Build Rust Project</a></li><li><a href="#make-a-docker-image">Make a Docker Image</a></li><li><a href="#common-troubleshooting-issues">Common troubleshooting issues</a><ul class=""><li><a href="#non-rust-build-dependencies">Non Rust Build Dependencies</a></li><li><a href="#nix-docs">Nix Docs</a></li></ul></li></ul></div></details><h2 id="why-nix"><a href="#why-nix" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Why Nix</h2><p>Getting a dev environment setup with rust is usually pretty simple, just use rustup then you&#x27;re good to go. Using a build tool like <a target="_blank" rel="noopener noreferrer" href="https://nixos.org/">Nix</a> can buy you much more for not much extra work. Nix lets you</p><ul><li>Specify non rust project dependencies in code</li><li>Automatically add all your projects tools/dependencies to your path with <a target="_blank" rel="noopener noreferrer" href="https://direnv.net/">direnv</a></li><li>Easily build slim docker containers</li></ul><p>Once you start working in a repo with nix you never want to go back. No more READMEs with a list of Homebrew, apt, pacman, etc. commands you need to run. Building slim docker containers is a breeze without needing to manually handle multiple layers to copy build artifacts from.</p><p>This post will mostly be a quick and dirty guide to getting started with nix, so I won&#x27;t go into too much detail on what nix is doing under the hood/nix syntax. For a quick and dirty nix syntax reference I recommend <a target="_blank" rel="noopener noreferrer" href="https://learnxinyminutes.com/docs/nix/">learn X in Y&#x27;s post</a>, if you have some functional programming experience most of the basics will be quick to pick up.</p><h2 id="the-dev-environment"><a href="#the-dev-environment" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The Dev Environment</h2><p>We will use <a target="_blank" rel="noopener noreferrer" href="https://nixos.wiki/wiki/Flakes">nix flakes</a> to set up nix for our project. Flakes are nix&#x27;s newish way to make nix builds more reproducible by adding a lock file concept to the project. Each flake can have <code>inputs</code> which are other flakes/nix files and many <a target="_blank" rel="noopener noreferrer" href="https://nixos.wiki/wiki/Flakes#Output_schema">outputs</a>. One thing to note, all files referenced in your flake (including itself) must be added to git. If you run into any file not found errors make sure you <code>git add</code> everything you need.</p><p>To get started in the root of your project run</p><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">$</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> nix</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> flake</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> init</span></span>
<span class="line"></span></code></pre></div><p>This will give you a <code>flake.nix</code> file that looks like</p><div class="remark-code-title">flake.nix</div><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  description</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;A very basic flake&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  outputs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> { self</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> nixpkgs }: {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    packages</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">x86_64-linux</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">hello</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> nixpkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">legacyPackages</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">x86_64-linux</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">hello</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    defaultPackage</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">x86_64-linux</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> self</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">packages</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">x86_64-linux</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">hello</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">  };</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre></div><p>This starter flake will build a hello world binary with <code>nix build .#hello</code> which calls the first line or with just <code>nix build</code> to call the <code>defaultPackage</code> line. The downside is this only builds the package on x86/64 Linux, let&#x27;s add some inputs to generalize this to more systems.</p><div class="remark-code-title">flake.nix</div><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  inputs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    nixpkgs</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">url</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;github:nixos/nixpkgs/nixos-unstable&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    flake-utils</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">url</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;github:numtide/flake-utils&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  outputs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> { self</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> nixpkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> flake-utils</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#d73a49;--shiki-dark:#F97583"> ... </span><span style="color:#24292e;--shiki-dark:#E1E4E8">}:</span></span>
<span class="line"><span style="color:#e36209;--shiki-dark:#FFAB70">    flake-utils</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">lib</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">eachDefaultSystem</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> (system:</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">      let</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> pkgs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> import</span><span style="color:#e36209;--shiki-dark:#FFAB70"> nixpkgs</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> { </span><span style="color:#d73a49;--shiki-dark:#F97583">inherit</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> system</span><span style="color:#24292e;--shiki-dark:#E1E4E8">; };</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">      in</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        packages</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">hello</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> pkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">hello</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        defaultPackage</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> pkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">hello</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">      });</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre></div><p>We added two inputs, the first is <code>nixpkgs</code> which lets us specify which version of nixpkgs we should use. There are many <a target="_blank" rel="noopener noreferrer" href="https://search.nixos.org/packages">thousands of packages</a> in the nixpkg repository, and they are updated often so here will use the unstable branch. We also added <a target="_blank" rel="noopener noreferrer" href="https://github.com/numtide/flake-utils">flake-utils</a> which helps us generalize the flake to support multiple systems, not just Linux.</p><p>Now on Linux and mac the hello package will build. When you run <code>nix build</code>, you should see a <code>result</code> folder which contains the <code>hello</code> package, you can run it with <code>./result/bin/hello</code>. The <code>result</code> folder is a symlink to the output of build in the nix store (where nix keeps all outputs). It will not always be a folder, it will just depend on the build.</p><h2 id="rust-in-nix"><a href="#rust-in-nix" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Rust in Nix</h2><p>To move on from &quot;hello world&quot; to rust lets add another input</p><div class="remark-code-title">flake.nix</div><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#e36209;--shiki-dark:#FFAB70">inputs</span><span style="color:#b31d28;--shiki-dark:#FDAEB7;font-style:italic;--shiki-dark-font-style:italic"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    nixpkgs</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">url</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;github:nixos/nixpkgs/nixos-unstable&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    flake-utils</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">url</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;github:numtide/flake-utils&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    rust-overlay</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">url</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;github:oxalica/rust-overlay&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">  }</span><span style="color:#b31d28;--shiki-dark:#FDAEB7;font-style:italic;--shiki-dark-font-style:italic">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#e36209;--shiki-dark:#FFAB70">outputs</span><span style="color:#b31d28;--shiki-dark:#FDAEB7;font-style:italic;--shiki-dark-font-style:italic"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> { self</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> nixpkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> flake-utils</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> rust-overlay</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#d73a49;--shiki-dark:#F97583"> ... </span><span style="color:#24292e;--shiki-dark:#E1E4E8">}:</span></span>
<span class="line"><span style="color:#e36209;--shiki-dark:#FFAB70">  flake-utils</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">lib</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">eachDefaultSystem</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> (system:</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">    let</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">      overlays</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> [ (</span><span style="color:#005cc5;--shiki-dark:#79B8FF">import</span><span style="color:#e36209;--shiki-dark:#FFAB70"> rust-overlay</span><span style="color:#24292e;--shiki-dark:#E1E4E8">) ];</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">      pkgs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> import</span><span style="color:#e36209;--shiki-dark:#FFAB70"> nixpkgs</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> { </span><span style="color:#d73a49;--shiki-dark:#F97583">inherit</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> system</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> overlays</span><span style="color:#24292e;--shiki-dark:#E1E4E8">; };</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">      rustVersion</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> pkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">rust-bin</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">stable</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">latest</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">default</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">    in</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">      devShell</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> pkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">mkShell</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        buildInputs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">          [ (</span><span style="color:#e36209;--shiki-dark:#FFAB70">rustVersion</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">override</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> { </span><span style="color:#6f42c1;--shiki-dark:#B392F0">extensions</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> [ </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;rust-src&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> ]; }) ];</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">      };</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    })</span><span style="color:#b31d28;--shiki-dark:#FDAEB7;font-style:italic;--shiki-dark-font-style:italic">;</span></span>
<span class="line"></span></code></pre></div><p>We added <a target="_blank" rel="noopener noreferrer" href="https://github.com/oxalica/rust-overlay">rust-overlay</a>, so we can easily specify different rust versions without relying on <code>nixpkgs</code> to give us what ever rust version in there.</p><p>We also switched the <code>outputs</code> to only have <code>devShell</code>, that output is tied to <code>nix develop</code>, when run you will get a new sandboxed shell with the stable rust version.</p><p>If you want to use a specific version/nightly build you can use <code>rustVersion = (pkgs.rust-bin.fromRustupToolchainFile ./rust-toolchain.toml);</code> to read a rust toolchain file and use the version specified in there.</p><p>You may also have noticed we added <code>.override { extensions = [ &quot;rust-src&quot; ]; })</code>. This is needed for rust analyzer to get rust source code.</p><h2 id="automatically-load-the-nix-environment"><a href="#automatically-load-the-nix-environment" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Automatically Load the Nix Environment</h2><p>Now that we have the rust version we want let&#x27;s make the <code>nix develop</code> step automatic.</p><p>Install <a target="_blank" rel="noopener noreferrer" href="https://direnv.net/">direnv</a> and <a target="_blank" rel="noopener noreferrer" href="https://github.com/nix-community/nix-direnv">nix-direnv</a>. The second is optional but helps with caching, so I recommend it.</p><p>Direnv will add hooks to your shell so when you <code>cd</code> into your project it will autoload the nix environment for you without needing to run <code>nix develop</code>.</p><p>In the root of your project run</p><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">$</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> echo</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;use flake&quot;</span><span style="color:#d73a49;--shiki-dark:#F97583"> &gt;&gt;</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> .envrc</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">$</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> direnv</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> allow</span></span>
<span class="line"></span></code></pre></div><p>The <code>.envrc</code> file will be loaded by direnv, and it will use the flake&#x27;s <code>devShell</code> output to set up your environment. On changes to your flake direnv will reload only what has changed.</p><p>If you are using VS Code, use <a target="_blank" rel="noopener noreferrer" href="https://marketplace.visualstudio.com/items?itemName=arrterian.nix-env-selector">nix env selector</a>, so VS Code is aware of the flake. It is not always necessary if you open VS Code from your terminal, but It&#x27;s simple to set up.</p><h2 id="build-rust-project"><a href="#build-rust-project" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Build Rust Project</h2><p>Now that we have rust in our dev environment we can make a new rust app with</p><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">$</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> cargo</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> init</span></span>
<span class="line"></span></code></pre></div><p>Then we can run/build the project like you normally would with <code>cargo run</code>/<code>cargo build</code>. That works well while developing but let&#x27;s use nix to build the project, this will help us later on when we make the docker image.</p><p>Let&#x27;s update the outputs too</p><div class="remark-code-title">flake.nix</div><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#e36209;--shiki-dark:#FFAB70">outputs</span><span style="color:#b31d28;--shiki-dark:#FDAEB7;font-style:italic;--shiki-dark-font-style:italic"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> { self</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> nixpkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> flake-utils</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> rust-overlay</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#d73a49;--shiki-dark:#F97583"> ... </span><span style="color:#24292e;--shiki-dark:#E1E4E8">}:</span></span>
<span class="line"><span style="color:#e36209;--shiki-dark:#FFAB70">    flake-utils</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">lib</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">eachDefaultSystem</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> (system:</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">      let</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        overlays</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> [ (</span><span style="color:#005cc5;--shiki-dark:#79B8FF">import</span><span style="color:#e36209;--shiki-dark:#FFAB70"> rust-overlay</span><span style="color:#24292e;--shiki-dark:#E1E4E8">) ];</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        pkgs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> import</span><span style="color:#e36209;--shiki-dark:#FFAB70"> nixpkgs</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> { </span><span style="color:#d73a49;--shiki-dark:#F97583">inherit</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> system</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> overlays</span><span style="color:#24292e;--shiki-dark:#E1E4E8">; };</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        rustVersion</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> pkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">rust-bin</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">stable</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">latest</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">default</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        rustPlatform</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> pkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">makeRustPlatform</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          cargo</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> rustVersion</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          rustc</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> rustVersion</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        myRustBuild</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> rustPlatform</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">buildRustPackage</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          pname</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            &quot;rust_nix_blog&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">; </span><span style="color:#6a737d;--shiki-dark:#6A737D"># make this what ever your cargo.toml package.name is</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          version</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;0.1.0&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          src</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> ./.</span><span style="color:#24292e;--shiki-dark:#E1E4E8">; </span><span style="color:#6a737d;--shiki-dark:#6A737D"># the folder with the cargo.toml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          cargoLock</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">lockFile</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> ./Cargo.lock</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">      in</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        defaultPackage</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> myRustBuild</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        devShell</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> pkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">mkShell</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          buildInputs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">            [ (</span><span style="color:#e36209;--shiki-dark:#FFAB70">rustVersion</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">override</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> { </span><span style="color:#6f42c1;--shiki-dark:#B392F0">extensions</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> [ </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;rust-src&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> ]; }) ];</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">      })</span><span style="color:#b31d28;--shiki-dark:#FDAEB7;font-style:italic;--shiki-dark-font-style:italic">;</span></span>
<span class="line"></span></code></pre></div><p>First we have to make a <code>rustPlatform</code> with our rust version. The platform will let us build our rust package with <code>rustPlatform.buildRustPackage</code>. This is the nix equivalent of <code>cargo build</code>. We need <code>cargoLock.lockFile</code> so nix can cache all of your project&#x27;s dependencies based on your existing lock file.</p><p>Now we can run <code>nix build</code>, then your project will be in the <code>result</code> folder again. In my case I can run <code>./result/bin/rust_nix_blog</code>.</p><h2 id="make-a-docker-image"><a href="#make-a-docker-image" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Make a Docker Image</h2><p>Now that we have nix building the rust project making the docker container is quite easy.</p><div class="remark-code-title">flake.nix</div><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#e36209;--shiki-dark:#FFAB70">outputs</span><span style="color:#b31d28;--shiki-dark:#FDAEB7;font-style:italic;--shiki-dark-font-style:italic"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> { self</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> nixpkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> flake-utils</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> rust-overlay</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#d73a49;--shiki-dark:#F97583"> ... </span><span style="color:#24292e;--shiki-dark:#E1E4E8">}:</span></span>
<span class="line"><span style="color:#e36209;--shiki-dark:#FFAB70">    flake-utils</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">lib</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">eachDefaultSystem</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> (system:</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">      let</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        overlays</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> [ (</span><span style="color:#005cc5;--shiki-dark:#79B8FF">import</span><span style="color:#e36209;--shiki-dark:#FFAB70"> rust-overlay</span><span style="color:#24292e;--shiki-dark:#E1E4E8">) ];</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        pkgs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> import</span><span style="color:#e36209;--shiki-dark:#FFAB70"> nixpkgs</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> { </span><span style="color:#d73a49;--shiki-dark:#F97583">inherit</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> system</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> overlays</span><span style="color:#24292e;--shiki-dark:#E1E4E8">; };</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        rustVersion</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> pkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">rust-bin</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">stable</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">latest</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">default</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        rustPlatform</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> pkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">makeRustPlatform</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          cargo</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> rustVersion</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          rustc</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> rustVersion</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        myRustBuild</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> rustPlatform</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">buildRustPackage</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          pname</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            &quot;rust_nix_blog&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">; </span><span style="color:#6a737d;--shiki-dark:#6A737D"># make this what ever your cargo.toml package.name is</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          version</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;0.1.0&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          src</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> ./.</span><span style="color:#24292e;--shiki-dark:#E1E4E8">; </span><span style="color:#6a737d;--shiki-dark:#6A737D"># the folder with the cargo.toml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          cargoLock</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">lockFile</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> ./Cargo.lock</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        dockerImage</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> pkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">dockerTools</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">buildImage</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          name</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;rust-nix-blog&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          config</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> { </span><span style="color:#6f42c1;--shiki-dark:#B392F0">Cmd</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> [ </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">${</span><span style="color:#005cc5;--shiki-dark:#79B8FF;font-style:italic;--shiki-dark-font-style:italic">myRustBuild</span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">}</span><span style="color:#032f62;--shiki-dark:#9ECBFF">/bin/rust_nix_blog&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> ]; };</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">      in</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        packages</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          rustPackage</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> myRustBuild</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          docker</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> dockerImage</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        defaultPackage</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> dockerImage</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        devShell</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> pkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">mkShell</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          buildInputs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">            [ (</span><span style="color:#e36209;--shiki-dark:#FFAB70">rustVersion</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">override</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> { </span><span style="color:#6f42c1;--shiki-dark:#B392F0">extensions</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> [ </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;rust-src&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> ]; }) ];</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">      })</span><span style="color:#b31d28;--shiki-dark:#FDAEB7;font-style:italic;--shiki-dark-font-style:italic">;</span></span>
<span class="line"></span></code></pre></div><p>Now <code>nix build</code> or <code>nix build .#docker</code> will build the docker image. After building <code>result</code> is just a sym link to the image tar file of a folder like before. Since nix is declarative it does not load it directly into docker for you. You can load it with</p><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">$</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> docker</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> load</span><span style="color:#d73a49;--shiki-dark:#F97583"> &lt;</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> result</span></span>
<span class="line"></span></code></pre></div><p>You should see an output like <code>rust-nix-blog:yyc9gd4nkydrikzpsvlp3gmwnpxhh1ik</code> which is the image and tag loaded in.</p><p>Now run the image with</p><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">$</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> docker</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> run</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> rust-nix-blog:yyc9gd4nkydrikzpsvlp3gmwnpxhh1ik</span></span>
<span class="line"></span></code></pre></div><p>We can automate this a bit with a script like. (Slightly modified example from <a target="_blank" rel="noopener noreferrer" href="https://jamey.thesharps.us/2021/02/02/docker-containers-nix/">here</a>)</p><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">#!/usr/bin/env bash</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79B8FF">set</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> -e</span><span style="color:#24292e;--shiki-dark:#E1E4E8">; </span><span style="color:#005cc5;--shiki-dark:#79B8FF">set</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> -o</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> pipefail</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">nix</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> build</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &#x27;.#docker&#x27;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">image</span><span style="color:#d73a49;--shiki-dark:#F97583">=</span><span style="color:#032f62;--shiki-dark:#9ECBFF">$((docker load </span><span style="color:#d73a49;--shiki-dark:#F97583">&lt;</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> result) </span><span style="color:#d73a49;--shiki-dark:#F97583">|</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> sed </span><span style="color:#d73a49;--shiki-dark:#F97583">-</span><span style="color:#032f62;--shiki-dark:#9ECBFF">n &#x27;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">$s</span><span style="color:#d73a49;--shiki-dark:#F97583">/</span><span style="color:#032f62;--shiki-dark:#9ECBFF">^Loaded image</span><span style="color:#d73a49;--shiki-dark:#F97583">:</span><span style="color:#d73a49;--shiki-dark:#F97583"> //</span><span style="color:#032f62;--shiki-dark:#9ECBFF">p&#x27;)</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">docker image tag &quot;$image&quot; rust-nix-blog:latest</span></span>
<span class="line"></span></code></pre></div><p>Let&#x27;s use <a target="_blank" rel="noopener noreferrer" href="https://github.com/wagoodman/dive">dive</a> to look at the image. You can use it temporarily with <code>nix shell nixpkgs#dive</code>.</p><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span> 33 MB  └── nix</span></span>
<span class="line"><span> 33 MB      └── store</span></span>
<span class="line"><span>374 kB          ├─⊕ h4isr1pyv1fjdrxj2g80vsa4hp2hp76s-rust_nix_blog-0.1.0</span></span>
<span class="line"><span>1.8 MB          ├─⊕ ik4qlj53grwmg7avzrfrn34bjf6a30ch-libunistring-1.0</span></span>
<span class="line"><span>246 kB          ├─⊕ w3zngkrag7vnm7v1q8vnqb71q6a1w8gn-libidn2-2.3.2</span></span>
<span class="line"><span> 30 MB          └─⊕ ybkkrhdwdj227kr20vk8qnzqnmj7a06x-glibc-2.34-115</span></span>
<span class="line"><span></span></span></code></pre></div><p>Looking at the output you can see it&#x27;s a single layer image with just what is needed to run the binary (in case just libc and the rust code).</p><h2 id="common-troubleshooting-issues"><a href="#common-troubleshooting-issues" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Common troubleshooting issues</h2><h3 id="non-rust-build-dependencies"><a href="#non-rust-build-dependencies" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Non Rust Build Dependencies</h3><p>Building with nix is great once its working, it will stay working forever. Getting to a working state can be a bit of pain sometimes. If your rust code relies on system packages (like OpenSSL) make sure you include them in <code>buildInputs</code>, for example</p><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#e36209;--shiki-dark:#FFAB70">rustPlatform</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">buildRustPackage</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  pname</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">    &quot;rust_nix_blog&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">; </span><span style="color:#6a737d;--shiki-dark:#6A737D"># make this what ever your cargo.toml package.name is</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  version</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;0.1.0&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  src</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> ./.</span><span style="color:#24292e;--shiki-dark:#E1E4E8">; </span><span style="color:#6a737d;--shiki-dark:#6A737D"># the folder with the cargo.toml</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  nativeBuildInputs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> [</span><span style="color:#e36209;--shiki-dark:#FFAB70">pkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">pkg-config</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> ]; </span><span style="color:#6a737d;--shiki-dark:#6A737D"># just for the host building the package</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  buildInputs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> [</span><span style="color:#e36209;--shiki-dark:#FFAB70">pkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">openssl</span><span style="color:#24292e;--shiki-dark:#E1E4E8">]; </span><span style="color:#6a737d;--shiki-dark:#6A737D"># packages needed by the consumer</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  cargoLock</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">lockFile</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> ./Cargo.lock</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">}</span><span style="color:#b31d28;--shiki-dark:#FDAEB7;font-style:italic;--shiki-dark-font-style:italic">;</span></span>
<span class="line"></span></code></pre></div><p>For OpenSSL specifically I would recommend using rustls when possible. It&#x27;s easier to build and in rust.</p><h3 id="nix-docs"><a href="#nix-docs" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Nix Docs</h3><p>Nix documentation is not the best. While the <a target="_blank" rel="noopener noreferrer" href="https://nixos.wiki/wiki/Rust">wiki</a> and <a target="_blank" rel="noopener noreferrer" href="https://nixos.org/manual/nixpkgs/stable/#preface">manual</a> have some info, I&#x27;ve found the best resources have been the many nix bloggers out there. Here are some good references</p><ul><li><a target="_blank" rel="noopener noreferrer" href="https://christine.website/blog/nix-flakes-1-2022-02-21">Xe</a> most of her blogs relate to nixos, the Linux distro based on nix, but it helps to learn the language and common patterns</li><li><a target="_blank" rel="noopener noreferrer" href="https://ianthehenry.com/posts/how-to-learn-nix/">Ian Henry&#x27;s how to learn nix</a> Ian has a blog series of him learning nix. It&#x27;s not really documentation but more curated notes of his process of using nix.</li><li><a target="_blank" rel="noopener noreferrer" href="https://www.tweag.io/blog/2020-05-25-flakes/">Intro to nix flakes</a> Great 3 part series on what flakes are and how to use them</li><li><a target="_blank" rel="noopener noreferrer" href="https://jamey.thesharps.us/2021/02/02/docker-containers-nix/">Building docker containers with nix</a> Linked this earlier, but it&#x27;s a good reference for more options on building containers</li></ul><p>I also highly recommend on diving headfirst into nix by using Nixos as your Linux distro. It will help make you more comfortable with the language and its great to use once it clicks.</p></div><div><div class="pb-6 pt-6 text-sm text-gray-700 dark:text-gray-300"><a target="_blank" rel="nofollow" href="https://mobile.twitter.com/search?q=https%3A%2F%2Fjohns.codes%2Fblog%2Frust-enviorment-and-docker-build-with-nix-flakes">Discuss on Twitter</a> • <a target="_blank" rel="noopener noreferrer" href="https://github.com/JRMurr/JRMurr.github.io/blob/main/content/blog/rust-enviorment-and-docker-build-with-nix-flakes.md">View on GitHub</a></div><div class="pb-6 pt-6 text-center text-gray-700 dark:text-gray-300" id="comment"><button>Load Comments</button></div></div></div><footer><div class="flex flex-col text-sm font-medium sm:flex-row sm:justify-between sm:text-base"><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" aria-label="Previous post: Intermediate Typescript: Generics and Mapped Types" href="/blog/intermediate-typescript-generics-and-mapped-types">← <!-- -->Intermediate Typescript: Generics and Mapped Types</a></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" aria-label="Next post: Type Safe GroupBy In TypeScript" href="/blog/type-safe-groupby-in-typescript">Type Safe GroupBy In TypeScript<!-- --> →</a></div></div></footer></div></div></article></section></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/JRMurr"><span class="sr-only">github</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://twitter.com/JRMurrCodes"><span class="sr-only">twitter</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://hachyderm.io/@jrmurr"><span class="sr-only">mastodon</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6"><path d="M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="/feed.xml"><span class="sr-only">rss</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6"><path d="M3.692 17.517A3.696 3.696 0 0 0 0 21.211C0 23.244 1.656 24.9 3.692 24.9s3.694-1.657 3.694-3.689a3.697 3.697 0 0 0-3.694-3.694z"></path><path d="M.384 8.142A.386.386 0 0 0 0 8.527v4.688c0 .211.173.383.384.383 6.02 0 10.919 4.898 10.919 10.92 0 .209.171.383.384.383h4.705a.385.385 0 0 0 .387-.383l-.018-.121C16.692 15.423 9.37 8.142.384 8.142z"></path><path d="M24.89 24.397C24.825 10.936 13.854.011.384.011A.385.385 0 0 0 0 .397v4.824c0 .212.173.383.384.383 10.429 0 18.913 8.486 18.913 18.914 0 .209.172.383.382.383h4.845a.39.39 0 0 0 .388-.383l-.022-.121z"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>John Murray</div><div> • </div><div>© 2024</div><div> • </div><a href="/">John&#x27;s Codes</a></div></div></footer></div></section><script src="/_next/static/chunks/webpack-278bcb5a0daf8917.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/2d141e1a38819612-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/css/895662d5d095c22a.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L3\"\n"])</script><script>self.__next_f.push([1,"4:HL[\"/_next/static/css/14fb540b7a3ad639.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"5:I[7690,[],\"\"]\n8:I[5613,[],\"\"]\na:I[1778,[],\"\"]\nb:I[8029,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"781\",\"static/chunks/781-9238b26c3a132736.js\",\"185\",\"static/chunks/app/layout-bdf5ad57b961fc92.js\"],\"ThemeProviders\"]\nc:I[5935,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"781\",\"static/chunks/781-9238b26c3a132736.js\",\"185\",\"static/chunks/app/layout-bdf5ad57b961fc92.js\"],\"\"]\nd:I[9266,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"781\",\"static/chunks/781-9238b26c3a132736.js\",\"185\",\"static/chunks/app/lay"])</script><script>self.__next_f.push([1,"out-bdf5ad57b961fc92.js\"],\"KBarSearchProvider\"]\ne:I[5250,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"749\",\"static/chunks/749-ed776d54eb5c7205.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-04bc103f80b6f059.js\"],\"\"]\nf:I[2146,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"781\",\"static/chunks/781-9238b26c3a132736.js\",\"185\",\"static/chunks/app/layout-bdf5ad57b961fc92.js\"],\"KBarButton\"]\n10:I[5021,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"781\",\"static/chunks/781-9238b26c3a132736.js\",\"185\",\"static/"])</script><script>self.__next_f.push([1,"chunks/app/layout-bdf5ad57b961fc92.js\"],\"\"]\n11:I[123,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"781\",\"static/chunks/781-9238b26c3a132736.js\",\"185\",\"static/chunks/app/layout-bdf5ad57b961fc92.js\"],\"\"]\n14:I[8955,[],\"\"]\n9:[\"slug\",\"rust-enviorment-and-docker-build-with-nix-flakes\",\"c\"]\n12:T44f,"])</script><script>self.__next_f.push([1,"M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"])</script><script>self.__next_f.push([1,"15:[]\n"])</script><script>self.__next_f.push([1,"3:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/895662d5d095c22a.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L5\",null,{\"buildId\":\"IKie5J7CTDxfEP0dGZ2Vw\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/blog/rust-enviorment-and-docker-build-with-nix-flakes\",\"initialTree\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"rust-enviorment-and-docker-build-with-nix-flakes\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"rust-enviorment-and-docker-build-with-nix-flakes\\\"]}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"rust-enviorment-and-docker-build-with-nix-flakes\",\"c\"],{\"children\":[\"__PAGE__\",{},[\"$L6\",\"$L7\",null]]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"$9\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/14fb540b7a3ad639.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}]]},[null,[\"$\",\"html\",null,{\"lang\":\"en-us\",\"className\":\"__variable_587f35 scroll-smooth\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"sizes\":\"76x76\",\"href\":\"/static/favicons/apple-touch-icon.png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"32x32\",\"href\":\"/static/favicons/favicon-32x32.png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"16x16\",\"href\":\"/static/favicons/favicon-16x16.png\"}],[\"$\",\"link\",null,{\"rel\":\"manifest\",\"href\":\"/static/favicons/site.webmanifest\"}],[\"$\",\"link\",null,{\"rel\":\"mask-icon\",\"href\":\"/static/favicons/safari-pinned-tab.svg\",\"color\":\"#5bbad5\"}],[\"$\",\"meta\",null,{\"name\":\"msapplication-TileColor\",\"content\":\"#000000\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: light)\",\"content\":\"#fff\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: dark)\",\"content\":\"#000\"}],[\"$\",\"link\",null,{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"/feed.xml\"}],[\"$\",\"body\",null,{\"className\":\"bg-white text-black antialiased dark:bg-gray-950 dark:text-white\",\"children\":[\"$\",\"$Lb\",null,{\"children\":[[[\"$\",\"$Lc\",null,{\"strategy\":\"lazyOnload\",\"data-domain\":\"johns.codes\",\"data-api\":\"$undefined\",\"src\":\"https://plausible.io/js/plausible.js\"}],[\"$\",\"$Lc\",null,{\"strategy\":\"lazyOnload\",\"id\":\"plausible-script\",\"children\":\"\\n            window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }\\n        \"}]],[\"$\",\"section\",null,{\"className\":\"mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex h-screen flex-col justify-between font-sans\",\"children\":[[\"$\",\"$Ld\",null,{\"kbarConfig\":{\"searchDocumentsPath\":\"search.json\"},\"children\":[[\"$\",\"header\",null,{\"className\":\"flex items-center justify-between py-10\",\"children\":[[\"$\",\"div\",null,{\"children\":[\"$\",\"$Le\",null,{\"href\":\"/\",\"aria-label\":\"John's Codes\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between\",\"children\":[\"$\",\"div\",null,{\"className\":\"hidden h-6 text-2xl font-semibold sm:block\",\"children\":\"John's Codes\"}]}]}]}],[\"$\",\"div\",null,{\"className\":\"flex items-center space-x-4 leading-5 sm:space-x-6\",\"children\":[[[\"$\",\"$Le\",null,{\"href\":\"/blog\",\"className\":\"hidden font-medium text-gray-900 dark:text-gray-100 sm:block\",\"children\":\"Blog\"}],[\"$\",\"$Le\",null,{\"href\":\"/tags\",\"className\":\"hidden font-medium text-gray-900 dark:text-gray-100 sm:block\",\"children\":\"Tags\"}],[\"$\",\"$Le\",null,{\"href\":\"/projects\",\"className\":\"hidden font-medium text-gray-900 dark:text-gray-100 sm:block\",\"children\":\"Projects\"}],[\"$\",\"$Le\",null,{\"href\":\"/about\",\"className\":\"hidden font-medium text-gray-900 dark:text-gray-100 sm:block\",\"children\":\"About\"}]],[\"$\",\"$Lf\",null,{\"aria-label\":\"Search\",\"children\":[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"fill\":\"none\",\"viewBox\":\"0 0 24 24\",\"strokeWidth\":1.5,\"stroke\":\"currentColor\",\"className\":\"h-6 w-6 text-gray-900 dark:text-gray-100\",\"children\":[\"$\",\"path\",null,{\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"d\":\"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z\"}]}]}],[\"$\",\"$L10\",null,{}],[\"$\",\"$L11\",null,{}]]}]]}],[\"$\",\"main\",null,{\"className\":\"mb-auto\",\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"className\":\"flex flex-col items-start justify-start md:mt-24 md:flex-row md:items-center md:justify-center md:space-x-6\",\"children\":[[\"$\",\"div\",null,{\"className\":\"space-x-2 pb-8 pt-6 md:space-y-5\",\"children\":[\"$\",\"h1\",null,{\"className\":\"text-6xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 md:border-r-2 md:px-6 md:text-8xl md:leading-14\",\"children\":\"404\"}]}],[\"$\",\"div\",null,{\"className\":\"max-w-md\",\"children\":[[\"$\",\"p\",null,{\"className\":\"mb-4 text-xl font-bold leading-normal md:text-2xl\",\"children\":\"Sorry we couldn't find this page.\"}],[\"$\",\"p\",null,{\"className\":\"mb-8\",\"children\":\"But dont worry, you can find plenty of other things on our homepage.\"}],[\"$\",\"$Le\",null,{\"href\":\"/\",\"className\":\"focus:shadow-outline-blue inline rounded-lg border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium leading-5 text-white shadow transition-colors duration-150 hover:bg-blue-700 focus:outline-none dark:hover:bg-blue-500\",\"children\":\"Back to homepage\"}]]}]]}],\"notFoundStyles\":[],\"styles\":null}]}]]}],[\"$\",\"footer\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"mt-16 flex flex-col items-center\",\"children\":[[\"$\",\"div\",null,{\"className\":\"mb-3 flex space-x-4\",\"children\":[null,[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/JRMurr\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"github\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6\",\"children\":[\"$\",\"path\",null,{\"d\":\"M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12\"}]}]]}],[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://twitter.com/JRMurrCodes\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"twitter\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6\",\"children\":[\"$\",\"path\",null,{\"d\":\"M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z\"}]}]]}],[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://hachyderm.io/@jrmurr\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"mastodon\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6\",\"children\":[\"$\",\"path\",null,{\"d\":\"$12\"}]}]]}],[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"/feed.xml\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"rss\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M3.692 17.517A3.696 3.696 0 0 0 0 21.211C0 23.244 1.656 24.9 3.692 24.9s3.694-1.657 3.694-3.689a3.697 3.697 0 0 0-3.694-3.694z\"}],[\"$\",\"path\",null,{\"d\":\"M.384 8.142A.386.386 0 0 0 0 8.527v4.688c0 .211.173.383.384.383 6.02 0 10.919 4.898 10.919 10.92 0 .209.171.383.384.383h4.705a.385.385 0 0 0 .387-.383l-.018-.121C16.692 15.423 9.37 8.142.384 8.142z\"}],[\"$\",\"path\",null,{\"d\":\"M24.89 24.397C24.825 10.936 13.854.011.384.011A.385.385 0 0 0 0 .397v4.824c0 .212.173.383.384.383 10.429 0 18.913 8.486 18.913 18.914 0 .209.172.383.382.383h4.845a.39.39 0 0 0 .388-.383l-.022-.121z\"}]]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400\",\"children\":[[\"$\",\"div\",null,{\"children\":\"John Murray\"}],[\"$\",\"div\",null,{\"children\":\" • \"}],[\"$\",\"div\",null,{\"children\":\"© 2024\"}],[\"$\",\"div\",null,{\"children\":\" • \"}],[\"$\",\"$Le\",null,{\"href\":\"/\",\"children\":\"John's Codes\"}]]}]]}]}]]}]}]]}]}]]}],null]],\"initialHead\":[false,\"$L13\"],\"globalErrorComponent\":\"$14\",\"missingSlots\":\"$W15\"}]]\n"])</script><script>self.__next_f.push([1,"16:I[144,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"749\",\"static/chunks/749-ed776d54eb5c7205.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-04bc103f80b6f059.js\"],\"\"]\n17:I[2502,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"749\",\"static/chunks/749-ed776d54eb5c7205.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-04bc103f80b6f059.js\"],\"\"]\n18:I[4282,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"749\",\"static/chunks/749-ed776d54eb5c7205.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-04bc1"])</script><script>self.__next_f.push([1,"03f80b6f059.js\"],\"\"]\n19:I[4970,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"749\",\"static/chunks/749-ed776d54eb5c7205.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-04bc103f80b6f059.js\"],\"\"]\n"])</script><script>self.__next_f.push([1,"7:[[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"BlogPosting\\\",\\\"headline\\\":\\\"Rust Environment and Docker Build with Nix Flakes\\\",\\\"datePublished\\\":\\\"2022-05-19T00:00:00.000Z\\\",\\\"dateModified\\\":\\\"2022-05-19T00:00:00.000Z\\\",\\\"description\\\":\\\"Reproducible dev environments and builds with Nix\\\",\\\"author\\\":[{\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"John Murray\\\"}]}\"}}],[\"$\",\"section\",null,{\"className\":\"mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0\",\"children\":[[\"$\",\"$L16\",null,{}],[\"$\",\"article\",null,{\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"header\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"space-y-1 border-b border-gray-200 pb-10 text-center dark:border-gray-700\",\"children\":[[\"$\",\"dl\",null,{\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"dt\",null,{\"className\":\"sr-only\",\"children\":\"Published on\"}],[\"$\",\"dd\",null,{\"className\":\"text-base font-medium leading-6 text-gray-500 dark:text-gray-400\",\"children\":[[\"$\",\"time\",null,{\"dateTime\":\"2022-05-19T00:00:00.000Z\",\"children\":\"May 19, 2022\"}],[\"$\",\"span\",null,{\"className\":\"mx-2\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"ml-1\",\"children\":[6,\" min read\"]}]]}]]}]}],[\"$\",\"div\",null,{\"children\":[\"$\",\"h1\",null,{\"className\":\"text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14\",\"children\":\"Rust Environment and Docker Build with Nix Flakes\"}]}]]}]}],[\"$\",\"div\",null,{\"className\":\"grid-rows-[auto_1fr] divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:divide-y-0\",\"children\":[[\"$\",\"div\",null,{\"className\":\"divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0\",\"children\":[[\"$\",\"div\",null,{\"className\":\"prose max-w-none pb-8 pt-10 dark:prose-invert\",\"children\":[[\"$\",\"$L17\",null,{\"series\":null,\"currSlug\":\"rust-enviorment-and-docker-build-with-nix-flakes\"}],[[\"$\",\"details\",null,{\"open\":true,\"children\":[[\"$\",\"summary\",null,{\"className\":\"ml-6 pb-2 pt-2 text-xl font-bold\",\"children\":\"Table of Contents\"}],[\"$\",\"div\",null,{\"className\":\"ml-6\",\"children\":[\"$\",\"ul\",null,{\"className\":\"\",\"children\":[[\"$\",\"li\",\"0\",{\"children\":[[\"$\",\"a\",null,{\"href\":\"#why-nix\",\"children\":\"Why Nix\"}],null]}],[\"$\",\"li\",\"1\",{\"children\":[[\"$\",\"a\",null,{\"href\":\"#the-dev-environment\",\"children\":\"The Dev Environment\"}],null]}],[\"$\",\"li\",\"2\",{\"children\":[[\"$\",\"a\",null,{\"href\":\"#rust-in-nix\",\"children\":\"Rust in Nix\"}],null]}],[\"$\",\"li\",\"3\",{\"children\":[[\"$\",\"a\",null,{\"href\":\"#automatically-load-the-nix-environment\",\"children\":\"Automatically Load the Nix Environment\"}],null]}],[\"$\",\"li\",\"4\",{\"children\":[[\"$\",\"a\",null,{\"href\":\"#build-rust-project\",\"children\":\"Build Rust Project\"}],null]}],[\"$\",\"li\",\"5\",{\"children\":[[\"$\",\"a\",null,{\"href\":\"#make-a-docker-image\",\"children\":\"Make a Docker Image\"}],null]}],[\"$\",\"li\",\"6\",{\"children\":[[\"$\",\"a\",null,{\"href\":\"#common-troubleshooting-issues\",\"children\":\"Common troubleshooting issues\"}],[\"$\",\"ul\",null,{\"className\":\"\",\"children\":[[\"$\",\"li\",\"0\",{\"children\":[[\"$\",\"a\",null,{\"href\":\"#non-rust-build-dependencies\",\"children\":\"Non Rust Build Dependencies\"}],null]}],[\"$\",\"li\",\"1\",{\"children\":[[\"$\",\"a\",null,{\"href\":\"#nix-docs\",\"children\":\"Nix Docs\"}],null]}]]}]]}]]}]}]]}],[\"$\",\"h2\",null,{\"id\":\"why-nix\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#why-nix\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Why Nix\"]}],[\"$\",\"p\",null,{\"children\":[\"Getting a dev environment setup with rust is usually pretty simple, just use rustup then you're good to go. Using a build tool like \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://nixos.org/\",\"children\":\"Nix\"}],\" can buy you much more for not much extra work. Nix lets you\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"Specify non rust project dependencies in code\"}],[\"$\",\"li\",null,{\"children\":[\"Automatically add all your projects tools/dependencies to your path with \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://direnv.net/\",\"children\":\"direnv\"}]]}],[\"$\",\"li\",null,{\"children\":\"Easily build slim docker containers\"}]]}],[\"$\",\"p\",null,{\"children\":\"Once you start working in a repo with nix you never want to go back. No more READMEs with a list of Homebrew, apt, pacman, etc. commands you need to run. Building slim docker containers is a breeze without needing to manually handle multiple layers to copy build artifacts from.\"}],[\"$\",\"p\",null,{\"children\":[\"This post will mostly be a quick and dirty guide to getting started with nix, so I won't go into too much detail on what nix is doing under the hood/nix syntax. For a quick and dirty nix syntax reference I recommend \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://learnxinyminutes.com/docs/nix/\",\"children\":\"learn X in Y's post\"}],\", if you have some functional programming experience most of the basics will be quick to pick up.\"]}],[\"$\",\"h2\",null,{\"id\":\"the-dev-environment\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#the-dev-environment\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"The Dev Environment\"]}],[\"$\",\"p\",null,{\"children\":[\"We will use \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://nixos.wiki/wiki/Flakes\",\"children\":\"nix flakes\"}],\" to set up nix for our project. Flakes are nix's newish way to make nix builds more reproducible by adding a lock file concept to the project. Each flake can have \",[\"$\",\"code\",null,{\"children\":\"inputs\"}],\" which are other flakes/nix files and many \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://nixos.wiki/wiki/Flakes#Output_schema\",\"children\":\"outputs\"}],\". One thing to note, all files referenced in your flake (including itself) must be added to git. If you run into any file not found errors make sure you \",[\"$\",\"code\",null,{\"children\":\"git add\"}],\" everything you need.\"]}],[\"$\",\"p\",null,{\"children\":\"To get started in the root of your project run\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"$$\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" nix\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" flake\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" init\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"This will give you a \",[\"$\",\"code\",null,{\"children\":\"flake.nix\"}],\" file that looks like\"]}],[\"$\",\"div\",null,{\"className\":\"remark-code-title\",\"children\":\"flake.nix\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"{\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  description\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"A very basic flake\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  outputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" { self\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" nixpkgs }: {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    packages\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"x86_64-linux\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"hello\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" nixpkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"legacyPackages\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"x86_64-linux\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"hello\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    defaultPackage\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"x86_64-linux\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" self\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"packages\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"x86_64-linux\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"hello\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"  };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"This starter flake will build a hello world binary with \",[\"$\",\"code\",null,{\"children\":\"nix build .#hello\"}],\" which calls the first line or with just \",[\"$\",\"code\",null,{\"children\":\"nix build\"}],\" to call the \",[\"$\",\"code\",null,{\"children\":\"defaultPackage\"}],\" line. The downside is this only builds the package on x86/64 Linux, let's add some inputs to generalize this to more systems.\"]}],[\"$\",\"div\",null,{\"className\":\"remark-code-title\",\"children\":\"flake.nix\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"{\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  inputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    nixpkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"url\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"github:nixos/nixpkgs/nixos-unstable\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    flake-utils\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"url\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"github:numtide/flake-utils\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"  };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  outputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" { self\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" nixpkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" flake-utils\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" ... \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"}:\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"    flake-utils\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"lib\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"eachDefaultSystem\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" (system:\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"      let\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" import\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" nixpkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"inherit\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" system\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"; };\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"      in\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        packages\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"hello\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"hello\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        defaultPackage\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"hello\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"      });\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"We added two inputs, the first is \",[\"$\",\"code\",null,{\"children\":\"nixpkgs\"}],\" which lets us specify which version of nixpkgs we should use. There are many \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://search.nixos.org/packages\",\"children\":\"thousands of packages\"}],\" in the nixpkg repository, and they are updated often so here will use the unstable branch. We also added \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/numtide/flake-utils\",\"children\":\"flake-utils\"}],\" which helps us generalize the flake to support multiple systems, not just Linux.\"]}],[\"$\",\"p\",null,{\"children\":[\"Now on Linux and mac the hello package will build. When you run \",[\"$\",\"code\",null,{\"children\":\"nix build\"}],\", you should see a \",[\"$\",\"code\",null,{\"children\":\"result\"}],\" folder which contains the \",[\"$\",\"code\",null,{\"children\":\"hello\"}],\" package, you can run it with \",[\"$\",\"code\",null,{\"children\":\"./result/bin/hello\"}],\". The \",[\"$\",\"code\",null,{\"children\":\"result\"}],\" folder is a symlink to the output of build in the nix store (where nix keeps all outputs). It will not always be a folder, it will just depend on the build.\"]}],[\"$\",\"h2\",null,{\"id\":\"rust-in-nix\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#rust-in-nix\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Rust in Nix\"]}],[\"$\",\"p\",null,{\"children\":\"To move on from \\\"hello world\\\" to rust lets add another input\"}],[\"$\",\"div\",null,{\"className\":\"remark-code-title\",\"children\":\"flake.nix\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"inputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#b31d28\",\"--shiki-dark\":\"#FDAEB7\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    nixpkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"url\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"github:nixos/nixpkgs/nixos-unstable\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    flake-utils\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"url\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"github:numtide/flake-utils\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    rust-overlay\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"url\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"github:oxalica/rust-overlay\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"  }\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#b31d28\",\"--shiki-dark\":\"#FDAEB7\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"outputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#b31d28\",\"--shiki-dark\":\"#FDAEB7\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" { self\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" nixpkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" flake-utils\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" rust-overlay\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" ... \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"}:\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"  flake-utils\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"lib\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"eachDefaultSystem\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" (system:\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"    let\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"      overlays\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" [ (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"import\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" rust-overlay\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\") ];\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"      pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" import\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" nixpkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"inherit\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" system\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" overlays\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"; };\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"      rustVersion\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"rust-bin\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"stable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"latest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"default\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"    in\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"      devShell\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"mkShell\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        buildInputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"          [ (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"rustVersion\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"override\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"extensions\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" [ \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"rust-src\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" ]; }) ];\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"      };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    })\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#b31d28\",\"--shiki-dark\":\"#FDAEB7\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"We added \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/oxalica/rust-overlay\",\"children\":\"rust-overlay\"}],\", so we can easily specify different rust versions without relying on \",[\"$\",\"code\",null,{\"children\":\"nixpkgs\"}],\" to give us what ever rust version in there.\"]}],[\"$\",\"p\",null,{\"children\":[\"We also switched the \",[\"$\",\"code\",null,{\"children\":\"outputs\"}],\" to only have \",[\"$\",\"code\",null,{\"children\":\"devShell\"}],\", that output is tied to \",[\"$\",\"code\",null,{\"children\":\"nix develop\"}],\", when run you will get a new sandboxed shell with the stable rust version.\"]}],[\"$\",\"p\",null,{\"children\":[\"If you want to use a specific version/nightly build you can use \",[\"$\",\"code\",null,{\"children\":\"rustVersion = (pkgs.rust-bin.fromRustupToolchainFile ./rust-toolchain.toml);\"}],\" to read a rust toolchain file and use the version specified in there.\"]}],[\"$\",\"p\",null,{\"children\":[\"You may also have noticed we added \",[\"$\",\"code\",null,{\"children\":\".override { extensions = [ \\\"rust-src\\\" ]; })\"}],\". This is needed for rust analyzer to get rust source code.\"]}],[\"$\",\"h2\",null,{\"id\":\"automatically-load-the-nix-environment\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#automatically-load-the-nix-environment\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Automatically Load the Nix Environment\"]}],[\"$\",\"p\",null,{\"children\":[\"Now that we have the rust version we want let's make the \",[\"$\",\"code\",null,{\"children\":\"nix develop\"}],\" step automatic.\"]}],[\"$\",\"p\",null,{\"children\":[\"Install \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://direnv.net/\",\"children\":\"direnv\"}],\" and \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/nix-community/nix-direnv\",\"children\":\"nix-direnv\"}],\". The second is optional but helps with caching, so I recommend it.\"]}],[\"$\",\"p\",null,{\"children\":[\"Direnv will add hooks to your shell so when you \",[\"$\",\"code\",null,{\"children\":\"cd\"}],\" into your project it will autoload the nix environment for you without needing to run \",[\"$\",\"code\",null,{\"children\":\"nix develop\"}],\".\"]}],[\"$\",\"p\",null,{\"children\":\"In the root of your project run\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"$$\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" echo\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"use flake\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" \u003e\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" .envrc\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"$$\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" direnv\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" allow\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"The \",[\"$\",\"code\",null,{\"children\":\".envrc\"}],\" file will be loaded by direnv, and it will use the flake's \",[\"$\",\"code\",null,{\"children\":\"devShell\"}],\" output to set up your environment. On changes to your flake direnv will reload only what has changed.\"]}],[\"$\",\"p\",null,{\"children\":[\"If you are using VS Code, use \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://marketplace.visualstudio.com/items?itemName=arrterian.nix-env-selector\",\"children\":\"nix env selector\"}],\", so VS Code is aware of the flake. It is not always necessary if you open VS Code from your terminal, but It's simple to set up.\"]}],[\"$\",\"h2\",null,{\"id\":\"build-rust-project\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#build-rust-project\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Build Rust Project\"]}],[\"$\",\"p\",null,{\"children\":\"Now that we have rust in our dev environment we can make a new rust app with\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"$$\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" cargo\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" init\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"Then we can run/build the project like you normally would with \",[\"$\",\"code\",null,{\"children\":\"cargo run\"}],\"/\",[\"$\",\"code\",null,{\"children\":\"cargo build\"}],\". That works well while developing but let's use nix to build the project, this will help us later on when we make the docker image.\"]}],[\"$\",\"p\",null,{\"children\":\"Let's update the outputs too\"}],[\"$\",\"div\",null,{\"className\":\"remark-code-title\",\"children\":\"flake.nix\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"outputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#b31d28\",\"--shiki-dark\":\"#FDAEB7\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" { self\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" nixpkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" flake-utils\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" rust-overlay\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" ... \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"}:\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"    flake-utils\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"lib\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"eachDefaultSystem\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" (system:\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"      let\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        overlays\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" [ (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"import\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" rust-overlay\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\") ];\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" import\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" nixpkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"inherit\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" system\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" overlays\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"; };\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        rustVersion\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"rust-bin\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"stable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"latest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"default\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        rustPlatform\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"makeRustPlatform\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          cargo\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" rustVersion\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          rustc\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" rustVersion\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"        };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        myRustBuild\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" rustPlatform\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"buildRustPackage\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          pname\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            \\\"rust_nix_blog\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"# make this what ever your cargo.toml package.name is\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          version\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"0.1.0\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          src\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ./.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"# the folder with the cargo.toml\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          cargoLock\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"lockFile\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ./Cargo.lock\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"        };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"      in\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        defaultPackage\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" myRustBuild\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        devShell\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"mkShell\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          buildInputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"            [ (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"rustVersion\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"override\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"extensions\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" [ \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"rust-src\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" ]; }) ];\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"        };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"      })\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#b31d28\",\"--shiki-dark\":\"#FDAEB7\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"First we have to make a \",[\"$\",\"code\",null,{\"children\":\"rustPlatform\"}],\" with our rust version. The platform will let us build our rust package with \",[\"$\",\"code\",null,{\"children\":\"rustPlatform.buildRustPackage\"}],\". This is the nix equivalent of \",[\"$\",\"code\",null,{\"children\":\"cargo build\"}],\". We need \",[\"$\",\"code\",null,{\"children\":\"cargoLock.lockFile\"}],\" so nix can cache all of your project's dependencies based on your existing lock file.\"]}],[\"$\",\"p\",null,{\"children\":[\"Now we can run \",[\"$\",\"code\",null,{\"children\":\"nix build\"}],\", then your project will be in the \",[\"$\",\"code\",null,{\"children\":\"result\"}],\" folder again. In my case I can run \",[\"$\",\"code\",null,{\"children\":\"./result/bin/rust_nix_blog\"}],\".\"]}],[\"$\",\"h2\",null,{\"id\":\"make-a-docker-image\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#make-a-docker-image\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Make a Docker Image\"]}],[\"$\",\"p\",null,{\"children\":\"Now that we have nix building the rust project making the docker container is quite easy.\"}],[\"$\",\"div\",null,{\"className\":\"remark-code-title\",\"children\":\"flake.nix\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"outputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#b31d28\",\"--shiki-dark\":\"#FDAEB7\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" { self\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" nixpkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" flake-utils\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" rust-overlay\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" ... \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"}:\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"    flake-utils\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"lib\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"eachDefaultSystem\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" (system:\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"      let\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        overlays\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" [ (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"import\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" rust-overlay\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\") ];\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" import\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" nixpkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"inherit\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" system\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" overlays\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"; };\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        rustVersion\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"rust-bin\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"stable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"latest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"default\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        rustPlatform\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"makeRustPlatform\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          cargo\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" rustVersion\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          rustc\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" rustVersion\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"        };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        myRustBuild\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" rustPlatform\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"buildRustPackage\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          pname\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            \\\"rust_nix_blog\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"# make this what ever your cargo.toml package.name is\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          version\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"0.1.0\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          src\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ./.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"# the folder with the cargo.toml\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          cargoLock\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"lockFile\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ./Cargo.lock\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"        };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        dockerImage\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"dockerTools\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"buildImage\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"rust-nix-blog\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          config\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"Cmd\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" [ \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"$${\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"myRustBuild\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"}\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"/bin/rust_nix_blog\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" ]; };\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"        };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"      in\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        packages\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          rustPackage\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" myRustBuild\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          docker\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" dockerImage\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"        };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        defaultPackage\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" dockerImage\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        devShell\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"mkShell\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          buildInputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"            [ (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"rustVersion\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"override\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"extensions\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" [ \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"rust-src\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" ]; }) ];\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"        };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"      })\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#b31d28\",\"--shiki-dark\":\"#FDAEB7\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"Now \",[\"$\",\"code\",null,{\"children\":\"nix build\"}],\" or \",[\"$\",\"code\",null,{\"children\":\"nix build .#docker\"}],\" will build the docker image. After building \",[\"$\",\"code\",null,{\"children\":\"result\"}],\" is just a sym link to the image tar file of a folder like before. Since nix is declarative it does not load it directly into docker for you. You can load it with\"]}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"$$\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" docker\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" load\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" result\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"You should see an output like \",[\"$\",\"code\",null,{\"children\":\"rust-nix-blog:yyc9gd4nkydrikzpsvlp3gmwnpxhh1ik\"}],\" which is the image and tag loaded in.\"]}],[\"$\",\"p\",null,{\"children\":\"Now run the image with\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"$$\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" docker\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" run\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" rust-nix-blog:yyc9gd4nkydrikzpsvlp3gmwnpxhh1ik\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"We can automate this a bit with a script like. (Slightly modified example from \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://jamey.thesharps.us/2021/02/02/docker-containers-nix/\",\"children\":\"here\"}],\")\"]}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"#!/usr/bin/env bash\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" -e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" -o\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" pipefail\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"nix\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" build\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" '.#docker'\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"image\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"$$((docker load \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" result) \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"|\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" sed \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"-\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"n '\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"$$s\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"^Loaded image\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" //\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"p')\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"docker image tag \\\"$image\\\" rust-nix-blog:latest\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"Let's use \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/wagoodman/dive\",\"children\":\"dive\"}],\" to look at the image. You can use it temporarily with \",[\"$\",\"code\",null,{\"children\":\"nix shell nixpkgs#dive\"}],\".\"]}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\" 33 MB  └── nix\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\" 33 MB      └── store\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"374 kB          ├─⊕ h4isr1pyv1fjdrxj2g80vsa4hp2hp76s-rust_nix_blog-0.1.0\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"1.8 MB          ├─⊕ ik4qlj53grwmg7avzrfrn34bjf6a30ch-libunistring-1.0\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"246 kB          ├─⊕ w3zngkrag7vnm7v1q8vnqb71q6a1w8gn-libidn2-2.3.2\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\" 30 MB          └─⊕ ybkkrhdwdj227kr20vk8qnzqnmj7a06x-glibc-2.34-115\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{}]}]]}]}],[\"$\",\"p\",null,{\"children\":\"Looking at the output you can see it's a single layer image with just what is needed to run the binary (in case just libc and the rust code).\"}],[\"$\",\"h2\",null,{\"id\":\"common-troubleshooting-issues\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#common-troubleshooting-issues\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Common troubleshooting issues\"]}],[\"$\",\"h3\",null,{\"id\":\"non-rust-build-dependencies\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#non-rust-build-dependencies\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Non Rust Build Dependencies\"]}],[\"$\",\"p\",null,{\"children\":[\"Building with nix is great once its working, it will stay working forever. Getting to a working state can be a bit of pain sometimes. If your rust code relies on system packages (like OpenSSL) make sure you include them in \",[\"$\",\"code\",null,{\"children\":\"buildInputs\"}],\", for example\"]}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"rustPlatform\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"buildRustPackage\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  pname\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"    \\\"rust_nix_blog\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"# make this what ever your cargo.toml package.name is\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  version\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"0.1.0\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  src\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ./.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"# the folder with the cargo.toml\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  nativeBuildInputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"pkg-config\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" ]; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"# just for the host building the package\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  buildInputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"openssl\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"]; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"# packages needed by the consumer\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  cargoLock\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"lockFile\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ./Cargo.lock\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"}\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#b31d28\",\"--shiki-dark\":\"#FDAEB7\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":\"For OpenSSL specifically I would recommend using rustls when possible. It's easier to build and in rust.\"}],[\"$\",\"h3\",null,{\"id\":\"nix-docs\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#nix-docs\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Nix Docs\"]}],[\"$\",\"p\",null,{\"children\":[\"Nix documentation is not the best. While the \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://nixos.wiki/wiki/Rust\",\"children\":\"wiki\"}],\" and \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://nixos.org/manual/nixpkgs/stable/#preface\",\"children\":\"manual\"}],\" have some info, I've found the best resources have been the many nix bloggers out there. Here are some good references\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://christine.website/blog/nix-flakes-1-2022-02-21\",\"children\":\"Xe\"}],\" most of her blogs relate to nixos, the Linux distro based on nix, but it helps to learn the language and common patterns\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://ianthehenry.com/posts/how-to-learn-nix/\",\"children\":\"Ian Henry's how to learn nix\"}],\" Ian has a blog series of him learning nix. It's not really documentation but more curated notes of his process of using nix.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://www.tweag.io/blog/2020-05-25-flakes/\",\"children\":\"Intro to nix flakes\"}],\" Great 3 part series on what flakes are and how to use them\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://jamey.thesharps.us/2021/02/02/docker-containers-nix/\",\"children\":\"Building docker containers with nix\"}],\" Linked this earlier, but it's a good reference for more options on building containers\"]}]]}],[\"$\",\"p\",null,{\"children\":\"I also highly recommend on diving headfirst into nix by using Nixos as your Linux distro. It will help make you more comfortable with the language and its great to use once it clicks.\"}]]]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"div\",null,{\"className\":\"pb-6 pt-6 text-sm text-gray-700 dark:text-gray-300\",\"children\":[[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"nofollow\",\"href\":\"https://mobile.twitter.com/search?q=https%3A%2F%2Fjohns.codes%2Fblog%2Frust-enviorment-and-docker-build-with-nix-flakes\",\"children\":\"Discuss on Twitter\"}],\" • \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/JRMurr/JRMurr.github.io/blob/main/content/blog/rust-enviorment-and-docker-build-with-nix-flakes.md\",\"children\":\"View on GitHub\"}]]}],[\"$\",\"div\",null,{\"className\":\"pb-6 pt-6 text-center text-gray-700 dark:text-gray-300\",\"id\":\"comment\",\"children\":[\"$\",\"$L19\",null,{}]}],\"$undefined\"]}]]}],[\"$\",\"footer\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col text-sm font-medium sm:flex-row sm:justify-between sm:text-base\",\"children\":[[\"$\",\"div\",null,{\"className\":\"pt-4 xl:pt-8\",\"children\":[\"$\",\"$Le\",null,{\"href\":\"/blog/intermediate-typescript-generics-and-mapped-types\",\"className\":\"text-primary-500 hover:text-primary-600 dark:hover:text-primary-400\",\"aria-label\":\"Previous post: Intermediate Typescript: Generics and Mapped Types\",\"children\":[\"← \",\"Intermediate Typescript: Generics and Mapped Types\"]}]}],[\"$\",\"div\",null,{\"className\":\"pt-4 xl:pt-8\",\"children\":[\"$\",\"$Le\",null,{\"href\":\"/blog/type-safe-groupby-in-typescript\",\"className\":\"text-primary-500 hover:text-primary-600 dark:hover:text-primary-400\",\"aria-label\":\"Next post: Type Safe GroupBy In TypeScript\",\"children\":[\"Type Safe GroupBy In TypeScript\",\" →\"]}]}]]}]}]]}]]}]}]]}]]\n"])</script><script>self.__next_f.push([1,"13:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Rust Environment and Docker Build with Nix Flakes | John's Codes\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Reproducible dev environments and builds with Nix\"}],[\"$\",\"meta\",\"4\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"5\",{\"name\":\"googlebot\",\"content\":\"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1\"}],[\"$\",\"link\",\"6\",{\"rel\":\"canonical\",\"href\":\"https://johns.codes/blog/rust-enviorment-and-docker-build-with-nix-flakes\"}],[\"$\",\"link\",\"7\",{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"https://johns.codes/feed.xml\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:title\",\"content\":\"Rust Environment and Docker Build with Nix Flakes\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:description\",\"content\":\"Reproducible dev environments and builds with Nix\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:url\",\"content\":\"https://johns.codes/blog/rust-enviorment-and-docker-build-with-nix-flakes\"}],[\"$\",\"meta\",\"11\",{\"property\":\"og:site_name\",\"content\":\"John's Codes\"}],[\"$\",\"meta\",\"12\",{\"property\":\"og:locale\",\"content\":\"en_US\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"14\",{\"property\":\"article:published_time\",\"content\":\"2022-05-19T00:00:00.000Z\"}],[\"$\",\"meta\",\"15\",{\"property\":\"article:modified_time\",\"content\":\"2022-05-19T00:00:00.000Z\"}],[\"$\",\"meta\",\"16\",{\"property\":\"article:author\",\"content\":\"John Murray\"}],[\"$\",\"meta\",\"17\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"18\",{\"name\":\"twitter:title\",\"content\":\"Rust Environment and Docker Build with Nix Flakes\"}],[\"$\",\"meta\",\"19\",{\"name\":\"twitter:description\",\"content\":\"Reproducible dev environments and builds with Nix\"}],[\"$\",\"meta\",\"20\",{\"name\":\"next-size-adjust\"}]]\n"])</script><script>self.__next_f.push([1,"6:null\n"])</script><script>self.__next_f.push([1,""])</script></body></html>