<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" content="#000000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>Building a Simple DB in Rust - Part 1 - Parsing</title><meta name="robots" content="follow, index"/><meta name="description" content="building a basic database in rust"/><meta property="og:url" content="https://johns.codes/blog/build-a-db/part01"/><meta property="og:type" content="article"/><meta property="og:site_name" content="John&#x27;s Codes"/><meta property="og:description" content="building a basic database in rust"/><meta property="og:title" content="Building a Simple DB in Rust - Part 1 - Parsing"/><meta property="og:image" content="https://johns.codes/static/images/twitter-card.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://twitter.com/JRMurrCodes"/><meta name="twitter:title" content="Building a Simple DB in Rust - Part 1 - Parsing"/><meta name="twitter:description" content="building a basic database in rust"/><meta name="twitter:image" content="https://johns.codes/static/images/twitter-card.png"/><meta property="article:published_time" content="2023-01-02T05:19:22.985Z"/><link rel="canonical" href="https://johns.codes/blog/build-a-db/part01"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://johns.codes/blog/build-a-db/part01"
  },
  "headline": "Building a Simple DB in Rust - Part 1 - Parsing",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://johns.codes/static/images/twitter-card.png"
    }
  ],
  "datePublished": "2023-01-02T05:19:22.985Z",
  "dateModified": "2023-01-02T05:19:22.985Z",
  "author": [
    {
      "@type": "Person",
      "name": "John Murray"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "John Murray",
    "logo": {
      "@type": "ImageObject",
      "url": "https://johns.codes/static/images/logo.png"
    }
  },
  "description": "building a basic database in rust"
}</script><meta name="next-head-count" content="20"/><link rel="preload" href="/_next/static/css/ff7a91e18d57a2d6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ff7a91e18d57a2d6.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-a0fb203be75c9eb6.js" defer=""></script><script src="/_next/static/chunks/main-b77bb48dcc3828e6.js" defer=""></script><script src="/_next/static/chunks/pages/_app-861f57e6bedfde14.js" defer=""></script><script src="/_next/static/chunks/framework-327e104994690a53.js" defer=""></script><script src="/_next/static/chunks/675-374a5a75205d32da.js" defer=""></script><script src="/_next/static/chunks/266-365d5fff0af19ac8.js" defer=""></script><script src="/_next/static/chunks/545-446f5effbf4e5f11.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-c8a468ed53b4c5d2.js" defer=""></script><script src="/_next/static/SynWlQ28OObrCnFVj8i-C/_buildManifest.js" defer=""></script><script src="/_next/static/SynWlQ28OObrCnFVj8i-C/_ssgManifest.js" defer=""></script><script src="/_next/static/SynWlQ28OObrCnFVj8i-C/_middlewareManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap">@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuFuYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body class="antialiased text-black bg-white dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex flex-col justify-between h-screen"><header class="flex items-center justify-between py-10"><div><a aria-label="John&#x27;s Codes" href="/"><div class="flex items-center justify-between"><div class="hidden h-6 text-2xl font-semibold sm:block">John&#x27;s Codes</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/projects">Projects</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="w-8 h-8 p-1 ml-1 mr-1 rounded sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="w-8 h-8 py-1 ml-1 mr-1 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed w-full h-full top-24 right-0 bg-gray-200 dark:bg-gray-800 opacity-95 z-10 transform ease-in-out duration-300 translate-x-full"><button type="button" aria-label="toggle modal" class="fixed w-full h-full cursor-auto focus:outline-none"></button><nav class="fixed h-full mt-8"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/projects">Projects</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed flex-col hidden gap-3 right-8 bottom-8 md:hidden"><button aria-label="Scroll To Comment" type="button" class="p-2 text-gray-500 transition-all bg-gray-200 rounded-full dark:text-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 hover:bg-gray-300"><svg class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="p-2 text-gray-500 transition-all bg-gray-200 rounded-full dark:text-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 hover:bg-gray-300"><svg class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-4 md:space-y-2 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="flex justify-center items-center text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2023-01-02T05:19:22.985Z">Monday, January 2, 2023</time><span class="mx-2">-</span><div class="flex items-center"><span class="ml-1">13 min read</span></div></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Building a Simple DB in Rust - Part 1 - Parsing</h1></div></div></header><div class="pb-8 divide-y divide-gray-200 xl:divide-y-0 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6" style="grid-template-rows:auto 1fr"><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:pb-0 xl:col-span-4 xl:row-span-2"><div class="pt-10 pb-8 prose dark:prose-dark max-w-none"><div class="pb-2"><p>This article is part of the <!-- -->Building a Simple DB in Rust<!-- --> series.</p><select class="block w-3/12 px-4 py-2 text-gray-900 bg-white border border-gray-300 rounded-md dark:border-gray-900 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-800 dark:text-gray-100"><option selected="" value="/blog/build-a-db/part01">Part 1 - Parsing</option><option value="/blog/build-a-db/part02">Part 2 - Basic Execution</option><option value="/blog/build-a-db/part03">Part 3 - Less Basic Execution</option></select></div><details open=""><summary class="pt-2 pb-2 ml-6 text-xl font-bold">Table of Contents</summary><div class="ml-6"><ul><li class="false"><a href="#what-am-i-making">What am I Making</a></li><li class="false"><a href="#project-setup">Project setup</a></li><li class="ml-6"><a href="#cargo-workspaces">Cargo Workspaces</a></li><li class="false"><a href="#the-repl">The REPL</a></li><li class="false"><a href="#parsing">Parsing</a></li><li class="ml-6"><a href="#nom-for-dummies">nom for dummies</a></li><li class="ml-6"><a href="#my-own-sql">My Own SQL</a></li><li class="ml-6"><a href="#actual-parsing">Actual parsing</a></li><li class="ml-6"><a href="#helper-trait">Helper trait</a></li><li class="ml-6"><a href="#parsing-create-table">Parsing Create Table</a></li><li class="ml-6"><a href="#pulling-it-all-together">Pulling it all together</a></li><li class="ml-6"><a href="#parser-errors">Parser Errors</a></li><li class="false"><a href="#part-1-wrap-up">Part 1 wrap up</a></li></ul></div></details>
<p>While I&#x27;ve used rust for a while and have had a few small projects in it, I felt like I was missing a truly &quot;systems&quot; project.
So when I came across <a target="_blank" rel="noopener noreferrer" href="https://cstack.github.io/db_tutorial/">this series</a> for making a simple DB in C, I figured why not try to make my basic DB in rust.
I will roughly follow the structure of that series at first, but I will most likely deviate and focus on what interests me more.</p>
<p>This series will be mostly a dev log (I&#x27;m making this up as I go) but will try to do what I can to use it as tutorial content when possible.
I will probably get things wrong, so please call me out in comments, on my <a target="_blank" rel="noopener noreferrer" href="https://github.com/JRMurr/JRMurr.github.io">GitHub</a>, or my <a href="/about">socials</a></p>
<p>I hate naming things, so I&#x27;ll keep it basic, I will be calling my DB SQLJr</p>
<p>If you wanna just jump to some code <a target="_blank" rel="noopener noreferrer" href="https://github.com/JRMurr/SQLJr">this is the repo for it</a>.
It will be mostly the same with some minor tweaks here and there (and more up-to-date).</p>
<h2 id="what-am-i-making"><a href="#what-am-i-making" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>What am I Making</h2>
<p>I plan on mostly focusing on building my own SQL (not following any spec) that will have basic filtering, aggregates, and joins.
Since rust has many B-Tree libraries (One of the core data structures for how to store/search rows), I will try to focus more on good concurrency+transaction support instead of building my own B-tree/persistence logic.
Also, many Rust based tools I used have excellent error messages, so I will try to have good/informative errors for all parts of the DB.</p>
<p>I will probably end up on some side tangents from those core features, so I will follow whatever vibe I get.</p>
<p>In this post, we will focus on getting the project setup and building a basic REPL (in a similar vein to <a target="_blank" rel="noopener noreferrer" href="https://www.postgresql.org/docs/current/app-psql.html">psql</a>) + parser
to make it easy to interact with the rest of the DB later on.</p>
<h2 id="project-setup"><a href="#project-setup" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Project setup</h2>
<p>I love <a target="_blank" rel="noopener noreferrer" href="https://nixos.org/">Nix</a>, so I always start with that to get rust installed.
I recently made my own <a target="_blank" rel="noopener noreferrer" href="https://github.com/JRMurr/NixOsConfig/tree/main/templates">nix flake templates</a> to make starting new projects easier.
You can run</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">shell</div><div class="code-container"><code><div class="line"><span style="color:#F8F8F2">$ nix flake --refresh new --template github:JRMurr/NixOsConfig#rust </span><span style="color:#FF79C6">&lt;</span><span style="color:#F8F8F2">pathToProjectDir</span><span style="color:#FF79C6">&gt;</span></div></code></div></pre></div>
<p>to create a new folder with a <code>flake.nix</code> file to get rust setup with nightly, update the <code>rust-toolchain.toml</code> to the most recent nightly.</p>
<p>The template does not include a <code>Cargo.toml</code> so make one with <code>cargo init</code> or <code>cargo new</code> to set up the crate.</p>
<h3 id="cargo-workspaces"><a href="#cargo-workspaces" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Cargo Workspaces</h3>
<p>While we could probably get away with having a <code>core</code>/<code>lib</code> crate and then make an <code>application</code> crate for CLI/HTTP access to the DB,
I would like to try to split up the crates across more logical boundaries. This helps out with compile times since rust can compile each crate in parallel.
My current idea is a different crate for</p>
<ul>
<li>a CLI/REPL to interact with a db</li>
<li>Parsing SQL</li>
<li>Query Execution</li>
</ul>
<p>Some things like defining the different commands/queries don&#x27;t quite feel right in being in the parsing/execution crates so might make sense to add a crate just for shared types.</p>
<p>To set up cargo workspaces make a <code>Cargo.toml</code> that looks like</p>
<div class="remark-code-title">Cargo.toml</div>
<div class="relative"><pre class="shiki dracula"><div class="language-id">toml</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">[</span><span style="color:#8BE9FD">workspace</span><span style="color:#FF79C6">]</span></div><div class="line"><span style="color:#8BE9FD">members</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#6272A4"># all crates in a `./crates` folder will be added to the workspace</span></div><div class="line"><span style="color:#F8F8F2">	</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">crates/*</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">]</span></div><div class="line"></div><div class="line"><span style="color:#6272A4"># https://doc.rust-lang.org/nightly/cargo/reference/specifying-dependencies.html#inheriting-a-dependency-from-a-workspace</span></div><div class="line"><span style="color:#6272A4"># Shared dependencies across all workspace crates</span></div><div class="line"><span style="color:#FF79C6">[</span><span style="color:#8BE9FD">workspace</span><span style="color:#FF79C6">.</span><span style="color:#8BE9FD">dependencies</span><span style="color:#FF79C6">]</span></div><div class="line"><span style="color:#6272A4"># these are very likely to be used across all/most crates so pin the version for them all</span></div><div class="line"><span style="color:#8BE9FD">miette</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">5.5.0</span><span style="color:#E9F284">&quot;</span></div><div class="line"><span style="color:#8BE9FD">serde</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> { </span><span style="color:#8BE9FD">version</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">1.0.151</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">features</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">derive</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">] }</span></div><div class="line"><span style="color:#8BE9FD">thiserror</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">1.0.38</span><span style="color:#E9F284">&quot;</span></div></code></div></pre></div>
<p>This will tell cargo we are using workspaces. Once we start making crates I will explain how to use the shared dependencies listed above</p>
<h2 id="the-repl"><a href="#the-repl" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The REPL</h2>
<p>While we could go right to execution or parsing and just develop with unit tests, I like having some form of interactivity as soon as possible.
The unit test approach would definitely make sense if this was a &quot;real&quot; project, for personal stuff I&#x27;m fine being a bit in the wild west to make life easier.</p>
<p>So to get to interactivity let&#x27;s make a REPL. We can make a new crate by going into the <code>crates`` directory and running </code>cargo new sql_jr_repl<code>. The [rustyline crate](https://github.com/kkawakam/rustyline) seems like it will cover the basics for a REPL, so we can add it with </code>cargo add rustyline<code>in the</code>sql_jr_repl` directory.</p>
<p>We can copy the example with some small tweaks to get started</p>
<div class="remark-code-title">sql_jr_repl/main.rs</div>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">use</span><span style="color:#F8F8F2"> rustyline</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">error</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">ReadlineError</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#FF79C6">use</span><span style="color:#F8F8F2"> rustyline</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">{</span><span style="color:#8BE9FD">Editor</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Result</span><span style="color:#F8F8F2">};</span></div><div class="line"></div><div class="line"><span style="color:#FF79C6">const</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">HISTORY_FILE</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">&amp;</span><span style="color:#8BE9FD">str</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;./history.txt&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"></div><div class="line"><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">main</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Result</span><span style="color:#F8F8F2">&lt;()&gt; {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">mut</span><span style="color:#F8F8F2"> rl </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Editor</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">&lt;()&gt;</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">if</span><span style="color:#F8F8F2"> rl</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">load_history</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">HISTORY_FILE</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">is_err</span><span style="color:#F8F8F2">() {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">println!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;No previous history.&quot;</span><span style="color:#F8F8F2">);</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">loop</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> readline </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> rl</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">readline</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;&gt;&gt; &quot;</span><span style="color:#F8F8F2">);</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#FF79C6">match</span><span style="color:#F8F8F2"> readline {</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#8BE9FD">Ok</span><span style="color:#F8F8F2">(line) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">                rl</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">add_history_entry</span><span style="color:#F8F8F2">(line</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">as_str</span><span style="color:#F8F8F2">());</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#50FA7B">println!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Line: {}&quot;</span><span style="color:#F8F8F2">, line);</span></div><div class="line"><span style="color:#F8F8F2">            },</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#8BE9FD">Err</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">ReadlineError</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Interrupted</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#6272A4">                // CTRL-C so just skip</span></div><div class="line"><span style="color:#F8F8F2">            },</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#8BE9FD">Err</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">ReadlineError</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Eof</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#6272A4">                // CTRL-D so exit</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">break</span></div><div class="line"><span style="color:#F8F8F2">            },</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#8BE9FD">Err</span><span style="color:#F8F8F2">(err) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#50FA7B">println!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Error: {:?}&quot;</span><span style="color:#F8F8F2">, err);</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">break</span></div><div class="line"><span style="color:#F8F8F2">            }</span></div><div class="line"><span style="color:#F8F8F2">        }</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"><span style="color:#F8F8F2">    rl</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">save_history</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">HISTORY_FILE</span><span style="color:#F8F8F2">)</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>This will store the history in a local file (we can use the user&#x27;s home/XDG dirs to store it elsewhere later) and allow <code>CTRL-C</code> to &quot;cancel&quot; the current input and have <code>CTRL-D</code>/an error exit the REPL.
Try it out with <code>cargo run</code>, it will just repeat the lines you send with enter and run until you hit <code>CTRL-D</code>.</p>
<h2 id="parsing"><a href="#parsing" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Parsing</h2>
<p>Now that the basic REPL is set up we can work on parsing our simple SQL. In Rust, I have usually used <a target="_blank" rel="noopener noreferrer" href="https://github.com/Geal/nom">nom</a> when I need to make a parser.
I like that I stay in rust and don&#x27;t need to mess with a new &quot;language&quot; to get my parsing code. With that said <a target="_blank" rel="noopener noreferrer" href="https://pest.rs/">pest</a> looks pretty great as a more generator approach and may end up switching to that later on.</p>
<h3 id="nom-for-dummies"><a href="#nom-for-dummies" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>nom for dummies</h3>
<p>nom is a <a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Parser_combinator">parser combinator library</a>. The TLDR for that is you make functions that take in parsers and output parsers to build up your grammar.</p>
<p>Here are some examples</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#6272A4">// IResult tracks the input type (generally string or bytes) and the output type for the parser</span></div><div class="line"><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">parser</span><span style="color:#F8F8F2">(s</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">&amp;</span><span style="color:#8BE9FD">str</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">IResult</span><span style="color:#F8F8F2">&lt;</span><span style="color:#FF79C6">&amp;</span><span style="color:#8BE9FD">str</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">&amp;</span><span style="color:#8BE9FD">str</span><span style="color:#F8F8F2">&gt; {</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">tag_no_case</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;hello&quot;</span><span style="color:#F8F8F2">)(s)</span></div><div class="line"><span style="color:#F8F8F2">}</span></div><div class="line"><span style="color:#6272A4">// when you run a parser on some input it will return the remaining input in the first param</span></div><div class="line"><span style="color:#6272A4">// and the matched input for that parser that ran</span></div><div class="line"><span style="color:#50FA7B">assert_eq!</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">parser</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Hello, World!&quot;</span><span style="color:#F8F8F2">), </span><span style="color:#8BE9FD">Ok</span><span style="color:#F8F8F2">((</span><span style="color:#F1FA8C">&quot;, World!&quot;</span><span style="color:#F8F8F2">, </span><span style="color:#F1FA8C">&quot;Hello&quot;</span><span style="color:#F8F8F2">)));</span></div><div class="line"></div><div class="line"></div><div class="line"><span style="color:#6272A4">// NOTE: this is missing some trait bounds but the vibe is right</span></div><div class="line"><span style="color:#6272A4">/// Run the given parser f on a comma seperated list</span></div><div class="line"><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">crate</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">comma_sep</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">I</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">O</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">E</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">F</span><span style="color:#F8F8F2">&gt;(</span></div><div class="line"><span style="color:#F8F8F2">    f</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">F</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">impl</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">FnMut</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">I</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">IResult</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">I</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Vec</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">O</span><span style="color:#F8F8F2">&gt;, </span><span style="color:#8BE9FD">E</span><span style="color:#F8F8F2">&gt;</span></div><div class="line"><span style="color:#FF79C6">where</span></div><div class="line"><span style="color:#F8F8F2">{</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">separated_list1</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">tuple</span><span style="color:#F8F8F2">((multispace0, </span><span style="color:#50FA7B">char</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&#x27;,&#x27;</span><span style="color:#F8F8F2">), multispace0)), f)</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>There are <a target="_blank" rel="noopener noreferrer" href="https://github.com/Geal/nom/blob/main/doc/choosing_a_combinator.md">many combinators</a> provided by nom.</p>
<h3 id="my-own-sql"><a href="#my-own-sql" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>My Own SQL</h3>
<p>Right now I&#x27;m going to handle basic select, insert, and create table statements that will look like</p>
<div class="relative"><pre class="shiki dracula"><div class="code-container"><code><div class="line"><span style="color:undefined">CREATE TABLE FOO (
    col1 string,
    col2 int
)

INSERT INTO FOO VALUES 1,2;

SELECT col1, col2 FROM foo;</span></div></code></div></pre></div>
<p>To start we can make a new lib crate <code>sql_jr_parser</code>. We will add in nom, <a target="_blank" rel="noopener noreferrer" href="https://github.com/fflorent/nom_locate">nom_locate</a>, and <a target="_blank" rel="noopener noreferrer" href="https://github.com/Lucretiel/nom-supreme">nom_supreme</a>.
<code>nom_locate</code> has a nice <code>LocatedSpan</code> type to easily track where in the source code a parser ran/threw an error.
<code>nom_supreme</code> is a nom utility lib, we will use it mostly for postfix calls on parsers to make the code a little easier to read and <a target="_blank" rel="noopener noreferrer" href="https://docs.rs/nom-supreme/latest/nom_supreme/error/type.ErrorTree.html">error tree</a>
to help with error formatting</p>
<p>To be completely honest we probably could get by without <code>nom_locate</code> and just use <code>nom_supreme</code> but if it&#x27;s good enough for <a target="_blank" rel="noopener noreferrer" href="https://fasterthanli.me/series/advent-of-code-2022/part-11#nice-parser-errors">Amos</a> it&#x27;s good enough for me</p>
<h3 id="actual-parsing"><a href="#actual-parsing" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Actual parsing</h3>
<div class="grid place-content-center"><div class="dark:bg-gray-800 bg-gray-100 rounded"><div class="box-content px-3 py-0"><p>nom requires ALOT of imports so will be ignoring most of them in the code snippets</p></div></div></div>
<p>First, we need to define some type aliases</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#6272A4">// Use nom_locate&#x27;s LocatedSpan as a wrapper around a string input</span></div><div class="line"><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">type</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">RawSpan</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">LocatedSpan</span><span style="color:#F8F8F2">&lt;</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">str</span><span style="color:#F8F8F2">&gt;;</span></div><div class="line"></div><div class="line"><span style="color:#6272A4">// the result for all of our parsers, they will have our span type as input and can have any output</span></div><div class="line"><span style="color:#6272A4">// this will use a default error type but we will change that latter</span></div><div class="line"><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">type</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">ParseResult</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">T</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">IResult</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">RawSpan</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt;, </span><span style="color:#8BE9FD">T</span><span style="color:#F8F8F2">&gt;</span></div></code></div></pre></div>
<p>We will need to parse identifiers for columns and tables so let&#x27;s make a parser for that</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#6272A4">/// Parse a unquoted sql identifier</span></div><div class="line"><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">crate</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">identifier</span><span style="color:#F8F8F2">(i</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">RawSpan</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">ParseResult</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">String</span><span style="color:#F8F8F2">&gt; {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">map</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">take_while1</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2">c</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">char</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2"> c</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">is_alphanumeric</span><span style="color:#F8F8F2">()), </span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2">s</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">RawSpan</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">        s</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">fragment</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">to_string</span><span style="color:#F8F8F2">()</span></div><div class="line"><span style="color:#F8F8F2">    })(i)</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>Since we made the parser take in a <code>RawSpan</code> instead of just a <code>&amp; str</code> or <code>String</code> we would need to first call <code>LocatedSpan::new(input_str)</code> to call our parsers.</p>
<h3 id="helper-trait"><a href="#helper-trait" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Helper trait</h3>
<p>Since we will have a lot of different things we need to parse let&#x27;s make a trait to make it easier to track what each parser is for.</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#6272A4">/// Implement the parse function to more easily convert a span into a sql</span></div><div class="line"><span style="color:#6272A4">/// command</span></div><div class="line"><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">trait</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Parse</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt;</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Sized</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#6272A4">    /// Parse the given span into self</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">parse</span><span style="color:#F8F8F2">(input</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">RawSpan</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt;) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">ParseResult</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">Self</span><span style="color:#F8F8F2">&gt;;</span></div><div class="line"></div><div class="line"><span style="color:#6272A4">    /// Helper method for tests to convert a str into a raw span and parse</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">parse_from_raw</span><span style="color:#F8F8F2">(input</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">str</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">ParseResult</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">Self</span><span style="color:#F8F8F2">&gt; {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> i </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">LocatedSpan</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">(input);</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#BD93F9">Self</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">parse</span><span style="color:#F8F8F2">(i)</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>Now anything we want to parse can implement a <code>Parse</code> method which lets us compose types/parsers,
and we can add any helper functions into this trait we need for testing or error handling.</p>
<h3 id="parsing-create-table"><a href="#parsing-create-table" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Parsing Create Table</h3>
<p>Create table statements need to parse/extract 3 things</p>
<ul>
<li>The table name we will create</li>
<li>The column names</li>
<li>The types for those columns</li>
</ul>
<p>So let&#x27;s make a type + parser for each</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#6272A4">// Using tag_no_case from nom_supreme since its error is nicer</span></div><div class="line"><span style="color:#6272A4">// ParserExt is mostly for adding `.context` on calls to identifier to say what kind of identifier we want</span></div><div class="line"><span style="color:#FF79C6">use</span><span style="color:#F8F8F2"> nom_supreme</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">{tag</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">complete</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">tag_no_case, </span><span style="color:#8BE9FD">ParserExt</span><span style="color:#F8F8F2">};</span></div><div class="line"><span style="color:#6272A4">// many other imports omitted</span></div><div class="line"></div><div class="line"><span style="color:#6272A4">/// A colum&#x27;s type</span></div><div class="line"><span style="color:#F8F8F2">#[derive(</span><span style="color:#8BE9FD">Debug</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Clone</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Eq</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Hash</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">PartialEq</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Serialize</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Deserialize</span><span style="color:#F8F8F2">)]</span></div><div class="line"><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">enum</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">SqlTypeInfo</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#6272A4">    // these are basic for now. Will add more + size max later on</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#8BE9FD">String</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#8BE9FD">Int</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">}</span></div><div class="line"><span style="color:#6272A4">// parses &quot;string | int&quot;</span></div><div class="line"><span style="color:#FF79C6">impl</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt; </span><span style="color:#8BE9FD">Parse</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">for</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">SqlTypeInfo</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">parse</span><span style="color:#F8F8F2">(input</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">RawSpan</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt;) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">ParseResult</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">Self</span><span style="color:#F8F8F2">&gt; {</span></div><div class="line"><span style="color:#6272A4">        // context will help give better error messages later on</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">context</span><span style="color:#F8F8F2">(</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#F1FA8C">&quot;Column Type&quot;</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#6272A4">            // alt will try each passed parser and return what ever succeeds</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#50FA7B">alt</span><span style="color:#F8F8F2">((</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#50FA7B">map</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">tag_no_case</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;string&quot;</span><span style="color:#F8F8F2">), </span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2">_</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">Self</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">String</span><span style="color:#F8F8F2">),</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#50FA7B">map</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">tag_no_case</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;int&quot;</span><span style="color:#F8F8F2">), </span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2">_</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">Self</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Int</span><span style="color:#F8F8F2">),</span></div><div class="line"><span style="color:#F8F8F2">            )),</span></div><div class="line"><span style="color:#F8F8F2">        )(input)</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"><span style="color:#F8F8F2">}</span></div><div class="line"></div><div class="line"><span style="color:#6272A4">/// A column&#x27;s name + type</span></div><div class="line"><span style="color:#F8F8F2">#[derive(</span><span style="color:#8BE9FD">Debug</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Clone</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Eq</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Hash</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">PartialEq</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Serialize</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Deserialize</span><span style="color:#F8F8F2">)]</span></div><div class="line"><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">struct</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Column</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> name</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">String</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> type_info</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">SqlTypeInfo</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">}</span></div><div class="line"></div><div class="line"><span style="color:#6272A4">// parses &quot;&lt;colName&gt; &lt;colType&gt;&quot;</span></div><div class="line"><span style="color:#FF79C6">impl</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt; </span><span style="color:#8BE9FD">Parse</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">for</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Column</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">parse</span><span style="color:#F8F8F2">(input</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">RawSpan</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt;) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">ParseResult</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">Self</span><span style="color:#F8F8F2">&gt; {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">context</span><span style="color:#F8F8F2">(</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#F1FA8C">&quot;Create Column&quot;</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#50FA7B">map</span><span style="color:#F8F8F2">(</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#50FA7B">separated_pair</span><span style="color:#F8F8F2">(</span></div><div class="line"><span style="color:#F8F8F2">                    identifier</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">context</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Column Name&quot;</span><span style="color:#F8F8F2">),</span></div><div class="line"><span style="color:#F8F8F2">                    multispace1,</span></div><div class="line"><span style="color:#F8F8F2">                    </span><span style="color:#8BE9FD">SqlTypeInfo</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">parse,</span></div><div class="line"><span style="color:#F8F8F2">                ),</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2">(name, type_info)</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">Self</span><span style="color:#F8F8F2"> { name, type_info },</span></div><div class="line"><span style="color:#F8F8F2">            ),</span></div><div class="line"><span style="color:#F8F8F2">        )(input)</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"><span style="color:#F8F8F2">}</span></div><div class="line"></div><div class="line"><span style="color:#6272A4">/// The table and its columns to create</span></div><div class="line"><span style="color:#F8F8F2">#[derive(</span><span style="color:#8BE9FD">Clone</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Debug</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Default</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Eq</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Hash</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">PartialEq</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Serialize</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Deserialize</span><span style="color:#F8F8F2">)]</span></div><div class="line"><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">struct</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">CreateStatement</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> table</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">String</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> columns</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Vec</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">Column</span><span style="color:#F8F8F2">&gt;,</span></div><div class="line"><span style="color:#F8F8F2">}</span></div><div class="line"></div><div class="line"><span style="color:#6272A4">// parses a comma seperated list of column definitions contained in parens</span></div><div class="line"><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">column_definitions</span><span style="color:#F8F8F2">(input</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">RawSpan</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">_</span><span style="color:#F8F8F2">&gt;) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">ParseResult</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">_</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Vec</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">Column</span><span style="color:#F8F8F2">&gt;&gt; {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">context</span><span style="color:#F8F8F2">(</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#F1FA8C">&quot;Column Definitions&quot;</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">map</span><span style="color:#F8F8F2">(</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#50FA7B">tuple</span><span style="color:#F8F8F2">((</span><span style="color:#50FA7B">char</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&#x27;(&#x27;</span><span style="color:#F8F8F2">), </span><span style="color:#50FA7B">comma_sep</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">Column</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">parse), </span><span style="color:#50FA7B">char</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&#x27;)&#x27;</span><span style="color:#F8F8F2">))),</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2">(_, cols, _)</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2"> cols,</span></div><div class="line"><span style="color:#F8F8F2">        ),</span></div><div class="line"><span style="color:#F8F8F2">    )(input)</span></div><div class="line"><span style="color:#F8F8F2">}</span></div><div class="line"></div><div class="line"><span style="color:#6272A4">// parses &quot;CREATE TABLE &lt;table name&gt; &lt;column defs&gt;</span></div><div class="line"><span style="color:#FF79C6">impl</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt; </span><span style="color:#8BE9FD">Parse</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">for</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">CreateStatement</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">parse</span><span style="color:#F8F8F2">(input</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">RawSpan</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt;) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">ParseResult</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">Self</span><span style="color:#F8F8F2">&gt; {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">map</span><span style="color:#F8F8F2">(</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#50FA7B">separated_pair</span><span style="color:#F8F8F2">(</span></div><div class="line"><span style="color:#6272A4">                // table name</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#50FA7B">preceded</span><span style="color:#F8F8F2">(</span></div><div class="line"><span style="color:#F8F8F2">                    </span><span style="color:#50FA7B">tuple</span><span style="color:#F8F8F2">((</span></div><div class="line"><span style="color:#F8F8F2">                        </span><span style="color:#50FA7B">tag_no_case</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;create&quot;</span><span style="color:#F8F8F2">),</span></div><div class="line"><span style="color:#F8F8F2">                        multispace1,</span></div><div class="line"><span style="color:#F8F8F2">                        </span><span style="color:#50FA7B">tag_no_case</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;table&quot;</span><span style="color:#F8F8F2">),</span></div><div class="line"><span style="color:#F8F8F2">                        multispace1,</span></div><div class="line"><span style="color:#F8F8F2">                    )),</span></div><div class="line"><span style="color:#F8F8F2">                    identifier</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">context</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Table Name&quot;</span><span style="color:#F8F8F2">),</span></div><div class="line"><span style="color:#F8F8F2">                ),</span></div><div class="line"><span style="color:#F8F8F2">                multispace1,</span></div><div class="line"><span style="color:#6272A4">                // column defs</span></div><div class="line"><span style="color:#F8F8F2">                column_definitions,</span></div><div class="line"><span style="color:#F8F8F2">            )</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">context</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;Create Table&quot;</span><span style="color:#F8F8F2">),</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2">(table, columns)</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">Self</span><span style="color:#F8F8F2"> { table, columns },</span></div><div class="line"><span style="color:#F8F8F2">        )(input)</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"><span style="color:#F8F8F2">}</span></div><div class="line"></div><div class="line"></div><div class="line"><span style="color:#6272A4">// I was a test hater earlier but may as well cover the basics...</span></div><div class="line"><span style="color:#F8F8F2">#[cfg(test)]</span></div><div class="line"><span style="color:#FF79C6">mod</span><span style="color:#F8F8F2"> tests {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">use</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">super</span><span style="color:#FF79C6">::*</span><span style="color:#F8F8F2">;</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">    #[test]</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">test_create</span><span style="color:#F8F8F2">() {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> expected </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">CreateStatement</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">            table</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;foo&quot;</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">into</span><span style="color:#F8F8F2">(),</span></div><div class="line"><span style="color:#F8F8F2">            columns</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">vec!</span><span style="color:#F8F8F2">[</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#8BE9FD">Column</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">                    name</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;col1&quot;</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">into</span><span style="color:#F8F8F2">(),</span></div><div class="line"><span style="color:#F8F8F2">                    type_info</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">SqlTypeInfo</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Int</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">                },</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#8BE9FD">Column</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">                    name</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;col2&quot;</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">into</span><span style="color:#F8F8F2">(),</span></div><div class="line"><span style="color:#F8F8F2">                    type_info</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">SqlTypeInfo</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">String</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">                },</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#8BE9FD">Column</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">                    name</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;col3&quot;</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">into</span><span style="color:#F8F8F2">(),</span></div><div class="line"><span style="color:#F8F8F2">                    type_info</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">SqlTypeInfo</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">String</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">                },</span></div><div class="line"><span style="color:#F8F8F2">            ],</span></div><div class="line"><span style="color:#F8F8F2">        };</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">assert_eq!</span><span style="color:#F8F8F2">(</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#8BE9FD">CreateStatement</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">parse_from_raw</span><span style="color:#F8F8F2">(</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#F1FA8C">&quot;CREATE TABLE foo (col1 int, col2 string, col3 string)&quot;</span></div><div class="line"><span style="color:#F8F8F2">            )</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">unwrap</span><span style="color:#F8F8F2">()</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#FF79C6">.</span><span style="color:#BD93F9">1</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">            expected</span></div><div class="line"><span style="color:#F8F8F2">        )</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>I will skip out on including the parsing for select/insert, but the vibes are similar.</p>
<h3 id="pulling-it-all-together"><a href="#pulling-it-all-together" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Pulling it all together</h3>
<p>Now that we can parse each of our commands we need to tell nom to try each of them. We can do that with the <a target="_blank" rel="noopener noreferrer" href="https://docs.rs/nom/latest/nom/branch/fn.alt.html">alt combinator</a> to try each parser and see which one succeeds.</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#6272A4">/// All possible commands</span></div><div class="line"><span style="color:#F8F8F2">#[derive(</span><span style="color:#8BE9FD">Clone</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Debug</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Eq</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Hash</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">PartialEq</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Serialize</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Deserialize</span><span style="color:#F8F8F2">)]</span></div><div class="line"><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">enum</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">SqlQuery</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">Select</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">SelectStatement</span><span style="color:#F8F8F2">),</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">Insert</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">InsertStatement</span><span style="color:#F8F8F2">),</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">Create</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">CreateStatement</span><span style="color:#F8F8F2">),</span></div><div class="line"><span style="color:#F8F8F2">}</span></div><div class="line"></div><div class="line"><span style="color:#FF79C6">impl</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt; </span><span style="color:#8BE9FD">Parse</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">for</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">SqlQuery</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">parse</span><span style="color:#F8F8F2">(input</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">RawSpan</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt;) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">ParseResult</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">Self</span><span style="color:#F8F8F2">&gt; {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> (rest, (query, _, _, _)) </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">context</span><span style="color:#F8F8F2">(</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#F1FA8C">&quot;Query&quot;</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#50FA7B">preceded</span><span style="color:#F8F8F2">(</span></div><div class="line"><span style="color:#F8F8F2">                multispace0,</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#50FA7B">tuple</span><span style="color:#F8F8F2">((</span></div><div class="line"><span style="color:#F8F8F2">                    </span><span style="color:#50FA7B">alt</span><span style="color:#F8F8F2">((</span></div><div class="line"><span style="color:#6272A4">                        // this feels ripe for a derive macro but another time....</span></div><div class="line"><span style="color:#F8F8F2">                        </span><span style="color:#50FA7B">map</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">SelectStatement</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">parse, </span><span style="color:#8BE9FD">SqlQuery</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Select</span><span style="color:#F8F8F2">),</span></div><div class="line"><span style="color:#F8F8F2">                        </span><span style="color:#50FA7B">map</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">InsertStatement</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">parse, </span><span style="color:#8BE9FD">SqlQuery</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Insert</span><span style="color:#F8F8F2">),</span></div><div class="line"><span style="color:#F8F8F2">                        </span><span style="color:#50FA7B">map</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">CreateStatement</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">parse, </span><span style="color:#8BE9FD">SqlQuery</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Create</span><span style="color:#F8F8F2">),</span></div><div class="line"><span style="color:#F8F8F2">                    )),</span></div><div class="line"><span style="color:#F8F8F2">                    multispace0,</span></div><div class="line"><span style="color:#F8F8F2">                    </span><span style="color:#50FA7B">char</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&#x27;;&#x27;</span><span style="color:#F8F8F2">),</span></div><div class="line"><span style="color:#F8F8F2">                    multispace0,</span></div><div class="line"><span style="color:#F8F8F2">                )),</span></div><div class="line"><span style="color:#F8F8F2">            ),</span></div><div class="line"><span style="color:#F8F8F2">        )(input)</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#8BE9FD">Ok</span><span style="color:#F8F8F2">((rest, query))</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"><span style="color:#F8F8F2">}</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">#[cfg(test)]</span></div><div class="line"><span style="color:#FF79C6">mod</span><span style="color:#F8F8F2"> tests {</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">use</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">super</span><span style="color:#FF79C6">::*</span><span style="color:#F8F8F2">;</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">    #[test]</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">test_error</span><span style="color:#F8F8F2">() {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> query </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">SqlQuery</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">parse_from_raw</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;select fart;&quot;</span><span style="color:#F8F8F2">);</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">assert!</span><span style="color:#F8F8F2">(query</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">is_err</span><span style="color:#F8F8F2">(), </span><span style="color:#F1FA8C">&quot;expected parse to fail, got {query:?}&quot;</span><span style="color:#F8F8F2">);</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">    #[test]</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">test_select</span><span style="color:#F8F8F2">() {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> expected </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">SelectStatement</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">            tables</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">vec!</span><span style="color:#F8F8F2">[</span><span style="color:#F1FA8C">&quot;t1&quot;</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">to_string</span><span style="color:#F8F8F2">(), </span><span style="color:#F1FA8C">&quot;t2&quot;</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">to_string</span><span style="color:#F8F8F2">()],</span></div><div class="line"><span style="color:#F8F8F2">            fields</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">vec!</span><span style="color:#F8F8F2">[</span><span style="color:#F1FA8C">&quot;foo&quot;</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">to_string</span><span style="color:#F8F8F2">(), </span><span style="color:#F1FA8C">&quot;bar&quot;</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">to_string</span><span style="color:#F8F8F2">()],</span></div><div class="line"><span style="color:#F8F8F2">        };</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">assert_eq!</span><span style="color:#F8F8F2">(</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#8BE9FD">SqlQuery</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">parse_from_raw</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;select foo, bar from t1,t2;&quot;</span><span style="color:#F8F8F2">)</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">unwrap</span><span style="color:#F8F8F2">()</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">.</span><span style="color:#BD93F9">1</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#8BE9FD">SqlQuery</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Select</span><span style="color:#F8F8F2">(expected)</span></div><div class="line"><span style="color:#F8F8F2">        )</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>Now that we have command parsing we can add it to our REPL. First, we need to add our parser crate to our <code>Cargo.toml</code> in the REPL crate</p>
<div class="remark-code-title">sql_jr_repl/Cargo.toml</div>
<div class="relative"><pre class="shiki dracula"><div class="language-id">toml</div><div class="code-container"><code><div class="line"><span style="color:#FF5555">...</span></div><div class="line"><span style="color:#FF79C6">[</span><span style="color:#8BE9FD">dependencies</span><span style="color:#FF79C6">]</span></div><div class="line"><span style="color:#FF5555">...</span></div><div class="line"><span style="color:#8BE9FD">sql_jr_parser</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> { </span><span style="color:#8BE9FD">path</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">../sql_jr_parser</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2"> }</span></div><div class="line"><span style="color:#FF5555">...</span></div></code></div></pre></div>
<p>then update our main function</p>
<div class="remark-code-title">sql_jr_repl/main.rs</div>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">...</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">match</span><span style="color:#F8F8F2"> readline {</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#8BE9FD">Ok</span><span style="color:#F8F8F2">(line) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">match</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">SqlQuery</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">parse_from_raw</span><span style="color:#F8F8F2">(line</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">as_ref</span><span style="color:#F8F8F2">()) {</span></div><div class="line"><span style="color:#F8F8F2">                    </span><span style="color:#8BE9FD">Ok</span><span style="color:#F8F8F2">(q) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">println!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;{q:?}&quot;</span><span style="color:#F8F8F2">),</span></div><div class="line"><span style="color:#F8F8F2">                    </span><span style="color:#8BE9FD">Err</span><span style="color:#F8F8F2">(e) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">eprintln!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;{e:?}&quot;</span><span style="color:#F8F8F2">),</span></div><div class="line"><span style="color:#F8F8F2">                }</span></div><div class="line"><span style="color:#F8F8F2">            }</span></div></code></div></pre></div>
<p>Now we can finally type some stuff and have different things come back.</p>
<div class="relative"><pre class="shiki dracula"><div class="code-container"><code><div class="line"><span style="color:undefined">&gt;&gt; select col1 from foo;
(LocatedSpan { offset: 21, line: 1, fragment: &quot;&quot;, extra: () }, Select(SelectStatement { tables: [&quot;foo&quot;], fields: [&quot;col1&quot;] }))</span></div></code></div></pre></div>
<p>However, when we get an error we just get a debug out, gross... let&#x27;s fix that.</p>
<h3 id="parser-errors"><a href="#parser-errors" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Parser Errors</h3>
<p>Errors can be a giant rabbit hole to keep improving. For now, as long as we show a span in the source tree and highlight the sad spots I&#x27;ll be happy.</p>
<p>I will be using <a target="_blank" rel="noopener noreferrer" href="https://github.com/zkat/miette">miette</a> to format/display errors. It can hook into source errors very easily and can show help, context, and much more.</p>
<p>Our error types will look like</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">use</span><span style="color:#F8F8F2"> miette</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Diagnostic</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#FF79C6">use</span><span style="color:#F8F8F2"> nom_supreme</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">error</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">{</span><span style="color:#8BE9FD">BaseErrorKind</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">ErrorTree</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">GenericErrorTree</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">StackContext</span><span style="color:#F8F8F2">};</span></div><div class="line"><span style="color:#FF79C6">use</span><span style="color:#F8F8F2"> thiserror</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Error</span><span style="color:#F8F8F2">;</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">#[derive(</span><span style="color:#8BE9FD">Error</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Debug</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Diagnostic</span><span style="color:#F8F8F2">)]</span></div><div class="line"><span style="color:#F8F8F2">#[error(</span><span style="color:#F1FA8C">&quot;Parse Error&quot;</span><span style="color:#F8F8F2">)]</span></div><div class="line"><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">struct</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">FormattedError</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">b</span><span style="color:#F8F8F2">&gt; {</span></div><div class="line"><span style="color:#6272A4">    // need &#x27;b since Diagnostic derive uses &#x27;a</span></div><div class="line"><span style="color:#F8F8F2">    #[source_code]</span></div><div class="line"><span style="color:#F8F8F2">    src</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">&#x27;</span><span style="color:#8BE9FD">b</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">str</span><span style="color:#F8F8F2">,</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">    #[label(</span><span style="color:#F1FA8C">&quot;{kind}&quot;</span><span style="color:#F8F8F2">)]</span></div><div class="line"><span style="color:#F8F8F2">    span</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> miette</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">SourceSpan</span><span style="color:#F8F8F2">,</span></div><div class="line"></div><div class="line"><span style="color:#6272A4">    // will explain this later. TLDR: the parsing error</span></div><div class="line"><span style="color:#F8F8F2">    kind</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">BaseErrorKind</span><span style="color:#F8F8F2">&lt;</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">&#x27;</span><span style="color:#8BE9FD">b</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">str</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Box</span><span style="color:#F8F8F2">&lt;</span><span style="color:#FF79C6">dyn</span><span style="color:#F8F8F2"> std</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">error</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Error</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Send</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Sync</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> &#x27;</span><span style="color:#8BE9FD">static</span><span style="color:#F8F8F2">&gt;&gt;,</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">    #[related]</span></div><div class="line"><span style="color:#F8F8F2">    others</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Vec</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">FormattedErrorContext</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">b</span><span style="color:#F8F8F2">&gt;&gt;,</span></div><div class="line"><span style="color:#F8F8F2">}</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">#[derive(</span><span style="color:#8BE9FD">Error</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Debug</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Diagnostic</span><span style="color:#F8F8F2">)]</span></div><div class="line"><span style="color:#F8F8F2">#[error(</span><span style="color:#F1FA8C">&quot;Parse Error Context&quot;</span><span style="color:#F8F8F2">)]</span></div><div class="line"><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">struct</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">FormattedErrorContext</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">b</span><span style="color:#F8F8F2">&gt; {</span></div><div class="line"><span style="color:#F8F8F2">    #[source_code]</span></div><div class="line"><span style="color:#F8F8F2">    src</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">&#x27;</span><span style="color:#8BE9FD">b</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">str</span><span style="color:#F8F8F2">,</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">    #[label(</span><span style="color:#F1FA8C">&quot;{context}&quot;</span><span style="color:#F8F8F2">)]</span></div><div class="line"><span style="color:#F8F8F2">    span</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> miette</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">SourceSpan</span><span style="color:#F8F8F2">,</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">    context</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">StackContext</span><span style="color:#F8F8F2">&lt;</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">&#x27;</span><span style="color:#8BE9FD">b</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">str</span><span style="color:#F8F8F2">&gt;,</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>These types can be used as normal rust error types without issue but when used in a miette <code>Reporter</code> we can get output like</p>
<div class="relative"><pre class="shiki dracula"><div class="code-container"><code><div class="line"><span style="color:undefined">&gt;&gt; select 1 fr

  × Parse Error
   ╭────
 1 │ select 1 fr
   ·          ▲
   ·          ╰── expected &quot;from&quot;
   ╰────

Error:
  × Parse Error Context
   ╭────
 1 │ select 1 fr
   · ▲
   · ╰── in section &quot;Select Statement&quot;
   ╰────
Error:
  × Parse Error Context
   ╭────
 1 │ select 1 fr
   · ▲
   · ╰── in section &quot;Query&quot;
   ╰────</span></div></code></div></pre></div>
<p>The main magic here is the <code>#[source_code]</code> macro marking what the passed string was and</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#F8F8F2">#[label(</span><span style="color:#F1FA8C">&quot;{kind}&quot;</span><span style="color:#F8F8F2">)]</span></div><div class="line"><span style="color:#F8F8F2">span</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> miette</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">SourceSpan</span><span style="color:#F8F8F2">,</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">kind</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">BaseErrorKind</span><span style="color:#F8F8F2">&lt;</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">&#x27;</span><span style="color:#8BE9FD">b</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">str</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Box</span><span style="color:#F8F8F2">&lt;</span><span style="color:#FF79C6">dyn</span><span style="color:#F8F8F2"> std</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">error</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Error</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Send</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Sync</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> &#x27;</span><span style="color:#8BE9FD">static</span><span style="color:#F8F8F2">&gt;&gt;,</span></div></code></div></pre></div>
<p>which tells miette to mark the provided span (the location in the source code) with the error display from <code>kind</code>.</p>
<p>Here we use the <a target="_blank" rel="noopener noreferrer" href="https://docs.rs/nom-supreme/latest/nom_supreme/error/type.ErrorTree.html">error tree</a> type to specify the parsing error.</p>
<p>The error tree type will make it easier to handle errors on &quot;alts&quot; (like our root type). If you tried to parse <code>select +!@#!@!!</code>
nom would fail in the select parser but still try the other ones, so it would not know what parser errors to show.
That issue can be fixed slightly with <a target="_blank" rel="noopener noreferrer" href="https://docs.rs/nom/latest/nom/combinator/fn.cut.html">cut</a> to not try other branches in the alt if we know for sure we are in a select/insert/create/etc.</p>
<p>However, cases like parsing <code>I like rust</code> are tough, all the parsers would fail without being cut, so what can we show? Ideally, we would say something like <code>expected select|create|insert, got ....</code> which the error tree type will help with (though not now).</p>
<p>To get these errors we first need to update <code>ParseResult</code> to use the error tree type as its error type.</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#6272A4">// Alias for later</span></div><div class="line"><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">type</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">MyParseError</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">ErrorTree</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">RawSpan</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt;&gt;;</span></div><div class="line"></div><div class="line"><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">type</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">ParseResult</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">T</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">IResult</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">RawSpan</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt;, </span><span style="color:#8BE9FD">T</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">MyParseError</span><span style="color:#F8F8F2">&gt;;</span></div></code></div></pre></div>
<p>The beauty of nom is we don&#x27;t need to update any code in our existing parsers to change the error type, they were all generic over it.</p>
<p>Now we need to convert the error tree error into our miette error type</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">format_parse_error</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt;(input</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">str</span><span style="color:#F8F8F2">, e</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">MyParseError</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt;) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">FormattedError</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt; {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">match</span><span style="color:#F8F8F2"> e {</span></div><div class="line"><span style="color:#6272A4">        // a &quot;normal&quot; error like unexpected charcter</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#8BE9FD">GenericErrorTree</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Base</span><span style="color:#F8F8F2"> { location, kind } </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#6272A4">            // the location type is nom_locate&#x27;s RawSpan type</span></div><div class="line"><span style="color:#6272A4">            // Might be nice to just use our own span/make a wrapper to implement</span></div><div class="line"><span style="color:#6272A4">            // From&lt;OurSpan&gt; for miette::SourceSpan</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> offset </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> location</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">location_offset</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">into</span><span style="color:#F8F8F2">();</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#8BE9FD">FormattedError</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">                src</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> input,</span></div><div class="line"><span style="color:#F8F8F2">                span</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> miette</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">SourceSpan</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">(offset, </span><span style="color:#BD93F9">0.</span><span style="color:#50FA7B">into</span><span style="color:#F8F8F2">()),</span></div><div class="line"><span style="color:#F8F8F2">                kind,</span></div><div class="line"><span style="color:#F8F8F2">                others</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Vec</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">(),</span></div><div class="line"><span style="color:#F8F8F2">            }</span></div><div class="line"><span style="color:#F8F8F2">        }</span></div><div class="line"><span style="color:#6272A4">        // an error that has a context attached (from nom&#x27;s context function)</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#8BE9FD">GenericErrorTree</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Stack</span><span style="color:#F8F8F2"> { base, contexts } </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">mut</span><span style="color:#F8F8F2"> base </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">format_parse_error</span><span style="color:#F8F8F2">(input, </span><span style="color:#FF79C6">*</span><span style="color:#F8F8F2">base);</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">mut</span><span style="color:#F8F8F2"> contexts</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Vec</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">FormattedErrorContext</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> contexts</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">into_iter</span><span style="color:#F8F8F2">()</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">map</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2">(location, context)</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">                    </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> offset </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> location</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">location_offset</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">into</span><span style="color:#F8F8F2">();</span></div><div class="line"><span style="color:#F8F8F2">                    </span><span style="color:#8BE9FD">FormattedErrorContext</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">                        src</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> input,</span></div><div class="line"><span style="color:#F8F8F2">                        span</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> miette</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">SourceSpan</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">(offset, </span><span style="color:#BD93F9">0.</span><span style="color:#50FA7B">into</span><span style="color:#F8F8F2">()),</span></div><div class="line"><span style="color:#F8F8F2">                        context,</span></div><div class="line"><span style="color:#F8F8F2">                    }</span></div><div class="line"><span style="color:#F8F8F2">                })</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">collect</span><span style="color:#F8F8F2">();</span></div><div class="line"><span style="color:#F8F8F2">            base</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">others</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">append</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;mut</span><span style="color:#F8F8F2"> contexts);</span></div><div class="line"><span style="color:#F8F8F2">            base</span></div><div class="line"><span style="color:#F8F8F2">        }</span></div><div class="line"><span style="color:#6272A4">        // an error from an &quot;alt&quot;</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#8BE9FD">GenericErrorTree</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Alt</span><span style="color:#F8F8F2">(alt_errors) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#6272A4">            // get the error with the most context</span></div><div class="line"><span style="color:#6272A4">            // since that parsed the most stuff</span></div><div class="line"><span style="color:#6272A4">            // TODO: figure out what to do on ties</span></div><div class="line"><span style="color:#F8F8F2">            alt_errors</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">into_iter</span><span style="color:#F8F8F2">()</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">map</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">format_parse_error</span><span style="color:#F8F8F2">(input, e))</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">max_by_key</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2">formatted</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2"> formatted</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">others</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">len</span><span style="color:#F8F8F2">())</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">unwrap</span><span style="color:#F8F8F2">()</span></div><div class="line"><span style="color:#F8F8F2">        }</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>Now to make it easy to get this formatted error add the following to our <code>Parser</code> trait</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">parse_format_error</span><span style="color:#F8F8F2">(i</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">str</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Result</span><span style="color:#F8F8F2">&lt;</span><span style="color:#BD93F9">Self</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">FormattedError</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt;&gt; {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> input </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">LocatedSpan</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">(i);</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#FF79C6">match</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">all_consuming</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">Self</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">parse)(input)</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">finish</span><span style="color:#F8F8F2">() {</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#8BE9FD">Ok</span><span style="color:#F8F8F2">((_, query)) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Ok</span><span style="color:#F8F8F2">(query),</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#8BE9FD">Err</span><span style="color:#F8F8F2">(e) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Err</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">format_parse_error</span><span style="color:#F8F8F2">(i, e)),</span></div><div class="line"><span style="color:#F8F8F2">        }</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div></code></div></pre></div>
<p>Now we can finally update our REPL with</p>
<div class="remark-code-title">sql_jr_repl/Cargo.toml</div>
<div class="relative"><pre class="shiki dracula"><div class="language-id">toml</div><div class="code-container"><code><div class="line"><span style="color:#FF5555">...</span></div><div class="line"><span style="color:#FF79C6">[</span><span style="color:#8BE9FD">dependencies</span><span style="color:#FF79C6">]</span></div><div class="line"><span style="color:#6272A4"># use the workspace version of miette but also use the fancy feature</span></div><div class="line"><span style="color:#6272A4"># to allow for display errors</span></div><div class="line"><span style="color:#8BE9FD">miette</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span><span style="color:#8BE9FD">workspace</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">true</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">features</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">fancy</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">]}</span></div><div class="line"><span style="color:#FF5555">...</span></div></code></div></pre></div>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> query </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">parse_sql_query</span><span style="color:#F8F8F2">(line);</span></div><div class="line"><span style="color:#FF79C6">match</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">SqlQuery</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">parse_format_error</span><span style="color:#F8F8F2">(line</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">as_ref</span><span style="color:#F8F8F2">()) {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#8BE9FD">Ok</span><span style="color:#F8F8F2">(q) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">println!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;{q:?}&quot;</span><span style="color:#F8F8F2">),</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#8BE9FD">Err</span><span style="color:#F8F8F2">(e) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">mut</span><span style="color:#F8F8F2"> s </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">String</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">();</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#8BE9FD">GraphicalReportHandler</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">()</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">render_report</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;mut</span><span style="color:#F8F8F2"> s, </span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">e)</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">unwrap</span><span style="color:#F8F8F2">();</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#50FA7B">println!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;{s}&quot;</span><span style="color:#F8F8F2">);</span></div><div class="line"><span style="color:#F8F8F2">    },</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>and we finally have some sweet parsing errors.</p>
<h2 id="part-1-wrap-up"><a href="#part-1-wrap-up" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Part 1 wrap up</h2>
<p>I definitely went overkill (but still feels like not enough...) on getting the parser errors to work nicely,
but our eventual 0 users will appreciate it.</p>
<p>Next post will focus on actually running queries (and addressing any feedback I get on this post).</p></div></div></div></div></article></div></main><footer><div class="flex flex-col items-center mt-16"><div class="flex mb-3 space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer me" href="https://github.com/JRMurr"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer me" href="https://twitter.com/JRMurrCodes"><span class="sr-only">twitter</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M23.953 4.57a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.06a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.936 4.936 0 0 0 4.604 3.417 9.867 9.867 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0 0 24 4.59z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer me" href="https://hachyderm.io/@jrmurr"><span class="sr-only">mastodon</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-8 w-8"><path d="M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer me" href="/feed.xml"><span class="sr-only">rss</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24.912 24.912" style="enable-background:new 0 0 24.912 24.912" xml:space="preserve" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M3.692 17.517A3.696 3.696 0 0 0 0 21.211C0 23.244 1.656 24.9 3.692 24.9s3.694-1.657 3.694-3.689a3.697 3.697 0 0 0-3.694-3.694z"></path><path d="M.384 8.142A.386.386 0 0 0 0 8.527v4.688c0 .211.173.383.384.383 6.02 0 10.919 4.898 10.919 10.92 0 .209.171.383.384.383h4.705a.385.385 0 0 0 .387-.383l-.018-.121C16.692 15.423 9.37 8.142.384 8.142z"></path><path d="M24.89 24.397C24.825 10.936 13.854.011.384.011A.385.385 0 0 0 0 .397v4.824c0 .212.173.383.384.383 10.429 0 18.913 8.486 18.913 18.914 0 .209.172.383.382.383h4.845a.39.39 0 0 0 .388-.383l-.022-.121z"></path></svg></a></div><div class="flex mb-2 space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>John Murray</div><div> • </div><div>© 2023</div><div> • </div><a href="/">John&#x27;s Codes</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var h=Object.create;var c=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var F=n=\u003ec(n,\"__esModule\",{value:!0});var v=(n,r)=\u003e()=\u003e(r||n((r={exports:{}}).exports,r),r.exports),N=(n,r)=\u003e{F(n);for(var s in r)c(n,s,{get:r[s],enumerable:!0})},C=(n,r,s)=\u003e{if(r\u0026\u0026typeof r==\"object\"||typeof r==\"function\")for(let e of y(r))!u.call(n,e)\u0026\u0026e!==\"default\"\u0026\u0026c(n,e,{get:()=\u003er[e],enumerable:!(s=p(r,e))||s.enumerable});return n},B=n=\u003eC(F(c(n!=null?h(m(n)):{},\"default\",n\u0026\u0026n.__esModule\u0026\u0026\"default\"in n?{get:()=\u003en.default,enumerable:!0}:{value:n,enumerable:!0})),n);var t=v((w,a)=\u003e{a.exports=_jsx_runtime});var g={};N(g,{default:()=\u003ef,frontmatter:()=\u003eE});var l=B(t()),E={title:\"Building a Simple DB in Rust - Part 1 - Parsing\",seriesTitle:\"Part 1 - Parsing\",date:new Date(1672636762985),tags:[\"rust\",\"database\",\"parsing\"],draft:!1,summary:\"building a basic database in rust\",images:[],layout:\"PostLayout\"};function D(n={}){let{wrapper:r}=n.components||{};return r?(0,l.jsx)(r,Object.assign({},n,{children:(0,l.jsx)(s,{})})):s();function s(){let e=Object.assign({p:\"p\",a:\"a\",h2:\"h2\",span:\"span\",pre:\"pre\",div:\"div\",code:\"code\",h3:\"h3\",ul:\"ul\",li:\"li\"},n.components),{TOCInline:o,Note:i}=e;return i||d(\"Note\",!0),o||d(\"TOCInline\",!0),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o,{toc:n.toc,asDisclosure:!0}),`\n`,(0,l.jsxs)(e.p,{children:[`While I've used rust for a while and have had a few small projects in it, I felt like I was missing a truly \"systems\" project.\nSo when I came across `,(0,l.jsx)(e.a,{href:\"https://cstack.github.io/db_tutorial/\",children:\"this series\"}),` for making a simple DB in C, I figured why not try to make my basic DB in rust.\nI will roughly follow the structure of that series at first, but I will most likely deviate and focus on what interests me more.`]}),`\n`,(0,l.jsxs)(e.p,{children:[`This series will be mostly a dev log (I'm making this up as I go) but will try to do what I can to use it as tutorial content when possible.\nI will probably get things wrong, so please call me out in comments, on my `,(0,l.jsx)(e.a,{href:\"https://github.com/JRMurr/JRMurr.github.io\",children:\"GitHub\"}),\", or my \",(0,l.jsx)(e.a,{href:\"/about\",children:\"socials\"})]}),`\n`,(0,l.jsx)(e.p,{children:\"I hate naming things, so I'll keep it basic, I will be calling my DB SQLJr\"}),`\n`,(0,l.jsxs)(e.p,{children:[\"If you wanna just jump to some code \",(0,l.jsx)(e.a,{href:\"https://github.com/JRMurr/SQLJr\",children:\"this is the repo for it\"}),`.\nIt will be mostly the same with some minor tweaks here and there (and more up-to-date).`]}),`\n`,(0,l.jsxs)(e.h2,{id:\"what-am-i-making\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#what-am-i-making\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"What am I Making\"]}),`\n`,(0,l.jsx)(e.p,{children:`I plan on mostly focusing on building my own SQL (not following any spec) that will have basic filtering, aggregates, and joins.\nSince rust has many B-Tree libraries (One of the core data structures for how to store/search rows), I will try to focus more on good concurrency+transaction support instead of building my own B-tree/persistence logic.\nAlso, many Rust based tools I used have excellent error messages, so I will try to have good/informative errors for all parts of the DB.`}),`\n`,(0,l.jsx)(e.p,{children:\"I will probably end up on some side tangents from those core features, so I will follow whatever vibe I get.\"}),`\n`,(0,l.jsxs)(e.p,{children:[\"In this post, we will focus on getting the project setup and building a basic REPL (in a similar vein to \",(0,l.jsx)(e.a,{href:\"https://www.postgresql.org/docs/current/app-psql.html\",children:\"psql\"}),`) + parser\nto make it easy to interact with the rest of the DB later on.`]}),`\n`,(0,l.jsxs)(e.h2,{id:\"project-setup\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#project-setup\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Project setup\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"I love \",(0,l.jsx)(e.a,{href:\"https://nixos.org/\",children:\"Nix\"}),`, so I always start with that to get rust installed.\nI recently made my own `,(0,l.jsx)(e.a,{href:\"https://github.com/JRMurr/NixOsConfig/tree/main/templates\",children:\"nix flake templates\"}),` to make starting new projects easier.\nYou can run`]}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"shell\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsx)(e.code,{children:(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"$ nix flake --refresh new --template github:JRMurr/NixOsConfig#rust \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"pathToProjectDir\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u003e\"})]})})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"to create a new folder with a \",(0,l.jsx)(e.code,{children:\"flake.nix\"}),\" file to get rust setup with nightly, update the \",(0,l.jsx)(e.code,{children:\"rust-toolchain.toml\"}),\" to the most recent nightly.\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"The template does not include a \",(0,l.jsx)(e.code,{children:\"Cargo.toml\"}),\" so make one with \",(0,l.jsx)(e.code,{children:\"cargo init\"}),\" or \",(0,l.jsx)(e.code,{children:\"cargo new\"}),\" to set up the crate.\"]}),`\n`,(0,l.jsxs)(e.h3,{id:\"cargo-workspaces\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#cargo-workspaces\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Cargo Workspaces\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"While we could probably get away with having a \",(0,l.jsx)(e.code,{children:\"core\"}),\"/\",(0,l.jsx)(e.code,{children:\"lib\"}),\" crate and then make an \",(0,l.jsx)(e.code,{children:\"application\"}),` crate for CLI/HTTP access to the DB,\nI would like to try to split up the crates across more logical boundaries. This helps out with compile times since rust can compile each crate in parallel.\nMy current idea is a different crate for`]}),`\n`,(0,l.jsxs)(e.ul,{children:[`\n`,(0,l.jsx)(e.li,{children:\"a CLI/REPL to interact with a db\"}),`\n`,(0,l.jsx)(e.li,{children:\"Parsing SQL\"}),`\n`,(0,l.jsx)(e.li,{children:\"Query Execution\"}),`\n`]}),`\n`,(0,l.jsx)(e.p,{children:\"Some things like defining the different commands/queries don't quite feel right in being in the parsing/execution crates so might make sense to add a crate just for shared types.\"}),`\n`,(0,l.jsxs)(e.p,{children:[\"To set up cargo workspaces make a \",(0,l.jsx)(e.code,{children:\"Cargo.toml\"}),\" that looks like\"]}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"Cargo.toml\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"toml\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"[\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"workspace\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"]\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"members\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" [\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# all crates in a `./crates` folder will be added to the workspace\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\t\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"crates/*\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"]\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# https://doc.rust-lang.org/nightly/cargo/reference/specifying-dependencies.html#inheriting-a-dependency-from-a-workspace\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# Shared dependencies across all workspace crates\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"[\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"workspace\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"dependencies\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"]\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# these are very likely to be used across all/most crates so pin the version for them all\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"miette\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"5.5.0\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"serde\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"version\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"1.0.151\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"features\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" [\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"derive\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"] }\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"thiserror\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"1.0.38\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'})]})]})})]}),`\n`,(0,l.jsx)(e.p,{children:\"This will tell cargo we are using workspaces. Once we start making crates I will explain how to use the shared dependencies listed above\"}),`\n`,(0,l.jsxs)(e.h2,{id:\"the-repl\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#the-repl\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"The REPL\"]}),`\n`,(0,l.jsx)(e.p,{children:`While we could go right to execution or parsing and just develop with unit tests, I like having some form of interactivity as soon as possible.\nThe unit test approach would definitely make sense if this was a \"real\" project, for personal stuff I'm fine being a bit in the wild west to make life easier.`}),`\n`,(0,l.jsxs)(e.p,{children:[\"So to get to interactivity let's make a REPL. We can make a new crate by going into the \",(0,l.jsx)(e.code,{children:\"crates`` directory and running \"}),\"cargo new sql_jr_repl\",(0,l.jsx)(e.code,{children:\". The [rustyline crate](https://github.com/kkawakam/rustyline) seems like it will cover the basics for a REPL, so we can add it with \"}),\"cargo add rustyline\",(0,l.jsx)(e.code,{children:\"in the\"}),\"sql_jr_repl` directory.\"]}),`\n`,(0,l.jsx)(e.p,{children:\"We can copy the example with some small tweaks to get started\"}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"sql_jr_repl/main.rs\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"use\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" rustyline\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"error\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ReadlineError\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"use\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" rustyline\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"{\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Editor\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Result\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"};\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"const\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"HISTORY_FILE\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"str\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"./history.txt\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"main\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"() \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Result\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c()\u003e {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"mut\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" rl \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Editor\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c()\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"?\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"if\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" rl\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"load_history\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"HISTORY_FILE\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"is_err\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"() {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"println!\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"No previous history.\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\");\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"loop\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" readline \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" rl\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"readline\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"\u003e\u003e \"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\");\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"match\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" readline {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Ok\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(line) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                rl\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"add_history_entry\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(line\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"as_str\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"());\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"println!\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"Line: {}\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", line);\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            },\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Err\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ReadlineError\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Interrupted\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"                // CTRL-C so just skip\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            },\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Err\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ReadlineError\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Eof\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"                // CTRL-D so exit\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"break\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            },\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Err\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(err) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"println!\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"Error: {:?}\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", err);\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"break\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    rl\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"save_history\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"HISTORY_FILE\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"This will store the history in a local file (we can use the user's home/XDG dirs to store it elsewhere later) and allow \",(0,l.jsx)(e.code,{children:\"CTRL-C\"}),' to \"cancel\" the current input and have ',(0,l.jsx)(e.code,{children:\"CTRL-D\"}),`/an error exit the REPL.\nTry it out with `,(0,l.jsx)(e.code,{children:\"cargo run\"}),\", it will just repeat the lines you send with enter and run until you hit \",(0,l.jsx)(e.code,{children:\"CTRL-D\"}),\".\"]}),`\n`,(0,l.jsxs)(e.h2,{id:\"parsing\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#parsing\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Parsing\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Now that the basic REPL is set up we can work on parsing our simple SQL. In Rust, I have usually used \",(0,l.jsx)(e.a,{href:\"https://github.com/Geal/nom\",children:\"nom\"}),` when I need to make a parser.\nI like that I stay in rust and don't need to mess with a new \"language\" to get my parsing code. With that said `,(0,l.jsx)(e.a,{href:\"https://pest.rs/\",children:\"pest\"}),\" looks pretty great as a more generator approach and may end up switching to that later on.\"]}),`\n`,(0,l.jsxs)(e.h3,{id:\"nom-for-dummies\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#nom-for-dummies\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"nom for dummies\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"nom is a \",(0,l.jsx)(e.a,{href:\"https://en.wikipedia.org/wiki/Parser_combinator\",children:\"parser combinator library\"}),\". The TLDR for that is you make functions that take in parsers and output parsers to build up your grammar.\"]}),`\n`,(0,l.jsx)(e.p,{children:\"Here are some examples\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"// IResult tracks the input type (generally string or bytes) and the output type for the parser\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"parser\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(s\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"str\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"IResult\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"str\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"str\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"tag_no_case\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"hello\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")(s)\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"// when you run a parser on some input it will return the remaining input in the first param\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"// and the matched input for that parser that ran\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"assert_eq!\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"parser\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"Hello, World!\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"), \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Ok\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"((\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\", World!\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"Hello\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")));\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"// NOTE: this is missing some trait bounds but the vibe is right\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"/// Run the given parser f on a comma seperated list\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"crate\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"comma_sep\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"I\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"O\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"E\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"F\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e(\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    f\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"F\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"impl\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"FnMut\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"I\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"IResult\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"I\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Vec\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"O\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e, \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"E\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"where\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"{\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"separated_list1\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"tuple\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"((multispace0, \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"char\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"','\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"), multispace0)), f)\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"There are \",(0,l.jsx)(e.a,{href:\"https://github.com/Geal/nom/blob/main/doc/choosing_a_combinator.md\",children:\"many combinators\"}),\" provided by nom.\"]}),`\n`,(0,l.jsxs)(e.h3,{id:\"my-own-sql\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#my-own-sql\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"My Own SQL\"]}),`\n`,(0,l.jsx)(e.p,{children:\"Right now I'm going to handle basic select, insert, and create table statements that will look like\"}),`\n`,(0,l.jsx)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsx)(e.code,{children:(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"undefined\"},children:`CREATE TABLE FOO (\n    col1 string,\n    col2 int\n)\n\nINSERT INTO FOO VALUES 1,2;\n\nSELECT col1, col2 FROM foo;`})})})})}),`\n`,(0,l.jsxs)(e.p,{children:[\"To start we can make a new lib crate \",(0,l.jsx)(e.code,{children:\"sql_jr_parser\"}),\". We will add in nom, \",(0,l.jsx)(e.a,{href:\"https://github.com/fflorent/nom_locate\",children:\"nom_locate\"}),\", and \",(0,l.jsx)(e.a,{href:\"https://github.com/Lucretiel/nom-supreme\",children:\"nom_supreme\"}),`.\n`,(0,l.jsx)(e.code,{children:\"nom_locate\"}),\" has a nice \",(0,l.jsx)(e.code,{children:\"LocatedSpan\"}),` type to easily track where in the source code a parser ran/threw an error.\n`,(0,l.jsx)(e.code,{children:\"nom_supreme\"}),\" is a nom utility lib, we will use it mostly for postfix calls on parsers to make the code a little easier to read and \",(0,l.jsx)(e.a,{href:\"https://docs.rs/nom-supreme/latest/nom_supreme/error/type.ErrorTree.html\",children:\"error tree\"}),`\nto help with error formatting`]}),`\n`,(0,l.jsxs)(e.p,{children:[\"To be completely honest we probably could get by without \",(0,l.jsx)(e.code,{children:\"nom_locate\"}),\" and just use \",(0,l.jsx)(e.code,{children:\"nom_supreme\"}),\" but if it's good enough for \",(0,l.jsx)(e.a,{href:\"https://fasterthanli.me/series/advent-of-code-2022/part-11#nice-parser-errors\",children:\"Amos\"}),\" it's good enough for me\"]}),`\n`,(0,l.jsxs)(e.h3,{id:\"actual-parsing\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#actual-parsing\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Actual parsing\"]}),`\n`,(0,l.jsx)(i,{children:(0,l.jsx)(e.p,{children:\"nom requires ALOT of imports so will be ignoring most of them in the code snippets\"})}),`\n`,(0,l.jsx)(e.p,{children:\"First, we need to define some type aliases\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"// Use nom_locate's LocatedSpan as a wrapper around a string input\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"type\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"RawSpan\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"LocatedSpan\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"str\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e;\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"// the result for all of our parsers, they will have our span type as input and can have any output\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"// this will use a default error type but we will change that latter\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"type\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ParseResult\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"T\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"IResult\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"RawSpan\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e, \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"T\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e\"})]})]})})]}),`\n`,(0,l.jsx)(e.p,{children:\"We will need to parse identifiers for columns and tables so let's make a parser for that\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"/// Parse a unquoted sql identifier\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"crate\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"identifier\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(i\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"RawSpan\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ParseResult\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"map\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"take_while1\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"c\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"char\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" c\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"is_alphanumeric\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()), \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"s\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"RawSpan\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        s\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"fragment\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"to_string\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    })(i)\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Since we made the parser take in a \",(0,l.jsx)(e.code,{children:\"RawSpan\"}),\" instead of just a \",(0,l.jsx)(e.code,{children:\"\u0026 str\"}),\" or \",(0,l.jsx)(e.code,{children:\"String\"}),\" we would need to first call \",(0,l.jsx)(e.code,{children:\"LocatedSpan::new(input_str)\"}),\" to call our parsers.\"]}),`\n`,(0,l.jsxs)(e.h3,{id:\"helper-trait\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#helper-trait\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Helper trait\"]}),`\n`,(0,l.jsx)(e.p,{children:\"Since we will have a lot of different things we need to parse let's make a trait to make it easier to track what each parser is for.\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"/// Implement the parse function to more easily convert a span into a sql\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"/// command\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"trait\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Parse\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Sized\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"    /// Parse the given span into self\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"parse\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(input\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"RawSpan\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ParseResult\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"Self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e;\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"    /// Helper method for tests to convert a str into a raw span and parse\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"parse_from_raw\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(input\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"str\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ParseResult\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"Self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" i \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"LocatedSpan\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(input);\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"Self\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"parse\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(i)\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Now anything we want to parse can implement a \",(0,l.jsx)(e.code,{children:\"Parse\"}),` method which lets us compose types/parsers,\nand we can add any helper functions into this trait we need for testing or error handling.`]}),`\n`,(0,l.jsxs)(e.h3,{id:\"parsing-create-table\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#parsing-create-table\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Parsing Create Table\"]}),`\n`,(0,l.jsx)(e.p,{children:\"Create table statements need to parse/extract 3 things\"}),`\n`,(0,l.jsxs)(e.ul,{children:[`\n`,(0,l.jsx)(e.li,{children:\"The table name we will create\"}),`\n`,(0,l.jsx)(e.li,{children:\"The column names\"}),`\n`,(0,l.jsx)(e.li,{children:\"The types for those columns\"}),`\n`]}),`\n`,(0,l.jsx)(e.p,{children:\"So let's make a type + parser for each\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"// Using tag_no_case from nom_supreme since its error is nicer\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"// ParserExt is mostly for adding `.context` on calls to identifier to say what kind of identifier we want\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"use\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" nom_supreme\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"{tag\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"complete\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"tag_no_case, \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ParserExt\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"};\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"// many other imports omitted\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"/// A colum's type\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"#[derive(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Debug\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Clone\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Eq\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Hash\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"PartialEq\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Serialize\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Deserialize\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")]\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"enum\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SqlTypeInfo\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"    // these are basic for now. Will add more + size max later on\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Int\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:'// parses \"string | int\"'})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"impl\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Parse\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"for\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SqlTypeInfo\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"parse\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(input\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"RawSpan\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ParseResult\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"Self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e {\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"        // context will help give better error messages later on\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"context\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"Column Type\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"            // alt will try each passed parser and return what ever succeeds\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"alt\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"((\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"map\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"tag_no_case\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"string\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"), \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"_\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"Self\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"),\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"map\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"tag_no_case\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"int\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"), \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"_\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"Self\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Int\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"),\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            )),\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        )(input)\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"/// A column's name + type\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"#[derive(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Debug\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Clone\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Eq\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Hash\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"PartialEq\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Serialize\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Deserialize\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")]\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"struct\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Column\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" name\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" type_info\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SqlTypeInfo\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:'// parses \"\u003ccolName\u003e \u003ccolType\u003e\"'})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"impl\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Parse\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"for\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Column\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"parse\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(input\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"RawSpan\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ParseResult\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"Self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"context\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"Create Column\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"map\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"separated_pair\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    identifier\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"context\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"Column Name\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"),\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    multispace1,\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SqlTypeInfo\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"parse,\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                ),\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(name, type_info)\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"Self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { name, type_info },\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            ),\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        )(input)\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"/// The table and its columns to create\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"#[derive(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Clone\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Debug\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Default\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Eq\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Hash\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"PartialEq\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Serialize\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Deserialize\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")]\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"struct\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"CreateStatement\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" table\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" columns\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Vec\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Column\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e,\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"// parses a comma seperated list of column definitions contained in parens\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"column_definitions\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(input\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"RawSpan\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"_\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ParseResult\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"_\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Vec\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Column\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e\u003e {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"context\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"Column Definitions\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"map\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"tuple\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"((\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"char\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"'('\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"), \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"comma_sep\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Column\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"parse), \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"char\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"')'\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"))),\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(_, cols, _)\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" cols,\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        ),\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    )(input)\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:'// parses \"CREATE TABLE \u003ctable name\u003e \u003ccolumn defs\u003e'})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"impl\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Parse\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"for\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"CreateStatement\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"parse\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(input\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"RawSpan\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ParseResult\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"Self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"map\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"separated_pair\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"                // table name\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"preceded\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"tuple\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"((\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"tag_no_case\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"create\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"),\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                        multispace1,\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"tag_no_case\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"table\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"),\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                        multispace1,\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    )),\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    identifier\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"context\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"Table Name\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"),\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                ),\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                multispace1,\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"                // column defs\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                column_definitions,\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            )\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"context\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"Create Table\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"),\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(table, columns)\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"Self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { table, columns },\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        )(input)\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"// I was a test hater earlier but may as well cover the basics...\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"#[cfg(test)]\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"mod\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" tests {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"use\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"super\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::*\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    #[test]\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"test_create\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"() {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" expected \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"CreateStatement\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            table\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"foo\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"into\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(),\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            columns\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"vec!\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"[\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Column\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    name\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"col1\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"into\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(),\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    type_info\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SqlTypeInfo\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Int\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                },\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Column\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    name\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"col2\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"into\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(),\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    type_info\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SqlTypeInfo\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                },\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Column\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    name\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"col3\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"into\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(),\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    type_info\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SqlTypeInfo\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                },\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            ],\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        };\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"assert_eq!\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"CreateStatement\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"parse_from_raw\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"CREATE TABLE foo (col1 int, col2 string, col3 string)\"'})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            )\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"unwrap\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"1\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            expected\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        )\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsx)(e.p,{children:\"I will skip out on including the parsing for select/insert, but the vibes are similar.\"}),`\n`,(0,l.jsxs)(e.h3,{id:\"pulling-it-all-together\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#pulling-it-all-together\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Pulling it all together\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Now that we can parse each of our commands we need to tell nom to try each of them. We can do that with the \",(0,l.jsx)(e.a,{href:\"https://docs.rs/nom/latest/nom/branch/fn.alt.html\",children:\"alt combinator\"}),\" to try each parser and see which one succeeds.\"]}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"/// All possible commands\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"#[derive(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Clone\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Debug\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Eq\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Hash\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"PartialEq\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Serialize\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Deserialize\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")]\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"enum\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SqlQuery\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"Select\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SelectStatement\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"),\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"Insert\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"InsertStatement\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"),\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"Create\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"CreateStatement\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"),\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"impl\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Parse\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"for\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SqlQuery\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"parse\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(input\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"RawSpan\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ParseResult\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"Self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" (rest, (query, _, _, _)) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"context\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"Query\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"preceded\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                multispace0,\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"tuple\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"((\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"alt\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"((\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"                        // this feels ripe for a derive macro but another time....\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"map\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SelectStatement\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"parse, \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SqlQuery\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Select\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"),\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"map\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"InsertStatement\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"parse, \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SqlQuery\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Insert\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"),\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"map\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"CreateStatement\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"parse, \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SqlQuery\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Create\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"),\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    )),\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    multispace0,\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"char\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"';'\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"),\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    multispace0,\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                )),\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            ),\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        )(input)\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"?\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Ok\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"((rest, query))\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"#[cfg(test)]\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"mod\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" tests {\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"use\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"super\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::*\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    #[test]\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"test_error\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"() {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" query \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SqlQuery\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"parse_from_raw\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"select fart;\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\");\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"assert!\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(query\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"is_err\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(), \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"expected parse to fail, got {query:?}\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\");\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    #[test]\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"test_select\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"() {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" expected \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SelectStatement\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            tables\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"vec!\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"[\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"t1\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"to_string\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(), \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"t2\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"to_string\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()],\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            fields\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"vec!\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"[\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"foo\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"to_string\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(), \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"bar\"'}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"to_string\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()],\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        };\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"assert_eq!\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SqlQuery\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"parse_from_raw\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"select foo, bar from t1,t2;\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"unwrap\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"1\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SqlQuery\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"Select\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(expected)\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        )\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Now that we have command parsing we can add it to our REPL. First, we need to add our parser crate to our \",(0,l.jsx)(e.code,{children:\"Cargo.toml\"}),\" in the REPL crate\"]}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"sql_jr_repl/Cargo.toml\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"toml\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FF5555\"},children:\"...\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"[\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"dependencies\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"]\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FF5555\"},children:\"...\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"sql_jr_parser\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"path\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"../sql_jr_parser\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" }\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FF5555\"},children:\"...\"})})]})})]}),`\n`,(0,l.jsx)(e.p,{children:\"then update our main function\"}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"sql_jr_repl/main.rs\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"...\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"match\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" readline {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Ok\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(line) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"match\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SqlQuery\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"parse_from_raw\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(line\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"as_ref\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()) {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Ok\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(q) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"println!\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"{q:?}\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"),\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Err\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(e) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"eprintln!\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"{e:?}\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"),\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            }\"})})]})})]}),`\n`,(0,l.jsx)(e.p,{children:\"Now we can finally type some stuff and have different things come back.\"}),`\n`,(0,l.jsx)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsx)(e.code,{children:(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"undefined\"},children:`\u003e\u003e select col1 from foo;\n(LocatedSpan { offset: 21, line: 1, fragment: \"\", extra: () }, Select(SelectStatement { tables: [\"foo\"], fields: [\"col1\"] }))`})})})})}),`\n`,(0,l.jsx)(e.p,{children:\"However, when we get an error we just get a debug out, gross... let's fix that.\"}),`\n`,(0,l.jsxs)(e.h3,{id:\"parser-errors\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#parser-errors\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Parser Errors\"]}),`\n`,(0,l.jsx)(e.p,{children:\"Errors can be a giant rabbit hole to keep improving. For now, as long as we show a span in the source tree and highlight the sad spots I'll be happy.\"}),`\n`,(0,l.jsxs)(e.p,{children:[\"I will be using \",(0,l.jsx)(e.a,{href:\"https://github.com/zkat/miette\",children:\"miette\"}),\" to format/display errors. It can hook into source errors very easily and can show help, context, and much more.\"]}),`\n`,(0,l.jsx)(e.p,{children:\"Our error types will look like\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"use\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" miette\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Diagnostic\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"use\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" nom_supreme\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"error\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"{\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"BaseErrorKind\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ErrorTree\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"GenericErrorTree\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"StackContext\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"};\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"use\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" thiserror\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Error\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"#[derive(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Error\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Debug\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Diagnostic\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")]\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"#[error(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"Parse Error\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")]\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"struct\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"FormattedError\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"b\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e {\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"    // need 'b since Diagnostic derive uses 'a\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    #[source_code]\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    src\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"b\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"str\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    #[label(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"{kind}\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")]\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    span\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" miette\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SourceSpan\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"    // will explain this later. TLDR: the parsing error\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    kind\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"BaseErrorKind\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"b\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"str\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Box\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"dyn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" std\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"error\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Error\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"+\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Send\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"+\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Sync\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"+\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" '\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"static\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e\u003e,\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    #[related]\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    others\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Vec\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"FormattedErrorContext\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"b\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e\u003e,\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"#[derive(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Error\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Debug\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Diagnostic\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")]\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"#[error(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"Parse Error Context\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")]\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"struct\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"FormattedErrorContext\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"b\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e {\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    #[source_code]\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    src\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"b\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"str\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    #[label(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"{context}\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")]\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    span\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" miette\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SourceSpan\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    context\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"StackContext\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"b\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"str\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e,\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"These types can be used as normal rust error types without issue but when used in a miette \",(0,l.jsx)(e.code,{children:\"Reporter\"}),\" we can get output like\"]}),`\n`,(0,l.jsx)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsx)(e.code,{children:(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"undefined\"},children:`\u003e\u003e select 1 fr\n\n  \\xD7 Parse Error\n   \\u256D\\u2500\\u2500\\u2500\\u2500\n 1 \\u2502 select 1 fr\n   \\xB7          \\u25B2\n   \\xB7          \\u2570\\u2500\\u2500 expected \"from\"\n   \\u2570\\u2500\\u2500\\u2500\\u2500\n\nError:\n  \\xD7 Parse Error Context\n   \\u256D\\u2500\\u2500\\u2500\\u2500\n 1 \\u2502 select 1 fr\n   \\xB7 \\u25B2\n   \\xB7 \\u2570\\u2500\\u2500 in section \"Select Statement\"\n   \\u2570\\u2500\\u2500\\u2500\\u2500\nError:\n  \\xD7 Parse Error Context\n   \\u256D\\u2500\\u2500\\u2500\\u2500\n 1 \\u2502 select 1 fr\n   \\xB7 \\u25B2\n   \\xB7 \\u2570\\u2500\\u2500 in section \"Query\"\n   \\u2570\\u2500\\u2500\\u2500\\u2500`})})})})}),`\n`,(0,l.jsxs)(e.p,{children:[\"The main magic here is the \",(0,l.jsx)(e.code,{children:\"#[source_code]\"}),\" macro marking what the passed string was and\"]}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"#[label(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"{kind}\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")]\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"span\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" miette\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SourceSpan\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"kind\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"BaseErrorKind\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"b\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"str\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Box\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"dyn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" std\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"error\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Error\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"+\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Send\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"+\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Sync\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"+\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" '\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"static\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e\u003e,\"})]})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"which tells miette to mark the provided span (the location in the source code) with the error display from \",(0,l.jsx)(e.code,{children:\"kind\"}),\".\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Here we use the \",(0,l.jsx)(e.a,{href:\"https://docs.rs/nom-supreme/latest/nom_supreme/error/type.ErrorTree.html\",children:\"error tree\"}),\" type to specify the parsing error.\"]}),`\n`,(0,l.jsxs)(e.p,{children:['The error tree type will make it easier to handle errors on \"alts\" (like our root type). If you tried to parse ',(0,l.jsx)(e.code,{children:\"select +!@#!@!!\"}),`\nnom would fail in the select parser but still try the other ones, so it would not know what parser errors to show.\nThat issue can be fixed slightly with `,(0,l.jsx)(e.a,{href:\"https://docs.rs/nom/latest/nom/combinator/fn.cut.html\",children:\"cut\"}),\" to not try other branches in the alt if we know for sure we are in a select/insert/create/etc.\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"However, cases like parsing \",(0,l.jsx)(e.code,{children:\"I like rust\"}),\" are tough, all the parsers would fail without being cut, so what can we show? Ideally, we would say something like \",(0,l.jsx)(e.code,{children:\"expected select|create|insert, got ....\"}),\" which the error tree type will help with (though not now).\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"To get these errors we first need to update \",(0,l.jsx)(e.code,{children:\"ParseResult\"}),\" to use the error tree type as its error type.\"]}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"// Alias for later\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"type\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"MyParseError\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ErrorTree\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"RawSpan\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e\u003e;\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"type\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ParseResult\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"T\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"IResult\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"RawSpan\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e, \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"T\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"MyParseError\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e;\"})]})]})})]}),`\n`,(0,l.jsx)(e.p,{children:\"The beauty of nom is we don't need to update any code in our existing parsers to change the error type, they were all generic over it.\"}),`\n`,(0,l.jsx)(e.p,{children:\"Now we need to convert the error tree error into our miette error type\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"format_parse_error\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e(input\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"str\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", e\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"MyParseError\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"FormattedError\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"match\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" e {\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:'        // a \"normal\" error like unexpected charcter'})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"GenericErrorTree\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Base\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { location, kind } \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"            // the location type is nom_locate's RawSpan type\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"            // Might be nice to just use our own span/make a wrapper to implement\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"            // From\u003cOurSpan\u003e for miette::SourceSpan\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" offset \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" location\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"location_offset\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"into\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"();\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"FormattedError\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                src\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" input,\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                span\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" miette\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SourceSpan\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(offset, \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"0.\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"into\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()),\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                kind,\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                others\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Vec\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(),\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"        // an error that has a context attached (from nom's context function)\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"GenericErrorTree\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Stack\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { base, contexts } \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"mut\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" base \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"format_parse_error\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(input, \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"*\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"base);\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"mut\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" contexts\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Vec\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"FormattedErrorContext\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" contexts\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"into_iter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"map\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(location, context)\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" offset \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" location\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"location_offset\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"into\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"();\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"FormattedErrorContext\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                        src\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" input,\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                        span\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" miette\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SourceSpan\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(offset, \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"0.\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"into\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()),\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                        context,\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                })\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"collect\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"();\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            base\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"others\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"append\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026mut\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" contexts);\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            base\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:'        // an error from an \"alt\"'})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"GenericErrorTree\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"Alt\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(alt_errors) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"            // get the error with the most context\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"            // since that parsed the most stuff\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"            // TODO: figure out what to do on ties\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            alt_errors\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"into_iter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"map\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"e\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"format_parse_error\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(input, e))\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"max_by_key\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"formatted\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" formatted\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"others\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"len\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"())\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"unwrap\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Now to make it easy to get this formatted error add the following to our \",(0,l.jsx)(e.code,{children:\"Parser\"}),\" trait\"]}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"parse_format_error\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(i\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"str\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Result\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"Self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"FormattedError\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e\u003e {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" input \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"LocatedSpan\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(i);\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"match\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"all_consuming\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"Self\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"parse)(input)\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"finish\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"() {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Ok\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"((_, query)) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Ok\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(query),\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Err\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(e) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Err\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"format_parse_error\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(i, e)),\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})})]})})]}),`\n`,(0,l.jsx)(e.p,{children:\"Now we can finally update our REPL with\"}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"sql_jr_repl/Cargo.toml\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"toml\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FF5555\"},children:\"...\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"[\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"dependencies\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"]\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# use the workspace version of miette but also use the fancy feature\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# to allow for display errors\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"miette\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"workspace\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"true\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"features\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" [\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"fancy\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"]}\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#FF5555\"},children:\"...\"})})]})})]}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" query \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"parse_sql_query\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(line);\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"match\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SqlQuery\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"parse_format_error\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(line\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"as_ref\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()) {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Ok\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(q) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"println!\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"{q:?}\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"),\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Err\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(e) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"mut\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" s \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"();\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"GraphicalReportHandler\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"render_report\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026mut\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" s, \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"e)\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"unwrap\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"();\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"println!\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"{s}\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\");\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    },\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsx)(e.p,{children:\"and we finally have some sweet parsing errors.\"}),`\n`,(0,l.jsxs)(e.h2,{id:\"part-1-wrap-up\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#part-1-wrap-up\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Part 1 wrap up\"]}),`\n`,(0,l.jsx)(e.p,{children:`I definitely went overkill (but still feels like not enough...) on getting the parser errors to work nicely,\nbut our eventual 0 users will appreciate it.`}),`\n`,(0,l.jsx)(e.p,{children:\"Next post will focus on actually running queries (and addressing any feedback I get on this post).\"})]})}}var f=D;function d(n,r){throw new Error(\"Expected \"+(r?\"component\":\"object\")+\" `\"+n+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return g;})();\n;return Component;","toc":[{"value":"What am I Making","url":"#what-am-i-making","depth":2},{"value":"Project setup","url":"#project-setup","depth":2},{"value":"Cargo Workspaces","url":"#cargo-workspaces","depth":3},{"value":"The REPL","url":"#the-repl","depth":2},{"value":"Parsing","url":"#parsing","depth":2},{"value":"nom for dummies","url":"#nom-for-dummies","depth":3},{"value":"My Own SQL","url":"#my-own-sql","depth":3},{"value":"Actual parsing","url":"#actual-parsing","depth":3},{"value":"Helper trait","url":"#helper-trait","depth":3},{"value":"Parsing Create Table","url":"#parsing-create-table","depth":3},{"value":"Pulling it all together","url":"#pulling-it-all-together","depth":3},{"value":"Parser Errors","url":"#parser-errors","depth":3},{"value":"Part 1 wrap up","url":"#part-1-wrap-up","depth":2}],"frontMatter":{"readingTime":{"text":"13 min read","minutes":12.504166666666666,"time":750250,"words":3001},"slug":"build-a-db/part01","fileName":"build-a-db/part01.md","title":"Building a Simple DB in Rust - Part 1 - Parsing","seriesTitle":"Part 1 - Parsing","date":"2023-01-02T05:19:22.985Z","tags":["rust","database","parsing"],"draft":false,"summary":"building a basic database in rust","images":[],"layout":"PostLayout"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.17916666666666667,"time":10750,"words":43},"slug":["default"],"fileName":"default.md","name":"John Murray","avatar":"/static/images/me.jpg","occupation":"Software Engineer","github":"https://github.com/JRMurr","twitter":"https://twitter.com/JRMurrCodes","mastodon":"https://hachyderm.io/@jrmurr","email":"johnreillymurray@gmail.com","date":null}],"series":{"title":"Building a Simple DB in Rust","posts":[{"title":"Building a Simple DB in Rust - Part 1 - Parsing","seriesTitle":"Part 1 - Parsing","date":"2023-01-02T05:19:22.985Z","tags":["rust","database","parsing"],"draft":false,"summary":"building a basic database in rust","images":[],"layout":"PostLayout","slug":"build-a-db/part01"},{"title":"Building a Simple DB in Rust - Part 2 - Basic Execution","seriesTitle":"Part 2 - Basic Execution","date":"2023-01-23T14:01:22.231Z","tags":["rust","database"],"draft":false,"summary":"Building a basic database in rust","images":[],"layout":"PostLayout","slug":"build-a-db/part02"},{"title":"Building a Simple DB in Rust - Part 3 - Less Basic Execution","seriesTitle":"Part 3 - Less Basic Execution","date":"2023-04-04T00:01:55.249Z","tags":["rust","database","repl"],"draft":false,"summary":"Cleaning up existing execution logic","images":[],"layout":"PostLayout","slug":"build-a-db/part03"}]}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["build-a-db","part01"]},"buildId":"SynWlQ28OObrCnFVj8i-C","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>