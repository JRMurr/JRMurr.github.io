<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" content="#000000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>Building a Simple DB in Rust - Part 2 - Basic Execution</title><meta name="robots" content="follow, index"/><meta name="description" content="Building a basic database in rust"/><meta property="og:url" content="https://johns.codes/blog/build-a-db/part02"/><meta property="og:type" content="article"/><meta property="og:site_name" content="John&#x27;s Codes"/><meta property="og:description" content="Building a basic database in rust"/><meta property="og:title" content="Building a Simple DB in Rust - Part 2 - Basic Execution"/><meta property="og:image" content="https://johns.codes/static/images/twitter-card.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://twitter.com/JRMurrCodes"/><meta name="twitter:title" content="Building a Simple DB in Rust - Part 2 - Basic Execution"/><meta name="twitter:description" content="Building a basic database in rust"/><meta name="twitter:image" content="https://johns.codes/static/images/twitter-card.png"/><meta property="article:published_time" content="2023-01-23T14:01:22.231Z"/><link rel="canonical" href="https://johns.codes/blog/build-a-db/part02"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://johns.codes/blog/build-a-db/part02"
  },
  "headline": "Building a Simple DB in Rust - Part 2 - Basic Execution",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://johns.codes/static/images/twitter-card.png"
    }
  ],
  "datePublished": "2023-01-23T14:01:22.231Z",
  "dateModified": "2023-01-23T14:01:22.231Z",
  "author": [
    {
      "@type": "Person",
      "name": "John Murray"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "John Murray",
    "logo": {
      "@type": "ImageObject",
      "url": "https://johns.codes/static/images/logo.png"
    }
  },
  "description": "Building a basic database in rust"
}</script><meta name="next-head-count" content="20"/><link rel="preload" href="/_next/static/css/ff7a91e18d57a2d6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ff7a91e18d57a2d6.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-a0fb203be75c9eb6.js" defer=""></script><script src="/_next/static/chunks/main-b77bb48dcc3828e6.js" defer=""></script><script src="/_next/static/chunks/pages/_app-861f57e6bedfde14.js" defer=""></script><script src="/_next/static/chunks/framework-327e104994690a53.js" defer=""></script><script src="/_next/static/chunks/675-374a5a75205d32da.js" defer=""></script><script src="/_next/static/chunks/266-365d5fff0af19ac8.js" defer=""></script><script src="/_next/static/chunks/545-446f5effbf4e5f11.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-c8a468ed53b4c5d2.js" defer=""></script><script src="/_next/static/GI-xhRfCsnPvaM497qH_S/_buildManifest.js" defer=""></script><script src="/_next/static/GI-xhRfCsnPvaM497qH_S/_ssgManifest.js" defer=""></script><script src="/_next/static/GI-xhRfCsnPvaM497qH_S/_middlewareManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap">@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuFuYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body class="antialiased text-black bg-white dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex flex-col justify-between h-screen"><header class="flex items-center justify-between py-10"><div><a aria-label="John&#x27;s Codes" href="/"><div class="flex items-center justify-between"><div class="hidden h-6 text-2xl font-semibold sm:block">John&#x27;s Codes</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/projects">Projects</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="w-8 h-8 p-1 ml-1 mr-1 rounded sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="w-8 h-8 py-1 ml-1 mr-1 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed w-full h-full top-24 right-0 bg-gray-200 dark:bg-gray-800 opacity-95 z-10 transform ease-in-out duration-300 translate-x-full"><button type="button" aria-label="toggle modal" class="fixed w-full h-full cursor-auto focus:outline-none"></button><nav class="fixed h-full mt-8"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/projects">Projects</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed flex-col hidden gap-3 right-8 bottom-8 md:hidden"><button aria-label="Scroll To Comment" type="button" class="p-2 text-gray-500 transition-all bg-gray-200 rounded-full dark:text-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 hover:bg-gray-300"><svg class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="p-2 text-gray-500 transition-all bg-gray-200 rounded-full dark:text-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 hover:bg-gray-300"><svg class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-4 md:space-y-2 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="flex justify-center items-center text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2023-01-23T14:01:22.231Z">Monday, January 23, 2023</time><span class="mx-2">-</span><div class="flex items-center"><span class="ml-1">12 min read</span></div></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Building a Simple DB in Rust - Part 2 - Basic Execution</h1></div></div></header><div class="pb-8 divide-y divide-gray-200 xl:divide-y-0 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6" style="grid-template-rows:auto 1fr"><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:pb-0 xl:col-span-4 xl:row-span-2"><div class="pt-10 pb-8 prose dark:prose-dark max-w-none"><div class="pb-2"><p>This article is part of the <!-- -->Building a Simple DB in Rust<!-- --> series.</p><select class="block w-3/12 px-4 py-2 text-gray-900 bg-white border border-gray-300 rounded-md dark:border-gray-900 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-800 dark:text-gray-100"><option value="/blog/build-a-db/part01">Part 1 - Parsing</option><option selected="" value="/blog/build-a-db/part02">Part 2 - Basic Execution</option><option value="/blog/build-a-db/part03">Part 3 - Less Basic Execution</option></select></div><details open=""><summary class="pt-2 pb-2 ml-6 text-xl font-bold">Table of Contents</summary><div class="ml-6"><ul><li class="false"><a href="#feedback-from-part-1">Feedback from part 1</a></li><li class="false"><a href="#execution">Execution</a></li><li class="ml-6"><a href="#what-is-a-b-tree">What is a B-Tree?</a></li><li class="ml-6"><a href="#why-b-tree">Why B-Tree?</a></li><li class="false"><a href="#actually-do-stuff">Actually do stuff</a></li><li class="false"><a href="#handling-sql-queries">Handling SQL Queries</a></li><li class="false"><a href="#brining-it-all-together">Brining it all together</a></li><li class="false"><a href="#better-display-for-repl">Better display for REPL</a></li><li class="false"><a href="#wrap-up">Wrap up</a></li></ul></div></details>
<h1 id="feedback-from-part-1"><a href="#feedback-from-part-1" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Feedback from part 1</h1>
<p>I got some very nice feedback from the <a href="/blog/build-a-db/part01">first part of this series</a>. The main suggestions where to use some different parsing libraries like <a target="_blank" rel="noopener noreferrer" href="https://docs.rs/chumsky/latest/chumsky/">chumsky</a> or use an existing SQL parser like <a target="_blank" rel="noopener noreferrer" href="https://github.com/sqlparser-rs/sqlparser-rs">sqlparser-rs</a>.</p>
<p><code>chumsky</code> looks like it handles a lot of the error handling logic I had to do myself while still being defined in rust (no extra language). If I had known of this before I would have used it. Might switch to it later on if our grammar gets more involved. Thanks <a target="_blank" rel="noopener noreferrer" href="https://hachyderm.io/@hjvt/109620348134117972">@hjvt@hachyderm.io</a> for the recommendation!</p>
<p><code>sqlparser-rs</code> on the other hand looks very well maintained and handles many existing SQL dialects. If this was not a toy project I would have probably started off with this to get going faster without writing any parser logic.</p>
<p>Enough feedback, let&#x27;s get into actually running queries.</p>
<h1 id="execution"><a href="#execution" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Execution</h1>
<p>To get started on execution let&#x27;s make a new crate for it with <code>cargo new sql_jr_execution</code>. We will need the parser crate for our types we made and some other workspace dependencies.</p>
<div class="remark-code-title">sql_jr_execution/Cargo.toml</div>
<div class="relative"><pre class="shiki dracula"><div class="language-id">toml</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">[</span><span style="color:#8BE9FD">package</span><span style="color:#FF79C6">]</span></div><div class="line"><span style="color:#8BE9FD">name</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">sql_jr_execution</span><span style="color:#E9F284">&quot;</span></div><div class="line"><span style="color:#8BE9FD">version</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">0.1.0</span><span style="color:#E9F284">&quot;</span></div><div class="line"><span style="color:#8BE9FD">edition</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">2021</span><span style="color:#E9F284">&quot;</span></div><div class="line"></div><div class="line"><span style="color:#FF79C6">[</span><span style="color:#8BE9FD">dependencies</span><span style="color:#FF79C6">]</span></div><div class="line"><span style="color:#8BE9FD">miette</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span><span style="color:#8BE9FD">workspace</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">true</span><span style="color:#F8F8F2">}</span></div><div class="line"><span style="color:#8BE9FD">serde</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span><span style="color:#8BE9FD">workspace</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">true</span><span style="color:#F8F8F2">}</span></div><div class="line"><span style="color:#8BE9FD">sql_jr_parser</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> { </span><span style="color:#8BE9FD">path</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">../sql_jr_parser</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2"> }</span></div><div class="line"><span style="color:#8BE9FD">thiserror</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> {</span><span style="color:#8BE9FD">workspace</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">true</span><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>Since we will need to operate on tables, lets start by defining our table type. For now, we will only deal with in memory execution. Soon enough we can handle reading from disk.</p>
<div class="remark-code-title">table.rs</div>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">use</span><span style="color:#F8F8F2"> std</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">collections</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">{</span><span style="color:#8BE9FD">BTreeMap</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">HashMap</span><span style="color:#F8F8F2">};</span></div><div class="line"></div><div class="line"><span style="color:#FF79C6">use</span><span style="color:#F8F8F2"> serde</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">{</span><span style="color:#8BE9FD">Deserialize</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Serialize</span><span style="color:#F8F8F2">};</span></div><div class="line"><span style="color:#FF79C6">use</span><span style="color:#F8F8F2"> sql_jr_parser</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Column</span><span style="color:#F8F8F2">;</span><span style="color:#6272A4"> // See part 1 for this type def. Just column name and sql data type (string or int)</span></div><div class="line"></div><div class="line"></div><div class="line"><span style="color:#6272A4">// NOTE: For now just a mapping of col name =&gt; data as a str. Will change later</span></div><div class="line"><span style="color:#6272A4">/// A row stored in a table</span></div><div class="line"><span style="color:#FF79C6">type</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">StoredRow</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">HashMap</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">String</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">String</span><span style="color:#F8F8F2">&gt;;</span></div><div class="line"></div><div class="line"><span style="color:#6272A4">/// List of column info</span></div><div class="line"><span style="color:#FF79C6">type</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">ColumnInfo</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Vec</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">Column</span><span style="color:#F8F8F2">&gt;;</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">#[derive(</span><span style="color:#8BE9FD">Debug</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Clone</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Default</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Serialize</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Deserialize</span><span style="color:#F8F8F2">)]</span></div><div class="line"><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">crate</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">struct</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Table</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#6272A4">    /// row id to row</span></div><div class="line"><span style="color:#F8F8F2">    rows</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">BTreeMap</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">usize</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">StoredRow</span><span style="color:#F8F8F2">&gt;,</span></div><div class="line"></div><div class="line"><span style="color:#6272A4">    /// Column info for all columns in the table</span></div><div class="line"><span style="color:#F8F8F2">    columns</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">ColumnInfo</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>The <code>Table</code> struct is basically just a wrapper around Rust&#x27;s <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/stable/std/collections/struct.BTreeMap.html#">Btree</a> with some extra column info.</p>
<h3 id="what-is-a-b-tree"><a href="#what-is-a-b-tree" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>What is a B-Tree?</h3>
<p>A <a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/B-tree">B-Tree</a> is a generalized Binary Search Tree (BST). BSTs are great in theory but in practice they kinda suck for cache locality, nodes only store 1 piece of data, has the potential to be unbalanced, and requires a heap allocation for each insertion. In &quot;current year&quot; CPUs are insanely fast, so we need data structures that are better for reducing memory access.</p>
<p><em>insert rant about why data oriented design is GOATED here</em>.</p>
<p>Alexis Beingessner in <a target="_blank" rel="noopener noreferrer" href="https://cglab.ca/~abeinges/blah/rust-btree-case/#what&#x27;s-a-b-tree?-why&#x27;s-a-b-tree?">Rust Collections Case Study: BTreeMap</a> described B-Trees as</p>
<blockquote>
<p>B-Trees take the idea of a BST, and say &quot;lets put some arrays in there; computers love arrays&quot;. Rather than each node consisting of a single element with two children, B-Tree nodes have an array of elements with an array of children</p>
</blockquote>
<p>I won&#x27;t go into too much detail on B-Tree implementation, since I&#x27;m just using rust&#x27;s built in for now. If you&#x27;re intersted here are some good resources on B-Trees.</p>
<ul>
<li><a target="_blank" rel="noopener noreferrer" href="https://cglab.ca/~abeinges/blah/rust-btree-case">Rust Collections Case Study: BTreeMap</a></li>
<li><a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/B-tree">Wikipedia</a></li>
<li><a target="_blank" rel="noopener noreferrer" href="http://opendatastructures.org/ods-python/14_2_B_Trees.html">Open Datastructures</a></li>
</ul>
<p>With that said, let&#x27;s walk through a basic example</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/6/65/B-tree.svg" alt="B-Tree example"/></p>
<p>Here the internal node (the root) has 3 children. All keys <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mn>7</mn></mrow><annotation encoding="application/x-tex">&lt; 7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">7</span></span></span></span></span> are in the left child, keys <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&gt;</mo><mn>7</mn></mrow><annotation encoding="application/x-tex">&gt; 7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">7</span></span></span></span></span> and <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mo>=</mo><mn>16</mn></mrow><annotation encoding="application/x-tex">&lt;= 16</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em"></span><span class="mrel">&lt;=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">16</span></span></span></span></span> are in the middle, and finally keys <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&gt;</mo><mn>16</mn></mrow><annotation encoding="application/x-tex">&gt; 16</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">16</span></span></span></span></span> are in the right child.</p>
<p>You can customize the <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span> constant to have nodes store more/fewer keys and have more/fewer children. Average Lookup for a B-tree with <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.10903em">N</span></span></span></span></span> keys is <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">O</mi><mo stretchy="false">(</mo><mi>log</mi><mo>⁡</mo><msub><mrow></mrow><mn>2</mn></msub><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(\log{_2}N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathcal" style="margin-right:0.02778em">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em">g</span></span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord"><span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em"><span style="top:-2.55em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="mclose">)</span></span></span></span></span> which is the same for a BST.</p>
<h3 id="why-b-tree"><a href="#why-b-tree" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Why B-Tree?</h3>
<p>Like a mentioned before B-Trees are great for cache locality. Also, you can make each node be the size of a memory/disk block. This way you can minimize reads by chunking up the data more efficiently.</p>
<h2 id="actually-do-stuff"><a href="#actually-do-stuff" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Actually do stuff</h2>
<p>Nerd stuff aside, let&#x27;s actually add actual logic for our table</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">impl</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Table</span><span style="color:#F8F8F2"> {</span></div><div class="line"></div><div class="line"><span style="color:#6272A4">    // Create a table with the given column definitions</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">(columns</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Vec</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">Column</span><span style="color:#F8F8F2">&gt;) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">Self</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#BD93F9">Self</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">            rows</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">BTreeMap</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">(),</span></div><div class="line"><span style="color:#F8F8F2">            columns,</span></div><div class="line"><span style="color:#F8F8F2">        }</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"></div><div class="line"><span style="color:#6272A4">    /// Insert values (a row) into the table</span></div><div class="line"><span style="color:#6272A4">    ///</span></div><div class="line"><span style="color:#6272A4">    /// assumes the values are in the same order of the columns passed to create</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">insert</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;mut</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">self</span><span style="color:#F8F8F2">, values</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Vec</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">String</span><span style="color:#F8F8F2">&gt;) {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> id </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">self</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">rows</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">last_key_value</span><span style="color:#F8F8F2">()</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">map_or</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2">(max_id, _)</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2"> max_id </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">1</span><span style="color:#F8F8F2">);</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> row</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">StoredRow</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> values</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">into_iter</span><span style="color:#F8F8F2">()</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">zip</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">columns</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">iter</span><span style="color:#F8F8F2">())</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">map</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2">(v, col)</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2"> (col</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">name</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">to_owned</span><span style="color:#F8F8F2">(), v))</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">collect</span><span style="color:#F8F8F2">();</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#BD93F9">self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">rows</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">insert</span><span style="color:#F8F8F2">(id, row);</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>Here we create a table with the given column definitions (from the create table sql command). For insert, we get an ID for the new row which is just an ID sequence starting at 0 for the first row. We then insert the values into the B-TreeMap with that ID as the key and the row&#x27;s values as a hash map of column name to a string of the value to insert.</p>
<p>Those two functions can handle creating tables (mostly) and inserting data, but how should we handle select? A simple first step is to re-use the <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/std/iter/trait.Iterator.html">Iterator</a> on <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/std/collections/struct.BTreeMap.html#method.iter">BTreeMap</a>.</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">impl</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Table</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">iter</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#BD93F9">self</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> std</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">collections</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">btree_map</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Iter</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">usize</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Row</span><span style="color:#F8F8F2">&gt; {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#BD93F9">self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">rows</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">iter</span><span style="color:#F8F8F2">()</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>This will give us an <code>Iterator</code> over <code>(row_id, row_values)</code>.</p>
<p>Re-using the iterator from BTreeMap is fine, but I like how many Rust DB libraries have a <code>Row</code> trait/struct that gives you extra information. For example <a target="_blank" rel="noopener noreferrer" href="https://github.com/launchbadge/sqlx">SQLX</a> has a <a target="_blank" rel="noopener noreferrer" href="https://docs.rs/sqlx/latest/sqlx/trait.Row.html">Row trait</a> lets you get column info back for the query you ran, safe/unsafe conversions into rust types, and a few other helpers. So let&#x27;s make our own <code>Row</code> struct and iterator, so we can add these features later on.</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">use</span><span style="color:#F8F8F2"> std</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">{collections</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">HashMap</span><span style="color:#F8F8F2">, rc</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Rc</span><span style="color:#F8F8F2">};</span></div><div class="line"></div><div class="line"><span style="color:#FF79C6">use</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">crate::</span><span style="color:#F8F8F2">table</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">ColumnInfo</span><span style="color:#F8F8F2">;</span><span style="color:#6272A4"> // Vec&lt;Column&gt;</span></div><div class="line"></div><div class="line"><span style="color:#6272A4">/// A Row in a Query response</span></div><div class="line"><span style="color:#F8F8F2">#[derive(</span><span style="color:#8BE9FD">Debug</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Clone</span><span style="color:#F8F8F2">)]</span></div><div class="line"><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">struct</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Row</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt; {</span></div><div class="line"><span style="color:#F8F8F2">    id</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">usize</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">    columns</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Rc</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">ColumnInfo</span><span style="color:#F8F8F2">&gt;,</span></div><div class="line"><span style="color:#F8F8F2">    data</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">HashMap</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">String</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">String</span><span style="color:#F8F8F2">&gt;,</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>Here I made the decision that this <code>Row</code> struct will not own the data its showing. Therefore, it needs a reference to the data stored in the table. I also want to have the row have access to the <code>ColumnInfo</code> from the table. Since every row will be holding a reference to the same <code>ColumnInfo</code>, I went with an <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/std/rc/index.html">RC</a> to avoid extra lifetime parameters on the row struct.</p>
<p>Now we can make our own <code>Iterator</code> for table. We can just wrap the existing <code>Iterator</code> from <code>BTreeMap</code> and transform each response into our <code>Row</code> struct.</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#6272A4">/// Iterator of [`Row`]s from a table</span></div><div class="line"><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">crate</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">struct</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">TableIter</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt; {</span></div><div class="line"><span style="color:#6272A4">    /// Underlying iterator over the btree_map</span></div><div class="line"><span style="color:#F8F8F2">    map_iter</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> std</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">collections</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">btree_map</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Iter</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">usize</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">StoredRow</span><span style="color:#F8F8F2">&gt;,</span></div><div class="line"><span style="color:#6272A4">    /// The columns of the [`Table`]</span></div><div class="line"><span style="color:#F8F8F2">    columns</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Rc</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">ColumnInfo</span><span style="color:#F8F8F2">&gt;,</span></div><div class="line"><span style="color:#F8F8F2">}</span></div><div class="line"></div><div class="line"><span style="color:#FF79C6">impl</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt; </span><span style="color:#8BE9FD">TableIter</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt; {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">(</span></div><div class="line"><span style="color:#F8F8F2">        map_iter</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> std</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">collections</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">btree_map</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Iter</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">usize</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">StoredRow</span><span style="color:#F8F8F2">&gt;,</span></div><div class="line"><span style="color:#F8F8F2">        columns</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Rc</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">ColumnInfo</span><span style="color:#F8F8F2">&gt;,</span></div><div class="line"><span style="color:#F8F8F2">    ) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">Self</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#BD93F9">Self</span><span style="color:#F8F8F2"> { map_iter, columns }</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"><span style="color:#F8F8F2">}</span></div><div class="line"></div><div class="line"><span style="color:#FF79C6">impl</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt; </span><span style="color:#8BE9FD">Iterator</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">for</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">TableIter</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt; {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">type</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Item</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Row</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt;;</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">next</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;mut</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">self</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Option</span><span style="color:#F8F8F2">&lt;</span><span style="color:#BD93F9">Self</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Item</span><span style="color:#F8F8F2">&gt; {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#BD93F9">self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">map_iter</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">next</span><span style="color:#F8F8F2">()</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">map</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2">(id, data)</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Row</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">columns</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">clone</span><span style="color:#F8F8F2">(), id</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">clone</span><span style="color:#F8F8F2">(), data))</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div></code></div></pre></div>
<p>Now we can implement the <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/std/iter/trait.IntoIterator.html">IntoIterator trait</a> on <code>Table</code> for easy conversion into an iterator.</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">impl</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt; </span><span style="color:#8BE9FD">IntoIterator</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">for</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Table</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">type</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Item</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Row</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt;;</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">type</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">IntoIter</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">TableIter</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt;;</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">into_iter</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">self</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">Self</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">IntoIter</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> col_info </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Rc</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">columns</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">clone</span><span style="color:#F8F8F2">());</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#8BE9FD">TableIter</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">rows</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">iter</span><span style="color:#F8F8F2">(), col_info)</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>now the <code>iter</code> method (not necessarily needed) on table can just call the trait method</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">impl</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Table</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">iter</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#BD93F9">self</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">impl</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Iterator</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">Item</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Row</span><span style="color:#F8F8F2">&gt; {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#BD93F9">self</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">into_iter</span><span style="color:#F8F8F2">()</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<h2 id="handling-sql-queries"><a href="#handling-sql-queries" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Handling SQL Queries</h2>
<p>Now that we have a <code>Table</code> struct we need to hook up the parsed commands to create, insert, and read from tables.</p>
<p>First we should define the response type for an execution</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">use</span><span style="color:#F8F8F2"> derive_more</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Display</span><span style="color:#F8F8F2">;</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">#[derive(</span><span style="color:#8BE9FD">Debug</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Display</span><span style="color:#F8F8F2">)]</span></div><div class="line"><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">enum</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">ExecResponse</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt; {</span></div><div class="line"><span style="color:#F8F8F2">    #[display(fmt </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;{_0:?}&quot;</span><span style="color:#F8F8F2">)]</span><span style="color:#6272A4"> // only show the values not &quot;Select(...)&quot;</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">Select</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">Vec</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">Row</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt;&gt;),</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#8BE9FD">Insert</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#8BE9FD">Create</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>Here I use the <a target="_blank" rel="noopener noreferrer" href="https://docs.rs/derive_more/latest/derive_more/">derive_more</a> crate&#x27;s Display derive macro to avoid writing my own implementation of Display. If you&#x27;re a real one who&#x27;s been paying attention, you may have noticed that we did not implement <code>Display</code> on <code>Row</code> but the <code>Display</code> derive still compiles, this is due to us adding <code>#[display(fmt = &quot;{_0:?}&quot;)]</code> to use the debug format of <code>Vec&lt;Row&gt;</code> as the <code>Display</code> format. While we won&#x27;t use it much for select display (more on that later), for the other response cases It&#x27;s nice to have.</p>
<p>We also should make our own Error type for Query Execution</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">use</span><span style="color:#F8F8F2"> miette</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Diagnostic</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#FF79C6">use</span><span style="color:#F8F8F2"> thiserror</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Error</span><span style="color:#F8F8F2">;</span></div><div class="line"></div><div class="line"><span style="color:#6272A4">/// Errors during query execution</span></div><div class="line"><span style="color:#F8F8F2">#[derive(</span><span style="color:#8BE9FD">Error</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Debug</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Diagnostic</span><span style="color:#F8F8F2">)]</span></div><div class="line"><span style="color:#F8F8F2">#[error(</span><span style="color:#F1FA8C">&quot;Query Execution Error&quot;</span><span style="color:#F8F8F2">)]</span></div><div class="line"><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">enum</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">QueryExecutionError</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    #[error(</span><span style="color:#F1FA8C">&quot;Table {0} was not found&quot;</span><span style="color:#F8F8F2">)]</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">TableNotFound</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">String</span><span style="color:#F8F8F2">),</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">    #[error(</span><span style="color:#F1FA8C">&quot;Table {0} already exists&quot;</span><span style="color:#F8F8F2">)]</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">TableAlreadyExists</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">String</span><span style="color:#F8F8F2">),</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">    #[error(</span><span style="color:#F1FA8C">&quot;Column {0} does not exist&quot;</span><span style="color:#F8F8F2">)]</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">ColumnDoesNotExist</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">String</span><span style="color:#F8F8F2">),</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>Like in <a href="/blog/build-a-db/part01">part1</a>, we still are using <a target="_blank" rel="noopener noreferrer" href="https://docs.rs/miette/latest/miette/">miette</a>/<a target="_blank" rel="noopener noreferrer" href="https://docs.rs/thiserror/latest/thiserror/">thiserror</a> for better looking errors.</p>
<p>Now we can finally actually run some queries. For a quick refresher on the <code>SqlQuery</code> type, see <a target="_blank" rel="noopener noreferrer" href="https://github.com/JRMurr/SQLJr/blob/5324c38bc74cb77d2daf035a0f3d1da3fc7b4c3b/crates/sql_jr_parser/src/ast.rs#L19">the source code</a></p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#F8F8F2">#[derive(</span><span style="color:#8BE9FD">Debug</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Default</span><span style="color:#F8F8F2">)]</span></div><div class="line"><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">struct</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Execution</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    tables</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">HashMap</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">String</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Table</span><span style="color:#F8F8F2">&gt;,</span></div><div class="line"><span style="color:#F8F8F2">}</span></div><div class="line"></div><div class="line"><span style="color:#FF79C6">impl</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Execution</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">Self</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#BD93F9">Self</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">            tables</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">HashMap</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">(),</span></div><div class="line"><span style="color:#F8F8F2">        }</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">run</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;mut</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">self</span><span style="color:#F8F8F2">, query</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">SqlQuery</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Result</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">ExecResponse</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">QueryExecutionError</span><span style="color:#F8F8F2">&gt; {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#FF79C6">match</span><span style="color:#F8F8F2"> query {</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#8BE9FD">SqlQuery</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Select</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">mut</span><span style="color:#F8F8F2"> select) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> table </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> select</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">table;</span><span style="color:#6272A4"> // the table name</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> table </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">self</span></div><div class="line"><span style="color:#F8F8F2">                    </span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">tables</span></div><div class="line"><span style="color:#F8F8F2">                    </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">get</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">table)</span></div><div class="line"><span style="color:#F8F8F2">                    </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">ok_or</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">QueryExecutionError</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">TableNotFound</span><span style="color:#F8F8F2">(table))</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#6272A4">                // not projecting to the selected columns yet</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> rows </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> table</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">iter</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">collect</span><span style="color:#F8F8F2">();</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#8BE9FD">Ok</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">ExecResponse</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Select</span><span style="color:#F8F8F2">(rows)))</span></div><div class="line"><span style="color:#F8F8F2">            }</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#8BE9FD">SqlQuery</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Insert</span><span style="color:#F8F8F2">(insert) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Some</span><span style="color:#F8F8F2">(table) </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">tables</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">get_mut</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">insert</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">table) </span><span style="color:#FF79C6">else</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">                    </span><span style="color:#FF79C6">return</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Err</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">QueryExecutionError</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">TableNotFound</span><span style="color:#F8F8F2">(insert</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">table))</span></div><div class="line"><span style="color:#F8F8F2">                };</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">                table</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">insert</span><span style="color:#F8F8F2">(insert</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">values);</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#8BE9FD">Ok</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">ExecResponse</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Insert</span><span style="color:#F8F8F2">)</span></div><div class="line"><span style="color:#F8F8F2">            }</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#8BE9FD">SqlQuery</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Create</span><span style="color:#F8F8F2">(create) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> table </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Table</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">(create</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">columns);</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#BD93F9">self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">tables</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">insert</span><span style="color:#F8F8F2">(create</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">table, table);</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#8BE9FD">Ok</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">ExecResponse</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Create</span><span style="color:#F8F8F2">)</span></div><div class="line"><span style="color:#F8F8F2">            }</span></div><div class="line"><span style="color:#F8F8F2">        }</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>Since we handled most of the logic in the <code>Table</code>/<code>Row</code> structs, the actual execution is mostly just wrapper around the <code>HashMap</code> of tables with some basic error handling.</p>
<h2 id="brining-it-all-together"><a href="#brining-it-all-together" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Brining it all together</h2>
<p>With the <code>Execution</code> struct we can handle the parsed commands from our parser but right now we don&#x27;t have it all hooked up.
We need to unify the parser and execution into one.</p>
<p>Ideally we would have some new crate for the full &quot;pipeline&quot; from parsing to execution (and probably more steps we will add later), but for now having this logic in the <code>Execution</code> crate feels fine.</p>
<p>First step is to combine the Error types from Parsing and Execution</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">use</span><span style="color:#F8F8F2"> miette</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Diagnostic</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#FF79C6">use</span><span style="color:#F8F8F2"> sql_jr_parser</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">error</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">FormattedError</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#FF79C6">use</span><span style="color:#F8F8F2"> thiserror</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Error</span><span style="color:#F8F8F2">;</span></div><div class="line"></div><div class="line"><span style="color:#6272A4">/// Errors at any point in the SQL &quot;pipeline&quot;</span></div><div class="line"><span style="color:#F8F8F2">#[derive(</span><span style="color:#8BE9FD">Error</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Debug</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Diagnostic</span><span style="color:#F8F8F2">)]</span></div><div class="line"><span style="color:#F8F8F2">#[error(transparent)]</span></div><div class="line"><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">enum</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">SQLError</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt; {</span></div><div class="line"><span style="color:#F8F8F2">    #[diagnostic(transparent)]</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">QueryExecutionError</span><span style="color:#F8F8F2">(#[from] </span><span style="color:#8BE9FD">QueryExecutionError</span><span style="color:#F8F8F2">),</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">    #[diagnostic(transparent)]</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#50FA7B">ParsingError</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">FormattedError</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt;),</span></div><div class="line"><span style="color:#F8F8F2">}</span></div><div class="line"></div><div class="line"><span style="color:#6272A4">// need a manual impl since the error #[from] seems sad on lifetimes</span></div><div class="line"><span style="color:#FF79C6">impl</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt; </span><span style="color:#8BE9FD">From</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">FormattedError</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt;&gt; </span><span style="color:#FF79C6">for</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">SQLError</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt; {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">from</span><span style="color:#F8F8F2">(value</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">FormattedError</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt;) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">Self</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#8BE9FD">SQLError</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">ParsingError</span><span style="color:#F8F8F2">(value)</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>Here <code>#[diagnostic(transparent)]</code> is similar to <code>#[error(transparent)]</code> in <code>thiserror</code>, it lets you wrap other errors but still call their <code>Display</code> trait when the error is shown.</p>
<p>Now we can have a function that parses and executes the query</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">impl</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Execution</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">   </span><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">parse_and_run</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt;(</span><span style="color:#FF79C6">&amp;mut</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">self</span><span style="color:#F8F8F2">, query</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">str</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Result</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">ExecResponse</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">SQLError</span><span style="color:#F8F8F2">&lt;&#x27;</span><span style="color:#8BE9FD">a</span><span style="color:#F8F8F2">&gt;&gt; {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> query </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">parse_sql_query</span><span style="color:#F8F8F2">(query)</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> res </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">self</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">run</span><span style="color:#F8F8F2">(query)</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#8BE9FD">Ok</span><span style="color:#F8F8F2">(res)</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>Which lets our REPL now look like</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">main</span><span style="color:#F8F8F2">() {</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#FF79C6">...</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">mut</span><span style="color:#F8F8F2"> exec </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> sql_jr_execution</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Execution</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">();</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#FF79C6">loop</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> readline </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> rl</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">readline</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;&gt;&gt; &quot;</span><span style="color:#F8F8F2">);</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#FF79C6">match</span><span style="color:#F8F8F2"> readline {</span></div><div class="line"><span style="color:#F8F8F2">          </span><span style="color:#8BE9FD">Ok</span><span style="color:#F8F8F2">(line) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">                rl</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">add_history_entry</span><span style="color:#F8F8F2">(line</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">as_str</span><span style="color:#F8F8F2">());</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> line</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">&amp;</span><span style="color:#8BE9FD">str</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> line</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">as_ref</span><span style="color:#F8F8F2">();</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> res </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> exec</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">parse_and_run</span><span style="color:#F8F8F2">(line);</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">match</span><span style="color:#F8F8F2"> res {</span></div><div class="line"><span style="color:#F8F8F2">                    </span><span style="color:#8BE9FD">Ok</span><span style="color:#F8F8F2">(exec_res) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">println!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;{exec_res}&quot;</span><span style="color:#F8F8F2">),</span></div><div class="line"><span style="color:#F8F8F2">                    </span><span style="color:#8BE9FD">Err</span><span style="color:#F8F8F2">(e) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">                        </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">mut</span><span style="color:#F8F8F2"> s </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">String</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">();</span></div><div class="line"><span style="color:#F8F8F2">                        </span><span style="color:#8BE9FD">GraphicalReportHandler</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">()</span></div><div class="line"><span style="color:#F8F8F2">                            </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">with_cause_chain</span><span style="color:#F8F8F2">()</span></div><div class="line"><span style="color:#F8F8F2">                            </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">with_context_lines</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">10</span><span style="color:#F8F8F2">)</span></div><div class="line"><span style="color:#F8F8F2">                            </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">render_report</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;mut</span><span style="color:#F8F8F2"> s, </span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">e)</span></div><div class="line"><span style="color:#F8F8F2">                            </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">unwrap</span><span style="color:#F8F8F2">();</span></div><div class="line"><span style="color:#F8F8F2">                        </span><span style="color:#50FA7B">println!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;{s}&quot;</span><span style="color:#F8F8F2">);</span></div><div class="line"><span style="color:#F8F8F2">                    }</span></div><div class="line"><span style="color:#F8F8F2">                }</span></div><div class="line"><span style="color:#F8F8F2">            }</span></div><div class="line"><span style="color:#6272A4">          // other cases unchanged from part 1</span></div><div class="line"><span style="color:#F8F8F2">        }</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>The happy path in our REPL now looks like</p>
<div class="relative"><pre class="shiki dracula"><div class="code-container"><code><div class="line"><span style="color:undefined">&gt;&gt; create table foo (col1 string, col2 string);
Create
&gt;&gt; insert into foo values a,b;
Insert
&gt;&gt; select col1,col2 from foo;
[Row { id: 0, columns: [Column { name: &quot;col1&quot;, type_info: String }, Column { name: &quot;col2&quot;, type_info: String }], data: {&quot;col1&quot;: &quot;a&quot;, &quot;col2&quot;: &quot;b&quot;} }]
&gt;&gt;</span></div></code></div></pre></div>
<h2 id="better-display-for-repl"><a href="#better-display-for-repl" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Better display for REPL</h2>
<p>The REPL works, but the display for select queries is pretty gross. We can use the <a target="_blank" rel="noopener noreferrer" href="https://github.com/zhiburt/tabled">tabled crate</a> to format the response as a table. We can run <code>cargo add tabled</code> in <code>crates/sql_jr_repl</code> to add the crate to the repl.</p>
<p>If you look at the docs for <code>tabled</code> many of the first examples involve the <code>#[derive(Tabled)]</code> macro on your structs/enums. This does not really work for select queries since the columns are dynamic. Tabled still supports this with the <a target="_blank" rel="noopener noreferrer" href="https://docs.rs/tabled/0.10.0/tabled/builder/struct.Builder.html">builder</a> to allow us to set the rows + columns dynamically.</p>
<p>Let&#x27;s add a new file to the REPL crate and handle display there</p>
<div class="remark-code-title">crates/sql_jr_repl/display.rs</div>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">display_response</span><span style="color:#F8F8F2">(res</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">ExecResponse</span><span style="color:#F8F8F2">) {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">match</span><span style="color:#F8F8F2"> res {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#8BE9FD">ExecResponse</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Select</span><span style="color:#F8F8F2">(rows) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">mut</span><span style="color:#F8F8F2"> builder </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Builder</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">default</span><span style="color:#F8F8F2">();</span></div><div class="line"></div><div class="line"><span style="color:#6272A4">            // Get column info from the first row</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> row </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> rows</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">get</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">expect</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;For now assuming we get data back&quot;</span><span style="color:#F8F8F2">);</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> columns</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Vec</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">String</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> row</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">columns</span><span style="color:#F8F8F2">()</span><span style="color:#6272A4"> // added helper, see below</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">iter</span><span style="color:#F8F8F2">()</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">map</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2">col</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2"> col</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">name</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">to_string</span><span style="color:#F8F8F2">())</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">collect</span><span style="color:#F8F8F2">();</span></div><div class="line"><span style="color:#F8F8F2">            builder</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">set_columns</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">columns);</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#FF79C6">for</span><span style="color:#F8F8F2"> row </span><span style="color:#FF79C6">in</span><span style="color:#F8F8F2"> rows</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">into_iter</span><span style="color:#F8F8F2">() {</span></div><div class="line"><span style="color:#F8F8F2">                builder</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">add_record</span><span style="color:#F8F8F2">(columns</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">iter</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">map</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2">col</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2"> row</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">get</span><span style="color:#F8F8F2">(col)));</span><span style="color:#6272A4"> // added a get helper, see below</span></div><div class="line"><span style="color:#F8F8F2">            }</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#50FA7B">println!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;{}&quot;</span><span style="color:#F8F8F2">, builder</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">build</span><span style="color:#F8F8F2">())</span></div><div class="line"><span style="color:#F8F8F2">        }</span></div><div class="line"><span style="color:#F8F8F2">        _ </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">println!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;{res}&quot;</span><span style="color:#F8F8F2">),</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>as noted in a comment I added these helpers to the row struct to make column lookup easier</p>
<div class="remark-code-title">crates/sql_jr_execution/row.rs</div>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">impl</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Row</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">     </span><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">columns</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#BD93F9">self</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">&amp;</span><span style="color:#8BE9FD">ColumnInfo</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#BD93F9">self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">columns</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">as_ref</span><span style="color:#F8F8F2">()</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"></div><div class="line"><span style="color:#6272A4">    /// Get a single value from the row</span></div><div class="line"><span style="color:#6272A4">    ///</span></div><div class="line"><span style="color:#6272A4">    /// # Panics</span></div><div class="line"><span style="color:#6272A4">    ///</span></div><div class="line"><span style="color:#6272A4">    /// Panics if the column does not exist</span></div><div class="line"><span style="color:#6272A4">    /// See [`try_get`](Self::try_get) for a non-panicking</span></div><div class="line"><span style="color:#6272A4">    /// version.</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">get</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#BD93F9">self</span><span style="color:#F8F8F2">, column</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">&amp;</span><span style="color:#8BE9FD">String</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">String</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#BD93F9">self</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">try_get</span><span style="color:#F8F8F2">(column)</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">unwrap</span><span style="color:#F8F8F2">()</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"></div><div class="line"><span style="color:#6272A4">    /// Get a single value from the row</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">try_get</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#BD93F9">self</span><span style="color:#F8F8F2">, column</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">&amp;</span><span style="color:#8BE9FD">String</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Result</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">String</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">QueryExecutionError</span><span style="color:#F8F8F2">&gt; {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#BD93F9">self</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">data</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">get</span><span style="color:#F8F8F2">(column)</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">map_or_else</span><span style="color:#F8F8F2">(</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#FF79C6">||</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Err</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">QueryExecutionError</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">ColumnDoesNotExist</span><span style="color:#F8F8F2">(column</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">to_owned</span><span style="color:#F8F8F2">())),</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2">val</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Ok</span><span style="color:#F8F8F2">(val</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">to_string</span><span style="color:#F8F8F2">()),</span></div><div class="line"><span style="color:#F8F8F2">        )</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>now the REPL from the example above would show</p>
<div class="relative"><pre class="shiki dracula"><div class="code-container"><code><div class="line"><span style="color:undefined">&gt;&gt; select col1,col2 from foo;
+------+------+
| col1 | col2 |
+------+------+
| a    | b    |
+------+------+</span></div></code></div></pre></div>
<p><code>tabled</code> has many <a target="_blank" rel="noopener noreferrer" href="https://github.com/zhiburt/tabled#style">style options</a> if we wanted to tweak the look, but this is fine for now.</p>
<p>You probably noticed the line</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#6272A4">//Get column info from the first row</span></div><div class="line"><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> row </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> rows</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">get</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">0</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">expect</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;For now assuming we get data back&quot;</span><span style="color:#F8F8F2">);</span></div></code></div></pre></div>
<p>in our display function. This obviously would get sad on empty responses. The best decision would be to add/move <code>ColumnInfo</code> into <code>ExecResponse::Select</code>, so we return something like</p>
<div class="relative"><pre class="shiki dracula"><div class="code-container"><code><div class="line"><span style="color:undefined">{columns: Rc&lt;ColumnInfo&gt;, row: Vec&lt;Row&gt;}</span></div></code></div></pre></div>
<p>but I&#x27;ll save that for the next post.</p>
<h2 id="wrap-up"><a href="#wrap-up" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Wrap up</h2>
<p>Having basic execution feels nice, but the real challenge will be actually filtering and projecting the data. We some extra clones and <code>unwraps</code>/<code>expects</code> we need to handle once we start moving away from this extremely simple happy path but so far the high level design feels good!</p></div></div></div></div></article></div></main><footer><div class="flex flex-col items-center mt-16"><div class="flex mb-3 space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer me" href="https://github.com/JRMurr"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer me" href="https://twitter.com/JRMurrCodes"><span class="sr-only">twitter</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M23.953 4.57a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.06a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.936 4.936 0 0 0 4.604 3.417 9.867 9.867 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0 0 24 4.59z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer me" href="https://hachyderm.io/@jrmurr"><span class="sr-only">mastodon</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-8 w-8"><path d="M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer me" href="/feed.xml"><span class="sr-only">rss</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24.912 24.912" style="enable-background:new 0 0 24.912 24.912" xml:space="preserve" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M3.692 17.517A3.696 3.696 0 0 0 0 21.211C0 23.244 1.656 24.9 3.692 24.9s3.694-1.657 3.694-3.689a3.697 3.697 0 0 0-3.694-3.694z"></path><path d="M.384 8.142A.386.386 0 0 0 0 8.527v4.688c0 .211.173.383.384.383 6.02 0 10.919 4.898 10.919 10.92 0 .209.171.383.384.383h4.705a.385.385 0 0 0 .387-.383l-.018-.121C16.692 15.423 9.37 8.142.384 8.142z"></path><path d="M24.89 24.397C24.825 10.936 13.854.011.384.011A.385.385 0 0 0 0 .397v4.824c0 .212.173.383.384.383 10.429 0 18.913 8.486 18.913 18.914 0 .209.172.383.382.383h4.845a.39.39 0 0 0 .388-.383l-.022-.121z"></path></svg></a></div><div class="flex mb-2 space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>John Murray</div><div> • </div><div>© 2023</div><div> • </div><a href="/">John&#x27;s Codes</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var d=Object.create;var c=Object.defineProperty;var t=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,y=Object.prototype.hasOwnProperty;var i=n=\u003ec(n,\"__esModule\",{value:!0});var m=(n,s)=\u003e()=\u003e(s||n((s={exports:{}}).exports,s),s.exports),u=(n,s)=\u003e{i(n);for(var r in s)c(n,r,{get:s[r],enumerable:!0})},N=(n,s,r)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let e of h(s))!y.call(n,e)\u0026\u0026e!==\"default\"\u0026\u0026c(n,e,{get:()=\u003es[e],enumerable:!(r=t(s,e))||r.enumerable});return n},C=n=\u003eN(i(c(n!=null?d(p(n)):{},\"default\",n\u0026\u0026n.__esModule\u0026\u0026\"default\"in n?{get:()=\u003en.default,enumerable:!0}:{value:n,enumerable:!0})),n);var F=m((w,a)=\u003e{a.exports=_jsx_runtime});var E={};u(E,{default:()=\u003eg,frontmatter:()=\u003ev});var l=C(F()),v={title:\"Building a Simple DB in Rust - Part 2 - Basic Execution\",seriesTitle:\"Part 2 - Basic Execution\",date:new Date(1674482482231),tags:[\"rust\",\"database\"],draft:!1,summary:\"Building a basic database in rust\",images:[],layout:\"PostLayout\"};function B(n={}){let{wrapper:s}=n.components||{};return s?(0,l.jsx)(s,Object.assign({},n,{children:(0,l.jsx)(r,{})})):r();function r(){let e=Object.assign({h1:\"h1\",a:\"a\",span:\"span\",p:\"p\",code:\"code\",pre:\"pre\",div:\"div\",h3:\"h3\",em:\"em\",blockquote:\"blockquote\",ul:\"ul\",li:\"li\",img:\"img\",math:\"math\",semantics:\"semantics\",mrow:\"mrow\",mo:\"mo\",mn:\"mn\",annotation:\"annotation\",mi:\"mi\",msub:\"msub\",h2:\"h2\"},n.components),{TOCInline:o}=e;return o||f(\"TOCInline\",!0),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o,{toc:n.toc,asDisclosure:!0}),`\n`,(0,l.jsxs)(e.h1,{id:\"feedback-from-part-1\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#feedback-from-part-1\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Feedback from part 1\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"I got some very nice feedback from the \",(0,l.jsx)(e.a,{href:\"/blog/build-a-db/part01\",children:\"first part of this series\"}),\". The main suggestions where to use some different parsing libraries like \",(0,l.jsx)(e.a,{href:\"https://docs.rs/chumsky/latest/chumsky/\",children:\"chumsky\"}),\" or use an existing SQL parser like \",(0,l.jsx)(e.a,{href:\"https://github.com/sqlparser-rs/sqlparser-rs\",children:\"sqlparser-rs\"}),\".\"]}),`\n`,(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:\"chumsky\"}),\" looks like it handles a lot of the error handling logic I had to do myself while still being defined in rust (no extra language). If I had known of this before I would have used it. Might switch to it later on if our grammar gets more involved. Thanks \",(0,l.jsx)(e.a,{href:\"https://hachyderm.io/@hjvt/109620348134117972\",children:\"@hjvt@hachyderm.io\"}),\" for the recommendation!\"]}),`\n`,(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:\"sqlparser-rs\"}),\" on the other hand looks very well maintained and handles many existing SQL dialects. If this was not a toy project I would have probably started off with this to get going faster without writing any parser logic.\"]}),`\n`,(0,l.jsx)(e.p,{children:\"Enough feedback, let's get into actually running queries.\"}),`\n`,(0,l.jsxs)(e.h1,{id:\"execution\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#execution\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Execution\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"To get started on execution let's make a new crate for it with \",(0,l.jsx)(e.code,{children:\"cargo new sql_jr_execution\"}),\". We will need the parser crate for our types we made and some other workspace dependencies.\"]}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"sql_jr_execution/Cargo.toml\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"toml\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"[\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"package\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"]\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"name\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"sql_jr_execution\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"version\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"0.1.0\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"edition\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"2021\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"[\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"dependencies\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"]\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"miette\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"workspace\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"true\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"serde\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"workspace\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"true\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"sql_jr_parser\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"path\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"../sql_jr_parser\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" }\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"thiserror\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"workspace\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"true\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})]})]})})]}),`\n`,(0,l.jsx)(e.p,{children:\"Since we will need to operate on tables, lets start by defining our table type. For now, we will only deal with in memory execution. Soon enough we can handle reading from disk.\"}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"table.rs\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"use\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" std\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"collections\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"{\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"BTreeMap\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"HashMap\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"};\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"use\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" serde\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"{\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Deserialize\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Serialize\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"};\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"use\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" sql_jr_parser\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Column\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\" // See part 1 for this type def. Just column name and sql data type (string or int)\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"// NOTE: For now just a mapping of col name =\u003e data as a str. Will change later\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"/// A row stored in a table\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"type\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"StoredRow\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"HashMap\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e;\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"/// List of column info\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"type\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ColumnInfo\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Vec\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Column\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e;\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"#[derive(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Debug\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Clone\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Default\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Serialize\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Deserialize\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")]\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"crate\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"struct\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Table\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"    /// row id to row\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    rows\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"BTreeMap\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"usize\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"StoredRow\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e,\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"    /// Column info for all columns in the table\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    columns\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ColumnInfo\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"The \",(0,l.jsx)(e.code,{children:\"Table\"}),\" struct is basically just a wrapper around Rust's \",(0,l.jsx)(e.a,{href:\"https://doc.rust-lang.org/stable/std/collections/struct.BTreeMap.html#\",children:\"Btree\"}),\" with some extra column info.\"]}),`\n`,(0,l.jsxs)(e.h3,{id:\"what-is-a-b-tree\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#what-is-a-b-tree\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"What is a B-Tree?\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"A \",(0,l.jsx)(e.a,{href:\"https://en.wikipedia.org/wiki/B-tree\",children:\"B-Tree\"}),' is a generalized Binary Search Tree (BST). BSTs are great in theory but in practice they kinda suck for cache locality, nodes only store 1 piece of data, has the potential to be unbalanced, and requires a heap allocation for each insertion. In \"current year\" CPUs are insanely fast, so we need data structures that are better for reducing memory access.']}),`\n`,(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.em,{children:\"insert rant about why data oriented design is GOATED here\"}),\".\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Alexis Beingessner in \",(0,l.jsx)(e.a,{href:\"https://cglab.ca/~abeinges/blah/rust-btree-case/#what's-a-b-tree?-why's-a-b-tree?\",children:\"Rust Collections Case Study: BTreeMap\"}),\" described B-Trees as\"]}),`\n`,(0,l.jsxs)(e.blockquote,{children:[`\n`,(0,l.jsx)(e.p,{children:'B-Trees take the idea of a BST, and say \"lets put some arrays in there; computers love arrays\". Rather than each node consisting of a single element with two children, B-Tree nodes have an array of elements with an array of children'}),`\n`]}),`\n`,(0,l.jsx)(e.p,{children:\"I won't go into too much detail on B-Tree implementation, since I'm just using rust's built in for now. If you're intersted here are some good resources on B-Trees.\"}),`\n`,(0,l.jsxs)(e.ul,{children:[`\n`,(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:\"https://cglab.ca/~abeinges/blah/rust-btree-case\",children:\"Rust Collections Case Study: BTreeMap\"})}),`\n`,(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:\"https://en.wikipedia.org/wiki/B-tree\",children:\"Wikipedia\"})}),`\n`,(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:\"http://opendatastructures.org/ods-python/14_2_B_Trees.html\",children:\"Open Datastructures\"})}),`\n`]}),`\n`,(0,l.jsx)(e.p,{children:\"With that said, let's walk through a basic example\"}),`\n`,(0,l.jsx)(e.p,{children:(0,l.jsx)(e.img,{src:\"https://upload.wikimedia.org/wikipedia/commons/6/65/B-tree.svg\",alt:\"B-Tree example\"})}),`\n`,(0,l.jsxs)(e.p,{children:[\"Here the internal node (the root) has 3 children. All keys \",(0,l.jsx)(e.span,{className:\"math math-inline\",children:(0,l.jsxs)(e.span,{className:\"katex\",children:[(0,l.jsx)(e.span,{className:\"katex-mathml\",children:(0,l.jsx)(e.math,{xmlns:\"http://www.w3.org/1998/Math/MathML\",children:(0,l.jsxs)(e.semantics,{children:[(0,l.jsxs)(e.mrow,{children:[(0,l.jsx)(e.mo,{children:\"\u003c\"}),(0,l.jsx)(e.mn,{children:\"7\"})]}),(0,l.jsx)(e.annotation,{encoding:\"application/x-tex\",children:\"\u003c 7\"})]})})}),(0,l.jsxs)(e.span,{className:\"katex-html\",\"aria-hidden\":\"true\",children:[(0,l.jsxs)(e.span,{className:\"base\",children:[(0,l.jsx)(e.span,{className:\"strut\",style:{height:\"0.5782em\",verticalAlign:\"-0.0391em\"}}),(0,l.jsx)(e.span,{className:\"mrel\",children:\"\u003c\"}),(0,l.jsx)(e.span,{className:\"mspace\",style:{marginRight:\"0.2778em\"}})]}),(0,l.jsxs)(e.span,{className:\"base\",children:[(0,l.jsx)(e.span,{className:\"strut\",style:{height:\"0.6444em\"}}),(0,l.jsx)(e.span,{className:\"mord\",children:\"7\"})]})]})]})}),\" are in the left child, keys \",(0,l.jsx)(e.span,{className:\"math math-inline\",children:(0,l.jsxs)(e.span,{className:\"katex\",children:[(0,l.jsx)(e.span,{className:\"katex-mathml\",children:(0,l.jsx)(e.math,{xmlns:\"http://www.w3.org/1998/Math/MathML\",children:(0,l.jsxs)(e.semantics,{children:[(0,l.jsxs)(e.mrow,{children:[(0,l.jsx)(e.mo,{children:\"\u003e\"}),(0,l.jsx)(e.mn,{children:\"7\"})]}),(0,l.jsx)(e.annotation,{encoding:\"application/x-tex\",children:\"\u003e 7\"})]})})}),(0,l.jsxs)(e.span,{className:\"katex-html\",\"aria-hidden\":\"true\",children:[(0,l.jsxs)(e.span,{className:\"base\",children:[(0,l.jsx)(e.span,{className:\"strut\",style:{height:\"0.5782em\",verticalAlign:\"-0.0391em\"}}),(0,l.jsx)(e.span,{className:\"mrel\",children:\"\u003e\"}),(0,l.jsx)(e.span,{className:\"mspace\",style:{marginRight:\"0.2778em\"}})]}),(0,l.jsxs)(e.span,{className:\"base\",children:[(0,l.jsx)(e.span,{className:\"strut\",style:{height:\"0.6444em\"}}),(0,l.jsx)(e.span,{className:\"mord\",children:\"7\"})]})]})]})}),\" and \",(0,l.jsx)(e.span,{className:\"math math-inline\",children:(0,l.jsxs)(e.span,{className:\"katex\",children:[(0,l.jsx)(e.span,{className:\"katex-mathml\",children:(0,l.jsx)(e.math,{xmlns:\"http://www.w3.org/1998/Math/MathML\",children:(0,l.jsxs)(e.semantics,{children:[(0,l.jsxs)(e.mrow,{children:[(0,l.jsx)(e.mo,{children:\"\u003c\"}),(0,l.jsx)(e.mo,{children:\"=\"}),(0,l.jsx)(e.mn,{children:\"16\"})]}),(0,l.jsx)(e.annotation,{encoding:\"application/x-tex\",children:\"\u003c= 16\"})]})})}),(0,l.jsxs)(e.span,{className:\"katex-html\",\"aria-hidden\":\"true\",children:[(0,l.jsxs)(e.span,{className:\"base\",children:[(0,l.jsx)(e.span,{className:\"strut\",style:{height:\"0.5782em\",verticalAlign:\"-0.0391em\"}}),(0,l.jsx)(e.span,{className:\"mrel\",children:\"\u003c=\"}),(0,l.jsx)(e.span,{className:\"mspace\",style:{marginRight:\"0.2778em\"}})]}),(0,l.jsxs)(e.span,{className:\"base\",children:[(0,l.jsx)(e.span,{className:\"strut\",style:{height:\"0.6444em\"}}),(0,l.jsx)(e.span,{className:\"mord\",children:\"16\"})]})]})]})}),\" are in the middle, and finally keys \",(0,l.jsx)(e.span,{className:\"math math-inline\",children:(0,l.jsxs)(e.span,{className:\"katex\",children:[(0,l.jsx)(e.span,{className:\"katex-mathml\",children:(0,l.jsx)(e.math,{xmlns:\"http://www.w3.org/1998/Math/MathML\",children:(0,l.jsxs)(e.semantics,{children:[(0,l.jsxs)(e.mrow,{children:[(0,l.jsx)(e.mo,{children:\"\u003e\"}),(0,l.jsx)(e.mn,{children:\"16\"})]}),(0,l.jsx)(e.annotation,{encoding:\"application/x-tex\",children:\"\u003e 16\"})]})})}),(0,l.jsxs)(e.span,{className:\"katex-html\",\"aria-hidden\":\"true\",children:[(0,l.jsxs)(e.span,{className:\"base\",children:[(0,l.jsx)(e.span,{className:\"strut\",style:{height:\"0.5782em\",verticalAlign:\"-0.0391em\"}}),(0,l.jsx)(e.span,{className:\"mrel\",children:\"\u003e\"}),(0,l.jsx)(e.span,{className:\"mspace\",style:{marginRight:\"0.2778em\"}})]}),(0,l.jsxs)(e.span,{className:\"base\",children:[(0,l.jsx)(e.span,{className:\"strut\",style:{height:\"0.6444em\"}}),(0,l.jsx)(e.span,{className:\"mord\",children:\"16\"})]})]})]})}),\" are in the right child.\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"You can customize the \",(0,l.jsx)(e.span,{className:\"math math-inline\",children:(0,l.jsxs)(e.span,{className:\"katex\",children:[(0,l.jsx)(e.span,{className:\"katex-mathml\",children:(0,l.jsx)(e.math,{xmlns:\"http://www.w3.org/1998/Math/MathML\",children:(0,l.jsxs)(e.semantics,{children:[(0,l.jsx)(e.mrow,{children:(0,l.jsx)(e.mi,{children:\"B\"})}),(0,l.jsx)(e.annotation,{encoding:\"application/x-tex\",children:\"B\"})]})})}),(0,l.jsx)(e.span,{className:\"katex-html\",\"aria-hidden\":\"true\",children:(0,l.jsxs)(e.span,{className:\"base\",children:[(0,l.jsx)(e.span,{className:\"strut\",style:{height:\"0.6833em\"}}),(0,l.jsx)(e.span,{className:\"mord mathnormal\",style:{marginRight:\"0.05017em\"},children:\"B\"})]})})]})}),\" constant to have nodes store more/fewer keys and have more/fewer children. Average Lookup for a B-tree with \",(0,l.jsx)(e.span,{className:\"math math-inline\",children:(0,l.jsxs)(e.span,{className:\"katex\",children:[(0,l.jsx)(e.span,{className:\"katex-mathml\",children:(0,l.jsx)(e.math,{xmlns:\"http://www.w3.org/1998/Math/MathML\",children:(0,l.jsxs)(e.semantics,{children:[(0,l.jsx)(e.mrow,{children:(0,l.jsx)(e.mi,{children:\"N\"})}),(0,l.jsx)(e.annotation,{encoding:\"application/x-tex\",children:\"N\"})]})})}),(0,l.jsx)(e.span,{className:\"katex-html\",\"aria-hidden\":\"true\",children:(0,l.jsxs)(e.span,{className:\"base\",children:[(0,l.jsx)(e.span,{className:\"strut\",style:{height:\"0.6833em\"}}),(0,l.jsx)(e.span,{className:\"mord mathnormal\",style:{marginRight:\"0.10903em\"},children:\"N\"})]})})]})}),\" keys is \",(0,l.jsx)(e.span,{className:\"math math-inline\",children:(0,l.jsxs)(e.span,{className:\"katex\",children:[(0,l.jsx)(e.span,{className:\"katex-mathml\",children:(0,l.jsx)(e.math,{xmlns:\"http://www.w3.org/1998/Math/MathML\",children:(0,l.jsxs)(e.semantics,{children:[(0,l.jsxs)(e.mrow,{children:[(0,l.jsx)(e.mi,{mathvariant:\"script\",children:\"O\"}),(0,l.jsx)(e.mo,{stretchy:\"false\",children:\"(\"}),(0,l.jsx)(e.mi,{children:\"log\"}),(0,l.jsx)(e.mo,{children:\"\\u2061\"}),(0,l.jsxs)(e.msub,{children:[(0,l.jsx)(e.mrow,{}),(0,l.jsx)(e.mn,{children:\"2\"})]}),(0,l.jsx)(e.mi,{children:\"N\"}),(0,l.jsx)(e.mo,{stretchy:\"false\",children:\")\"})]}),(0,l.jsx)(e.annotation,{encoding:\"application/x-tex\",children:\"\\\\mathcal{O}(\\\\log{_2}N)\"})]})})}),(0,l.jsx)(e.span,{className:\"katex-html\",\"aria-hidden\":\"true\",children:(0,l.jsxs)(e.span,{className:\"base\",children:[(0,l.jsx)(e.span,{className:\"strut\",style:{height:\"1em\",verticalAlign:\"-0.25em\"}}),(0,l.jsx)(e.span,{className:\"mord mathcal\",style:{marginRight:\"0.02778em\"},children:\"O\"}),(0,l.jsx)(e.span,{className:\"mopen\",children:\"(\"}),(0,l.jsxs)(e.span,{className:\"mop\",children:[\"lo\",(0,l.jsx)(e.span,{style:{marginRight:\"0.01389em\"},children:\"g\"})]}),(0,l.jsx)(e.span,{className:\"mspace\",style:{marginRight:\"0.1667em\"}}),(0,l.jsx)(e.span,{className:\"mord\",children:(0,l.jsxs)(e.span,{className:\"mord\",children:[(0,l.jsx)(e.span,{}),(0,l.jsx)(e.span,{className:\"msupsub\",children:(0,l.jsxs)(e.span,{className:\"vlist-t vlist-t2\",children:[(0,l.jsxs)(e.span,{className:\"vlist-r\",children:[(0,l.jsx)(e.span,{className:\"vlist\",style:{height:\"0.3011em\"},children:(0,l.jsxs)(e.span,{style:{top:\"-2.55em\",marginRight:\"0.05em\"},children:[(0,l.jsx)(e.span,{className:\"pstrut\",style:{height:\"2.7em\"}}),(0,l.jsx)(e.span,{className:\"sizing reset-size6 size3 mtight\",children:(0,l.jsx)(e.span,{className:\"mord mtight\",children:\"2\"})})]})}),(0,l.jsx)(e.span,{className:\"vlist-s\",children:\"\\u200B\"})]}),(0,l.jsx)(e.span,{className:\"vlist-r\",children:(0,l.jsx)(e.span,{className:\"vlist\",style:{height:\"0.15em\"},children:(0,l.jsx)(e.span,{})})})]})})]})}),(0,l.jsx)(e.span,{className:\"mord mathnormal\",style:{marginRight:\"0.10903em\"},children:\"N\"}),(0,l.jsx)(e.span,{className:\"mclose\",children:\")\"})]})})]})}),\" which is the same for a BST.\"]}),`\n`,(0,l.jsxs)(e.h3,{id:\"why-b-tree\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#why-b-tree\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Why B-Tree?\"]}),`\n`,(0,l.jsx)(e.p,{children:\"Like a mentioned before B-Trees are great for cache locality. Also, you can make each node be the size of a memory/disk block. This way you can minimize reads by chunking up the data more efficiently.\"}),`\n`,(0,l.jsxs)(e.h2,{id:\"actually-do-stuff\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#actually-do-stuff\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Actually do stuff\"]}),`\n`,(0,l.jsx)(e.p,{children:\"Nerd stuff aside, let's actually add actual logic for our table\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"impl\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Table\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"    // Create a table with the given column definitions\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(columns\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Vec\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Column\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"Self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"Self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            rows\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"BTreeMap\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(),\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            columns,\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"    /// Insert values (a row) into the table\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"    ///\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"    /// assumes the values are in the same order of the columns passed to create\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"insert\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026mut\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", values\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Vec\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e) {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" id \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"rows\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"last_key_value\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"map_or\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"0\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(max_id, _)\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" max_id \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"+\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"1\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\");\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" row\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"StoredRow\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" values\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"into_iter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"zip\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"columns\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"iter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"())\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"map\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(v, col)\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" (col\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"name\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"to_owned\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(), v))\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"collect\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"();\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"rows\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"insert\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(id, row);\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsx)(e.p,{children:\"Here we create a table with the given column definitions (from the create table sql command). For insert, we get an ID for the new row which is just an ID sequence starting at 0 for the first row. We then insert the values into the B-TreeMap with that ID as the key and the row's values as a hash map of column name to a string of the value to insert.\"}),`\n`,(0,l.jsxs)(e.p,{children:[\"Those two functions can handle creating tables (mostly) and inserting data, but how should we handle select? A simple first step is to re-use the \",(0,l.jsx)(e.a,{href:\"https://doc.rust-lang.org/std/iter/trait.Iterator.html\",children:\"Iterator\"}),\" on \",(0,l.jsx)(e.a,{href:\"https://doc.rust-lang.org/std/collections/struct.BTreeMap.html#method.iter\",children:\"BTreeMap\"}),\".\"]}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"impl\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Table\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"iter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" std\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"collections\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"btree_map\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Iter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"usize\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Row\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"rows\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"iter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"This will give us an \",(0,l.jsx)(e.code,{children:\"Iterator\"}),\" over \",(0,l.jsx)(e.code,{children:\"(row_id, row_values)\"}),\".\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Re-using the iterator from BTreeMap is fine, but I like how many Rust DB libraries have a \",(0,l.jsx)(e.code,{children:\"Row\"}),\" trait/struct that gives you extra information. For example \",(0,l.jsx)(e.a,{href:\"https://github.com/launchbadge/sqlx\",children:\"SQLX\"}),\" has a \",(0,l.jsx)(e.a,{href:\"https://docs.rs/sqlx/latest/sqlx/trait.Row.html\",children:\"Row trait\"}),\" lets you get column info back for the query you ran, safe/unsafe conversions into rust types, and a few other helpers. So let's make our own \",(0,l.jsx)(e.code,{children:\"Row\"}),\" struct and iterator, so we can add these features later on.\"]}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"use\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" std\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"{collections\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"HashMap\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", rc\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Rc\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"};\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"use\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"crate::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"table\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ColumnInfo\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\" // Vec\u003cColumn\u003e\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"/// A Row in a Query response\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"#[derive(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Debug\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Clone\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")]\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"struct\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Row\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    id\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"usize\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    columns\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Rc\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ColumnInfo\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e,\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    data\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"HashMap\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e,\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Here I made the decision that this \",(0,l.jsx)(e.code,{children:\"Row\"}),\" struct will not own the data its showing. Therefore, it needs a reference to the data stored in the table. I also want to have the row have access to the \",(0,l.jsx)(e.code,{children:\"ColumnInfo\"}),\" from the table. Since every row will be holding a reference to the same \",(0,l.jsx)(e.code,{children:\"ColumnInfo\"}),\", I went with an \",(0,l.jsx)(e.a,{href:\"https://doc.rust-lang.org/std/rc/index.html\",children:\"RC\"}),\" to avoid extra lifetime parameters on the row struct.\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Now we can make our own \",(0,l.jsx)(e.code,{children:\"Iterator\"}),\" for table. We can just wrap the existing \",(0,l.jsx)(e.code,{children:\"Iterator\"}),\" from \",(0,l.jsx)(e.code,{children:\"BTreeMap\"}),\" and transform each response into our \",(0,l.jsx)(e.code,{children:\"Row\"}),\" struct.\"]}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"/// Iterator of [`Row`]s from a table\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"crate\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"struct\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"TableIter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e {\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"    /// Underlying iterator over the btree_map\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    map_iter\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" std\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"collections\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"btree_map\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Iter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"usize\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"StoredRow\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e,\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"    /// The columns of the [`Table`]\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    columns\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Rc\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ColumnInfo\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e,\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"impl\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"TableIter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        map_iter\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" std\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"collections\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"btree_map\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Iter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"usize\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"StoredRow\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e,\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        columns\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Rc\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ColumnInfo\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e,\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    ) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"Self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"Self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { map_iter, columns }\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"impl\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Iterator\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"for\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"TableIter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"type\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Item\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Row\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e;\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"next\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026mut\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Option\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"Self\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Item\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"map_iter\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"next\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"map\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(id, data)\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Row\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"columns\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"clone\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(), id\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"clone\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(), data))\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Now we can implement the \",(0,l.jsx)(e.a,{href:\"https://doc.rust-lang.org/std/iter/trait.IntoIterator.html\",children:\"IntoIterator trait\"}),\" on \",(0,l.jsx)(e.code,{children:\"Table\"}),\" for easy conversion into an iterator.\"]}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"impl\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"IntoIterator\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"for\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Table\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"type\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Item\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Row\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e;\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"type\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"IntoIter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"TableIter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e;\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"into_iter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"Self\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"IntoIter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" col_info \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Rc\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"columns\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"clone\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"());\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"TableIter\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"rows\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"iter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(), col_info)\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"now the \",(0,l.jsx)(e.code,{children:\"iter\"}),\" method (not necessarily needed) on table can just call the trait method\"]}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"impl\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Table\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"iter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"impl\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Iterator\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Item\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Row\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"into_iter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.h2,{id:\"handling-sql-queries\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#handling-sql-queries\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Handling SQL Queries\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Now that we have a \",(0,l.jsx)(e.code,{children:\"Table\"}),\" struct we need to hook up the parsed commands to create, insert, and read from tables.\"]}),`\n`,(0,l.jsx)(e.p,{children:\"First we should define the response type for an execution\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"use\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" derive_more\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Display\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"#[derive(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Debug\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Display\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")]\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"enum\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ExecResponse\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    #[display(fmt \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"{_0:?}\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")]\"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:' // only show the values not \"Select(...)\"'})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"Select\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Vec\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Row\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e\u003e),\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Insert\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Create\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Here I use the \",(0,l.jsx)(e.a,{href:\"https://docs.rs/derive_more/latest/derive_more/\",children:\"derive_more\"}),\" crate's Display derive macro to avoid writing my own implementation of Display. If you're a real one who's been paying attention, you may have noticed that we did not implement \",(0,l.jsx)(e.code,{children:\"Display\"}),\" on \",(0,l.jsx)(e.code,{children:\"Row\"}),\" but the \",(0,l.jsx)(e.code,{children:\"Display\"}),\" derive still compiles, this is due to us adding \",(0,l.jsx)(e.code,{children:'#[display(fmt = \"{_0:?}\")]'}),\" to use the debug format of \",(0,l.jsx)(e.code,{children:\"Vec\u003cRow\u003e\"}),\" as the \",(0,l.jsx)(e.code,{children:\"Display\"}),\" format. While we won't use it much for select display (more on that later), for the other response cases It's nice to have.\"]}),`\n`,(0,l.jsx)(e.p,{children:\"We also should make our own Error type for Query Execution\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"use\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" miette\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Diagnostic\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"use\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" thiserror\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Error\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"/// Errors during query execution\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"#[derive(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Error\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Debug\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Diagnostic\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")]\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"#[error(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"Query Execution Error\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")]\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"enum\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"QueryExecutionError\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    #[error(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"Table {0} was not found\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")]\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"TableNotFound\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"),\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    #[error(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"Table {0} already exists\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")]\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"TableAlreadyExists\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"),\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    #[error(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"Column {0} does not exist\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")]\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"ColumnDoesNotExist\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"),\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Like in \",(0,l.jsx)(e.a,{href:\"/blog/build-a-db/part01\",children:\"part1\"}),\", we still are using \",(0,l.jsx)(e.a,{href:\"https://docs.rs/miette/latest/miette/\",children:\"miette\"}),\"/\",(0,l.jsx)(e.a,{href:\"https://docs.rs/thiserror/latest/thiserror/\",children:\"thiserror\"}),\" for better looking errors.\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Now we can finally actually run some queries. For a quick refresher on the \",(0,l.jsx)(e.code,{children:\"SqlQuery\"}),\" type, see \",(0,l.jsx)(e.a,{href:\"https://github.com/JRMurr/SQLJr/blob/5324c38bc74cb77d2daf035a0f3d1da3fc7b4c3b/crates/sql_jr_parser/src/ast.rs#L19\",children:\"the source code\"})]}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"#[derive(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Debug\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Default\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")]\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"struct\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Execution\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    tables\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"HashMap\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Table\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e,\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"impl\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Execution\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"() \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"Self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"Self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            tables\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"HashMap\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(),\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"run\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026mut\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", query\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SqlQuery\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Result\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ExecResponse\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"QueryExecutionError\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"match\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" query {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SqlQuery\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"Select\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"mut\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" select) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" table \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" select\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"table;\"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\" // the table name\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" table \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"tables\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"get\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"table)\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"ok_or\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"QueryExecutionError\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"TableNotFound\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(table))\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"?\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"                // not projecting to the selected columns yet\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" rows \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" table\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"iter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"collect\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"();\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Ok\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ExecResponse\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"Select\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(rows)))\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            }\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SqlQuery\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"Insert\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(insert) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Some\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(table) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"tables\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"get_mut\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"insert\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"table) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"else\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"return\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Err\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"QueryExecutionError\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"TableNotFound\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(insert\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"table))\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                };\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                table\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"insert\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(insert\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"values);\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Ok\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ExecResponse\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Insert\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            }\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SqlQuery\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"Create\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(create) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" table \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Table\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(create\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"columns);\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"tables\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"insert\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(create\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"table, table);\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Ok\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ExecResponse\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Create\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Since we handled most of the logic in the \",(0,l.jsx)(e.code,{children:\"Table\"}),\"/\",(0,l.jsx)(e.code,{children:\"Row\"}),\" structs, the actual execution is mostly just wrapper around the \",(0,l.jsx)(e.code,{children:\"HashMap\"}),\" of tables with some basic error handling.\"]}),`\n`,(0,l.jsxs)(e.h2,{id:\"brining-it-all-together\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#brining-it-all-together\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Brining it all together\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"With the \",(0,l.jsx)(e.code,{children:\"Execution\"}),` struct we can handle the parsed commands from our parser but right now we don't have it all hooked up.\nWe need to unify the parser and execution into one.`]}),`\n`,(0,l.jsxs)(e.p,{children:['Ideally we would have some new crate for the full \"pipeline\" from parsing to execution (and probably more steps we will add later), but for now having this logic in the ',(0,l.jsx)(e.code,{children:\"Execution\"}),\" crate feels fine.\"]}),`\n`,(0,l.jsx)(e.p,{children:\"First step is to combine the Error types from Parsing and Execution\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"use\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" miette\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Diagnostic\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"use\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" sql_jr_parser\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"error\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"FormattedError\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"use\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" thiserror\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Error\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:'/// Errors at any point in the SQL \"pipeline\"'})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"#[derive(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Error\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Debug\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Diagnostic\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")]\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"#[error(transparent)]\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"enum\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SQLError\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e {\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    #[diagnostic(transparent)]\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"QueryExecutionError\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(#[from] \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"QueryExecutionError\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"),\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    #[diagnostic(transparent)]\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"ParsingError\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"FormattedError\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e),\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"// need a manual impl since the error #[from] seems sad on lifetimes\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"impl\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"From\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"FormattedError\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e\u003e \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"for\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SQLError\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"from\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(value\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"FormattedError\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"Self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SQLError\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"ParsingError\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(value)\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Here \",(0,l.jsx)(e.code,{children:\"#[diagnostic(transparent)]\"}),\" is similar to \",(0,l.jsx)(e.code,{children:\"#[error(transparent)]\"}),\" in \",(0,l.jsx)(e.code,{children:\"thiserror\"}),\", it lets you wrap other errors but still call their \",(0,l.jsx)(e.code,{children:\"Display\"}),\" trait when the error is shown.\"]}),`\n`,(0,l.jsx)(e.p,{children:\"Now we can have a function that parses and executes the query\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"impl\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Execution\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"   \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"parse_and_run\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026mut\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", query\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"str\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Result\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ExecResponse\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"SQLError\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c'\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e\u003e {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" query \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"parse_sql_query\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(query)\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"?\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" res \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"run\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(query)\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"?\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Ok\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(res)\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsx)(e.p,{children:\"Which lets our REPL now look like\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"main\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"() {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"...\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"mut\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" exec \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" sql_jr_execution\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Execution\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"();\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"loop\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" readline \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" rl\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"readline\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"\u003e\u003e \"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\");\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"match\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" readline {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Ok\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(line) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                rl\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"add_history_entry\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(line\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"as_str\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"());\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" line\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"str\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" line\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"as_ref\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"();\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" res \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" exec\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"parse_and_run\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(line);\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"match\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" res {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Ok\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(exec_res) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"println!\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"{exec_res}\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"),\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Err\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(e) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                        \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"mut\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" s \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"();\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                        \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"GraphicalReportHandler\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"with_cause_chain\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"with_context_lines\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"10\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"render_report\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026mut\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" s, \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"e)\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"unwrap\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"();\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                        \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"println!\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"{s}\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\");\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"          // other cases unchanged from part 1\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsx)(e.p,{children:\"The happy path in our REPL now looks like\"}),`\n`,(0,l.jsx)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsx)(e.code,{children:(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"undefined\"},children:`\u003e\u003e create table foo (col1 string, col2 string);\nCreate\n\u003e\u003e insert into foo values a,b;\nInsert\n\u003e\u003e select col1,col2 from foo;\n[Row { id: 0, columns: [Column { name: \"col1\", type_info: String }, Column { name: \"col2\", type_info: String }], data: {\"col1\": \"a\", \"col2\": \"b\"} }]\n\u003e\u003e`})})})})}),`\n`,(0,l.jsxs)(e.h2,{id:\"better-display-for-repl\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#better-display-for-repl\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Better display for REPL\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"The REPL works, but the display for select queries is pretty gross. We can use the \",(0,l.jsx)(e.a,{href:\"https://github.com/zhiburt/tabled\",children:\"tabled crate\"}),\" to format the response as a table. We can run \",(0,l.jsx)(e.code,{children:\"cargo add tabled\"}),\" in \",(0,l.jsx)(e.code,{children:\"crates/sql_jr_repl\"}),\" to add the crate to the repl.\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"If you look at the docs for \",(0,l.jsx)(e.code,{children:\"tabled\"}),\" many of the first examples involve the \",(0,l.jsx)(e.code,{children:\"#[derive(Tabled)]\"}),\" macro on your structs/enums. This does not really work for select queries since the columns are dynamic. Tabled still supports this with the \",(0,l.jsx)(e.a,{href:\"https://docs.rs/tabled/0.10.0/tabled/builder/struct.Builder.html\",children:\"builder\"}),\" to allow us to set the rows + columns dynamically.\"]}),`\n`,(0,l.jsx)(e.p,{children:\"Let's add a new file to the REPL crate and handle display there\"}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"crates/sql_jr_repl/display.rs\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"display_response\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(res\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ExecResponse\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"match\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" res {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ExecResponse\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"Select\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(rows) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"mut\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" builder \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Builder\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"default\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"();\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"            // Get column info from the first row\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" row \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" rows\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"get\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"0\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"expect\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"For now assuming we get data back\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\");\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" columns\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Vec\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" row\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"columns\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\" // added helper, see below\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"iter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"map\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"col\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" col\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"name\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"to_string\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"())\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"collect\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"();\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            builder\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"set_columns\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"columns);\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"for\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" row \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"in\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" rows\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"into_iter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"() {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                builder\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"add_record\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(columns\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"iter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"map\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"col\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" row\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"get\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(col)));\"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\" // added a get helper, see below\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            }\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"println!\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"{}\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", builder\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"build\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"())\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        }\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        _ \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"println!\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"{res}\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"),\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsx)(e.p,{children:\"as noted in a comment I added these helpers to the row struct to make column lookup easier\"}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"crates/sql_jr_execution/row.rs\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"impl\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Row\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"     \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"columns\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ColumnInfo\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"columns\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"as_ref\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"    /// Get a single value from the row\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"    ///\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"    /// # Panics\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"    ///\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"    /// Panics if the column does not exist\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"    /// See [`try_get`](Self::try_get) for a non-panicking\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"    /// version.\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"get\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", column\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"try_get\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(column)\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"unwrap\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"    /// Get a single value from the row\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"try_get\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", column\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Result\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"QueryExecutionError\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"data\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"get\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(column)\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"map_or_else\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"||\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Err\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"QueryExecutionError\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"ColumnDoesNotExist\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(column\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"to_owned\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"())),\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"val\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Ok\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(val\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"to_string\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()),\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        )\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsx)(e.p,{children:\"now the REPL from the example above would show\"}),`\n`,(0,l.jsx)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsx)(e.code,{children:(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"undefined\"},children:`\u003e\u003e select col1,col2 from foo;\n+------+------+\n| col1 | col2 |\n+------+------+\n| a    | b    |\n+------+------+`})})})})}),`\n`,(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:\"tabled\"}),\" has many \",(0,l.jsx)(e.a,{href:\"https://github.com/zhiburt/tabled#style\",children:\"style options\"}),\" if we wanted to tweak the look, but this is fine for now.\"]}),`\n`,(0,l.jsx)(e.p,{children:\"You probably noticed the line\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"//Get column info from the first row\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" row \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" rows\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"get\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"0\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"expect\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"For now assuming we get data back\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\");\"})]})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"in our display function. This obviously would get sad on empty responses. The best decision would be to add/move \",(0,l.jsx)(e.code,{children:\"ColumnInfo\"}),\" into \",(0,l.jsx)(e.code,{children:\"ExecResponse::Select\"}),\", so we return something like\"]}),`\n`,(0,l.jsx)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsx)(e.code,{children:(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"undefined\"},children:\"{columns: Rc\u003cColumnInfo\u003e, row: Vec\u003cRow\u003e}\"})})})})}),`\n`,(0,l.jsx)(e.p,{children:\"but I'll save that for the next post.\"}),`\n`,(0,l.jsxs)(e.h2,{id:\"wrap-up\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#wrap-up\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Wrap up\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Having basic execution feels nice, but the real challenge will be actually filtering and projecting the data. We some extra clones and \",(0,l.jsx)(e.code,{children:\"unwraps\"}),\"/\",(0,l.jsx)(e.code,{children:\"expects\"}),\" we need to handle once we start moving away from this extremely simple happy path but so far the high level design feels good!\"]})]})}}var g=B;function f(n,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+n+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return E;})();\n;return Component;","toc":[{"value":"Feedback from part 1","url":"#feedback-from-part-1","depth":1},{"value":"Execution","url":"#execution","depth":1},{"value":"What is a B-Tree?","url":"#what-is-a-b-tree","depth":3},{"value":"Why B-Tree?","url":"#why-b-tree","depth":3},{"value":"Actually do stuff","url":"#actually-do-stuff","depth":2},{"value":"Handling SQL Queries","url":"#handling-sql-queries","depth":2},{"value":"Brining it all together","url":"#brining-it-all-together","depth":2},{"value":"Better display for REPL","url":"#better-display-for-repl","depth":2},{"value":"Wrap up","url":"#wrap-up","depth":2}],"frontMatter":{"readingTime":{"text":"12 min read","minutes":11.845,"time":710700,"words":2369},"slug":"build-a-db/part02","fileName":"build-a-db/part02.md","title":"Building a Simple DB in Rust - Part 2 - Basic Execution","seriesTitle":"Part 2 - Basic Execution","date":"2023-01-23T14:01:22.231Z","tags":["rust","database"],"draft":false,"summary":"Building a basic database in rust","images":[],"layout":"PostLayout"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.215,"time":12900,"words":43},"slug":["default"],"fileName":"default.md","name":"John Murray","avatar":"/static/images/me.jpg","occupation":"Software Engineer","github":"https://github.com/JRMurr","twitter":"https://twitter.com/JRMurrCodes","mastodon":"https://hachyderm.io/@jrmurr","email":"johnreillymurray@gmail.com","date":null}],"series":{"title":"Building a Simple DB in Rust","posts":[{"title":"Building a Simple DB in Rust - Part 1 - Parsing","seriesTitle":"Part 1 - Parsing","date":"2023-01-02T05:19:22.985Z","tags":["rust","database","parsing"],"draft":false,"summary":"building a basic database in rust","images":[],"layout":"PostLayout","slug":"build-a-db/part01"},{"title":"Building a Simple DB in Rust - Part 2 - Basic Execution","seriesTitle":"Part 2 - Basic Execution","date":"2023-01-23T14:01:22.231Z","tags":["rust","database"],"draft":false,"summary":"Building a basic database in rust","images":[],"layout":"PostLayout","slug":"build-a-db/part02"},{"title":"Building a Simple DB in Rust - Part 3 - Less Basic Execution","seriesTitle":"Part 3 - Less Basic Execution","date":"2023-04-04T00:01:55.249Z","tags":["rust","database","repl"],"draft":false,"summary":"Cleaning up existing execution logic","images":[],"layout":"PostLayout","slug":"build-a-db/part03"}]}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["build-a-db","part02"]},"buildId":"GI-xhRfCsnPvaM497qH_S","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>