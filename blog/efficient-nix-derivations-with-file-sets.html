<!DOCTYPE html><html lang="en-us" class="__variable_587f35 scroll-smooth"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/2d141e1a38819612-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/895662d5d095c22a.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/14fb540b7a3ad639.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-278bcb5a0daf8917.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-28d8581e6e02654e.js" async="" crossorigin=""></script><script src="/_next/static/chunks/69-dbeadf5c9f0cdabc.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-bef4f1fcfc072c84.js" async="" crossorigin=""></script><script src="/_next/static/chunks/250-a30085ccab20449f.js" async=""></script><script src="/_next/static/chunks/781-9238b26c3a132736.js" async=""></script><script src="/_next/static/chunks/app/layout-9608048ecb38eb6e.js" async=""></script><script src="/_next/static/chunks/749-ed776d54eb5c7205.js" async=""></script><script src="/_next/static/chunks/app/blog/%5B...slug%5D/page-fd9b73ee915812e8.js" async=""></script><title>Efficient Nix Derivations with File Sets | John&#x27;s Codes</title><meta name="description" content="Using nix&#x27;s new file set API to make efficient derivations"/><meta name="robots" content="index, follow"/><meta name="googlebot" content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"/><link rel="canonical" href="https://johns.codes/blog/efficient-nix-derivations-with-file-sets"/><link rel="alternate" type="application/rss+xml" href="https://johns.codes/feed.xml"/><meta property="og:title" content="Efficient Nix Derivations with File Sets"/><meta property="og:description" content="Using nix&#x27;s new file set API to make efficient derivations"/><meta property="og:url" content="https://johns.codes/blog/efficient-nix-derivations-with-file-sets"/><meta property="og:site_name" content="John&#x27;s Codes"/><meta property="og:locale" content="en_US"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2023-12-02T21:22:44.113Z"/><meta property="article:modified_time" content="2023-12-02T21:22:44.113Z"/><meta property="article:author" content="John Murray"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Efficient Nix Derivations with File Sets"/><meta name="twitter:description" content="Using nix&#x27;s new file set API to make efficient derivations"/><meta name="next-size-adjust"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-950 dark:text-white"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><section class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between font-sans"><header class="flex items-center justify-between py-10"><div><a aria-label="John&#x27;s Codes" href="/"><div class="flex items-center justify-between"><div class="hidden h-6 text-2xl font-semibold sm:block">John&#x27;s Codes</div></div></a></div><div class="flex items-center space-x-4 leading-5 sm:space-x-6"><a class="hidden font-medium text-gray-900 dark:text-gray-100 sm:block" href="/blog">Blog</a><a class="hidden font-medium text-gray-900 dark:text-gray-100 sm:block" href="/tags">Tags</a><a class="hidden font-medium text-gray-900 dark:text-gray-100 sm:block" href="/projects">Projects</a><a class="hidden font-medium text-gray-900 dark:text-gray-100 sm:block" href="/about">About</a><button aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6 text-gray-900 dark:text-gray-100"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path></svg></button><button aria-label="Toggle Menu" class="sm:hidden"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-8 w-8 text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed left-0 top-0 z-10 h-full w-full transform bg-white opacity-95 duration-300 ease-in-out dark:bg-gray-950 dark:opacity-[0.98] translate-x-full"><div class="flex justify-end"><button class="mr-8 mt-11 h-8 w-8" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/">Home</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/projects">Projects</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></header><main class="mb-auto"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Efficient Nix Derivations with File Sets","datePublished":"2023-12-02T21:22:44.113Z","dateModified":"2023-12-02T21:22:44.113Z","description":"Using nix's new file set API to make efficient derivations","author":[{"@type":"Person","name":"John Murray"}]}</script><section class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed bottom-8 right-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div><header><div class="space-y-1 border-b border-gray-200 pb-10 text-center dark:border-gray-700"><dl><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2023-12-02T21:22:44.113Z">December 2, 2023</time><span class="mx-2">-</span><span class="ml-1">4<!-- --> min read</span></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Efficient Nix Derivations with File Sets</h1></div></div></header><div class="grid-rows-[auto_1fr] divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:divide-y-0"><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pb-8 pt-10 dark:prose-invert"><details open=""><summary class="ml-6 pb-2 pt-2 text-xl font-bold">Table of Contents</summary><div class="ml-6"><ul class=""><li><a href="#what-are-file-sets">What are file sets</a></li><li><a href="#a-real-example">A Real Example</a></li><li><a href="#wrap-up">Wrap up</a></li></ul></div></details><p>If you are using Nix to build your own packages you will eventually come across something like</p><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#e36209;--shiki-dark:#FFAB70">stdenv</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">mkDerivation</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    name</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;my awesome pkg&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    src</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> ./.</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    buildPhase</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &#x27;&#x27;</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">        # I have no idea if this actually works (the gcc call bit)</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">        # but the vibe is what I care about</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">        gcc main.c -o my_program</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">        mkdir -p $out</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">        cp my_program $out</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">    &#x27;&#x27;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre></div><p>The issue with the above is setting <code>src = ./.</code>, which makes <strong>ALL</strong> of the current directory an input to the derivation. So if you have a readme file in this folder, changing that will cause this derivation to rebuild.</p><p>The build only really cares about <code>main.c</code> in this case so what can we do to fix this?</p><p>Back in the dark dark times of pre-Nixos 23.11, there were ways to do this kind of filtering but IMO they were kinda confusing and I never quite got it to work right so I just stuck with <code>src = ./.</code></p><p>Now with 23.11 we have <a target="_blank" rel="noopener noreferrer" href="https://www.tweag.io/blog/2023-11-28-file-sets/">filesets</a>, which makes filtering and adding files much simpler.</p><h2 id="what-are-file-sets"><a href="#what-are-file-sets" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>What are file sets</h2><p>I would recommend checking out the <a target="_blank" rel="noopener noreferrer" href="https://nixos.org/manual/nixpkgs/unstable/#sec-functions-library-fileset">docs</a> or <a target="_blank" rel="noopener noreferrer" href="https://nix.dev/tutorials/file-sets">official tutorial</a>, but for a TLDR, you can do the following</p><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">let</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    fs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> pkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">lib</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">fileset</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    baseSrc</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> fs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">unions</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> [ </span><span style="color:#032f62;--shiki-dark:#9ECBFF">./Makefile</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> ./src</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> ];</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    filterMarkdownFiles</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> fs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">fileFilter</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> (file: </span><span style="color:#e36209;--shiki-dark:#FFAB70">hasSuffix</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;.md&quot;</span><span style="color:#e36209;--shiki-dark:#FFAB70"> file</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">name</span><span style="color:#24292e;--shiki-dark:#E1E4E8">) </span><span style="color:#032f62;--shiki-dark:#9ECBFF">./.</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    removedMarkedDown</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> fs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">difference</span><span style="color:#e36209;--shiki-dark:#FFAB70"> baseSrc</span><span style="color:#e36209;--shiki-dark:#FFAB70"> filterMarkdownFiles</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">in</span></span>
<span class="line"><span style="color:#e36209;--shiki-dark:#FFAB70">stdenv</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">mkDerivation</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    name</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;my awesome pkg&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    src</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> fs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">toSource</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        root</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> ./.</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        fileset</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> removedMarkedDown</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    };</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    buildPhase</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &#x27;&#x27;</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">       # call make or w/e you want</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">    &#x27;&#x27;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre></div><p>Now with this setup, we have a &quot;base&quot; file set of <code>[ ./Makefile ./src ]</code> then with <code>fs.difference</code> we can remove all files that are markdown with the <code>filterMarkdownFiles</code> filter.</p><h2 id="a-real-example"><a href="#a-real-example" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>A Real Example</h2><p>Recently I started messing around with the language <a target="_blank" rel="noopener noreferrer" href="https://www.roc-lang.org/">Roc</a>. If you haven&#x27;t heard of it, Roc is a new functional language heavily inspired by Elm. It&#x27;s fast but also very nice to use (though some rough edges since it&#x27;s pre-0.1.0).</p><p>One of its interesting ideas is that Roc needs your app to pick what <a target="_blank" rel="noopener noreferrer" href="https://www.roc-lang.org/platforms">platform</a> to run on. A platform would be written in something like rust, zig, c, etc. The platform provides roc APIs for things like managing memory, making network requests, printing to stdout, and other IO-like actions. Right now the two most widely used are a <a target="_blank" rel="noopener noreferrer" href="https://github.com/roc-lang/basic-cli">cli platform</a> and <a target="_blank" rel="noopener noreferrer" href="https://github.com/roc-lang/basic-webserver">webserver platform</a></p><p>This is really neat but brings an issue for developing a platform along with the roc code needed to define the platform API. You need to compile the &quot;platform code&quot; (ie rust + some c), do w/e linking is needed for that, then distribute that with the roc source code. The roc cli will do this for you when developing but it doesn&#x27;t work as nicely to compile just the platform with nix.</p><p>For example, <a target="_blank" rel="noopener noreferrer" href="https://github.com/roc-lang/roc/tree/main/examples/platform-switching/rust-platform">this</a> is one of the sample platforms</p><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">❯</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> exa</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> --tree</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> --level</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> 2</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79B8FF">.</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">├──</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> Cargo.lock</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">├──</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> Cargo.toml</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">├──</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> host.c</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">├──</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> main.roc</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">├──</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> rust-toolchain.toml</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">└──</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> src</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">   ├──</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> glue.rs</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">   ├──</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> lib.rs</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">   └──</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> main.rs</span></span>
<span class="line"></span></code></pre></div><p>To build this platform you need to run a <code>cargo build --lib ...</code> on the rust code, compile the <code>host.c</code> file, link those two object files together, and then finally distribute the linked object file with the roc code.</p><p>so after all those steps, it should look something like</p><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">❯</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> exa</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> --tree</span><span style="color:#d73a49;--shiki-dark:#F97583"> &lt;</span><span style="color:#032f62;--shiki-dark:#9ECBFF">compiled</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> folde</span><span style="color:#24292e;--shiki-dark:#E1E4E8">r</span><span style="color:#d73a49;--shiki-dark:#F97583">&gt;</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">&lt;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">compiled folder</span><span style="color:#d73a49;--shiki-dark:#F97583">&gt;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">├──</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> linux-x64.o</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">└──</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> main.roc</span></span>
<span class="line"></span></code></pre></div><p>The naive approach would probably be something like</p><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">let</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">compiledC</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> mkDerivation</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    src</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> ./.</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">    # compile the c ...</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">rustBuiltLib</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> buildRustPackage</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    src</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> ./.</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">    # build the rust</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">in</span></span>
<span class="line"><span style="color:#e36209;--shiki-dark:#FFAB70">llvmPkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">stdenv</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">mkDerivation</span><span style="color:#d73a49;--shiki-dark:#F97583"> rec</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  name</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">${</span><span style="color:#005cc5;--shiki-dark:#79B8FF;font-style:italic;--shiki-dark-font-style:italic">pname</span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">}</span><span style="color:#032f62;--shiki-dark:#9ECBFF">-</span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">${</span><span style="color:#005cc5;--shiki-dark:#79B8FF;font-style:italic;--shiki-dark-font-style:italic">version</span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">}</span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  srcs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#e36209;--shiki-dark:#FFAB70">    rustBuiltLib</span></span>
<span class="line"><span style="color:#e36209;--shiki-dark:#FFAB70">    compiledC</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">    ./.</span><span style="color:#6a737d;--shiki-dark:#6A737D"> # for the roc code</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">  ];</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  sourceRoot</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;.&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  buildPhase</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &#x27;&#x27;</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">    # link the rust and c files</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">    # copy roc and linked object out</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">  &#x27;&#x27;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre></div><p>while this works, it also sucks. <strong>ANY</strong> change to the files will cause all 3 derivations to be rebuilt.</p><p>Now with filesets we can be all cute and fancy</p><div class="grid place-content-center"><div class="rounded bg-gray-100 dark:bg-gray-800"><div class="box-content px-3 py-0"><p>This example will have many parts omitted to keep the code easy to follow. To see the real code, look at my <a target="_blank" rel="noopener noreferrer" href="https://github.com/JRMurr/roc2nix/blob/main/lib/platformBuilders/buildRustPlatform.nix">roc2nix repo</a> where this came from</p></div></div></div><p>First let&#x27;s define a helper file for filtering files based on their extension</p><div class="remark-code-title">languageFilters.nix</div><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">{lib}:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D"># Note i generally don&#x27;t like doing `with` at the top of a file</span></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D"># but since this will be only fileSet stuff it should be fine</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">with</span><span style="color:#e36209;--shiki-dark:#FFAB70"> lib</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">fileset</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">let</span></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">    # helper func to take in a list of allowed</span></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">    # returns a function of `file =&gt; bool` to be used in a fileFilter.</span></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">    # true if file has suffix, false if not</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    fileHasAnySuffix</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> fileSuffixes: file: (</span><span style="color:#e36209;--shiki-dark:#FFAB70">lib</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">lists</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">any</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> (s: </span><span style="color:#e36209;--shiki-dark:#FFAB70">lib</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">hasSuffix</span><span style="color:#e36209;--shiki-dark:#FFAB70"> s</span><span style="color:#e36209;--shiki-dark:#FFAB70"> file</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">name</span><span style="color:#24292e;--shiki-dark:#E1E4E8">) </span><span style="color:#e36209;--shiki-dark:#FFAB70">fileSuffixes</span><span style="color:#24292e;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">    # given a basePath src path, return a fileset of files in that path that are rust files, toml files, or cargo toml/lock</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    rustFilter</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> basePath: (</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">        let</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        mainFilter</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> fileFilter</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">            (</span><span style="color:#e36209;--shiki-dark:#FFAB70">fileHasAnySuffix</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> [ </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;.rs&quot;</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;.toml&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> ])</span></span>
<span class="line"><span style="color:#e36209;--shiki-dark:#FFAB70">            basePath</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">        in</span></span>
<span class="line"><span style="color:#e36209;--shiki-dark:#FFAB70">        unions</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> [ </span><span style="color:#e36209;--shiki-dark:#FFAB70">mainFilter</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> (</span><span style="color:#e36209;--shiki-dark:#FFAB70">basePath</span><span style="color:#d73a49;--shiki-dark:#F97583"> +</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;/Cargo.toml&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">) (</span><span style="color:#e36209;--shiki-dark:#FFAB70">basePath</span><span style="color:#d73a49;--shiki-dark:#F97583"> +</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;/Cargo.lock&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">) ]</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">    # given a basePath src path return a fileset with files ending with `.c`</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    cFilter</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> basePath: </span><span style="color:#e36209;--shiki-dark:#FFAB70">fileFilter</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> (</span><span style="color:#e36209;--shiki-dark:#FFAB70">fileHasAnySuffix</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> [ </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;.c&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> ]) </span><span style="color:#e36209;--shiki-dark:#FFAB70">basePath</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">    # given a basePath src path return a fileset with files ending with `.roc`</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    rocFilter</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> basePath: </span><span style="color:#e36209;--shiki-dark:#FFAB70">fileFilter</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> (</span><span style="color:#e36209;--shiki-dark:#FFAB70">fileHasAnySuffix</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> [ </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;.roc&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> ]) </span><span style="color:#e36209;--shiki-dark:#FFAB70">basePath</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">in</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">  inherit</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> rustFilter</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> cFilter</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> rocFilter</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre></div><p>Now with that helper, we can do</p><div class="remark-code-title">buildRustPlatform.nix</div><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">let</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  fs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> lib</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">fileset</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  languageFilters</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> import</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> ./languageFilters.nix</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span><span style="color:#d73a49;--shiki-dark:#F97583">inherit</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> lib</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  baseDir</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> ./.</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  compiledC</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> mkDerivation</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">      src</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> fs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">toSource</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          root</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> baseDir</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          fileset</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> languageFilters</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">cFilter</span><span style="color:#e36209;--shiki-dark:#FFAB70"> baseDir</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">      };</span></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">      # compile the c ...</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">  };</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  rustBuiltLib</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> buildRustPackage</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">      src</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> fs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">toSource</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        root</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> baseDir</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        fileset</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> languageFilters</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">rustFilter</span><span style="color:#e36209;--shiki-dark:#FFAB70"> baseDir</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">      };</span></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">      # build the rust</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">  };</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  rocCode</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> fs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">toSource</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">      root</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> baseDir</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">      fileset</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> languageFilters</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">rocFilter</span><span style="color:#e36209;--shiki-dark:#FFAB70"> baseDir</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">  };</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">in</span></span>
<span class="line"><span style="color:#e36209;--shiki-dark:#FFAB70">llvmPkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">stdenv</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">mkDerivation</span><span style="color:#d73a49;--shiki-dark:#F97583"> rec</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  name</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">${</span><span style="color:#005cc5;--shiki-dark:#79B8FF;font-style:italic;--shiki-dark-font-style:italic">pname</span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">}</span><span style="color:#032f62;--shiki-dark:#9ECBFF">-</span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">${</span><span style="color:#005cc5;--shiki-dark:#79B8FF;font-style:italic;--shiki-dark-font-style:italic">version</span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">}</span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  srcs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#e36209;--shiki-dark:#FFAB70">    rustBuiltLib</span></span>
<span class="line"><span style="color:#e36209;--shiki-dark:#FFAB70">    compiledC</span></span>
<span class="line"><span style="color:#e36209;--shiki-dark:#FFAB70">    rocCode</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">  ];</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  sourceRoot</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;.&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  buildPhase</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &#x27;&#x27;</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">    # NOTE: this link could be pulled into its own derivation for even better seperation</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">    # I only just realized this while making this post...</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">    $LD -r -L </span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">${</span><span style="color:#005cc5;--shiki-dark:#79B8FF;font-style:italic;--shiki-dark-font-style:italic">rustBuildName</span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">}</span><span style="color:#032f62;--shiki-dark:#9ECBFF">/lib </span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">${</span><span style="color:#005cc5;--shiki-dark:#79B8FF;font-style:italic;--shiki-dark-font-style:italic">cBuildName</span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">}</span><span style="color:#032f62;--shiki-dark:#9ECBFF">/</span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">${</span><span style="color:#005cc5;--shiki-dark:#79B8FF;font-style:italic;--shiki-dark-font-style:italic">cHostDest</span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">}</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> -lhost -o </span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">${</span><span style="color:#005cc5;--shiki-dark:#79B8FF;font-style:italic;--shiki-dark-font-style:italic">host_dest</span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">    mkdir -p $out</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">    cp </span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">${</span><span style="color:#005cc5;--shiki-dark:#79B8FF;font-style:italic;--shiki-dark-font-style:italic">host_dest</span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">}</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> $out/</span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">${</span><span style="color:#005cc5;--shiki-dark:#79B8FF;font-style:italic;--shiki-dark-font-style:italic">host_dest</span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">}</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">    cp -r </span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">${</span><span style="color:#005cc5;--shiki-dark:#79B8FF;font-style:italic;--shiki-dark-font-style:italic">rocCode</span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">}</span><span style="color:#032f62;--shiki-dark:#9ECBFF">/. $out</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">  &#x27;&#x27;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre></div><p>Now this is about as good as you can get. The rust and c builds have no dependency on each other so you are free to modify the c without needing to rebuild the rust.</p><p>If you only change the roc code, you won&#x27;t need to do any build (other than linking but in this example that could also be pulled out....).</p><h2 id="wrap-up"><a href="#wrap-up" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Wrap up</h2><p>Huge shoutout to <a target="_blank" rel="noopener noreferrer" href="https://github.com/infinisil">Silvan Mosberger</a> from <a target="_blank" rel="noopener noreferrer" href="https://www.tweag.io/">Tweag</a> for bringing file sets to the main Nix library. He was sponsored through my current employer <a target="_blank" rel="noopener noreferrer" href="https://antithesis.com/">Antithesis</a> to develop this feature!</p><p>I hope filesets make more people take a stab at making their own <code>*2nix</code> builders, or just make their own builds more efficent.</p><p>I had a lot of fun working on <a target="_blank" rel="noopener noreferrer" href="https://github.com/JRMurr/roc2nix/">roc2nix</a>, it was my first time making a &quot;real&quot; nix library and I learned a lot along the way (not just file sets). If you are interested in learning more about it check out the repo or let me know in the comments and I might make a separate blog diving into that (and hopefully some blogs on roc itself).</p></div><div><div class="pb-6 pt-6 text-sm text-gray-700 dark:text-gray-300"><a target="_blank" rel="nofollow" href="https://mobile.twitter.com/search?q=https%3A%2F%2Fjohns.codes%2Fblog%2Fefficient-nix-derivations-with-file-sets">Discuss on Twitter</a> • <a target="_blank" rel="noopener noreferrer" href="https://github.com/JRMurr/JRMurr.github.io/blob/main/content/blog/efficient-nix-derivations-with-file-sets.md">View on GitHub</a></div><div class="pb-6 pt-6 text-center text-gray-700 dark:text-gray-300" id="comment"><button>Load Comments</button></div></div></div><footer><div class="flex flex-col text-sm font-medium sm:flex-row sm:justify-between sm:text-base"><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" aria-label="Previous post: Organizing system configs with NixOS" href="/blog/organizing-system-configs-with-nixos">← <!-- -->Organizing system configs with NixOS</a></div></div></footer></div></div></article></section></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/JRMurr"><span class="sr-only">github</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://twitter.com/JRMurrCodes"><span class="sr-only">twitter</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://hachyderm.io/@jrmurr"><span class="sr-only">mastodon</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6"><path d="M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="/feed.xml"><span class="sr-only">rss</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6"><path d="M3.692 17.517A3.696 3.696 0 0 0 0 21.211C0 23.244 1.656 24.9 3.692 24.9s3.694-1.657 3.694-3.689a3.697 3.697 0 0 0-3.694-3.694z"></path><path d="M.384 8.142A.386.386 0 0 0 0 8.527v4.688c0 .211.173.383.384.383 6.02 0 10.919 4.898 10.919 10.92 0 .209.171.383.384.383h4.705a.385.385 0 0 0 .387-.383l-.018-.121C16.692 15.423 9.37 8.142.384 8.142z"></path><path d="M24.89 24.397C24.825 10.936 13.854.011.384.011A.385.385 0 0 0 0 .397v4.824c0 .212.173.383.384.383 10.429 0 18.913 8.486 18.913 18.914 0 .209.172.383.382.383h4.845a.39.39 0 0 0 .388-.383l-.022-.121z"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>John Murray</div><div> • </div><div>© 2024</div><div> • </div><a href="/">John&#x27;s Codes</a></div></div></footer></div></section><script src="/_next/static/chunks/webpack-278bcb5a0daf8917.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/2d141e1a38819612-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/css/895662d5d095c22a.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L3\"\n"])</script><script>self.__next_f.push([1,"4:HL[\"/_next/static/css/14fb540b7a3ad639.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"5:I[7690,[],\"\"]\n8:I[5613,[],\"\"]\na:I[1778,[],\"\"]\nb:I[8029,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"781\",\"static/chunks/781-9238b26c3a132736.js\",\"185\",\"static/chunks/app/layout-9608048ecb38eb6e.js\"],\"ThemeProviders\"]\nc:I[5935,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"781\",\"static/chunks/781-9238b26c3a132736.js\",\"185\",\"static/chunks/app/layout-9608048ecb38eb6e.js\"],\"\"]\nd:I[9266,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"781\",\"static/chunks/781-9238b26c3a132736.js\",\"185\",\"static/chunks/app/lay"])</script><script>self.__next_f.push([1,"out-9608048ecb38eb6e.js\"],\"KBarSearchProvider\"]\ne:I[5250,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"749\",\"static/chunks/749-ed776d54eb5c7205.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-fd9b73ee915812e8.js\"],\"\"]\nf:I[2146,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"781\",\"static/chunks/781-9238b26c3a132736.js\",\"185\",\"static/chunks/app/layout-9608048ecb38eb6e.js\"],\"KBarButton\"]\n10:I[5021,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"781\",\"static/chunks/781-9238b26c3a132736.js\",\"185\",\"static/"])</script><script>self.__next_f.push([1,"chunks/app/layout-9608048ecb38eb6e.js\"],\"\"]\n11:I[123,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"781\",\"static/chunks/781-9238b26c3a132736.js\",\"185\",\"static/chunks/app/layout-9608048ecb38eb6e.js\"],\"\"]\n14:I[8955,[],\"\"]\n9:[\"slug\",\"efficient-nix-derivations-with-file-sets\",\"c\"]\n12:T44f,"])</script><script>self.__next_f.push([1,"M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"])</script><script>self.__next_f.push([1,"15:[]\n"])</script><script>self.__next_f.push([1,"3:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/895662d5d095c22a.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L5\",null,{\"buildId\":\"eDPdjg8oJpDO6n8_m9oD4\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/blog/efficient-nix-derivations-with-file-sets\",\"initialTree\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"efficient-nix-derivations-with-file-sets\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"efficient-nix-derivations-with-file-sets\\\"]}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"efficient-nix-derivations-with-file-sets\",\"c\"],{\"children\":[\"__PAGE__\",{},[\"$L6\",\"$L7\",null]]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"$9\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/14fb540b7a3ad639.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}]]},[null,[\"$\",\"html\",null,{\"lang\":\"en-us\",\"className\":\"__variable_587f35 scroll-smooth\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"sizes\":\"76x76\",\"href\":\"/static/favicons/apple-touch-icon.png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"32x32\",\"href\":\"/static/favicons/favicon-32x32.png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"16x16\",\"href\":\"/static/favicons/favicon-16x16.png\"}],[\"$\",\"link\",null,{\"rel\":\"manifest\",\"href\":\"/static/favicons/site.webmanifest\"}],[\"$\",\"link\",null,{\"rel\":\"mask-icon\",\"href\":\"/static/favicons/safari-pinned-tab.svg\",\"color\":\"#5bbad5\"}],[\"$\",\"meta\",null,{\"name\":\"msapplication-TileColor\",\"content\":\"#000000\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: light)\",\"content\":\"#fff\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: dark)\",\"content\":\"#000\"}],[\"$\",\"link\",null,{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"/feed.xml\"}],[\"$\",\"body\",null,{\"className\":\"bg-white text-black antialiased dark:bg-gray-950 dark:text-white\",\"children\":[\"$\",\"$Lb\",null,{\"children\":[[[\"$\",\"$Lc\",null,{\"strategy\":\"lazyOnload\",\"data-domain\":\"johns.codes\",\"data-api\":\"$undefined\",\"src\":\"https://plausible.io/js/plausible.js\"}],[\"$\",\"$Lc\",null,{\"strategy\":\"lazyOnload\",\"id\":\"plausible-script\",\"children\":\"\\n            window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }\\n        \"}]],[\"$\",\"section\",null,{\"className\":\"mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex h-screen flex-col justify-between font-sans\",\"children\":[[\"$\",\"$Ld\",null,{\"kbarConfig\":{\"searchDocumentsPath\":\"search.json\"},\"children\":[[\"$\",\"header\",null,{\"className\":\"flex items-center justify-between py-10\",\"children\":[[\"$\",\"div\",null,{\"children\":[\"$\",\"$Le\",null,{\"href\":\"/\",\"aria-label\":\"John's Codes\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between\",\"children\":[\"$\",\"div\",null,{\"className\":\"hidden h-6 text-2xl font-semibold sm:block\",\"children\":\"John's Codes\"}]}]}]}],[\"$\",\"div\",null,{\"className\":\"flex items-center space-x-4 leading-5 sm:space-x-6\",\"children\":[[[\"$\",\"$Le\",null,{\"href\":\"/blog\",\"className\":\"hidden font-medium text-gray-900 dark:text-gray-100 sm:block\",\"children\":\"Blog\"}],[\"$\",\"$Le\",null,{\"href\":\"/tags\",\"className\":\"hidden font-medium text-gray-900 dark:text-gray-100 sm:block\",\"children\":\"Tags\"}],[\"$\",\"$Le\",null,{\"href\":\"/projects\",\"className\":\"hidden font-medium text-gray-900 dark:text-gray-100 sm:block\",\"children\":\"Projects\"}],[\"$\",\"$Le\",null,{\"href\":\"/about\",\"className\":\"hidden font-medium text-gray-900 dark:text-gray-100 sm:block\",\"children\":\"About\"}]],[\"$\",\"$Lf\",null,{\"aria-label\":\"Search\",\"children\":[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"fill\":\"none\",\"viewBox\":\"0 0 24 24\",\"strokeWidth\":1.5,\"stroke\":\"currentColor\",\"className\":\"h-6 w-6 text-gray-900 dark:text-gray-100\",\"children\":[\"$\",\"path\",null,{\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"d\":\"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z\"}]}]}],[\"$\",\"$L10\",null,{}],[\"$\",\"$L11\",null,{}]]}]]}],[\"$\",\"main\",null,{\"className\":\"mb-auto\",\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"className\":\"flex flex-col items-start justify-start md:mt-24 md:flex-row md:items-center md:justify-center md:space-x-6\",\"children\":[[\"$\",\"div\",null,{\"className\":\"space-x-2 pb-8 pt-6 md:space-y-5\",\"children\":[\"$\",\"h1\",null,{\"className\":\"text-6xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 md:border-r-2 md:px-6 md:text-8xl md:leading-14\",\"children\":\"404\"}]}],[\"$\",\"div\",null,{\"className\":\"max-w-md\",\"children\":[[\"$\",\"p\",null,{\"className\":\"mb-4 text-xl font-bold leading-normal md:text-2xl\",\"children\":\"Sorry we couldn't find this page.\"}],[\"$\",\"p\",null,{\"className\":\"mb-8\",\"children\":\"But dont worry, you can find plenty of other things on our homepage.\"}],[\"$\",\"$Le\",null,{\"href\":\"/\",\"className\":\"focus:shadow-outline-blue inline rounded-lg border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium leading-5 text-white shadow transition-colors duration-150 hover:bg-blue-700 focus:outline-none dark:hover:bg-blue-500\",\"children\":\"Back to homepage\"}]]}]]}],\"notFoundStyles\":[],\"styles\":null}]}]]}],[\"$\",\"footer\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"mt-16 flex flex-col items-center\",\"children\":[[\"$\",\"div\",null,{\"className\":\"mb-3 flex space-x-4\",\"children\":[null,[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/JRMurr\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"github\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6\",\"children\":[\"$\",\"path\",null,{\"d\":\"M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12\"}]}]]}],[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://twitter.com/JRMurrCodes\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"twitter\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6\",\"children\":[\"$\",\"path\",null,{\"d\":\"M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z\"}]}]]}],[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://hachyderm.io/@jrmurr\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"mastodon\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6\",\"children\":[\"$\",\"path\",null,{\"d\":\"$12\"}]}]]}],[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"/feed.xml\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"rss\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M3.692 17.517A3.696 3.696 0 0 0 0 21.211C0 23.244 1.656 24.9 3.692 24.9s3.694-1.657 3.694-3.689a3.697 3.697 0 0 0-3.694-3.694z\"}],[\"$\",\"path\",null,{\"d\":\"M.384 8.142A.386.386 0 0 0 0 8.527v4.688c0 .211.173.383.384.383 6.02 0 10.919 4.898 10.919 10.92 0 .209.171.383.384.383h4.705a.385.385 0 0 0 .387-.383l-.018-.121C16.692 15.423 9.37 8.142.384 8.142z\"}],[\"$\",\"path\",null,{\"d\":\"M24.89 24.397C24.825 10.936 13.854.011.384.011A.385.385 0 0 0 0 .397v4.824c0 .212.173.383.384.383 10.429 0 18.913 8.486 18.913 18.914 0 .209.172.383.382.383h4.845a.39.39 0 0 0 .388-.383l-.022-.121z\"}]]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400\",\"children\":[[\"$\",\"div\",null,{\"children\":\"John Murray\"}],[\"$\",\"div\",null,{\"children\":\" • \"}],[\"$\",\"div\",null,{\"children\":\"© 2024\"}],[\"$\",\"div\",null,{\"children\":\" • \"}],[\"$\",\"$Le\",null,{\"href\":\"/\",\"children\":\"John's Codes\"}]]}]]}]}]]}]}]]}]}]]}],null]],\"initialHead\":[false,\"$L13\"],\"globalErrorComponent\":\"$14\",\"missingSlots\":\"$W15\"}]]\n"])</script><script>self.__next_f.push([1,"16:I[144,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"749\",\"static/chunks/749-ed776d54eb5c7205.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-fd9b73ee915812e8.js\"],\"\"]\n17:I[2502,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"749\",\"static/chunks/749-ed776d54eb5c7205.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-fd9b73ee915812e8.js\"],\"\"]\n18:I[4282,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"749\",\"static/chunks/749-ed776d54eb5c7205.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-fd9b7"])</script><script>self.__next_f.push([1,"3ee915812e8.js\"],\"\"]\n19:I[4970,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"749\",\"static/chunks/749-ed776d54eb5c7205.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-fd9b73ee915812e8.js\"],\"\"]\n"])</script><script>self.__next_f.push([1,"7:[[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"BlogPosting\\\",\\\"headline\\\":\\\"Efficient Nix Derivations with File Sets\\\",\\\"datePublished\\\":\\\"2023-12-02T21:22:44.113Z\\\",\\\"dateModified\\\":\\\"2023-12-02T21:22:44.113Z\\\",\\\"description\\\":\\\"Using nix's new file set API to make efficient derivations\\\",\\\"author\\\":[{\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"John Murray\\\"}]}\"}}],[\"$\",\"section\",null,{\"className\":\"mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0\",\"children\":[[\"$\",\"$L16\",null,{}],[\"$\",\"article\",null,{\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"header\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"space-y-1 border-b border-gray-200 pb-10 text-center dark:border-gray-700\",\"children\":[[\"$\",\"dl\",null,{\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"dt\",null,{\"className\":\"sr-only\",\"children\":\"Published on\"}],[\"$\",\"dd\",null,{\"className\":\"text-base font-medium leading-6 text-gray-500 dark:text-gray-400\",\"children\":[[\"$\",\"time\",null,{\"dateTime\":\"2023-12-02T21:22:44.113Z\",\"children\":\"December 2, 2023\"}],[\"$\",\"span\",null,{\"className\":\"mx-2\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"ml-1\",\"children\":[4,\" min read\"]}]]}]]}]}],[\"$\",\"div\",null,{\"children\":[\"$\",\"h1\",null,{\"className\":\"text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14\",\"children\":\"Efficient Nix Derivations with File Sets\"}]}]]}]}],[\"$\",\"div\",null,{\"className\":\"grid-rows-[auto_1fr] divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:divide-y-0\",\"children\":[[\"$\",\"div\",null,{\"className\":\"divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0\",\"children\":[[\"$\",\"div\",null,{\"className\":\"prose max-w-none pb-8 pt-10 dark:prose-invert\",\"children\":[[\"$\",\"$L17\",null,{\"series\":null,\"currSlug\":\"efficient-nix-derivations-with-file-sets\"}],[[\"$\",\"details\",null,{\"open\":true,\"children\":[[\"$\",\"summary\",null,{\"className\":\"ml-6 pb-2 pt-2 text-xl font-bold\",\"children\":\"Table of Contents\"}],[\"$\",\"div\",null,{\"className\":\"ml-6\",\"children\":[\"$\",\"ul\",null,{\"className\":\"\",\"children\":[[\"$\",\"li\",\"0\",{\"children\":[[\"$\",\"a\",null,{\"href\":\"#what-are-file-sets\",\"children\":\"What are file sets\"}],null]}],[\"$\",\"li\",\"1\",{\"children\":[[\"$\",\"a\",null,{\"href\":\"#a-real-example\",\"children\":\"A Real Example\"}],null]}],[\"$\",\"li\",\"2\",{\"children\":[[\"$\",\"a\",null,{\"href\":\"#wrap-up\",\"children\":\"Wrap up\"}],null]}]]}]}]]}],[\"$\",\"p\",null,{\"children\":\"If you are using Nix to build your own packages you will eventually come across something like\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"stdenv\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"mkDerivation\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"my awesome pkg\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    src\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ./.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    buildPhase\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ''\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"        # I have no idea if this actually works (the gcc call bit)\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"        # but the vibe is what I care about\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"        gcc main.c -o my_program\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"        mkdir -p $out\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"        cp my_program $out\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"    ''\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"The issue with the above is setting \",[\"$\",\"code\",null,{\"children\":\"src = ./.\"}],\", which makes \",[\"$\",\"strong\",null,{\"children\":\"ALL\"}],\" of the current directory an input to the derivation. So if you have a readme file in this folder, changing that will cause this derivation to rebuild.\"]}],[\"$\",\"p\",null,{\"children\":[\"The build only really cares about \",[\"$\",\"code\",null,{\"children\":\"main.c\"}],\" in this case so what can we do to fix this?\"]}],[\"$\",\"p\",null,{\"children\":[\"Back in the dark dark times of pre-Nixos 23.11, there were ways to do this kind of filtering but IMO they were kinda confusing and I never quite got it to work right so I just stuck with \",[\"$\",\"code\",null,{\"children\":\"src = ./.\"}]]}],[\"$\",\"p\",null,{\"children\":[\"Now with 23.11 we have \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://www.tweag.io/blog/2023-11-28-file-sets/\",\"children\":\"filesets\"}],\", which makes filtering and adding files much simpler.\"]}],[\"$\",\"h2\",null,{\"id\":\"what-are-file-sets\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#what-are-file-sets\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"What are file sets\"]}],[\"$\",\"p\",null,{\"children\":[\"I would recommend checking out the \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://nixos.org/manual/nixpkgs/unstable/#sec-functions-library-fileset\",\"children\":\"docs\"}],\" or \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://nix.dev/tutorials/file-sets\",\"children\":\"official tutorial\"}],\", but for a TLDR, you can do the following\"]}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"let\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    fs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"lib\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"fileset\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    baseSrc\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" fs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"unions\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" [ \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"./Makefile\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ./src\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" ];\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    filterMarkdownFiles\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" fs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"fileFilter\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" (file: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"hasSuffix\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\".md\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" file\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"./.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    removedMarkedDown\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" fs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"difference\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" baseSrc\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" filterMarkdownFiles\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"in\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"stdenv\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"mkDerivation\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"my awesome pkg\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    src\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" fs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"toSource\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        root\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ./.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        fileset\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" removedMarkedDown\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    buildPhase\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ''\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"       # call make or w/e you want\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"    ''\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"Now with this setup, we have a \\\"base\\\" file set of \",[\"$\",\"code\",null,{\"children\":\"[ ./Makefile ./src ]\"}],\" then with \",[\"$\",\"code\",null,{\"children\":\"fs.difference\"}],\" we can remove all files that are markdown with the \",[\"$\",\"code\",null,{\"children\":\"filterMarkdownFiles\"}],\" filter.\"]}],[\"$\",\"h2\",null,{\"id\":\"a-real-example\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#a-real-example\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"A Real Example\"]}],[\"$\",\"p\",null,{\"children\":[\"Recently I started messing around with the language \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://www.roc-lang.org/\",\"children\":\"Roc\"}],\". If you haven't heard of it, Roc is a new functional language heavily inspired by Elm. It's fast but also very nice to use (though some rough edges since it's pre-0.1.0).\"]}],[\"$\",\"p\",null,{\"children\":[\"One of its interesting ideas is that Roc needs your app to pick what \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://www.roc-lang.org/platforms\",\"children\":\"platform\"}],\" to run on. A platform would be written in something like rust, zig, c, etc. The platform provides roc APIs for things like managing memory, making network requests, printing to stdout, and other IO-like actions. Right now the two most widely used are a \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/roc-lang/basic-cli\",\"children\":\"cli platform\"}],\" and \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/roc-lang/basic-webserver\",\"children\":\"webserver platform\"}]]}],[\"$\",\"p\",null,{\"children\":\"This is really neat but brings an issue for developing a platform along with the roc code needed to define the platform API. You need to compile the \\\"platform code\\\" (ie rust + some c), do w/e linking is needed for that, then distribute that with the roc source code. The roc cli will do this for you when developing but it doesn't work as nicely to compile just the platform with nix.\"}],[\"$\",\"p\",null,{\"children\":[\"For example, \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/roc-lang/roc/tree/main/examples/platform-switching/rust-platform\",\"children\":\"this\"}],\" is one of the sample platforms\"]}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"❯\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" exa\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" --tree\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" --level\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" 2\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\".\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"├──\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" Cargo.lock\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"├──\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" Cargo.toml\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"├──\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" host.c\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"├──\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" main.roc\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"├──\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" rust-toolchain.toml\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"└──\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" src\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"   ├──\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" glue.rs\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"   ├──\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" lib.rs\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"   └──\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" main.rs\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"To build this platform you need to run a \",[\"$\",\"code\",null,{\"children\":\"cargo build --lib ...\"}],\" on the rust code, compile the \",[\"$\",\"code\",null,{\"children\":\"host.c\"}],\" file, link those two object files together, and then finally distribute the linked object file with the roc code.\"]}],[\"$\",\"p\",null,{\"children\":\"so after all those steps, it should look something like\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"❯\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" exa\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" --tree\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"compiled\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" folde\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"r\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"compiled folder\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"├──\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" linux-x64.o\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"└──\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" main.roc\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":\"The naive approach would probably be something like\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"let\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"compiledC\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" mkDerivation\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    src\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ./.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"    # compile the c ...\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"};\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"rustBuiltLib\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" buildRustPackage\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    src\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ./.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"    # build the rust\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"};\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"in\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"llvmPkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"stdenv\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"mkDerivation\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" rec\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"$${\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"pname\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"}\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"-\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"$${\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"version\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"}\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  srcs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" [\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"    rustBuiltLib\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"    compiledC\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"    ./.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\" # for the roc code\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"  ];\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  sourceRoot\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\".\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  buildPhase\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ''\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"    # link the rust and c files\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"    # copy roc and linked object out\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"  ''\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"while this works, it also sucks. \",[\"$\",\"strong\",null,{\"children\":\"ANY\"}],\" change to the files will cause all 3 derivations to be rebuilt.\"]}],[\"$\",\"p\",null,{\"children\":\"Now with filesets we can be all cute and fancy\"}],[\"$\",\"div\",null,{\"className\":\"grid place-content-center\",\"children\":[\"$\",\"div\",null,{\"className\":\"rounded bg-gray-100 dark:bg-gray-800\",\"children\":[\"$\",\"div\",null,{\"className\":\"box-content px-3 py-0\",\"children\":[\"$\",\"p\",null,{\"children\":[\"This example will have many parts omitted to keep the code easy to follow. To see the real code, look at my \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/JRMurr/roc2nix/blob/main/lib/platformBuilders/buildRustPlatform.nix\",\"children\":\"roc2nix repo\"}],\" where this came from\"]}]}]}]}],[\"$\",\"p\",null,{\"children\":\"First let's define a helper file for filtering files based on their extension\"}],[\"$\",\"div\",null,{\"className\":\"remark-code-title\",\"children\":\"languageFilters.nix\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"{lib}:\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"# Note i generally don't like doing `with` at the top of a file\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"# but since this will be only fileSet stuff it should be fine\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"with\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" lib\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"fileset\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"let\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"    # helper func to take in a list of allowed\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"    # returns a function of `file =\u003e bool` to be used in a fileFilter.\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"    # true if file has suffix, false if not\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    fileHasAnySuffix\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" fileSuffixes: file: (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"lib\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"lists\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"any\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" (s: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"lib\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"hasSuffix\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" s\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" file\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"fileSuffixes\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"    # given a basePath src path, return a fileset of files in that path that are rust files, toml files, or cargo toml/lock\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    rustFilter\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" basePath: (\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"        let\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        mainFilter\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" fileFilter\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"            (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"fileHasAnySuffix\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" [ \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\".rs\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\".toml\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" ])\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"            basePath\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"        in\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"        unions\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" [ \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"mainFilter\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"basePath\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" +\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"/Cargo.toml\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\") (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"basePath\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" +\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"/Cargo.lock\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\") ]\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    );\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"    # given a basePath src path return a fileset with files ending with `.c`\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    cFilter\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" basePath: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"fileFilter\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"fileHasAnySuffix\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" [ \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\".c\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" ]) \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"basePath\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"    # given a basePath src path return a fileset with files ending with `.roc`\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    rocFilter\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" basePath: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"fileFilter\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"fileHasAnySuffix\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" [ \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\".roc\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" ]) \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"basePath\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"in\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"{\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"  inherit\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" rustFilter\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" cFilter\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" rocFilter\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":\"Now with that helper, we can do\"}],[\"$\",\"div\",null,{\"className\":\"remark-code-title\",\"children\":\"buildRustPlatform.nix\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"let\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  fs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" lib\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"fileset\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  languageFilters\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" import\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ./languageFilters.nix\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"inherit\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" lib\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";};\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  baseDir\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ./.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  compiledC\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" mkDerivation\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"      src\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" fs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"toSource\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          root\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" baseDir\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          fileset\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" languageFilters\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"cFilter\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" baseDir\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"      };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"      # compile the c ...\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"  };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  rustBuiltLib\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" buildRustPackage\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"      src\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" fs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"toSource\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        root\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" baseDir\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        fileset\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" languageFilters\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"rustFilter\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" baseDir\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"      };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"      # build the rust\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"  };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  rocCode\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" fs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"toSource\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"      root\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" baseDir\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"      fileset\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" languageFilters\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"rocFilter\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" baseDir\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"  };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"in\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"llvmPkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"stdenv\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"mkDerivation\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" rec\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"$${\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"pname\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"}\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"-\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"$${\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"version\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"}\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  srcs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" [\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"    rustBuiltLib\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"    compiledC\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"    rocCode\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"  ];\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  sourceRoot\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\".\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  buildPhase\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ''\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"    # NOTE: this link could be pulled into its own derivation for even better seperation\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"    # I only just realized this while making this post...\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"    $LD -r -L \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"$${\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"rustBuildName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"}\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"/lib \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"$${\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"cBuildName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"}\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"$${\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"cHostDest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"}\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" -lhost -o \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"$${\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"host_dest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"    mkdir -p $out\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"    cp \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"$${\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"host_dest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"}\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" $out/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"$${\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"host_dest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"}\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"    cp -r \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"$${\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"rocCode\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"}\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"/. $out\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"  ''\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":\"Now this is about as good as you can get. The rust and c builds have no dependency on each other so you are free to modify the c without needing to rebuild the rust.\"}],[\"$\",\"p\",null,{\"children\":\"If you only change the roc code, you won't need to do any build (other than linking but in this example that could also be pulled out....).\"}],[\"$\",\"h2\",null,{\"id\":\"wrap-up\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#wrap-up\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Wrap up\"]}],[\"$\",\"p\",null,{\"children\":[\"Huge shoutout to \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/infinisil\",\"children\":\"Silvan Mosberger\"}],\" from \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://www.tweag.io/\",\"children\":\"Tweag\"}],\" for bringing file sets to the main Nix library. He was sponsored through my current employer \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://antithesis.com/\",\"children\":\"Antithesis\"}],\" to develop this feature!\"]}],[\"$\",\"p\",null,{\"children\":[\"I hope filesets make more people take a stab at making their own \",[\"$\",\"code\",null,{\"children\":\"*2nix\"}],\" builders, or just make their own builds more efficent.\"]}],[\"$\",\"p\",null,{\"children\":[\"I had a lot of fun working on \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/JRMurr/roc2nix/\",\"children\":\"roc2nix\"}],\", it was my first time making a \\\"real\\\" nix library and I learned a lot along the way (not just file sets). If you are interested in learning more about it check out the repo or let me know in the comments and I might make a separate blog diving into that (and hopefully some blogs on roc itself).\"]}]]]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"div\",null,{\"className\":\"pb-6 pt-6 text-sm text-gray-700 dark:text-gray-300\",\"children\":[[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"nofollow\",\"href\":\"https://mobile.twitter.com/search?q=https%3A%2F%2Fjohns.codes%2Fblog%2Fefficient-nix-derivations-with-file-sets\",\"children\":\"Discuss on Twitter\"}],\" • \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/JRMurr/JRMurr.github.io/blob/main/content/blog/efficient-nix-derivations-with-file-sets.md\",\"children\":\"View on GitHub\"}]]}],[\"$\",\"div\",null,{\"className\":\"pb-6 pt-6 text-center text-gray-700 dark:text-gray-300\",\"id\":\"comment\",\"children\":[\"$\",\"$L19\",null,{}]}],\"$undefined\"]}]]}],[\"$\",\"footer\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col text-sm font-medium sm:flex-row sm:justify-between sm:text-base\",\"children\":[[\"$\",\"div\",null,{\"className\":\"pt-4 xl:pt-8\",\"children\":[\"$\",\"$Le\",null,{\"href\":\"/blog/organizing-system-configs-with-nixos\",\"className\":\"text-primary-500 hover:text-primary-600 dark:hover:text-primary-400\",\"aria-label\":\"Previous post: Organizing system configs with NixOS\",\"children\":[\"← \",\"Organizing system configs with NixOS\"]}]}],\"$undefined\"]}]}]]}]]}]}]]}]]\n"])</script><script>self.__next_f.push([1,"13:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Efficient Nix Derivations with File Sets | John's Codes\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Using nix's new file set API to make efficient derivations\"}],[\"$\",\"meta\",\"4\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"5\",{\"name\":\"googlebot\",\"content\":\"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1\"}],[\"$\",\"link\",\"6\",{\"rel\":\"canonical\",\"href\":\"https://johns.codes/blog/efficient-nix-derivations-with-file-sets\"}],[\"$\",\"link\",\"7\",{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"https://johns.codes/feed.xml\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:title\",\"content\":\"Efficient Nix Derivations with File Sets\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:description\",\"content\":\"Using nix's new file set API to make efficient derivations\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:url\",\"content\":\"https://johns.codes/blog/efficient-nix-derivations-with-file-sets\"}],[\"$\",\"meta\",\"11\",{\"property\":\"og:site_name\",\"content\":\"John's Codes\"}],[\"$\",\"meta\",\"12\",{\"property\":\"og:locale\",\"content\":\"en_US\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"14\",{\"property\":\"article:published_time\",\"content\":\"2023-12-02T21:22:44.113Z\"}],[\"$\",\"meta\",\"15\",{\"property\":\"article:modified_time\",\"content\":\"2023-12-02T21:22:44.113Z\"}],[\"$\",\"meta\",\"16\",{\"property\":\"article:author\",\"content\":\"John Murray\"}],[\"$\",\"meta\",\"17\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"18\",{\"name\":\"twitter:title\",\"content\":\"Efficient Nix Derivations with File Sets\"}],[\"$\",\"meta\",\"19\",{\"name\":\"twitter:description\",\"content\":\"Using nix's new file set API to make efficient derivations\"}],[\"$\",\"meta\",\"20\",{\"name\":\"next-size-adjust\"}]]\n"])</script><script>self.__next_f.push([1,"6:null\n"])</script><script>self.__next_f.push([1,""])</script></body></html>