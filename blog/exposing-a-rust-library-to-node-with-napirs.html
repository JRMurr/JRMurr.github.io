<!DOCTYPE html><html lang="en-us" class="__variable_587f35 scroll-smooth"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/2d141e1a38819612-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/895662d5d095c22a.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/14fb540b7a3ad639.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-278bcb5a0daf8917.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-28d8581e6e02654e.js" async="" crossorigin=""></script><script src="/_next/static/chunks/69-dbeadf5c9f0cdabc.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-bef4f1fcfc072c84.js" async="" crossorigin=""></script><script src="/_next/static/chunks/250-a30085ccab20449f.js" async=""></script><script src="/_next/static/chunks/781-9238b26c3a132736.js" async=""></script><script src="/_next/static/chunks/app/layout-bdf5ad57b961fc92.js" async=""></script><script src="/_next/static/chunks/749-ed776d54eb5c7205.js" async=""></script><script src="/_next/static/chunks/app/blog/%5B...slug%5D/page-04bc103f80b6f059.js" async=""></script><title>Exposing a Rust Library to Node with Napi-rs | John&#x27;s Codes</title><meta name="description" content="Short guide/exploration on making native node addons with rust"/><meta name="robots" content="index, follow"/><meta name="googlebot" content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"/><link rel="canonical" href="https://johns.codes/blog/exposing-a-rust-library-to-node-with-napirs"/><link rel="alternate" type="application/rss+xml" href="https://johns.codes/feed.xml"/><meta property="og:title" content="Exposing a Rust Library to Node with Napi-rs"/><meta property="og:description" content="Short guide/exploration on making native node addons with rust"/><meta property="og:url" content="https://johns.codes/blog/exposing-a-rust-library-to-node-with-napirs"/><meta property="og:site_name" content="John&#x27;s Codes"/><meta property="og:locale" content="en_US"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2023-05-01T17:21:59.515Z"/><meta property="article:modified_time" content="2023-05-01T17:21:59.515Z"/><meta property="article:author" content="John Murray"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Exposing a Rust Library to Node with Napi-rs"/><meta name="twitter:description" content="Short guide/exploration on making native node addons with rust"/><meta name="next-size-adjust"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-950 dark:text-white"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><section class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between font-sans"><header class="flex items-center justify-between py-10"><div><a aria-label="John&#x27;s Codes" href="/"><div class="flex items-center justify-between"><div class="hidden h-6 text-2xl font-semibold sm:block">John&#x27;s Codes</div></div></a></div><div class="flex items-center space-x-4 leading-5 sm:space-x-6"><a class="hidden font-medium text-gray-900 dark:text-gray-100 sm:block" href="/blog">Blog</a><a class="hidden font-medium text-gray-900 dark:text-gray-100 sm:block" href="/tags">Tags</a><a class="hidden font-medium text-gray-900 dark:text-gray-100 sm:block" href="/projects">Projects</a><a class="hidden font-medium text-gray-900 dark:text-gray-100 sm:block" href="/about">About</a><button aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6 text-gray-900 dark:text-gray-100"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path></svg></button><button aria-label="Toggle Menu" class="sm:hidden"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-8 w-8 text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed left-0 top-0 z-10 h-full w-full transform bg-white opacity-95 duration-300 ease-in-out dark:bg-gray-950 dark:opacity-[0.98] translate-x-full"><div class="flex justify-end"><button class="mr-8 mt-11 h-8 w-8" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/">Home</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/projects">Projects</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></header><main class="mb-auto"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Exposing a Rust Library to Node with Napi-rs","datePublished":"2023-05-01T17:21:59.515Z","dateModified":"2023-05-01T17:21:59.515Z","description":"Short guide/exploration on making native node addons with rust","author":[{"@type":"Person","name":"John Murray"}]}</script><section class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed bottom-8 right-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div><header><div class="space-y-1 border-b border-gray-200 pb-10 text-center dark:border-gray-700"><dl><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2023-05-01T17:21:59.515Z">May 1, 2023</time><span class="mx-2">-</span><span class="ml-1">7<!-- --> min read</span></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Exposing a Rust Library to Node with Napi-rs</h1></div></div></header><div class="grid-rows-[auto_1fr] divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:divide-y-0"><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pb-8 pt-10 dark:prose-invert"><details open=""><summary class="ml-6 pb-2 pt-2 text-xl font-bold">Table of Contents</summary><div class="ml-6"><ul class=""><li><a href="#why">Why?</a></li><li><a href="#setting-up-napi">Setting up napi</a></li><li><a href="#using-napi">Using napi</a><ul class=""><li><a href="#allowed-values">Allowed values</a></li><li><a href="#exposing-classes">Exposing Classes</a></li></ul></li><li><a href="#async-support">Async Support</a></li><li><a href="#napi-limitations">napi limitations</a></li><li><a href="#wrap-up">Wrap up</a></li></ul></div></details><p>I unapologetically shill Rust every chance I get, annoying my coworkers by insisting that everything would be better if we just used Rust. At this point, it has become a bit of a meme, so no one listens to me (rightfully so).</p><p>To finally put an end to the meme, I decided to research ways we could incorporate Rust into our systems. Ideally, we would create a new service in Rust, but since we are not yet big on microservices, the best approach would be to call Rust directly from our Node monolith.</p><p>Since Node is written in C++, it provides ways to call native code via <a target="_blank" rel="noopener noreferrer" href="https://nodejs.org/api/addons.html">addons</a>. The <a target="_blank" rel="noopener noreferrer" href="https://napi.rs/">napi-rs</a> library helps with the boilerplate of exposing Rust code as a Node addon.</p><p>Napi-rs along with generating the node addon will also generate typescript type definitions and has a nice CLI to more easily make addons for all popular systems/architectures.</p><h2 id="why"><a href="#why" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Why?</h2><p>BECAUSE I CAN.</p><p>For real though, there are several reasons why creating a native Rust addon for a Node app could be beneficial:</p><ul><li>Native code can be much more performant than JavaScript for certain use cases (although the JIT does help a lot).</li><li>Compared to C++ addons, building and deploying with napi is much easier. However, I have limited experience managing C++ addons.</li><li>Many <a target="_blank" rel="noopener noreferrer" href="https://lib.rs/">Rust libraries</a> would be nice to reuse in Node.</li><li>Subjectively, Rust is a great language to write in. It has been voted the most loved language for the last few years for a reason.</li></ul><h2 id="setting-up-napi"><a href="#setting-up-napi" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Setting up napi</h2><p>I&#x27;m going to experiment with napi in the codebase from the <a href="/blog/build-a-db/part01">build a db in rust series</a>, branch with all the code <a target="_blank" rel="noopener noreferrer" href="https://github.com/JRMurr/SQLJr/tree/napi-bindings/crates/sql_jr_node">here</a>.</p><p>Most of the following is taken from the <a target="_blank" rel="noopener noreferrer" href="https://napi.rs/docs/introduction/getting-started">napi getting started docs</a></p><p>You first need to install the napi CLI, which can be done with your favorite node package manager of choice. While I could use npm/yarn/pnpm, I like to use nix flakes, so I added the following to my project&#x27;s flake file</p><div class="remark-code-title">flake.nix</div><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#e36209;--shiki-dark:#FFAB70">  buildInputs</span><span style="color:#b31d28;--shiki-dark:#FDAEB7;font-style:italic;--shiki-dark-font-style:italic"> =</span><span style="color:#b31d28;--shiki-dark:#FDAEB7;font-style:italic;--shiki-dark-font-style:italic"> with</span><span style="color:#e36209;--shiki-dark:#FFAB70"> pkgs</span><span style="color:#b31d28;--shiki-dark:#FDAEB7;font-style:italic;--shiki-dark-font-style:italic">;</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#e36209;--shiki-dark:#FFAB70">     napi-rs-cli</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">  ]</span><span style="color:#b31d28;--shiki-dark:#FDAEB7;font-style:italic;--shiki-dark-font-style:italic">;</span></span>
<span class="line"></span></code></pre></div><p>The CLI generates a Rust crate with the appropriate build scripts to build the node addon, along with the necessary node boilerplate to load the addon with type definitions. Additionally, it includes some GitHub actions to build and publish the npm packages.</p><p>Run the CLI with</p><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">napi</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> new</span></span>
<span class="line"></span></code></pre></div><p>You will get an interactive prompt to give a package name and folder path (useful if you use cargo workspaces). The docs recommend prefixing the package name with a <a target="_blank" rel="noopener noreferrer" href="https://docs.npmjs.com/creating-and-publishing-scoped-public-packages/">npm scope</a> since napi will publish multiple packages for different architectures.</p><p>The generated rust will look like</p><div class="remark-code-title">src/lib.rs</div><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">// imports excluded</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">#[napi]</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">pub</span><span style="color:#d73a49;--shiki-dark:#F97583"> fn</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> sum</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(a</span><span style="color:#d73a49;--shiki-dark:#F97583">:</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> i32</span><span style="color:#24292e;--shiki-dark:#E1E4E8">, b</span><span style="color:#d73a49;--shiki-dark:#F97583">:</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> i32</span><span style="color:#24292e;--shiki-dark:#E1E4E8">) </span><span style="color:#d73a49;--shiki-dark:#F97583">-&gt;</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> i32</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">  a </span><span style="color:#d73a49;--shiki-dark:#F97583">+</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> b</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre></div><p>A generated test file that uses the node addon looks like</p><div class="remark-code-title">__test__/index.spec.mjs</div><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">import</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> test </span><span style="color:#d73a49;--shiki-dark:#F97583">from</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &#x27;ava&#x27;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">import</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> { sum } </span><span style="color:#d73a49;--shiki-dark:#F97583">from</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &#x27;../index.js&#x27;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">test</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#032f62;--shiki-dark:#9ECBFF">&#x27;sum from native&#x27;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">, (</span><span style="color:#e36209;--shiki-dark:#FFAB70">t</span><span style="color:#24292e;--shiki-dark:#E1E4E8">) </span><span style="color:#d73a49;--shiki-dark:#F97583">=&gt;</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">  t.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">is</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#6f42c1;--shiki-dark:#B392F0">sum</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#005cc5;--shiki-dark:#79B8FF">1</span><span style="color:#24292e;--shiki-dark:#E1E4E8">, </span><span style="color:#005cc5;--shiki-dark:#79B8FF">2</span><span style="color:#24292e;--shiki-dark:#E1E4E8">), </span><span style="color:#005cc5;--shiki-dark:#79B8FF">3</span><span style="color:#24292e;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">})</span></span>
<span class="line"></span></code></pre></div><p>The other main piece is the <code>index.js</code> file at the package root which has all the logic for loading the right addon for each architecture.</p><p>you can then run the following to build the addon, generate TS types, and run tests</p><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">npm</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> install</span><span style="color:#6a737d;--shiki-dark:#6A737D"> # replace with your node package manager of choice</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">npm</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> run</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> build</span><span style="color:#6a737d;--shiki-dark:#6A737D"> # builds the rust code into a node addon + add typescript definitons</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">npm</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> run</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> test</span><span style="color:#6a737d;--shiki-dark:#6A737D"> # runs the sample js test file using the node addon</span></span>
<span class="line"></span></code></pre></div><p>After the build step, you should see and <code>index.d.ts</code> file that looks like</p><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">/* tslint:disable */</span></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">/* eslint-disable */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">/* auto-generated by NAPI-RS */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">export</span><span style="color:#d73a49;--shiki-dark:#F97583"> function</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> sum</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#e36209;--shiki-dark:#FFAB70">a</span><span style="color:#d73a49;--shiki-dark:#F97583">:</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> number</span><span style="color:#24292e;--shiki-dark:#E1E4E8">, </span><span style="color:#e36209;--shiki-dark:#FFAB70">b</span><span style="color:#d73a49;--shiki-dark:#F97583">:</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> number</span><span style="color:#24292e;--shiki-dark:#E1E4E8">)</span><span style="color:#d73a49;--shiki-dark:#F97583">:</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> number</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span></code></pre></div><h2 id="using-napi"><a href="#using-napi" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Using napi</h2><p>To explore more of napi, let&#x27;s write a rust function that does something slightly more sophisticated with my SQL_JR db.</p><div class="remark-code-title">src/lib.rs</div><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">#[napi]</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">pub</span><span style="color:#d73a49;--shiki-dark:#F97583"> fn</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> basic_query</span><span style="color:#24292e;--shiki-dark:#E1E4E8">() </span><span style="color:#d73a49;--shiki-dark:#F97583">-&gt;</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> Vec</span><span style="color:#24292e;--shiki-dark:#E1E4E8">&lt;</span><span style="color:#6f42c1;--shiki-dark:#B392F0">Vec</span><span style="color:#24292e;--shiki-dark:#E1E4E8">&lt;</span><span style="color:#6f42c1;--shiki-dark:#B392F0">String</span><span style="color:#24292e;--shiki-dark:#E1E4E8">&gt;&gt; {</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">    let</span><span style="color:#d73a49;--shiki-dark:#F97583"> mut</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> exec </span><span style="color:#d73a49;--shiki-dark:#F97583">=</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> sql_jr_execution</span><span style="color:#d73a49;--shiki-dark:#F97583">::</span><span style="color:#6f42c1;--shiki-dark:#B392F0">Execution</span><span style="color:#d73a49;--shiki-dark:#F97583">::</span><span style="color:#6f42c1;--shiki-dark:#B392F0">new</span><span style="color:#24292e;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    exec</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">parse_and_run</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">        &quot;</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">      CREATE TABLE foo (</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">        col1 int,</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">        col2 string</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">      );</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">    &quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    )</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">    .</span><span style="color:#6f42c1;--shiki-dark:#B392F0">expect</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;create works..&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    exec</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">parse_and_run</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">        &quot;</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">        INSERT INTO foo</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">        VALUES</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            1, &#x27;aString&#x27;;</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">      &quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    )</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">    .</span><span style="color:#6f42c1;--shiki-dark:#B392F0">expect</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;insert 1 works..&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    exec</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">parse_and_run</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">        &quot;</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">        INSERT INTO foo</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">        VALUES</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            4, &#x27;aDiffString with spaces&#x27;;</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">    &quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    )</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">    .</span><span style="color:#6f42c1;--shiki-dark:#B392F0">expect</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;insert 2 works..&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">    let</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> res </span><span style="color:#d73a49;--shiki-dark:#F97583">=</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> exec</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">        .</span><span style="color:#6f42c1;--shiki-dark:#B392F0">parse_and_run</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            &quot;</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">        SELECT</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">          col1,</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">          col2</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">        FROM</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            foo;</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">        &quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">        )</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">        .</span><span style="color:#6f42c1;--shiki-dark:#B392F0">expect</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;select works&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">    match</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> res {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        ExecResponse</span><span style="color:#d73a49;--shiki-dark:#F97583">::</span><span style="color:#6f42c1;--shiki-dark:#B392F0">Select</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(table_iter) </span><span style="color:#d73a49;--shiki-dark:#F97583">=&gt;</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">            let</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> columns</span><span style="color:#d73a49;--shiki-dark:#F97583">:</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> Vec</span><span style="color:#24292e;--shiki-dark:#E1E4E8">&lt;</span><span style="color:#6f42c1;--shiki-dark:#B392F0">String</span><span style="color:#24292e;--shiki-dark:#E1E4E8">&gt; </span><span style="color:#d73a49;--shiki-dark:#F97583">=</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> table_iter</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">                .</span><span style="color:#24292e;--shiki-dark:#E1E4E8">columns</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">                .</span><span style="color:#6f42c1;--shiki-dark:#B392F0">iter</span><span style="color:#24292e;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">                .</span><span style="color:#6f42c1;--shiki-dark:#B392F0">map</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#d73a49;--shiki-dark:#F97583">|</span><span style="color:#24292e;--shiki-dark:#E1E4E8">col</span><span style="color:#d73a49;--shiki-dark:#F97583">|</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> col</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#24292e;--shiki-dark:#E1E4E8">name</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">to_string</span><span style="color:#24292e;--shiki-dark:#E1E4E8">())</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">                .</span><span style="color:#6f42c1;--shiki-dark:#B392F0">collect</span><span style="color:#24292e;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">            let</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> rows</span><span style="color:#d73a49;--shiki-dark:#F97583">:</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> Vec</span><span style="color:#24292e;--shiki-dark:#E1E4E8">&lt;</span><span style="color:#6f42c1;--shiki-dark:#B392F0">Vec</span><span style="color:#24292e;--shiki-dark:#E1E4E8">&lt;_&gt;&gt; </span><span style="color:#d73a49;--shiki-dark:#F97583">=</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> table_iter</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">                .</span><span style="color:#6f42c1;--shiki-dark:#B392F0">map</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#d73a49;--shiki-dark:#F97583">|</span><span style="color:#24292e;--shiki-dark:#E1E4E8">row</span><span style="color:#d73a49;--shiki-dark:#F97583">|</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">                    columns</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">                        .</span><span style="color:#6f42c1;--shiki-dark:#B392F0">iter</span><span style="color:#24292e;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">                        .</span><span style="color:#6f42c1;--shiki-dark:#B392F0">map</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#d73a49;--shiki-dark:#F97583">move</span><span style="color:#d73a49;--shiki-dark:#F97583"> |</span><span style="color:#24292e;--shiki-dark:#E1E4E8">col</span><span style="color:#d73a49;--shiki-dark:#F97583">|</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> row</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">get</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(col)</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">to_string</span><span style="color:#24292e;--shiki-dark:#E1E4E8">())</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">                        .</span><span style="color:#6f42c1;--shiki-dark:#B392F0">collect</span><span style="color:#24292e;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">                })</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">                .</span><span style="color:#6f42c1;--shiki-dark:#B392F0">collect</span><span style="color:#24292e;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">            rows</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">        _ </span><span style="color:#d73a49;--shiki-dark:#F97583">=&gt;</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> unreachable!</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(),</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre></div><p>The above code is very jank rust, but it will get the job done for exploring for now. After running the build we can use it in this test file</p><div class="remark-code-title">__test__/index.spec.mjs</div><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">import</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> test </span><span style="color:#d73a49;--shiki-dark:#F97583">from</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;ava&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">import</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> { basicQuery } </span><span style="color:#d73a49;--shiki-dark:#F97583">from</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;../index.js&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">test</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;basic test&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">, (</span><span style="color:#e36209;--shiki-dark:#FFAB70">t</span><span style="color:#24292e;--shiki-dark:#E1E4E8">) </span><span style="color:#d73a49;--shiki-dark:#F97583">=&gt;</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">  t.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">deepEqual</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#6f42c1;--shiki-dark:#B392F0">basicQuery</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(), [</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    [</span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;1&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">, </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;aString&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">],</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    [</span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;4&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">, </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;aDiffString with spaces&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">],</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">  ]);</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">});</span></span>
<span class="line"></span></code></pre></div><p>One thing you&#x27;ll notice is the casing of <code>basic_query</code> in rust was changed to <code>basicQuery</code> in JS.</p><h3 id="allowed-values"><a href="#allowed-values" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Allowed values</h3><p>When exposing a function with the napi macro you are limited to what types are supported in the arguments/returns types. The function doc page lists them <a target="_blank" rel="noopener noreferrer" href="https://napi.rs/docs/concepts/function#arguments">here</a>. The TLDR is most &quot;primitive&quot; rust types are supported and any struct you add the <code>#[napi]</code> macro too. This could cause issues with third-party libraries, so you probably will need to make your own wrapper types to pass them between rust and node.</p><h3 id="exposing-classes"><a href="#exposing-classes" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Exposing Classes</h3><p>While the above works it&#x27;s very restrictive and crappy rust, so let&#x27;s expose a wrapper around <code>sql_jr_execution::Execution</code>, so the node side can run arbitrary queries + track state.</p><p>Like we did with functions you can add the <code>#[napi]</code> macro above structs to expose them as a JS class. While we could add that macro in the <code>sql_jr_execution</code> crate on the <code>Execution</code> struct itself I think it will be better to have a napi crate + explicit wrapper structs to keep the API of the node addon more stable. Also, as you will come to see there are some limitations on the exposed code that would be nice to not litter the rest of the code base with.</p><p>So let&#x27;s make a <code>NodeExec</code> struct like this</p><div class="remark-code-title">src/lib.rs</div><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">#[napi(js_name </span><span style="color:#d73a49;--shiki-dark:#F97583">=</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;Execution&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">)]</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">pub</span><span style="color:#d73a49;--shiki-dark:#F97583"> struct</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> NodeExec</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    execution</span><span style="color:#d73a49;--shiki-dark:#F97583">:</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> Execution</span><span style="color:#24292e;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">#[napi]</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">impl</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> NodeExec</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    #[napi(constructor)]</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">    pub</span><span style="color:#d73a49;--shiki-dark:#F97583"> fn</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> new</span><span style="color:#24292e;--shiki-dark:#E1E4E8">() </span><span style="color:#d73a49;--shiki-dark:#F97583">-&gt;</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> Self</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79B8FF">        Self</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">            execution</span><span style="color:#d73a49;--shiki-dark:#F97583">:</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> Execution</span><span style="color:#d73a49;--shiki-dark:#F97583">::</span><span style="color:#6f42c1;--shiki-dark:#B392F0">new</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(),</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre></div><p>This will expose a JS class called <code>Execution</code> with a constructor corresponding to the <code>new</code> function.</p><p>Let&#x27;s add a class method that will run a query and return an array of records when it was a select query.</p><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">/// A List of rows returned by the query.</span></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">/// Each row is a map of col =&gt; data as string</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">type</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> QueryRes</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> Vec</span><span style="color:#24292e;--shiki-dark:#E1E4E8">&lt;</span><span style="color:#6f42c1;--shiki-dark:#B392F0">HashMap</span><span style="color:#24292e;--shiki-dark:#E1E4E8">&lt;</span><span style="color:#6f42c1;--shiki-dark:#B392F0">String</span><span style="color:#24292e;--shiki-dark:#E1E4E8">, </span><span style="color:#6f42c1;--shiki-dark:#B392F0">String</span><span style="color:#24292e;--shiki-dark:#E1E4E8">&gt;&gt;;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">#[napi]</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">impl</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> NodeExec</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">  #[napi(ts_return_type </span><span style="color:#d73a49;--shiki-dark:#F97583">=</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;Array&lt;Record&lt;string,string&gt;&gt;&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">)]</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">  pub</span><span style="color:#d73a49;--shiki-dark:#F97583"> fn</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> query</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#d73a49;--shiki-dark:#F97583">&amp;mut</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292e;--shiki-dark:#E1E4E8">, query</span><span style="color:#d73a49;--shiki-dark:#F97583">:</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> String</span><span style="color:#24292e;--shiki-dark:#E1E4E8">) </span><span style="color:#d73a49;--shiki-dark:#F97583">-&gt;</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> napi</span><span style="color:#d73a49;--shiki-dark:#F97583">::</span><span style="color:#6f42c1;--shiki-dark:#B392F0">Result</span><span style="color:#24292e;--shiki-dark:#E1E4E8">&lt;</span><span style="color:#6f42c1;--shiki-dark:#B392F0">QueryRes</span><span style="color:#24292e;--shiki-dark:#E1E4E8">&gt; {</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">      use</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> napi</span><span style="color:#d73a49;--shiki-dark:#F97583">::</span><span style="color:#24292e;--shiki-dark:#E1E4E8">{</span><span style="color:#6f42c1;--shiki-dark:#B392F0">Error</span><span style="color:#24292e;--shiki-dark:#E1E4E8">, </span><span style="color:#6f42c1;--shiki-dark:#B392F0">Status</span><span style="color:#24292e;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">      let</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> res </span><span style="color:#d73a49;--shiki-dark:#F97583">=</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> self</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">          .</span><span style="color:#24292e;--shiki-dark:#E1E4E8">execution</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">          .</span><span style="color:#6f42c1;--shiki-dark:#B392F0">parse_and_run</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#d73a49;--shiki-dark:#F97583">&amp;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">query)</span></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">          // Probably a good idea to impl From&lt;SqlError&lt;_&gt; for napi::Error in sql_jr_execution</span></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">          // gated behind a napi feature flag</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">          .</span><span style="color:#6f42c1;--shiki-dark:#B392F0">map_err</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#d73a49;--shiki-dark:#F97583">|</span><span style="color:#24292e;--shiki-dark:#E1E4E8">e</span><span style="color:#d73a49;--shiki-dark:#F97583">|</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> Error</span><span style="color:#d73a49;--shiki-dark:#F97583">::</span><span style="color:#6f42c1;--shiki-dark:#B392F0">new</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#6f42c1;--shiki-dark:#B392F0">Status</span><span style="color:#d73a49;--shiki-dark:#F97583">::</span><span style="color:#6f42c1;--shiki-dark:#B392F0">GenericFailure</span><span style="color:#24292e;--shiki-dark:#E1E4E8">, </span><span style="color:#6f42c1;--shiki-dark:#B392F0">format!</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;{}&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">, e)))</span><span style="color:#d73a49;--shiki-dark:#F97583">?</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">      Ok</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#d73a49;--shiki-dark:#F97583">match</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> res {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          ExecResponse</span><span style="color:#d73a49;--shiki-dark:#F97583">::</span><span style="color:#6f42c1;--shiki-dark:#B392F0">Select</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(table_iter) </span><span style="color:#d73a49;--shiki-dark:#F97583">=&gt;</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">              let</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> columns</span><span style="color:#d73a49;--shiki-dark:#F97583">:</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> Vec</span><span style="color:#24292e;--shiki-dark:#E1E4E8">&lt;</span><span style="color:#6f42c1;--shiki-dark:#B392F0">String</span><span style="color:#24292e;--shiki-dark:#E1E4E8">&gt; </span><span style="color:#d73a49;--shiki-dark:#F97583">=</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> table_iter</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">                  .</span><span style="color:#24292e;--shiki-dark:#E1E4E8">columns</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">                  .</span><span style="color:#6f42c1;--shiki-dark:#B392F0">iter</span><span style="color:#24292e;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">                  .</span><span style="color:#6f42c1;--shiki-dark:#B392F0">map</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#d73a49;--shiki-dark:#F97583">|</span><span style="color:#24292e;--shiki-dark:#E1E4E8">col</span><span style="color:#d73a49;--shiki-dark:#F97583">|</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> col</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#24292e;--shiki-dark:#E1E4E8">name</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">to_string</span><span style="color:#24292e;--shiki-dark:#E1E4E8">())</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">                  .</span><span style="color:#6f42c1;--shiki-dark:#B392F0">collect</span><span style="color:#24292e;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">              table_iter</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">                  .</span><span style="color:#6f42c1;--shiki-dark:#B392F0">map</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#d73a49;--shiki-dark:#F97583">|</span><span style="color:#24292e;--shiki-dark:#E1E4E8">row</span><span style="color:#d73a49;--shiki-dark:#F97583">|</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">                      columns</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">                          .</span><span style="color:#6f42c1;--shiki-dark:#B392F0">iter</span><span style="color:#24292e;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">                          .</span><span style="color:#6f42c1;--shiki-dark:#B392F0">map</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#d73a49;--shiki-dark:#F97583">move</span><span style="color:#d73a49;--shiki-dark:#F97583"> |</span><span style="color:#24292e;--shiki-dark:#E1E4E8">col</span><span style="color:#d73a49;--shiki-dark:#F97583">|</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> (col</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">clone</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(), row</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">get</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(col)</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">to_string</span><span style="color:#24292e;--shiki-dark:#E1E4E8">()))</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">                          .</span><span style="color:#6f42c1;--shiki-dark:#B392F0">collect</span><span style="color:#24292e;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">                  })</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">                  .</span><span style="color:#6f42c1;--shiki-dark:#B392F0">collect</span><span style="color:#24292e;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">          }</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">          _ </span><span style="color:#d73a49;--shiki-dark:#F97583">=&gt;</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> Vec</span><span style="color:#d73a49;--shiki-dark:#F97583">::</span><span style="color:#6f42c1;--shiki-dark:#B392F0">new</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(),</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">      })</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre></div><p>First, we need to manually set <code>ts_return_type = &quot;Array&lt;Record&lt;string,string&gt;&gt;&quot;</code> since we used a type alias in the function signatures. This is due to some limitations in how <a target="_blank" rel="noopener noreferrer" href="https://github.com/napi-rs/napi-rs/issues/1019#issuecomment-1009116165">proc macros in rust work</a>.</p><p>Second we needed to convert the returned Error from <code>parse_and_run</code> into a <code>napi::Error</code> with <code>.map_err(|e| Error::new(Status::GenericFailure, format!(&quot;{}&quot;, e)))</code>. This is not the best conversion since it would just stringify the execution error, but it&#x27;s not the end of the world.</p><p>The generated typescript looks like</p><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">/* tslint:disable */</span></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">/* eslint-disable */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">/* auto-generated by NAPI-RS */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">export</span><span style="color:#d73a49;--shiki-dark:#F97583"> function</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> basicQuery</span><span style="color:#24292e;--shiki-dark:#E1E4E8">()</span><span style="color:#d73a49;--shiki-dark:#F97583">:</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> Array</span><span style="color:#24292e;--shiki-dark:#E1E4E8">&lt;</span><span style="color:#6f42c1;--shiki-dark:#B392F0">Array</span><span style="color:#24292e;--shiki-dark:#E1E4E8">&lt;</span><span style="color:#005cc5;--shiki-dark:#79B8FF">string</span><span style="color:#24292e;--shiki-dark:#E1E4E8">&gt;&gt;;</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">export</span><span style="color:#d73a49;--shiki-dark:#F97583"> type</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> NodeExec</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> Execution</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">export</span><span style="color:#d73a49;--shiki-dark:#F97583"> class</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> Execution</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">  constructor</span><span style="color:#24292e;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  query</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#e36209;--shiki-dark:#FFAB70">query</span><span style="color:#d73a49;--shiki-dark:#F97583">:</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292e;--shiki-dark:#E1E4E8">)</span><span style="color:#d73a49;--shiki-dark:#F97583">:</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> Array</span><span style="color:#24292e;--shiki-dark:#E1E4E8">&lt;</span><span style="color:#6f42c1;--shiki-dark:#B392F0">Record</span><span style="color:#24292e;--shiki-dark:#E1E4E8">&lt;</span><span style="color:#005cc5;--shiki-dark:#79B8FF">string</span><span style="color:#24292e;--shiki-dark:#E1E4E8">, </span><span style="color:#005cc5;--shiki-dark:#79B8FF">string</span><span style="color:#24292e;--shiki-dark:#E1E4E8">&gt;&gt;;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre></div><p>To use this we can add the following test.</p><div class="remark-code-title">__test__/index.spec.mjs</div><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">import</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> test </span><span style="color:#d73a49;--shiki-dark:#F97583">from</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;ava&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">import</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> { Execution } </span><span style="color:#d73a49;--shiki-dark:#F97583">from</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &#x27;../index.js&#x27;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">test</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#032f62;--shiki-dark:#9ECBFF">&#x27;exec struct&#x27;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">, (</span><span style="color:#e36209;--shiki-dark:#FFAB70">t</span><span style="color:#24292e;--shiki-dark:#E1E4E8">) </span><span style="color:#d73a49;--shiki-dark:#F97583">=&gt;</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">    const</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> exec</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#d73a49;--shiki-dark:#F97583"> new</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> Execution</span><span style="color:#24292e;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    t.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">deepEqual</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">        exec.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">query</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#032f62;--shiki-dark:#9ECBFF">`</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">        CREATE TABLE foo (</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">          col1 int,</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">          col2 string</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">        );</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">      `</span><span style="color:#24292e;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">        []</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    t.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">deepEqual</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">        exec.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">query</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#032f62;--shiki-dark:#9ECBFF">`</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">          INSERT INTO foo</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">          VALUES</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">              1, &#x27;aString&#x27;;</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">        `</span><span style="color:#24292e;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">        []</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    t.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">deepEqual</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">        exec.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">query</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#032f62;--shiki-dark:#9ECBFF">`</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">          INSERT INTO foo</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">          VALUES</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">              4, &#x27;aDiffString with spaces&#x27;;</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">        `</span><span style="color:#24292e;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">        []</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    t.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">deepEqual</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">        exec.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">query</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#032f62;--shiki-dark:#9ECBFF">`</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">          SELECT</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            col1,</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            col2</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">          FROM</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">              foo;</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">        `</span><span style="color:#24292e;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">        [</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">                col1: </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&#x27;1&#x27;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">                col2: </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&#x27;aString&#x27;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">            },</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">                col1: </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&#x27;4&#x27;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">                col2: </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&#x27;aDiffString with spaces&#x27;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">            },</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">        ]</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    );</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">test</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#032f62;--shiki-dark:#9ECBFF">&#x27;parse error&#x27;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">, (</span><span style="color:#e36209;--shiki-dark:#FFAB70">t</span><span style="color:#24292e;--shiki-dark:#E1E4E8">) </span><span style="color:#d73a49;--shiki-dark:#F97583">=&gt;</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">    const</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> exec</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#d73a49;--shiki-dark:#F97583"> new</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> Execution</span><span style="color:#24292e;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    t.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">throws</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(() </span><span style="color:#d73a49;--shiki-dark:#F97583">=&gt;</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> exec.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">query</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#032f62;--shiki-dark:#9ECBFF">`sad`</span><span style="color:#24292e;--shiki-dark:#E1E4E8">), { code: </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&#x27;GenericFailure&#x27;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">, message: </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&#x27;Parse Error&#x27;</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">});</span></span>
<span class="line"></span></code></pre></div><p>In the success case, we get an array of records, in the failure case a JS error is thrown.</p><h2 id="async-support"><a href="#async-support" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Async Support</h2><p>My db does not have any async code yet so let&#x27;s play with a dummy example.</p><p>To enable async support you can enable the <code>tokio_rt</code> feature on the napi crate in the <code>Cargo.toml</code></p><div class="remark-code-title">Cargo.toml</div><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">[</span><span style="color:#6f42c1;--shiki-dark:#B392F0">dependencies</span><span style="color:#24292e;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">napi = { version = </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;2.10.0&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">, default-features = </span><span style="color:#005cc5;--shiki-dark:#79B8FF">false</span><span style="color:#24292e;--shiki-dark:#E1E4E8">, features = [</span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;napi4&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">, </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;tokio_rt&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">] }</span></span>
<span class="line"></span></code></pre></div><p>Let&#x27;s add a dummy function on the execution class that will accept a promise as a parameter that will resolve to the query to run</p><div class="remark-code-title">src/lib.rs</div><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">#[napi]</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">impl</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> NodeExec</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">    /// # Safety</span></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">    ///</span></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">    /// The execution struct should not be handled in multiple async functions</span></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">    /// at a time.</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    #[napi(ts_return_type </span><span style="color:#d73a49;--shiki-dark:#F97583">=</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;Promise&lt;Array&lt;Record&lt;string,string&gt;&gt;&gt;&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">)]</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">    pub</span><span style="color:#d73a49;--shiki-dark:#F97583"> async</span><span style="color:#d73a49;--shiki-dark:#F97583"> unsafe</span><span style="color:#d73a49;--shiki-dark:#F97583"> fn</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> query_async</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">        &amp;mut</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292e;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">        query_promise</span><span style="color:#d73a49;--shiki-dark:#F97583">:</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> Promise</span><span style="color:#24292e;--shiki-dark:#E1E4E8">&lt;</span><span style="color:#6f42c1;--shiki-dark:#B392F0">String</span><span style="color:#24292e;--shiki-dark:#E1E4E8">&gt;,</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    ) </span><span style="color:#d73a49;--shiki-dark:#F97583">-&gt;</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> napi</span><span style="color:#d73a49;--shiki-dark:#F97583">::</span><span style="color:#6f42c1;--shiki-dark:#B392F0">Result</span><span style="color:#24292e;--shiki-dark:#E1E4E8">&lt;</span><span style="color:#6f42c1;--shiki-dark:#B392F0">QueryRes</span><span style="color:#24292e;--shiki-dark:#E1E4E8">&gt; {</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">        let</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> query </span><span style="color:#d73a49;--shiki-dark:#F97583">=</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> query_promise</span><span style="color:#d73a49;--shiki-dark:#F97583">.await?</span><span style="color:#24292e;--shiki-dark:#E1E4E8">; </span><span style="color:#6a737d;--shiki-dark:#6A737D">// awaits the js promise like any other rust future</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79B8FF">        self</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">query</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(query)</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre></div><p>One thing you will notice is that we needed to mark the function as <code>unsafe</code> since we take in <code>&amp;mut self</code> in an <code>async</code> function. The issue is rust can not enforce its borrow checker rules across the boundary with node. In sync code, this is not an issue since node is single-threaded. However, in async contexts, another async task could mutate the Execution struct while a different task using that struct is suspended.</p><p>We can then test it like this</p><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">test</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#032f62;--shiki-dark:#9ECBFF">&#x27;async function&#x27;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">, </span><span style="color:#d73a49;--shiki-dark:#F97583">async</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> (</span><span style="color:#e36209;--shiki-dark:#FFAB70">t</span><span style="color:#24292e;--shiki-dark:#E1E4E8">) </span><span style="color:#d73a49;--shiki-dark:#F97583">=&gt;</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">  const</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> exec</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#d73a49;--shiki-dark:#F97583"> new</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> Execution</span><span style="color:#24292e;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">  const</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> get_query</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#d73a49;--shiki-dark:#F97583"> async</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> () </span><span style="color:#d73a49;--shiki-dark:#F97583">=&gt;</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">    return</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> `</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            CREATE TABLE foo (</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">                col1 int,</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">                col2 string</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            );</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">        `</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">  t.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">deepEqual</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#d73a49;--shiki-dark:#F97583">await</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> exec.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">queryAsync</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#6f42c1;--shiki-dark:#B392F0">get_query</span><span style="color:#24292e;--shiki-dark:#E1E4E8">()), []);</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">});</span></span>
<span class="line"></span></code></pre></div><h2 id="napi-limitations"><a href="#napi-limitations" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>napi limitations</h2><p>One of the main issues with napi (or any rust FFI) is that some “rustisms” don&#x27;t transfer well to JS/TS. For example, JS uses exceptions and not <code>Result</code> so any napi function returning a result will throw an error in node. Similar issue for <code>Option</code> which just becomes <code>undefined | T</code>. Would be cool if napi had a feature flag to make rust results be exposed as a <a target="_blank" rel="noopener noreferrer" href="https://github.com/supermacro/neverthrow">https://github.com/supermacro/neverthrow</a> result or a similar lib.</p><p>The other main issue is there is overhead involved when passing large/complex types between node and rust. Rust needs to serialize/deserialize the JS types into a format it can use. There are workarounds like using buffers/typed arrays but that requires some manual work on both ends to manually serialize/deserialize the objects. In the <a target="_blank" rel="noopener noreferrer" href="https://github.com/napi-rs/napi-rs/issues/1493">napi v3</a> goals, they plan on adding ways to make working around this simpler.</p><p>Lastly, there is currently only <a target="_blank" rel="noopener noreferrer" href="https://docs.rs/napi/latest/napi/iterator/trait.Generator.html">experimental JS generator support</a> (with no docs on it that I can find), and no support for async generators/node streams. While you could manually add JS code to support these would be much nicer if napi did it for you. Stream support is planned for v3, so hopefully the others will follow.</p><h2 id="wrap-up"><a href="#wrap-up" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Wrap up</h2><p>Overall napi is very useable and with my limited use of cross-language FFI tools, it has had the nicest user experience. While it has limitations/some issues overall nothing major is in your way from exposing very useable and performant code if you put in a little extra work.</p></div><div><div class="pb-6 pt-6 text-sm text-gray-700 dark:text-gray-300"><a target="_blank" rel="nofollow" href="https://mobile.twitter.com/search?q=https%3A%2F%2Fjohns.codes%2Fblog%2Fexposing-a-rust-library-to-node-with-napirs">Discuss on Twitter</a> • <a target="_blank" rel="noopener noreferrer" href="https://github.com/JRMurr/JRMurr.github.io/blob/main/content/blog/exposing-a-rust-library-to-node-with-napirs.md">View on GitHub</a></div><div class="pb-6 pt-6 text-center text-gray-700 dark:text-gray-300" id="comment"><button>Load Comments</button></div></div></div><footer><div class="flex flex-col text-sm font-medium sm:flex-row sm:justify-between sm:text-base"><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" aria-label="Previous post: Building a Simple DB in Rust - Part 3 - Less Basic Execution" href="/blog/build-a-db/part03">← <!-- -->Building a Simple DB in Rust - Part 3 - Less Basic Execution</a></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" aria-label="Next post: Organizing system configs with NixOS" href="/blog/organizing-system-configs-with-nixos">Organizing system configs with NixOS<!-- --> →</a></div></div></footer></div></div></article></section></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/JRMurr"><span class="sr-only">github</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://twitter.com/JRMurrCodes"><span class="sr-only">twitter</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://hachyderm.io/@jrmurr"><span class="sr-only">mastodon</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6"><path d="M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="/feed.xml"><span class="sr-only">rss</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6"><path d="M3.692 17.517A3.696 3.696 0 0 0 0 21.211C0 23.244 1.656 24.9 3.692 24.9s3.694-1.657 3.694-3.689a3.697 3.697 0 0 0-3.694-3.694z"></path><path d="M.384 8.142A.386.386 0 0 0 0 8.527v4.688c0 .211.173.383.384.383 6.02 0 10.919 4.898 10.919 10.92 0 .209.171.383.384.383h4.705a.385.385 0 0 0 .387-.383l-.018-.121C16.692 15.423 9.37 8.142.384 8.142z"></path><path d="M24.89 24.397C24.825 10.936 13.854.011.384.011A.385.385 0 0 0 0 .397v4.824c0 .212.173.383.384.383 10.429 0 18.913 8.486 18.913 18.914 0 .209.172.383.382.383h4.845a.39.39 0 0 0 .388-.383l-.022-.121z"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>John Murray</div><div> • </div><div>© 2024</div><div> • </div><a href="/">John&#x27;s Codes</a></div></div></footer></div></section><script src="/_next/static/chunks/webpack-278bcb5a0daf8917.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/2d141e1a38819612-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/css/895662d5d095c22a.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L3\"\n"])</script><script>self.__next_f.push([1,"4:HL[\"/_next/static/css/14fb540b7a3ad639.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"5:I[7690,[],\"\"]\n8:I[5613,[],\"\"]\na:I[1778,[],\"\"]\nb:I[8029,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"781\",\"static/chunks/781-9238b26c3a132736.js\",\"185\",\"static/chunks/app/layout-bdf5ad57b961fc92.js\"],\"ThemeProviders\"]\nc:I[5935,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"781\",\"static/chunks/781-9238b26c3a132736.js\",\"185\",\"static/chunks/app/layout-bdf5ad57b961fc92.js\"],\"\"]\nd:I[9266,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"781\",\"static/chunks/781-9238b26c3a132736.js\",\"185\",\"static/chunks/app/lay"])</script><script>self.__next_f.push([1,"out-bdf5ad57b961fc92.js\"],\"KBarSearchProvider\"]\ne:I[5250,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"749\",\"static/chunks/749-ed776d54eb5c7205.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-04bc103f80b6f059.js\"],\"\"]\nf:I[2146,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"781\",\"static/chunks/781-9238b26c3a132736.js\",\"185\",\"static/chunks/app/layout-bdf5ad57b961fc92.js\"],\"KBarButton\"]\n10:I[5021,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"781\",\"static/chunks/781-9238b26c3a132736.js\",\"185\",\"static/"])</script><script>self.__next_f.push([1,"chunks/app/layout-bdf5ad57b961fc92.js\"],\"\"]\n11:I[123,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"781\",\"static/chunks/781-9238b26c3a132736.js\",\"185\",\"static/chunks/app/layout-bdf5ad57b961fc92.js\"],\"\"]\n14:I[8955,[],\"\"]\n9:[\"slug\",\"exposing-a-rust-library-to-node-with-napirs\",\"c\"]\n12:T44f,"])</script><script>self.__next_f.push([1,"M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"])</script><script>self.__next_f.push([1,"15:[]\n"])</script><script>self.__next_f.push([1,"3:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/895662d5d095c22a.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L5\",null,{\"buildId\":\"IKie5J7CTDxfEP0dGZ2Vw\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/blog/exposing-a-rust-library-to-node-with-napirs\",\"initialTree\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"exposing-a-rust-library-to-node-with-napirs\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"exposing-a-rust-library-to-node-with-napirs\\\"]}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"exposing-a-rust-library-to-node-with-napirs\",\"c\"],{\"children\":[\"__PAGE__\",{},[\"$L6\",\"$L7\",null]]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"$9\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/14fb540b7a3ad639.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}]]},[null,[\"$\",\"html\",null,{\"lang\":\"en-us\",\"className\":\"__variable_587f35 scroll-smooth\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"sizes\":\"76x76\",\"href\":\"/static/favicons/apple-touch-icon.png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"32x32\",\"href\":\"/static/favicons/favicon-32x32.png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"16x16\",\"href\":\"/static/favicons/favicon-16x16.png\"}],[\"$\",\"link\",null,{\"rel\":\"manifest\",\"href\":\"/static/favicons/site.webmanifest\"}],[\"$\",\"link\",null,{\"rel\":\"mask-icon\",\"href\":\"/static/favicons/safari-pinned-tab.svg\",\"color\":\"#5bbad5\"}],[\"$\",\"meta\",null,{\"name\":\"msapplication-TileColor\",\"content\":\"#000000\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: light)\",\"content\":\"#fff\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: dark)\",\"content\":\"#000\"}],[\"$\",\"link\",null,{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"/feed.xml\"}],[\"$\",\"body\",null,{\"className\":\"bg-white text-black antialiased dark:bg-gray-950 dark:text-white\",\"children\":[\"$\",\"$Lb\",null,{\"children\":[[[\"$\",\"$Lc\",null,{\"strategy\":\"lazyOnload\",\"data-domain\":\"johns.codes\",\"data-api\":\"$undefined\",\"src\":\"https://plausible.io/js/plausible.js\"}],[\"$\",\"$Lc\",null,{\"strategy\":\"lazyOnload\",\"id\":\"plausible-script\",\"children\":\"\\n            window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }\\n        \"}]],[\"$\",\"section\",null,{\"className\":\"mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex h-screen flex-col justify-between font-sans\",\"children\":[[\"$\",\"$Ld\",null,{\"kbarConfig\":{\"searchDocumentsPath\":\"search.json\"},\"children\":[[\"$\",\"header\",null,{\"className\":\"flex items-center justify-between py-10\",\"children\":[[\"$\",\"div\",null,{\"children\":[\"$\",\"$Le\",null,{\"href\":\"/\",\"aria-label\":\"John's Codes\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between\",\"children\":[\"$\",\"div\",null,{\"className\":\"hidden h-6 text-2xl font-semibold sm:block\",\"children\":\"John's Codes\"}]}]}]}],[\"$\",\"div\",null,{\"className\":\"flex items-center space-x-4 leading-5 sm:space-x-6\",\"children\":[[[\"$\",\"$Le\",null,{\"href\":\"/blog\",\"className\":\"hidden font-medium text-gray-900 dark:text-gray-100 sm:block\",\"children\":\"Blog\"}],[\"$\",\"$Le\",null,{\"href\":\"/tags\",\"className\":\"hidden font-medium text-gray-900 dark:text-gray-100 sm:block\",\"children\":\"Tags\"}],[\"$\",\"$Le\",null,{\"href\":\"/projects\",\"className\":\"hidden font-medium text-gray-900 dark:text-gray-100 sm:block\",\"children\":\"Projects\"}],[\"$\",\"$Le\",null,{\"href\":\"/about\",\"className\":\"hidden font-medium text-gray-900 dark:text-gray-100 sm:block\",\"children\":\"About\"}]],[\"$\",\"$Lf\",null,{\"aria-label\":\"Search\",\"children\":[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"fill\":\"none\",\"viewBox\":\"0 0 24 24\",\"strokeWidth\":1.5,\"stroke\":\"currentColor\",\"className\":\"h-6 w-6 text-gray-900 dark:text-gray-100\",\"children\":[\"$\",\"path\",null,{\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"d\":\"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z\"}]}]}],[\"$\",\"$L10\",null,{}],[\"$\",\"$L11\",null,{}]]}]]}],[\"$\",\"main\",null,{\"className\":\"mb-auto\",\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"className\":\"flex flex-col items-start justify-start md:mt-24 md:flex-row md:items-center md:justify-center md:space-x-6\",\"children\":[[\"$\",\"div\",null,{\"className\":\"space-x-2 pb-8 pt-6 md:space-y-5\",\"children\":[\"$\",\"h1\",null,{\"className\":\"text-6xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 md:border-r-2 md:px-6 md:text-8xl md:leading-14\",\"children\":\"404\"}]}],[\"$\",\"div\",null,{\"className\":\"max-w-md\",\"children\":[[\"$\",\"p\",null,{\"className\":\"mb-4 text-xl font-bold leading-normal md:text-2xl\",\"children\":\"Sorry we couldn't find this page.\"}],[\"$\",\"p\",null,{\"className\":\"mb-8\",\"children\":\"But dont worry, you can find plenty of other things on our homepage.\"}],[\"$\",\"$Le\",null,{\"href\":\"/\",\"className\":\"focus:shadow-outline-blue inline rounded-lg border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium leading-5 text-white shadow transition-colors duration-150 hover:bg-blue-700 focus:outline-none dark:hover:bg-blue-500\",\"children\":\"Back to homepage\"}]]}]]}],\"notFoundStyles\":[],\"styles\":null}]}]]}],[\"$\",\"footer\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"mt-16 flex flex-col items-center\",\"children\":[[\"$\",\"div\",null,{\"className\":\"mb-3 flex space-x-4\",\"children\":[null,[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/JRMurr\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"github\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6\",\"children\":[\"$\",\"path\",null,{\"d\":\"M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12\"}]}]]}],[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://twitter.com/JRMurrCodes\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"twitter\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6\",\"children\":[\"$\",\"path\",null,{\"d\":\"M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z\"}]}]]}],[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://hachyderm.io/@jrmurr\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"mastodon\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6\",\"children\":[\"$\",\"path\",null,{\"d\":\"$12\"}]}]]}],[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"/feed.xml\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"rss\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M3.692 17.517A3.696 3.696 0 0 0 0 21.211C0 23.244 1.656 24.9 3.692 24.9s3.694-1.657 3.694-3.689a3.697 3.697 0 0 0-3.694-3.694z\"}],[\"$\",\"path\",null,{\"d\":\"M.384 8.142A.386.386 0 0 0 0 8.527v4.688c0 .211.173.383.384.383 6.02 0 10.919 4.898 10.919 10.92 0 .209.171.383.384.383h4.705a.385.385 0 0 0 .387-.383l-.018-.121C16.692 15.423 9.37 8.142.384 8.142z\"}],[\"$\",\"path\",null,{\"d\":\"M24.89 24.397C24.825 10.936 13.854.011.384.011A.385.385 0 0 0 0 .397v4.824c0 .212.173.383.384.383 10.429 0 18.913 8.486 18.913 18.914 0 .209.172.383.382.383h4.845a.39.39 0 0 0 .388-.383l-.022-.121z\"}]]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400\",\"children\":[[\"$\",\"div\",null,{\"children\":\"John Murray\"}],[\"$\",\"div\",null,{\"children\":\" • \"}],[\"$\",\"div\",null,{\"children\":\"© 2024\"}],[\"$\",\"div\",null,{\"children\":\" • \"}],[\"$\",\"$Le\",null,{\"href\":\"/\",\"children\":\"John's Codes\"}]]}]]}]}]]}]}]]}]}]]}],null]],\"initialHead\":[false,\"$L13\"],\"globalErrorComponent\":\"$14\",\"missingSlots\":\"$W15\"}]]\n"])</script><script>self.__next_f.push([1,"16:I[144,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"749\",\"static/chunks/749-ed776d54eb5c7205.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-04bc103f80b6f059.js\"],\"\"]\n17:I[2502,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"749\",\"static/chunks/749-ed776d54eb5c7205.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-04bc103f80b6f059.js\"],\"\"]\n18:I[4282,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"749\",\"static/chunks/749-ed776d54eb5c7205.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-04bc1"])</script><script>self.__next_f.push([1,"03f80b6f059.js\"],\"\"]\n19:I[4970,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"749\",\"static/chunks/749-ed776d54eb5c7205.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-04bc103f80b6f059.js\"],\"\"]\n"])</script><script>self.__next_f.push([1,"7:[[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"BlogPosting\\\",\\\"headline\\\":\\\"Exposing a Rust Library to Node with Napi-rs\\\",\\\"datePublished\\\":\\\"2023-05-01T17:21:59.515Z\\\",\\\"dateModified\\\":\\\"2023-05-01T17:21:59.515Z\\\",\\\"description\\\":\\\"Short guide/exploration on making native node addons with rust\\\",\\\"author\\\":[{\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"John Murray\\\"}]}\"}}],[\"$\",\"section\",null,{\"className\":\"mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0\",\"children\":[[\"$\",\"$L16\",null,{}],[\"$\",\"article\",null,{\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"header\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"space-y-1 border-b border-gray-200 pb-10 text-center dark:border-gray-700\",\"children\":[[\"$\",\"dl\",null,{\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"dt\",null,{\"className\":\"sr-only\",\"children\":\"Published on\"}],[\"$\",\"dd\",null,{\"className\":\"text-base font-medium leading-6 text-gray-500 dark:text-gray-400\",\"children\":[[\"$\",\"time\",null,{\"dateTime\":\"2023-05-01T17:21:59.515Z\",\"children\":\"May 1, 2023\"}],[\"$\",\"span\",null,{\"className\":\"mx-2\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"ml-1\",\"children\":[7,\" min read\"]}]]}]]}]}],[\"$\",\"div\",null,{\"children\":[\"$\",\"h1\",null,{\"className\":\"text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14\",\"children\":\"Exposing a Rust Library to Node with Napi-rs\"}]}]]}]}],[\"$\",\"div\",null,{\"className\":\"grid-rows-[auto_1fr] divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:divide-y-0\",\"children\":[[\"$\",\"div\",null,{\"className\":\"divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0\",\"children\":[[\"$\",\"div\",null,{\"className\":\"prose max-w-none pb-8 pt-10 dark:prose-invert\",\"children\":[[\"$\",\"$L17\",null,{\"series\":null,\"currSlug\":\"exposing-a-rust-library-to-node-with-napirs\"}],[[\"$\",\"details\",null,{\"open\":true,\"children\":[[\"$\",\"summary\",null,{\"className\":\"ml-6 pb-2 pt-2 text-xl font-bold\",\"children\":\"Table of Contents\"}],[\"$\",\"div\",null,{\"className\":\"ml-6\",\"children\":[\"$\",\"ul\",null,{\"className\":\"\",\"children\":[[\"$\",\"li\",\"0\",{\"children\":[[\"$\",\"a\",null,{\"href\":\"#why\",\"children\":\"Why?\"}],null]}],[\"$\",\"li\",\"1\",{\"children\":[[\"$\",\"a\",null,{\"href\":\"#setting-up-napi\",\"children\":\"Setting up napi\"}],null]}],[\"$\",\"li\",\"2\",{\"children\":[[\"$\",\"a\",null,{\"href\":\"#using-napi\",\"children\":\"Using napi\"}],[\"$\",\"ul\",null,{\"className\":\"\",\"children\":[[\"$\",\"li\",\"0\",{\"children\":[[\"$\",\"a\",null,{\"href\":\"#allowed-values\",\"children\":\"Allowed values\"}],null]}],[\"$\",\"li\",\"1\",{\"children\":[[\"$\",\"a\",null,{\"href\":\"#exposing-classes\",\"children\":\"Exposing Classes\"}],null]}]]}]]}],[\"$\",\"li\",\"3\",{\"children\":[[\"$\",\"a\",null,{\"href\":\"#async-support\",\"children\":\"Async Support\"}],null]}],[\"$\",\"li\",\"4\",{\"children\":[[\"$\",\"a\",null,{\"href\":\"#napi-limitations\",\"children\":\"napi limitations\"}],null]}],[\"$\",\"li\",\"5\",{\"children\":[[\"$\",\"a\",null,{\"href\":\"#wrap-up\",\"children\":\"Wrap up\"}],null]}]]}]}]]}],[\"$\",\"p\",null,{\"children\":\"I unapologetically shill Rust every chance I get, annoying my coworkers by insisting that everything would be better if we just used Rust. At this point, it has become a bit of a meme, so no one listens to me (rightfully so).\"}],[\"$\",\"p\",null,{\"children\":\"To finally put an end to the meme, I decided to research ways we could incorporate Rust into our systems. Ideally, we would create a new service in Rust, but since we are not yet big on microservices, the best approach would be to call Rust directly from our Node monolith.\"}],[\"$\",\"p\",null,{\"children\":[\"Since Node is written in C++, it provides ways to call native code via \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://nodejs.org/api/addons.html\",\"children\":\"addons\"}],\". The \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://napi.rs/\",\"children\":\"napi-rs\"}],\" library helps with the boilerplate of exposing Rust code as a Node addon.\"]}],[\"$\",\"p\",null,{\"children\":\"Napi-rs along with generating the node addon will also generate typescript type definitions and has a nice CLI to more easily make addons for all popular systems/architectures.\"}],[\"$\",\"h2\",null,{\"id\":\"why\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#why\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Why?\"]}],[\"$\",\"p\",null,{\"children\":\"BECAUSE I CAN.\"}],[\"$\",\"p\",null,{\"children\":\"For real though, there are several reasons why creating a native Rust addon for a Node app could be beneficial:\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"Native code can be much more performant than JavaScript for certain use cases (although the JIT does help a lot).\"}],[\"$\",\"li\",null,{\"children\":\"Compared to C++ addons, building and deploying with napi is much easier. However, I have limited experience managing C++ addons.\"}],[\"$\",\"li\",null,{\"children\":[\"Many \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://lib.rs/\",\"children\":\"Rust libraries\"}],\" would be nice to reuse in Node.\"]}],[\"$\",\"li\",null,{\"children\":\"Subjectively, Rust is a great language to write in. It has been voted the most loved language for the last few years for a reason.\"}]]}],[\"$\",\"h2\",null,{\"id\":\"setting-up-napi\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#setting-up-napi\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Setting up napi\"]}],[\"$\",\"p\",null,{\"children\":[\"I'm going to experiment with napi in the codebase from the \",[\"$\",\"$Le\",null,{\"href\":\"/blog/build-a-db/part01\",\"children\":\"build a db in rust series\"}],\", branch with all the code \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/JRMurr/SQLJr/tree/napi-bindings/crates/sql_jr_node\",\"children\":\"here\"}],\".\"]}],[\"$\",\"p\",null,{\"children\":[\"Most of the following is taken from the \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://napi.rs/docs/introduction/getting-started\",\"children\":\"napi getting started docs\"}]]}],[\"$\",\"p\",null,{\"children\":\"You first need to install the napi CLI, which can be done with your favorite node package manager of choice. While I could use npm/yarn/pnpm, I like to use nix flakes, so I added the following to my project's flake file\"}],[\"$\",\"div\",null,{\"className\":\"remark-code-title\",\"children\":\"flake.nix\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"  buildInputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#b31d28\",\"--shiki-dark\":\"#FDAEB7\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#b31d28\",\"--shiki-dark\":\"#FDAEB7\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\" with\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#b31d28\",\"--shiki-dark\":\"#FDAEB7\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\";\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" [\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"     napi-rs-cli\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"  ]\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#b31d28\",\"--shiki-dark\":\"#FDAEB7\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":\"The CLI generates a Rust crate with the appropriate build scripts to build the node addon, along with the necessary node boilerplate to load the addon with type definitions. Additionally, it includes some GitHub actions to build and publish the npm packages.\"}],[\"$\",\"p\",null,{\"children\":\"Run the CLI with\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"napi\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" new\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"You will get an interactive prompt to give a package name and folder path (useful if you use cargo workspaces). The docs recommend prefixing the package name with a \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://docs.npmjs.com/creating-and-publishing-scoped-public-packages/\",\"children\":\"npm scope\"}],\" since napi will publish multiple packages for different architectures.\"]}],[\"$\",\"p\",null,{\"children\":\"The generated rust will look like\"}],[\"$\",\"div\",null,{\"className\":\"remark-code-title\",\"children\":\"src/lib.rs\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"// imports excluded\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"#[napi]\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"pub\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" fn\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" sum\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" i32\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\", b\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" i32\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"-\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" i32\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"  a \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"+\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" b\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":\"A generated test file that uses the node addon looks like\"}],[\"$\",\"div\",null,{\"className\":\"remark-code-title\",\"children\":\"__test__/index.spec.mjs\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"import\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" test \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"from\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" 'ava'\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"import\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" { sum } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"from\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" '../index.js'\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"test\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"'sum from native'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\", (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"t\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"  t.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"is\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"sum\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"1\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"2\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"), \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"3\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\")\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"})\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"The other main piece is the \",[\"$\",\"code\",null,{\"children\":\"index.js\"}],\" file at the package root which has all the logic for loading the right addon for each architecture.\"]}],[\"$\",\"p\",null,{\"children\":\"you can then run the following to build the addon, generate TS types, and run tests\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"npm\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" install\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\" # replace with your node package manager of choice\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"npm\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" run\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" build\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\" # builds the rust code into a node addon + add typescript definitons\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"npm\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" run\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" test\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\" # runs the sample js test file using the node addon\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"After the build step, you should see and \",[\"$\",\"code\",null,{\"children\":\"index.d.ts\"}],\" file that looks like\"]}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"/* tslint:disable */\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"/* eslint-disable */\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"/* auto-generated by NAPI-RS */\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"export\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" function\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" sum\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" number\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"b\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" number\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\")\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" number\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"h2\",null,{\"id\":\"using-napi\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#using-napi\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Using napi\"]}],[\"$\",\"p\",null,{\"children\":\"To explore more of napi, let's write a rust function that does something slightly more sophisticated with my SQL_JR db.\"}],[\"$\",\"div\",null,{\"className\":\"remark-code-title\",\"children\":\"src/lib.rs\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"#[napi]\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"pub\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" fn\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" basic_query\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"() \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"-\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" Vec\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"String\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"\u003e\u003e {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"    let\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" mut\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" exec \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" sql_jr_execution\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"::\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"Execution\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"::\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    exec\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"parse_and_run\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"        \\\"\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"      CREATE TABLE foo (\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"        col1 int,\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"        col2 string\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"      );\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"    \\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    )\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"    .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"expect\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"create works..\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    exec\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"parse_and_run\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"        \\\"\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"        INSERT INTO foo\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"        VALUES\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            1, 'aString';\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"      \\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    )\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"    .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"expect\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"insert 1 works..\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    exec\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"parse_and_run\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"        \\\"\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"        INSERT INTO foo\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"        VALUES\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            4, 'aDiffString with spaces';\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"    \\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    )\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"    .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"expect\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"insert 2 works..\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"    let\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" res \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" exec\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"        .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"parse_and_run\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            \\\"\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"        SELECT\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"          col1,\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"          col2\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"        FROM\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            foo;\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"        \\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"        )\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"        .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"expect\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"select works\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"    match\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" res {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        ExecResponse\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"::\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"Select\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(table_iter) \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"            let\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" columns\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" Vec\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"String\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" table_iter\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"                .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"columns\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"                .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"iter\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"()\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"                .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"map\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"|\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"col\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"|\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" col\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"to_string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"())\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"                .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"collect\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"            let\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" rows\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" Vec\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"\u003c_\u003e\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" table_iter\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"                .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"map\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"|\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"row\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"|\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"                    columns\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"                        .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"iter\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"()\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"                        .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"map\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"move\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" |\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"col\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"|\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" row\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(col)\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"to_string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"())\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"                        .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"collect\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"()\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"                })\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"                .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"collect\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"            rows\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"        }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"        _ \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" unreachable!\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(),\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":\"The above code is very jank rust, but it will get the job done for exploring for now. After running the build we can use it in this test file\"}],[\"$\",\"div\",null,{\"className\":\"remark-code-title\",\"children\":\"__test__/index.spec.mjs\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"import\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" test \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"from\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"ava\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"import\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" { basicQuery } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"from\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"../index.js\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"test\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"basic test\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\", (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"t\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"  t.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"deepEqual\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"basicQuery\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(), [\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"1\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"aString\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"],\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"4\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"aDiffString with spaces\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"],\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"  ]);\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"});\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"One thing you'll notice is the casing of \",[\"$\",\"code\",null,{\"children\":\"basic_query\"}],\" in rust was changed to \",[\"$\",\"code\",null,{\"children\":\"basicQuery\"}],\" in JS.\"]}],[\"$\",\"h3\",null,{\"id\":\"allowed-values\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#allowed-values\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Allowed values\"]}],[\"$\",\"p\",null,{\"children\":[\"When exposing a function with the napi macro you are limited to what types are supported in the arguments/returns types. The function doc page lists them \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://napi.rs/docs/concepts/function#arguments\",\"children\":\"here\"}],\". The TLDR is most \\\"primitive\\\" rust types are supported and any struct you add the \",[\"$\",\"code\",null,{\"children\":\"#[napi]\"}],\" macro too. This could cause issues with third-party libraries, so you probably will need to make your own wrapper types to pass them between rust and node.\"]}],[\"$\",\"h3\",null,{\"id\":\"exposing-classes\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#exposing-classes\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Exposing Classes\"]}],[\"$\",\"p\",null,{\"children\":[\"While the above works it's very restrictive and crappy rust, so let's expose a wrapper around \",[\"$\",\"code\",null,{\"children\":\"sql_jr_execution::Execution\"}],\", so the node side can run arbitrary queries + track state.\"]}],[\"$\",\"p\",null,{\"children\":[\"Like we did with functions you can add the \",[\"$\",\"code\",null,{\"children\":\"#[napi]\"}],\" macro above structs to expose them as a JS class. While we could add that macro in the \",[\"$\",\"code\",null,{\"children\":\"sql_jr_execution\"}],\" crate on the \",[\"$\",\"code\",null,{\"children\":\"Execution\"}],\" struct itself I think it will be better to have a napi crate + explicit wrapper structs to keep the API of the node addon more stable. Also, as you will come to see there are some limitations on the exposed code that would be nice to not litter the rest of the code base with.\"]}],[\"$\",\"p\",null,{\"children\":[\"So let's make a \",[\"$\",\"code\",null,{\"children\":\"NodeExec\"}],\" struct like this\"]}],[\"$\",\"div\",null,{\"className\":\"remark-code-title\",\"children\":\"src/lib.rs\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"#[napi(js_name \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"Execution\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\")]\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"pub\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" struct\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" NodeExec\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    execution\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" Execution\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"#[napi]\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"impl\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" NodeExec\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    #[napi(constructor)]\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"    pub\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" fn\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"() \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"-\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" Self\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"        Self\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"            execution\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" Execution\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"::\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(),\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"        }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"This will expose a JS class called \",[\"$\",\"code\",null,{\"children\":\"Execution\"}],\" with a constructor corresponding to the \",[\"$\",\"code\",null,{\"children\":\"new\"}],\" function.\"]}],[\"$\",\"p\",null,{\"children\":\"Let's add a class method that will run a query and return an array of records when it was a select query.\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"/// A List of rows returned by the query.\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"/// Each row is a map of col =\u003e data as string\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"type\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" QueryRes\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" Vec\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"HashMap\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"String\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"String\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"\u003e\u003e;\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"#[napi]\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"impl\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" NodeExec\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"  #[napi(ts_return_type \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"Array\u003cRecord\u003cstring,string\u003e\u003e\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\")]\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"  pub\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" fn\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" query\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"\u0026mut\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" self\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\", query\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" String\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"-\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" napi\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"::\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"Result\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"QueryRes\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"\u003e {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"      use\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" napi\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"::\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"{\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"Error\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"Status\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"};\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"      let\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" res \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" self\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"          .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"execution\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"          .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"parse_and_run\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"query)\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"          // Probably a good idea to impl From\u003cSqlError\u003c_\u003e for napi::Error in sql_jr_execution\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"          // gated behind a napi feature flag\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"          .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"map_err\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"|\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"|\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" Error\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"::\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"Status\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"::\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"GenericFailure\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"format!\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"{}\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\", e)))\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"?\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"      Ok\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"match\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" res {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          ExecResponse\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"::\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"Select\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(table_iter) \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"              let\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" columns\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" Vec\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"String\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" table_iter\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"                  .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"columns\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"                  .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"iter\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"()\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"                  .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"map\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"|\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"col\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"|\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" col\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"to_string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"())\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"                  .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"collect\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"              table_iter\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"                  .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"map\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"|\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"row\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"|\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"                      columns\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"                          .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"iter\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"()\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"                          .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"map\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"move\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" |\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"col\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"|\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" (col\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"clone\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(), row\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(col)\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"to_string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"()))\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"                          .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"collect\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"()\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"                  })\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"                  .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"collect\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"()\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"          }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"          _ \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" Vec\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"::\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(),\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"      })\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"First, we need to manually set \",[\"$\",\"code\",null,{\"children\":\"ts_return_type = \\\"Array\u003cRecord\u003cstring,string\u003e\u003e\\\"\"}],\" since we used a type alias in the function signatures. This is due to some limitations in how \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/napi-rs/napi-rs/issues/1019#issuecomment-1009116165\",\"children\":\"proc macros in rust work\"}],\".\"]}],[\"$\",\"p\",null,{\"children\":[\"Second we needed to convert the returned Error from \",[\"$\",\"code\",null,{\"children\":\"parse_and_run\"}],\" into a \",[\"$\",\"code\",null,{\"children\":\"napi::Error\"}],\" with \",[\"$\",\"code\",null,{\"children\":\".map_err(|e| Error::new(Status::GenericFailure, format!(\\\"{}\\\", e)))\"}],\". This is not the best conversion since it would just stringify the execution error, but it's not the end of the world.\"]}],[\"$\",\"p\",null,{\"children\":\"The generated typescript looks like\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"/* tslint:disable */\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"/* eslint-disable */\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"/* auto-generated by NAPI-RS */\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"export\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" function\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" basicQuery\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"()\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" Array\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"Array\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"\u003e\u003e;\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"export\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" type\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" NodeExec\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" Execution\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"export\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" Execution\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"  constructor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  query\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"query\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\")\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" Array\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"Record\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"\u003e\u003e;\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":\"To use this we can add the following test.\"}],[\"$\",\"div\",null,{\"className\":\"remark-code-title\",\"children\":\"__test__/index.spec.mjs\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"import\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" test \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"from\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"ava\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"import\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" { Execution } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"from\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" '../index.js'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"test\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"'exec struct'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\", (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"t\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"    const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" exec\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" Execution\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    t.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"deepEqual\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"        exec.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"query\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"`\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"        CREATE TABLE foo (\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"          col1 int,\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"          col2 string\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"        );\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"      `\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"),\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"        []\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    );\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    t.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"deepEqual\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"        exec.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"query\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"`\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"          INSERT INTO foo\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"          VALUES\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"              1, 'aString';\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"        `\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"),\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"        []\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    );\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    t.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"deepEqual\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"        exec.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"query\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"`\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"          INSERT INTO foo\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"          VALUES\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"              4, 'aDiffString with spaces';\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"        `\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"),\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"        []\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    );\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    t.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"deepEqual\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"        exec.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"query\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"`\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"          SELECT\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            col1,\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            col2\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"          FROM\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"              foo;\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"        `\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"),\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"        [\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"            {\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"                col1: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"'1'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"                col2: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"'aString'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"            },\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"            {\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"                col1: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"'4'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"                col2: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"'aDiffString with spaces'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"            },\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"        ]\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    );\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"});\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"test\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"'parse error'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\", (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"t\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"    const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" exec\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" Execution\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    t.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"throws\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(() \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" exec.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"query\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"`sad`\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"), { code: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"'GenericFailure'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\", message: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"'Parse Error'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" });\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"});\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":\"In the success case, we get an array of records, in the failure case a JS error is thrown.\"}],[\"$\",\"h2\",null,{\"id\":\"async-support\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#async-support\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Async Support\"]}],[\"$\",\"p\",null,{\"children\":\"My db does not have any async code yet so let's play with a dummy example.\"}],[\"$\",\"p\",null,{\"children\":[\"To enable async support you can enable the \",[\"$\",\"code\",null,{\"children\":\"tokio_rt\"}],\" feature on the napi crate in the \",[\"$\",\"code\",null,{\"children\":\"Cargo.toml\"}]]}],[\"$\",\"div\",null,{\"className\":\"remark-code-title\",\"children\":\"Cargo.toml\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"[\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"dependencies\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"]\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"napi = { version = \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"2.10.0\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\", default-features = \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"false\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\", features = [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"napi4\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"tokio_rt\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"] }\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":\"Let's add a dummy function on the execution class that will accept a promise as a parameter that will resolve to the query to run\"}],[\"$\",\"div\",null,{\"className\":\"remark-code-title\",\"children\":\"src/lib.rs\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"#[napi]\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"impl\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" NodeExec\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"    /// # Safety\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"    ///\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"    /// The execution struct should not be handled in multiple async functions\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"    /// at a time.\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    #[napi(ts_return_type \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"Promise\u003cArray\u003cRecord\u003cstring,string\u003e\u003e\u003e\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\")]\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"    pub\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" unsafe\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" fn\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" query_async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"        \u0026mut\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" self\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"        query_promise\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" Promise\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"String\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"\u003e,\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    ) \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"-\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" napi\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"::\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"Result\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"QueryRes\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"\u003e {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"        let\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" query \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" query_promise\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".await?\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"// awaits the js promise like any other rust future\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"        self\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"query\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(query)\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"One thing you will notice is that we needed to mark the function as \",[\"$\",\"code\",null,{\"children\":\"unsafe\"}],\" since we take in \",[\"$\",\"code\",null,{\"children\":\"\u0026mut self\"}],\" in an \",[\"$\",\"code\",null,{\"children\":\"async\"}],\" function. The issue is rust can not enforce its borrow checker rules across the boundary with node. In sync code, this is not an issue since node is single-threaded. However, in async contexts, another async task could mutate the Execution struct while a different task using that struct is suspended.\"]}],[\"$\",\"p\",null,{\"children\":\"We can then test it like this\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"test\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"'async function'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"t\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"  const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" exec\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" Execution\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"  const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" get_query\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" () \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"    return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" `\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            CREATE TABLE foo (\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"                col1 int,\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"                col2 string\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            );\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"        `\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"  };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"  t.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"deepEqual\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" exec.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"queryAsync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"get_query\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"()), []);\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"});\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"h2\",null,{\"id\":\"napi-limitations\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#napi-limitations\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"napi limitations\"]}],[\"$\",\"p\",null,{\"children\":[\"One of the main issues with napi (or any rust FFI) is that some “rustisms” don't transfer well to JS/TS. For example, JS uses exceptions and not \",[\"$\",\"code\",null,{\"children\":\"Result\"}],\" so any napi function returning a result will throw an error in node. Similar issue for \",[\"$\",\"code\",null,{\"children\":\"Option\"}],\" which just becomes \",[\"$\",\"code\",null,{\"children\":\"undefined | T\"}],\". Would be cool if napi had a feature flag to make rust results be exposed as a \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/supermacro/neverthrow\",\"children\":\"https://github.com/supermacro/neverthrow\"}],\" result or a similar lib.\"]}],[\"$\",\"p\",null,{\"children\":[\"The other main issue is there is overhead involved when passing large/complex types between node and rust. Rust needs to serialize/deserialize the JS types into a format it can use. There are workarounds like using buffers/typed arrays but that requires some manual work on both ends to manually serialize/deserialize the objects. In the \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/napi-rs/napi-rs/issues/1493\",\"children\":\"napi v3\"}],\" goals, they plan on adding ways to make working around this simpler.\"]}],[\"$\",\"p\",null,{\"children\":[\"Lastly, there is currently only \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://docs.rs/napi/latest/napi/iterator/trait.Generator.html\",\"children\":\"experimental JS generator support\"}],\" (with no docs on it that I can find), and no support for async generators/node streams. While you could manually add JS code to support these would be much nicer if napi did it for you. Stream support is planned for v3, so hopefully the others will follow.\"]}],[\"$\",\"h2\",null,{\"id\":\"wrap-up\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#wrap-up\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Wrap up\"]}],[\"$\",\"p\",null,{\"children\":\"Overall napi is very useable and with my limited use of cross-language FFI tools, it has had the nicest user experience. While it has limitations/some issues overall nothing major is in your way from exposing very useable and performant code if you put in a little extra work.\"}]]]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"div\",null,{\"className\":\"pb-6 pt-6 text-sm text-gray-700 dark:text-gray-300\",\"children\":[[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"nofollow\",\"href\":\"https://mobile.twitter.com/search?q=https%3A%2F%2Fjohns.codes%2Fblog%2Fexposing-a-rust-library-to-node-with-napirs\",\"children\":\"Discuss on Twitter\"}],\" • \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/JRMurr/JRMurr.github.io/blob/main/content/blog/exposing-a-rust-library-to-node-with-napirs.md\",\"children\":\"View on GitHub\"}]]}],[\"$\",\"div\",null,{\"className\":\"pb-6 pt-6 text-center text-gray-700 dark:text-gray-300\",\"id\":\"comment\",\"children\":[\"$\",\"$L19\",null,{}]}],\"$undefined\"]}]]}],[\"$\",\"footer\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col text-sm font-medium sm:flex-row sm:justify-between sm:text-base\",\"children\":[[\"$\",\"div\",null,{\"className\":\"pt-4 xl:pt-8\",\"children\":[\"$\",\"$Le\",null,{\"href\":\"/blog/build-a-db/part03\",\"className\":\"text-primary-500 hover:text-primary-600 dark:hover:text-primary-400\",\"aria-label\":\"Previous post: Building a Simple DB in Rust - Part 3 - Less Basic Execution\",\"children\":[\"← \",\"Building a Simple DB in Rust - Part 3 - Less Basic Execution\"]}]}],[\"$\",\"div\",null,{\"className\":\"pt-4 xl:pt-8\",\"children\":[\"$\",\"$Le\",null,{\"href\":\"/blog/organizing-system-configs-with-nixos\",\"className\":\"text-primary-500 hover:text-primary-600 dark:hover:text-primary-400\",\"aria-label\":\"Next post: Organizing system configs with NixOS\",\"children\":[\"Organizing system configs with NixOS\",\" →\"]}]}]]}]}]]}]]}]}]]}]]\n"])</script><script>self.__next_f.push([1,"13:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Exposing a Rust Library to Node with Napi-rs | John's Codes\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Short guide/exploration on making native node addons with rust\"}],[\"$\",\"meta\",\"4\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"5\",{\"name\":\"googlebot\",\"content\":\"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1\"}],[\"$\",\"link\",\"6\",{\"rel\":\"canonical\",\"href\":\"https://johns.codes/blog/exposing-a-rust-library-to-node-with-napirs\"}],[\"$\",\"link\",\"7\",{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"https://johns.codes/feed.xml\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:title\",\"content\":\"Exposing a Rust Library to Node with Napi-rs\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:description\",\"content\":\"Short guide/exploration on making native node addons with rust\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:url\",\"content\":\"https://johns.codes/blog/exposing-a-rust-library-to-node-with-napirs\"}],[\"$\",\"meta\",\"11\",{\"property\":\"og:site_name\",\"content\":\"John's Codes\"}],[\"$\",\"meta\",\"12\",{\"property\":\"og:locale\",\"content\":\"en_US\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"14\",{\"property\":\"article:published_time\",\"content\":\"2023-05-01T17:21:59.515Z\"}],[\"$\",\"meta\",\"15\",{\"property\":\"article:modified_time\",\"content\":\"2023-05-01T17:21:59.515Z\"}],[\"$\",\"meta\",\"16\",{\"property\":\"article:author\",\"content\":\"John Murray\"}],[\"$\",\"meta\",\"17\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"18\",{\"name\":\"twitter:title\",\"content\":\"Exposing a Rust Library to Node with Napi-rs\"}],[\"$\",\"meta\",\"19\",{\"name\":\"twitter:description\",\"content\":\"Short guide/exploration on making native node addons with rust\"}],[\"$\",\"meta\",\"20\",{\"name\":\"next-size-adjust\"}]]\n"])</script><script>self.__next_f.push([1,"6:null\n"])</script><script>self.__next_f.push([1,""])</script></body></html>