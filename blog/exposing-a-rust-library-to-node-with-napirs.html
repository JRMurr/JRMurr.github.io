<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" content="#000000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>Exposing a Rust Library to Node with Napi-rs</title><meta name="robots" content="follow, index"/><meta name="description" content="Short guide/exploration on making native node addons with rust"/><meta property="og:url" content="https://johns.codes/blog/exposing-a-rust-library-to-node-with-napirs"/><meta property="og:type" content="article"/><meta property="og:site_name" content="John&#x27;s Codes"/><meta property="og:description" content="Short guide/exploration on making native node addons with rust"/><meta property="og:title" content="Exposing a Rust Library to Node with Napi-rs"/><meta property="og:image" content="https://johns.codes/static/images/twitter-card.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://twitter.com/JRMurrCodes"/><meta name="twitter:title" content="Exposing a Rust Library to Node with Napi-rs"/><meta name="twitter:description" content="Short guide/exploration on making native node addons with rust"/><meta name="twitter:image" content="https://johns.codes/static/images/twitter-card.png"/><meta property="article:published_time" content="2023-05-01T17:21:59.515Z"/><link rel="canonical" href="https://johns.codes/blog/exposing-a-rust-library-to-node-with-napirs"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://johns.codes/blog/exposing-a-rust-library-to-node-with-napirs"
  },
  "headline": "Exposing a Rust Library to Node with Napi-rs",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://johns.codes/static/images/twitter-card.png"
    }
  ],
  "datePublished": "2023-05-01T17:21:59.515Z",
  "dateModified": "2023-05-01T17:21:59.515Z",
  "author": [
    {
      "@type": "Person",
      "name": "John Murray"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "John Murray",
    "logo": {
      "@type": "ImageObject",
      "url": "https://johns.codes/static/images/logo.png"
    }
  },
  "description": "Short guide/exploration on making native node addons with rust"
}</script><meta name="next-head-count" content="20"/><link rel="preload" href="/_next/static/css/ff7a91e18d57a2d6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ff7a91e18d57a2d6.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-a0fb203be75c9eb6.js" defer=""></script><script src="/_next/static/chunks/main-b77bb48dcc3828e6.js" defer=""></script><script src="/_next/static/chunks/pages/_app-861f57e6bedfde14.js" defer=""></script><script src="/_next/static/chunks/framework-327e104994690a53.js" defer=""></script><script src="/_next/static/chunks/675-374a5a75205d32da.js" defer=""></script><script src="/_next/static/chunks/266-365d5fff0af19ac8.js" defer=""></script><script src="/_next/static/chunks/545-446f5effbf4e5f11.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-c8a468ed53b4c5d2.js" defer=""></script><script src="/_next/static/s10FPnTlL5cwtRs3HC583/_buildManifest.js" defer=""></script><script src="/_next/static/s10FPnTlL5cwtRs3HC583/_ssgManifest.js" defer=""></script><script src="/_next/static/s10FPnTlL5cwtRs3HC583/_middlewareManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap">@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuFuYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02AF,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body class="antialiased text-black bg-white dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex flex-col justify-between h-screen"><header class="flex items-center justify-between py-10"><div><a aria-label="John&#x27;s Codes" href="/"><div class="flex items-center justify-between"><div class="hidden h-6 text-2xl font-semibold sm:block">John&#x27;s Codes</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/projects">Projects</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="w-8 h-8 p-1 ml-1 mr-1 rounded sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="w-8 h-8 py-1 ml-1 mr-1 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed w-full h-full top-24 right-0 bg-gray-200 dark:bg-gray-800 opacity-95 z-10 transform ease-in-out duration-300 translate-x-full"><button type="button" aria-label="toggle modal" class="fixed w-full h-full cursor-auto focus:outline-none"></button><nav class="fixed h-full mt-8"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/projects">Projects</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed flex-col hidden gap-3 right-8 bottom-8 md:hidden"><button aria-label="Scroll To Comment" type="button" class="p-2 text-gray-500 transition-all bg-gray-200 rounded-full dark:text-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 hover:bg-gray-300"><svg class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="p-2 text-gray-500 transition-all bg-gray-200 rounded-full dark:text-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 hover:bg-gray-300"><svg class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-4 md:space-y-2 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="flex justify-center items-center text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2023-05-01T17:21:59.515Z">Monday, May 1, 2023</time><span class="mx-2">-</span><div class="flex items-center"><span class="ml-1">10 min read</span></div></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Exposing a Rust Library to Node with Napi-rs</h1></div></div></header><div class="pb-8 divide-y divide-gray-200 xl:divide-y-0 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6" style="grid-template-rows:auto 1fr"><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:pb-0 xl:col-span-4 xl:row-span-2"><div class="pt-10 pb-8 prose dark:prose-dark max-w-none"><details open=""><summary class="pt-2 pb-2 ml-6 text-xl font-bold">Table of Contents</summary><div class="ml-6"><ul><li class="false"><a href="#setting-up-napi">Setting up napi</a></li><li class="false"><a href="#using-napi">Using napi</a></li><li class="ml-6"><a href="#allowed-values">Allowed values</a></li><li class="ml-6"><a href="#exposing-classes">Exposing Classes</a></li><li class="false"><a href="#async-support">Async Support</a></li><li class="false"><a href="#napi-limitations">napi limitations</a></li><li class="false"><a href="#wrap-up">Wrap up</a></li></ul></div></details>
<p>I unapologetically shill Rust every chance I get, annoying my coworkers by insisting that everything would be better if we just used Rust. At this point, it has become a bit of a meme, so no one really listens to me (rightfully so).</p>
<p>To finally put an end to the meme, I decided to research ways we could incorporate Rust into our systems. Ideally, we would create a new service in Rust, but since we are not yet big on microservices, the best approach would be to call Rust directly from our Node monolith.</p>
<p>Since Node is written in C++, it provides ways to call native code via <a target="_blank" rel="noopener noreferrer" href="https://nodejs.org/api/addons.html">addons</a>. The <a target="_blank" rel="noopener noreferrer" href="https://napi.rs/">napi-rs</a> library helps with the boilerplate of exposing Rust code as a Node addon.</p>
<p>Napi-rs along with generating the node addon will also generate typescript type definitions and has a nice CLI to more easily make addons for all popular systems/architectures.</p>
<h2 id="setting-up-napi"><a href="#setting-up-napi" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Setting up napi</h2>
<p>I&#x27;m going to experiment with napi in the codebase from the <a href="/blog/build-a-db/part01">build a db in rust series</a>, branch with all the code <a target="_blank" rel="noopener noreferrer" href="https://github.com/JRMurr/SQLJr/tree/napi-bindings/crates/sql_jr_node">here</a>.</p>
<p>Most of the following is taken form the <a target="_blank" rel="noopener noreferrer" href="https://napi.rs/docs/introduction/getting-started">napi getting started docs</a></p>
<p>You first need to install the napi CLI, which can be done with your favorite node package manager of choice.
While I could use npm/yarn/pnpm, I like use nix flakes, so I added the following to my project&#x27;s flake file</p>
<div class="remark-code-title">flake.nix</div>
<div class="relative"><pre class="shiki dracula"><div class="language-id">nix</div><div class="code-container"><code><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#FFB86C">buildInputs</span><span style="color:#F8F8F2"> </span><span style="color:#FF5555">=</span><span style="color:#F8F8F2"> </span><span style="color:#FF5555">with</span><span style="color:#F8F8F2"> </span><span style="color:#FFB86C">pkgs</span><span style="color:#FF5555">;</span><span style="color:#F8F8F2"> [</span></div><div class="line"><span style="color:#F8F8F2">     </span><span style="color:#FFB86C">napi-rs-cli</span></div><div class="line"><span style="color:#F8F8F2">  ]</span><span style="color:#FF5555">;</span></div></code></div></pre></div>
<p>The CLI generates a Rust crate with the appropriate build scripts to build the node addon, along with the necessary node boilerplate to load the addon with type definitions. Additionally, it includes some GitHub actions to build and publish the npm packages.</p>
<p>Run the CLI with</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">shell</div><div class="code-container"><code><div class="line"><span style="color:#F8F8F2">napi new</span></div></code></div></pre></div>
<p>You will get an interactive prompt to give a package name and folder path (useful if you use cargo workspaces). The docs recommend prefixing the package name with a <a target="_blank" rel="noopener noreferrer" href="https://docs.npmjs.com/creating-and-publishing-scoped-public-packages/">npm scope</a> since napi will publish multiple packages for different architectures.</p>
<p>The generated rust will look like</p>
<div class="remark-code-title">src/lib.rs</div>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#6272A4">// imports excluded</span></div><div class="line"><span style="color:#F8F8F2">#[napi]</span></div><div class="line"><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">sum</span><span style="color:#F8F8F2">(a</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">i32</span><span style="color:#F8F8F2">, b</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">i32</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">i32</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">  a </span><span style="color:#FF79C6">+</span><span style="color:#F8F8F2"> b</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>A generated test file which uses the node addon looks like</p>
<div class="remark-code-title">__test__/index.spec.mjs</div>
<div class="relative"><pre class="shiki dracula"><div class="language-id">javascript</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">import</span><span style="color:#F8F8F2"> test </span><span style="color:#FF79C6">from</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">ava</span><span style="color:#E9F284">&#x27;</span></div><div class="line"></div><div class="line"><span style="color:#FF79C6">import</span><span style="color:#F8F8F2"> { sum } </span><span style="color:#FF79C6">from</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">../index.js</span><span style="color:#E9F284">&#x27;</span></div><div class="line"></div><div class="line"><span style="color:#50FA7B">test</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">sum from native</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2">, (</span><span style="color:#FFB86C">t</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">  t.</span><span style="color:#50FA7B">is</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">sum</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9">1</span><span style="color:#F8F8F2">, </span><span style="color:#BD93F9">2</span><span style="color:#F8F8F2">), </span><span style="color:#BD93F9">3</span><span style="color:#F8F8F2">)</span></div><div class="line"><span style="color:#F8F8F2">})</span></div></code></div></pre></div>
<p>The other main piece is the <code>index.js</code> file at the package root which has all the logic for loading the right addon for each architecture.</p>
<p>you can then run the following to build the addon, generate TS types, and run tests</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">shell</div><div class="code-container"><code><div class="line"><span style="color:#F8F8F2">npm install </span><span style="color:#6272A4"># replace with your node package manager of choice</span></div><div class="line"><span style="color:#F8F8F2">npm run build </span><span style="color:#6272A4"># builds the rust code into a node addon + add typescript definitons</span></div><div class="line"><span style="color:#F8F8F2">npm run </span><span style="color:#8BE9FD">test</span><span style="color:#F8F8F2"> </span><span style="color:#6272A4"># runs the sample js test file using the node addon</span></div></code></div></pre></div>
<p>After the build step you should see and <code>index.d.ts</code> file that looks like</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">typescript</div><div class="code-container"><code><div class="line"><span style="color:#6272A4">/* tslint:disable */</span></div><div class="line"><span style="color:#6272A4">/* eslint-disable */</span></div><div class="line"></div><div class="line"><span style="color:#6272A4">/* auto-generated by NAPI-RS */</span></div><div class="line"></div><div class="line"><span style="color:#FF79C6">export</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">function</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">sum</span><span style="color:#F8F8F2">(</span><span style="color:#FFB86C">a</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">number</span><span style="color:#F8F8F2">, </span><span style="color:#FFB86C">b</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">number</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">number</span><span style="color:#F8F8F2">;</span></div></code></div></pre></div>
<h2 id="using-napi"><a href="#using-napi" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Using napi</h2>
<p>To explore more of napi, let&#x27;s write a rust function that does something slightly more sophisticated with my SQL_JR db.</p>
<div class="remark-code-title">src/lib.rs</div>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#F8F8F2">#[napi]</span></div><div class="line"><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">basic_query</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Vec</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">Vec</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">String</span><span style="color:#F8F8F2">&gt;&gt; {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">mut</span><span style="color:#F8F8F2"> exec </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> sql_jr_execution</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Execution</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">();</span></div><div class="line"><span style="color:#F8F8F2">    exec</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">parse_and_run</span><span style="color:#F8F8F2">(</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#F1FA8C">&quot;</span></div><div class="line"><span style="color:#F1FA8C">      CREATE TABLE foo (</span></div><div class="line"><span style="color:#F1FA8C">        col1 int,</span></div><div class="line"><span style="color:#F1FA8C">        col2 string</span></div><div class="line"><span style="color:#F1FA8C">      );</span></div><div class="line"><span style="color:#F1FA8C">    &quot;</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">    )</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">expect</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;create works..&quot;</span><span style="color:#F8F8F2">);</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">    exec</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">parse_and_run</span><span style="color:#F8F8F2">(</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#F1FA8C">&quot;</span></div><div class="line"><span style="color:#F1FA8C">        INSERT INTO foo</span></div><div class="line"><span style="color:#F1FA8C">        VALUES</span></div><div class="line"><span style="color:#F1FA8C">            1, &#x27;aString&#x27;;</span></div><div class="line"><span style="color:#F1FA8C">      &quot;</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">    )</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">expect</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;insert 1 works..&quot;</span><span style="color:#F8F8F2">);</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">    exec</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">parse_and_run</span><span style="color:#F8F8F2">(</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#F1FA8C">&quot;</span></div><div class="line"><span style="color:#F1FA8C">        INSERT INTO foo</span></div><div class="line"><span style="color:#F1FA8C">        VALUES</span></div><div class="line"><span style="color:#F1FA8C">            4, &#x27;aDiffString with spaces&#x27;;</span></div><div class="line"><span style="color:#F1FA8C">    &quot;</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">    )</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">expect</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;insert 2 works..&quot;</span><span style="color:#F8F8F2">);</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> res </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> exec</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">parse_and_run</span><span style="color:#F8F8F2">(</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#F1FA8C">&quot;</span></div><div class="line"><span style="color:#F1FA8C">        SELECT</span></div><div class="line"><span style="color:#F1FA8C">          col1,</span></div><div class="line"><span style="color:#F1FA8C">          col2</span></div><div class="line"><span style="color:#F1FA8C">        FROM</span></div><div class="line"><span style="color:#F1FA8C">            foo;</span></div><div class="line"><span style="color:#F1FA8C">        &quot;</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">        )</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">expect</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;select works&quot;</span><span style="color:#F8F8F2">);</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">match</span><span style="color:#F8F8F2"> res {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#8BE9FD">ExecResponse</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Select</span><span style="color:#F8F8F2">(table_iter) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> columns</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Vec</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">String</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> table_iter</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">columns</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">iter</span><span style="color:#F8F8F2">()</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">map</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2">col</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2"> col</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">name</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">to_string</span><span style="color:#F8F8F2">())</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">collect</span><span style="color:#F8F8F2">();</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">            </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> rows</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Vec</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">Vec</span><span style="color:#F8F8F2">&lt;_&gt;&gt; </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> table_iter</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">map</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2">row</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">                    columns</span></div><div class="line"><span style="color:#F8F8F2">                        </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">iter</span><span style="color:#F8F8F2">()</span></div><div class="line"><span style="color:#F8F8F2">                        </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">map</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">move</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2">col</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2"> row</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">get</span><span style="color:#F8F8F2">(col)</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">to_string</span><span style="color:#F8F8F2">())</span></div><div class="line"><span style="color:#F8F8F2">                        </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">collect</span><span style="color:#F8F8F2">()</span></div><div class="line"><span style="color:#F8F8F2">                })</span></div><div class="line"><span style="color:#F8F8F2">                </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">collect</span><span style="color:#F8F8F2">();</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">            rows</span></div><div class="line"><span style="color:#F8F8F2">        }</span></div><div class="line"><span style="color:#F8F8F2">        _ </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">unreachable!</span><span style="color:#F8F8F2">(),</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>The above code is very jank rust, but it will get the job done for explore for now.
After running the build we can use it the test file like so</p>
<div class="remark-code-title">__test__/index.spec.mjs</div>
<div class="relative"><pre class="shiki dracula"><div class="language-id">javascript</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">import</span><span style="color:#F8F8F2"> test </span><span style="color:#FF79C6">from</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">ava</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"></div><div class="line"><span style="color:#FF79C6">import</span><span style="color:#F8F8F2"> { basicQuery } </span><span style="color:#FF79C6">from</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">../index.js</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"></div><div class="line"><span style="color:#50FA7B">test</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">basic test</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">, (</span><span style="color:#FFB86C">t</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">  t.</span><span style="color:#50FA7B">deepEqual</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">basicQuery</span><span style="color:#F8F8F2">(), [</span></div><div class="line"><span style="color:#F8F8F2">    [</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">1</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">, </span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">aString</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">],</span></div><div class="line"><span style="color:#F8F8F2">    [</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">4</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">, </span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">aDiffString with spaces</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">],</span></div><div class="line"><span style="color:#F8F8F2">  ]);</span></div><div class="line"><span style="color:#F8F8F2">});</span></div></code></div></pre></div>
<p>One thing you&#x27;ll notice is the casing of <code>basic_query</code> in rust was changed to <code>basicQuery</code> in JS.</p>
<h3 id="allowed-values"><a href="#allowed-values" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Allowed values</h3>
<p>When exposing a function with the napi macro you are limited into what types are supported in the arguments/returns types. The function doc page lists then <a target="_blank" rel="noopener noreferrer" href="https://napi.rs/docs/concepts/function#arguments">here</a>. The TLDR is most &quot;primitive&quot; rust types are supported and any struct you add the <code>#[napi]</code> macro too. This could cause issues with third party libraries, so you probably will need to make your own wrapper types to pass them between rust and node.</p>
<h3 id="exposing-classes"><a href="#exposing-classes" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Exposing Classes</h3>
<p>While the above works its obviously very restrictive and crappy rust, so let&#x27;s expose a wrapper around <code>sql_jr_execution::Execution</code>, so the node side can run arbitrary queries + track state.</p>
<p>Like we did with functions you can add the <code>#[napi]</code> macro above structs to expose them as a JS class.
While we could add that macro in the <code>sql_jr_execution</code> crate on the <code>Execution</code> struct itself I think it will be better to have a napi crate + explicit wrapper structs to keep the API of the node addon more stable. Also, as you will come to see there are some limitations on the exposed code that would be nice to not litter the rest of the code base with.</p>
<p>So let&#x27;s make a <code>NodeExec</code> struct like so</p>
<div class="remark-code-title">src/lib.rs</div>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#F8F8F2">#[napi(js_name </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;Execution&quot;</span><span style="color:#F8F8F2">)]</span></div><div class="line"><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">struct</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">NodeExec</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    execution</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Execution</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">}</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">#[napi]</span></div><div class="line"><span style="color:#FF79C6">impl</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">NodeExec</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    #[napi(constructor)]</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">() </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">Self</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#BD93F9">Self</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">            execution</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Execution</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">(),</span></div><div class="line"><span style="color:#F8F8F2">        }</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>This will expose a JS class called <code>Execution</code> with a constructor corresponding to the <code>new</code> function.</p>
<p>Let&#x27;s add a class method that will run a query return an array of records when it was a select query.</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#6272A4">/// A List of rows returned by the query.</span></div><div class="line"><span style="color:#6272A4">/// Each row is a map of col =&gt; data as string</span></div><div class="line"><span style="color:#FF79C6">type</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">QueryRes</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Vec</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">HashMap</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">String</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">String</span><span style="color:#F8F8F2">&gt;&gt;;</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">#[napi]</span></div><div class="line"><span style="color:#FF79C6">impl</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">NodeExec</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">  #[napi(ts_return_type </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;Array&lt;Record&lt;string,string&gt;&gt;&quot;</span><span style="color:#F8F8F2">)]</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">query</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;mut</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">self</span><span style="color:#F8F8F2">, query</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">String</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> napi</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Result</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">QueryRes</span><span style="color:#F8F8F2">&gt; {</span></div><div class="line"><span style="color:#F8F8F2">      </span><span style="color:#FF79C6">use</span><span style="color:#F8F8F2"> napi</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">{</span><span style="color:#8BE9FD">Error</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">Status</span><span style="color:#F8F8F2">};</span></div><div class="line"><span style="color:#F8F8F2">      </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> res </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">self</span></div><div class="line"><span style="color:#F8F8F2">          </span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">execution</span></div><div class="line"><span style="color:#F8F8F2">          </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">parse_and_run</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">&amp;</span><span style="color:#F8F8F2">query)</span></div><div class="line"><span style="color:#6272A4">          // Probably a good idea to impl From&lt;SqlError&lt;_&gt; for napi::Error in sql_jr_execution</span></div><div class="line"><span style="color:#6272A4">          // gated behind a napi feature flag</span></div><div class="line"><span style="color:#F8F8F2">          </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">map_err</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Error</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD">Status</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">GenericFailure</span><span style="color:#F8F8F2">, </span><span style="color:#50FA7B">format!</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">&quot;{}&quot;</span><span style="color:#F8F8F2">, e)))</span><span style="color:#FF79C6">?</span><span style="color:#F8F8F2">;</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">      </span><span style="color:#8BE9FD">Ok</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">match</span><span style="color:#F8F8F2"> res {</span></div><div class="line"><span style="color:#F8F8F2">          </span><span style="color:#8BE9FD">ExecResponse</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">Select</span><span style="color:#F8F8F2">(table_iter) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">              </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> columns</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Vec</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">String</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> table_iter</span></div><div class="line"><span style="color:#F8F8F2">                  </span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">columns</span></div><div class="line"><span style="color:#F8F8F2">                  </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">iter</span><span style="color:#F8F8F2">()</span></div><div class="line"><span style="color:#F8F8F2">                  </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">map</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2">col</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2"> col</span><span style="color:#FF79C6">.</span><span style="color:#F8F8F2">name</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">to_string</span><span style="color:#F8F8F2">())</span></div><div class="line"><span style="color:#F8F8F2">                  </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">collect</span><span style="color:#F8F8F2">();</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">              table_iter</span></div><div class="line"><span style="color:#F8F8F2">                  </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">map</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2">row</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">                      columns</span></div><div class="line"><span style="color:#F8F8F2">                          </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">iter</span><span style="color:#F8F8F2">()</span></div><div class="line"><span style="color:#F8F8F2">                          </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">map</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">move</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2">col</span><span style="color:#FF79C6">|</span><span style="color:#F8F8F2"> (col</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">clone</span><span style="color:#F8F8F2">(), row</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">get</span><span style="color:#F8F8F2">(col)</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">to_string</span><span style="color:#F8F8F2">()))</span></div><div class="line"><span style="color:#F8F8F2">                          </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">collect</span><span style="color:#F8F8F2">()</span></div><div class="line"><span style="color:#F8F8F2">                  })</span></div><div class="line"><span style="color:#F8F8F2">                  </span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">collect</span><span style="color:#F8F8F2">()</span></div><div class="line"><span style="color:#F8F8F2">          }</span></div><div class="line"><span style="color:#F8F8F2">          _ </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Vec</span><span style="color:#FF79C6">::</span><span style="color:#50FA7B">new</span><span style="color:#F8F8F2">(),</span></div><div class="line"><span style="color:#F8F8F2">      })</span></div><div class="line"><span style="color:#F8F8F2">  }</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>First we need to manually set <code>ts_return_type = &quot;Array&lt;Record&lt;string,string&gt;&gt;&quot;</code> since we used a type alias in the function signatures. This is due to some limitations into how <a target="_blank" rel="noopener noreferrer" href="https://github.com/napi-rs/napi-rs/issues/1019#issuecomment-1009116165">proc macros in rust work</a>.</p>
<p>Second we needed to convert the returned Error from <code>parse_and_run</code> into a <code>napi::Error</code> with <code>.map_err(|e| Error::new(Status::GenericFailure, format!(&quot;{}&quot;, e)))</code>. This is not the best conversion since it would just stringify the execution error but it&#x27;s not the end of the world.</p>
<p>The generated typescript looks like</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">typescript</div><div class="code-container"><code><div class="line"><span style="color:#6272A4">/* tslint:disable */</span></div><div class="line"><span style="color:#6272A4">/* eslint-disable */</span></div><div class="line"></div><div class="line"><span style="color:#6272A4">/* auto-generated by NAPI-RS */</span></div><div class="line"></div><div class="line"><span style="color:#FF79C6">export</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">function</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">basicQuery</span><span style="color:#F8F8F2">()</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Array</span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C">Array</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">string</span><span style="color:#F8F8F2">&gt;&gt;;</span></div><div class="line"><span style="color:#FF79C6">export</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">type</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">NodeExec</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Execution</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#FF79C6">export</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">class</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Execution</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#FF79C6">constructor</span><span style="color:#F8F8F2">();</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#50FA7B">query</span><span style="color:#F8F8F2">(</span><span style="color:#FFB86C">query</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">string</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Array</span><span style="color:#F8F8F2">&lt;</span><span style="color:#FFB86C">Record</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">string</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">string</span><span style="color:#F8F8F2">&gt;&gt;;</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>To use this we can add the following test.</p>
<div class="remark-code-title">__test__/index.spec.mjs</div>
<div class="relative"><pre class="shiki dracula"><div class="language-id">javascript</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">import</span><span style="color:#F8F8F2"> test </span><span style="color:#FF79C6">from</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">ava</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">;</span></div><div class="line"></div><div class="line"><span style="color:#FF79C6">import</span><span style="color:#F8F8F2"> { Execution } </span><span style="color:#FF79C6">from</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">../index.js</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2">;</span></div><div class="line"></div><div class="line"><span style="color:#50FA7B">test</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">exec struct</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2">, (</span><span style="color:#FFB86C">t</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">const</span><span style="color:#F8F8F2"> exec </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">new</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">Execution</span><span style="color:#F8F8F2">();</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">    t.</span><span style="color:#50FA7B">deepEqual</span><span style="color:#F8F8F2">(</span></div><div class="line"><span style="color:#F8F8F2">        exec.</span><span style="color:#50FA7B">query</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">`</span></div><div class="line"><span style="color:#F1FA8C">        CREATE TABLE foo (</span></div><div class="line"><span style="color:#F1FA8C">          col1 int,</span></div><div class="line"><span style="color:#F1FA8C">          col2 string</span></div><div class="line"><span style="color:#F1FA8C">        );</span></div><div class="line"><span style="color:#F1FA8C">      `</span><span style="color:#F8F8F2">),</span></div><div class="line"><span style="color:#F8F8F2">        []</span></div><div class="line"><span style="color:#F8F8F2">    );</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">    t.</span><span style="color:#50FA7B">deepEqual</span><span style="color:#F8F8F2">(</span></div><div class="line"><span style="color:#F8F8F2">        exec.</span><span style="color:#50FA7B">query</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">`</span></div><div class="line"><span style="color:#F1FA8C">          INSERT INTO foo</span></div><div class="line"><span style="color:#F1FA8C">          VALUES</span></div><div class="line"><span style="color:#F1FA8C">              1, &#x27;aString&#x27;;</span></div><div class="line"><span style="color:#F1FA8C">        `</span><span style="color:#F8F8F2">),</span></div><div class="line"><span style="color:#F8F8F2">        []</span></div><div class="line"><span style="color:#F8F8F2">    );</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">    t.</span><span style="color:#50FA7B">deepEqual</span><span style="color:#F8F8F2">(</span></div><div class="line"><span style="color:#F8F8F2">        exec.</span><span style="color:#50FA7B">query</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">`</span></div><div class="line"><span style="color:#F1FA8C">          INSERT INTO foo</span></div><div class="line"><span style="color:#F1FA8C">          VALUES</span></div><div class="line"><span style="color:#F1FA8C">              4, &#x27;aDiffString with spaces&#x27;;</span></div><div class="line"><span style="color:#F1FA8C">        `</span><span style="color:#F8F8F2">),</span></div><div class="line"><span style="color:#F8F8F2">        []</span></div><div class="line"><span style="color:#F8F8F2">    );</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">    t.</span><span style="color:#50FA7B">deepEqual</span><span style="color:#F8F8F2">(</span></div><div class="line"><span style="color:#F8F8F2">        exec.</span><span style="color:#50FA7B">query</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">`</span></div><div class="line"><span style="color:#F1FA8C">          SELECT</span></div><div class="line"><span style="color:#F1FA8C">            col1,</span></div><div class="line"><span style="color:#F1FA8C">            col2</span></div><div class="line"><span style="color:#F1FA8C">          FROM</span></div><div class="line"><span style="color:#F1FA8C">              foo;</span></div><div class="line"><span style="color:#F1FA8C">        `</span><span style="color:#F8F8F2">),</span></div><div class="line"><span style="color:#F8F8F2">        [</span></div><div class="line"><span style="color:#F8F8F2">            {</span></div><div class="line"><span style="color:#F8F8F2">                col1</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">1</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">                col2</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">aString</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">            },</span></div><div class="line"><span style="color:#F8F8F2">            {</span></div><div class="line"><span style="color:#F8F8F2">                col1</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">4</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">                col2</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">aDiffString with spaces</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">            },</span></div><div class="line"><span style="color:#F8F8F2">        ]</span></div><div class="line"><span style="color:#F8F8F2">    );</span></div><div class="line"><span style="color:#F8F8F2">});</span></div><div class="line"></div><div class="line"><span style="color:#50FA7B">test</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">parse error</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2">, (</span><span style="color:#FFB86C">t</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">const</span><span style="color:#F8F8F2"> exec </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">new</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">Execution</span><span style="color:#F8F8F2">();</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">    t.</span><span style="color:#50FA7B">throws</span><span style="color:#F8F8F2">(() </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> exec.</span><span style="color:#50FA7B">query</span><span style="color:#F8F8F2">(</span><span style="color:#F1FA8C">`sad`</span><span style="color:#F8F8F2">), { code</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">GenericFailure</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2">, message</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">Parse Error</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2"> });</span></div><div class="line"><span style="color:#F8F8F2">});</span></div></code></div></pre></div>
<p>In the success case we get an array of records, in the failure case a JS error is thrown.</p>
<h2 id="async-support"><a href="#async-support" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Async Support</h2>
<p>My db does not have any async code yet so lets play with a dummy example.</p>
<p>To enable async support you can enable the <code>tokio_rt</code> feature on the napi crate in the <code>Cargo.toml</code></p>
<div class="remark-code-title">Cargo.toml</div>
<div class="relative"><pre class="shiki dracula"><div class="language-id">toml</div><div class="code-container"><code><div class="line"><span style="color:#FF79C6">[</span><span style="color:#8BE9FD">dependencies</span><span style="color:#FF79C6">]</span></div><div class="line"><span style="color:#8BE9FD">napi</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> { </span><span style="color:#8BE9FD">version</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">2.10.0</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">default-features</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">false</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD">features</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> [</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">napi4</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">, </span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">tokio_rt</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">] }</span></div></code></div></pre></div>
<p>Let&#x27;s add a dummy function on the execution class that will accept a promise as a parameter that will resolve to the query to run</p>
<div class="remark-code-title">src/lib.rs</div>
<div class="relative"><pre class="shiki dracula"><div class="language-id">rust</div><div class="code-container"><code><div class="line"><span style="color:#F8F8F2">#[napi]</span></div><div class="line"><span style="color:#FF79C6">impl</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">NodeExec</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#6272A4">    /// # Safety</span></div><div class="line"><span style="color:#6272A4">    ///</span></div><div class="line"><span style="color:#6272A4">    /// The execution struct should not be handled in multiple async functions</span></div><div class="line"><span style="color:#6272A4">    /// at a time.</span></div><div class="line"><span style="color:#F8F8F2">    #[napi(ts_return_type </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">&quot;Promise&lt;Array&lt;Record&lt;string,string&gt;&gt;&gt;&quot;</span><span style="color:#F8F8F2">)]</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">pub</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">async</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">unsafe</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">fn</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">query_async</span><span style="color:#F8F8F2">(</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#FF79C6">&amp;mut</span><span style="color:#F8F8F2"> </span><span style="color:#BD93F9">self</span><span style="color:#F8F8F2">,</span></div><div class="line"><span style="color:#F8F8F2">        query_promise</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> </span><span style="color:#8BE9FD">Promise</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">String</span><span style="color:#F8F8F2">&gt;,</span></div><div class="line"><span style="color:#F8F8F2">    ) </span><span style="color:#FF79C6">-&gt;</span><span style="color:#F8F8F2"> napi</span><span style="color:#FF79C6">::</span><span style="color:#8BE9FD">Result</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD">QueryRes</span><span style="color:#F8F8F2">&gt; {</span></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#FF79C6">let</span><span style="color:#F8F8F2"> query </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> query_promise</span><span style="color:#FF79C6">.await?</span><span style="color:#F8F8F2">;</span><span style="color:#6272A4"> // awaits the js promise like any other rust future</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">        </span><span style="color:#BD93F9">self</span><span style="color:#FF79C6">.</span><span style="color:#50FA7B">query</span><span style="color:#F8F8F2">(query)</span></div><div class="line"><span style="color:#F8F8F2">    }</span></div><div class="line"><span style="color:#F8F8F2">}</span></div></code></div></pre></div>
<p>One thing you will notice is that we needed to mark the function as <code>unsafe</code> since we take in <code>&amp;mut self</code> in an <code>async</code> function. The issue is rust can not enforce its borrow checker rules across the boundary with node. In sync code this is not an issue since node is single threaded. However, in async contexts another async task could mutate the Execution struct while a different task using that struct is suspended.</p>
<p>We can then test it like so</p>
<div class="relative"><pre class="shiki dracula"><div class="language-id">javascript</div><div class="code-container"><code><div class="line"><span style="color:#50FA7B">test</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&#x27;</span><span style="color:#F1FA8C">async function</span><span style="color:#E9F284">&#x27;</span><span style="color:#F8F8F2">, </span><span style="color:#FF79C6">async</span><span style="color:#F8F8F2"> (</span><span style="color:#FFB86C">t</span><span style="color:#F8F8F2">) </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#FF79C6">const</span><span style="color:#F8F8F2"> exec </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">new</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">Execution</span><span style="color:#F8F8F2">();</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">  </span><span style="color:#FF79C6">const</span><span style="color:#F8F8F2"> </span><span style="color:#50FA7B">get_query</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> </span><span style="color:#FF79C6">async</span><span style="color:#F8F8F2"> () </span><span style="color:#FF79C6">=&gt;</span><span style="color:#F8F8F2"> {</span></div><div class="line"><span style="color:#F8F8F2">    </span><span style="color:#FF79C6">return</span><span style="color:#F8F8F2"> </span><span style="color:#F1FA8C">`</span></div><div class="line"><span style="color:#F1FA8C">            CREATE TABLE foo (</span></div><div class="line"><span style="color:#F1FA8C">                col1 int,</span></div><div class="line"><span style="color:#F1FA8C">                col2 string</span></div><div class="line"><span style="color:#F1FA8C">            );</span></div><div class="line"><span style="color:#F1FA8C">        `</span><span style="color:#F8F8F2">;</span></div><div class="line"><span style="color:#F8F8F2">  };</span></div><div class="line"></div><div class="line"><span style="color:#F8F8F2">  t.</span><span style="color:#50FA7B">deepEqual</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">await</span><span style="color:#F8F8F2"> exec.</span><span style="color:#50FA7B">queryAsync</span><span style="color:#F8F8F2">(</span><span style="color:#50FA7B">get_query</span><span style="color:#F8F8F2">()), []);</span></div><div class="line"><span style="color:#F8F8F2">});</span></div></code></div></pre></div>
<h2 id="napi-limitations"><a href="#napi-limitations" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>napi limitations</h2>
<p>One of the main issues with napi (or any rust FFI) is that some “rustisms” don&#x27;t transfer well to JS/TS.
For example JS uses exceptions and not Result so any napi function returning a result will throw an error in node. Similar issue for option which just becomes <code>undefined | T</code>. Would be cool if napi had a feature flag to make rust results be exposed as a <a target="_blank" rel="noopener noreferrer" href="https://github.com/supermacro/neverthrow">https://github.com/supermacro/neverthrow</a> result or a similar lib.</p>
<p>The other main issue is there is overhead involved when passing large/complex type between node and rust. Rust needs to serialize/deserialize the JS types into a format it can use. There are workarounds like using buffers/typed arrays but that requires some manual work on both ends to manually serialize/deserialize the objects. In the <a target="_blank" rel="noopener noreferrer" href="https://github.com/napi-rs/napi-rs/issues/1493">napi v3</a> goals they plan on adding ways to make working around this simpler.</p>
<p>Lastly there is currently only <a target="_blank" rel="noopener noreferrer" href="https://docs.rs/napi/latest/napi/iterator/trait.Generator.html">experimental JS generator support</a> (with no docs on it that I can find), and no support for async generators/node streams. While you could manually add JS code to support these would be much nicer if napi did it for you. Stream support is planned for v3, so hopefully the others will follow.</p>
<h2 id="wrap-up"><a href="#wrap-up" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Wrap up</h2>
<p>Overall napi is very useable and with my limited use of cross language FFI tools, it has had the nicest user experience.
While it has limitations/some issues overall nothing major is in your way from exposing very useable and performant code if you put in a little extra work.</p></div></div></div></div></article></div></main><footer><div class="flex flex-col items-center mt-16"><div class="flex mb-3 space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer me" href="https://github.com/JRMurr"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer me" href="https://twitter.com/JRMurrCodes"><span class="sr-only">twitter</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M23.953 4.57a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.06a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.936 4.936 0 0 0 4.604 3.417 9.867 9.867 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0 0 24 4.59z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer me" href="https://hachyderm.io/@jrmurr"><span class="sr-only">mastodon</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-8 w-8"><path d="M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer me" href="/feed.xml"><span class="sr-only">rss</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24.912 24.912" style="enable-background:new 0 0 24.912 24.912" xml:space="preserve" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M3.692 17.517A3.696 3.696 0 0 0 0 21.211C0 23.244 1.656 24.9 3.692 24.9s3.694-1.657 3.694-3.689a3.697 3.697 0 0 0-3.694-3.694z"></path><path d="M.384 8.142A.386.386 0 0 0 0 8.527v4.688c0 .211.173.383.384.383 6.02 0 10.919 4.898 10.919 10.92 0 .209.171.383.384.383h4.705a.385.385 0 0 0 .387-.383l-.018-.121C16.692 15.423 9.37 8.142.384 8.142z"></path><path d="M24.89 24.397C24.825 10.936 13.854.011.384.011A.385.385 0 0 0 0 .397v4.824c0 .212.173.383.384.383 10.429 0 18.913 8.486 18.913 18.914 0 .209.172.383.382.383h4.845a.39.39 0 0 0 .388-.383l-.022-.121z"></path></svg></a></div><div class="flex mb-2 space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>John Murray</div><div> • </div><div>© 2023</div><div> • </div><a href="/">John&#x27;s Codes</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var d=Object.create;var r=Object.defineProperty;var t=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,y=Object.prototype.hasOwnProperty;var i=n=\u003er(n,\"__esModule\",{value:!0});var m=(n,s)=\u003e()=\u003e(s||n((s={exports:{}}).exports,s),s.exports),u=(n,s)=\u003e{i(n);for(var c in s)r(n,c,{get:s[c],enumerable:!0})},v=(n,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let e of h(s))!y.call(n,e)\u0026\u0026e!==\"default\"\u0026\u0026r(n,e,{get:()=\u003es[e],enumerable:!(c=t(s,e))||c.enumerable});return n},N=n=\u003ev(i(r(n!=null?d(p(n)):{},\"default\",n\u0026\u0026n.__esModule\u0026\u0026\"default\"in n?{get:()=\u003en.default,enumerable:!0}:{value:n,enumerable:!0})),n);var F=m((w,a)=\u003e{a.exports=_jsx_runtime});var E={};u(E,{default:()=\u003eg,frontmatter:()=\u003eC});var l=N(F()),C={title:\"Exposing a Rust Library to Node with Napi-rs\",date:new Date(1682961719515),tags:[\"rust\",\"node\",\"typescript\"],draft:!1,summary:\"Short guide/exploration on making native node addons with rust\",images:[],layout:\"PostLayout\"};function A(n={}){let{wrapper:s}=n.components||{};return s?(0,l.jsx)(s,Object.assign({},n,{children:(0,l.jsx)(c,{})})):c();function c(){let e=Object.assign({p:\"p\",a:\"a\",h2:\"h2\",span:\"span\",pre:\"pre\",div:\"div\",code:\"code\",h3:\"h3\"},n.components),{TOCInline:o}=e;return o||f(\"TOCInline\",!0),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o,{toc:n.toc,asDisclosure:!0}),`\n`,(0,l.jsx)(e.p,{children:\"I unapologetically shill Rust every chance I get, annoying my coworkers by insisting that everything would be better if we just used Rust. At this point, it has become a bit of a meme, so no one really listens to me (rightfully so).\"}),`\n`,(0,l.jsx)(e.p,{children:\"To finally put an end to the meme, I decided to research ways we could incorporate Rust into our systems. Ideally, we would create a new service in Rust, but since we are not yet big on microservices, the best approach would be to call Rust directly from our Node monolith.\"}),`\n`,(0,l.jsxs)(e.p,{children:[\"Since Node is written in C++, it provides ways to call native code via \",(0,l.jsx)(e.a,{href:\"https://nodejs.org/api/addons.html\",children:\"addons\"}),\". The \",(0,l.jsx)(e.a,{href:\"https://napi.rs/\",children:\"napi-rs\"}),\" library helps with the boilerplate of exposing Rust code as a Node addon.\"]}),`\n`,(0,l.jsx)(e.p,{children:\"Napi-rs along with generating the node addon will also generate typescript type definitions and has a nice CLI to more easily make addons for all popular systems/architectures.\"}),`\n`,(0,l.jsxs)(e.h2,{id:\"setting-up-napi\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#setting-up-napi\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Setting up napi\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"I'm going to experiment with napi in the codebase from the \",(0,l.jsx)(e.a,{href:\"/blog/build-a-db/part01\",children:\"build a db in rust series\"}),\", branch with all the code \",(0,l.jsx)(e.a,{href:\"https://github.com/JRMurr/SQLJr/tree/napi-bindings/crates/sql_jr_node\",children:\"here\"}),\".\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Most of the following is taken form the \",(0,l.jsx)(e.a,{href:\"https://napi.rs/docs/introduction/getting-started\",children:\"napi getting started docs\"})]}),`\n`,(0,l.jsx)(e.p,{children:`You first need to install the napi CLI, which can be done with your favorite node package manager of choice.\nWhile I could use npm/yarn/pnpm, I like use nix flakes, so I added the following to my project's flake file`}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"flake.nix\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"nix\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"buildInputs\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF5555\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF5555\"},children:\"with\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"pkgs\"}),(0,l.jsx)(e.span,{style:{color:\"#FF5555\"},children:\";\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" [\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"     \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"napi-rs-cli\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  ]\"}),(0,l.jsx)(e.span,{style:{color:\"#FF5555\"},children:\";\"})]})]})})]}),`\n`,(0,l.jsx)(e.p,{children:\"The CLI generates a Rust crate with the appropriate build scripts to build the node addon, along with the necessary node boilerplate to load the addon with type definitions. Additionally, it includes some GitHub actions to build and publish the npm packages.\"}),`\n`,(0,l.jsx)(e.p,{children:\"Run the CLI with\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"shell\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsx)(e.code,{children:(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"napi new\"})})})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"You will get an interactive prompt to give a package name and folder path (useful if you use cargo workspaces). The docs recommend prefixing the package name with a \",(0,l.jsx)(e.a,{href:\"https://docs.npmjs.com/creating-and-publishing-scoped-public-packages/\",children:\"npm scope\"}),\" since napi will publish multiple packages for different architectures.\"]}),`\n`,(0,l.jsx)(e.p,{children:\"The generated rust will look like\"}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"src/lib.rs\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"// imports excluded\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"#[napi]\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"sum\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(a\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"i32\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", b\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"i32\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"i32\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  a \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"+\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" b\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsx)(e.p,{children:\"A generated test file which uses the node addon looks like\"}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"__test__/index.spec.mjs\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"javascript\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"import\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" test \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"from\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"ava\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:\"'\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"import\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { sum } \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"from\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"../index.js\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:\"'\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"test\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"sum from native\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", (\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"t\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  t.\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"is\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"sum\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"1\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"2\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"), \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"3\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"})\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"The other main piece is the \",(0,l.jsx)(e.code,{children:\"index.js\"}),\" file at the package root which has all the logic for loading the right addon for each architecture.\"]}),`\n`,(0,l.jsx)(e.p,{children:\"you can then run the following to build the addon, generate TS types, and run tests\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"shell\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"npm install \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# replace with your node package manager of choice\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"npm run build \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# builds the rust code into a node addon + add typescript definitons\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"npm run \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"test\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"# runs the sample js test file using the node addon\"})]})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"After the build step you should see and \",(0,l.jsx)(e.code,{children:\"index.d.ts\"}),\" file that looks like\"]}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"typescript\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"/* tslint:disable */\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"/* eslint-disable */\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"/* auto-generated by NAPI-RS */\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"export\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"function\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"sum\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"a\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"number\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"b\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"number\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"number\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]})]})})]}),`\n`,(0,l.jsxs)(e.h2,{id:\"using-napi\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#using-napi\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Using napi\"]}),`\n`,(0,l.jsx)(e.p,{children:\"To explore more of napi, let's write a rust function that does something slightly more sophisticated with my SQL_JR db.\"}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"src/lib.rs\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"#[napi]\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"basic_query\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"() \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Vec\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Vec\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e\u003e {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"mut\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" exec \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" sql_jr_execution\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Execution\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"();\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    exec\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"parse_and_run\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"'})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"      CREATE TABLE foo (\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"        col1 int,\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"        col2 string\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"      );\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'    \"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    )\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"expect\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"create works..\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\");\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    exec\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"parse_and_run\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"'})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"        INSERT INTO foo\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"        VALUES\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            1, 'aString';\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'      \"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    )\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"expect\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"insert 1 works..\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\");\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    exec\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"parse_and_run\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"'})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"        INSERT INTO foo\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"        VALUES\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            4, 'aDiffString with spaces';\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'    \"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    )\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"expect\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"insert 2 works..\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\");\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" res \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" exec\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"parse_and_run\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"'})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"        SELECT\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"          col1,\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"          col2\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"        FROM\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            foo;\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'        \"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        )\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"expect\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"select works\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\");\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"match\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" res {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ExecResponse\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"Select\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(table_iter) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" columns\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Vec\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" table_iter\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"columns\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"iter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"map\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"col\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" col\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"name\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"to_string\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"())\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"collect\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"();\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" rows\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Vec\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Vec\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c_\u003e\u003e \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" table_iter\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"map\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"row\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                    columns\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                        \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"iter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                        \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"map\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"move\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"col\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" row\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"get\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(col)\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"to_string\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"())\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                        \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"collect\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                })\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"collect\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"();\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            rows\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        }\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        _ \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"unreachable!\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(),\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsx)(e.p,{children:`The above code is very jank rust, but it will get the job done for explore for now.\nAfter running the build we can use it the test file like so`}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"__test__/index.spec.mjs\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"javascript\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"import\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" test \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"from\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"ava\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"import\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { basicQuery } \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"from\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"../index.js\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"test\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"basic test\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", (\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"t\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  t.\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"deepEqual\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"basicQuery\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(), [\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    [\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"1\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"aString\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"],\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    [\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"4\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"aDiffString with spaces\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"],\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  ]);\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"});\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"One thing you'll notice is the casing of \",(0,l.jsx)(e.code,{children:\"basic_query\"}),\" in rust was changed to \",(0,l.jsx)(e.code,{children:\"basicQuery\"}),\" in JS.\"]}),`\n`,(0,l.jsxs)(e.h3,{id:\"allowed-values\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#allowed-values\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Allowed values\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"When exposing a function with the napi macro you are limited into what types are supported in the arguments/returns types. The function doc page lists then \",(0,l.jsx)(e.a,{href:\"https://napi.rs/docs/concepts/function#arguments\",children:\"here\"}),'. The TLDR is most \"primitive\" rust types are supported and any struct you add the ',(0,l.jsx)(e.code,{children:\"#[napi]\"}),\" macro too. This could cause issues with third party libraries, so you probably will need to make your own wrapper types to pass them between rust and node.\"]}),`\n`,(0,l.jsxs)(e.h3,{id:\"exposing-classes\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#exposing-classes\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Exposing Classes\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"While the above works its obviously very restrictive and crappy rust, so let's expose a wrapper around \",(0,l.jsx)(e.code,{children:\"sql_jr_execution::Execution\"}),\", so the node side can run arbitrary queries + track state.\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Like we did with functions you can add the \",(0,l.jsx)(e.code,{children:\"#[napi]\"}),` macro above structs to expose them as a JS class.\nWhile we could add that macro in the `,(0,l.jsx)(e.code,{children:\"sql_jr_execution\"}),\" crate on the \",(0,l.jsx)(e.code,{children:\"Execution\"}),\" struct itself I think it will be better to have a napi crate + explicit wrapper structs to keep the API of the node addon more stable. Also, as you will come to see there are some limitations on the exposed code that would be nice to not litter the rest of the code base with.\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"So let's make a \",(0,l.jsx)(e.code,{children:\"NodeExec\"}),\" struct like so\"]}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"src/lib.rs\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"#[napi(js_name \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"Execution\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")]\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"struct\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"NodeExec\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    execution\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Execution\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"#[napi]\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"impl\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"NodeExec\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    #[napi(constructor)]\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"() \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"Self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"Self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            execution\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Execution\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(),\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"This will expose a JS class called \",(0,l.jsx)(e.code,{children:\"Execution\"}),\" with a constructor corresponding to the \",(0,l.jsx)(e.code,{children:\"new\"}),\" function.\"]}),`\n`,(0,l.jsx)(e.p,{children:\"Let's add a class method that will run a query return an array of records when it was a select query.\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"/// A List of rows returned by the query.\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"/// Each row is a map of col =\u003e data as string\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"type\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"QueryRes\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Vec\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"HashMap\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e\u003e;\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"#[napi]\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"impl\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"NodeExec\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  #[napi(ts_return_type \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"Array\u003cRecord\u003cstring,string\u003e\u003e\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")]\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"query\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026mut\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", query\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" napi\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Result\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"QueryRes\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"use\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" napi\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"{\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Error\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Status\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"};\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" res \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"execution\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"parse_and_run\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"query)\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"          // Probably a good idea to impl From\u003cSqlError\u003c_\u003e for napi::Error in sql_jr_execution\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"          // gated behind a napi feature flag\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"map_err\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"e\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Error\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Status\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"GenericFailure\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"format!\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"{}\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", e)))\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"?\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Ok\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"match\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" res {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"ExecResponse\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"Select\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(table_iter) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"              \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" columns\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Vec\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" table_iter\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                  \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"columns\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                  \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"iter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                  \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"map\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"col\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" col\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"name\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"to_string\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"())\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                  \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"collect\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"();\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"              table_iter\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                  \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"map\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"row\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                      columns\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                          \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"iter\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                          \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"map\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"move\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"col\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"|\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" (col\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"clone\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(), row\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"get\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(col)\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"to_string\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()))\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                          \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"collect\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                  })\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                  \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"collect\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          }\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"          _ \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Vec\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(),\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"      })\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"First we need to manually set \",(0,l.jsx)(e.code,{children:'ts_return_type = \"Array\u003cRecord\u003cstring,string\u003e\u003e\"'}),\" since we used a type alias in the function signatures. This is due to some limitations into how \",(0,l.jsx)(e.a,{href:\"https://github.com/napi-rs/napi-rs/issues/1019#issuecomment-1009116165\",children:\"proc macros in rust work\"}),\".\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Second we needed to convert the returned Error from \",(0,l.jsx)(e.code,{children:\"parse_and_run\"}),\" into a \",(0,l.jsx)(e.code,{children:\"napi::Error\"}),\" with \",(0,l.jsx)(e.code,{children:'.map_err(|e| Error::new(Status::GenericFailure, format!(\"{}\", e)))'}),\". This is not the best conversion since it would just stringify the execution error but it's not the end of the world.\"]}),`\n`,(0,l.jsx)(e.p,{children:\"The generated typescript looks like\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"typescript\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"/* tslint:disable */\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"/* eslint-disable */\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"/* auto-generated by NAPI-RS */\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"export\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"function\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"basicQuery\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Array\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"Array\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"string\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e\u003e;\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"export\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"type\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"NodeExec\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Execution\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"export\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"class\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Execution\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"constructor\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"();\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"query\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"query\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"string\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Array\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"Record\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"string\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"string\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e\u003e;\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsx)(e.p,{children:\"To use this we can add the following test.\"}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"__test__/index.spec.mjs\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"javascript\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"import\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" test \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"from\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"ava\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"import\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { Execution } \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"from\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"../index.js\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"test\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"exec struct\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", (\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"t\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"const\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" exec \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"Execution\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"();\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    t.\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"deepEqual\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        exec.\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"query\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"`\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"        CREATE TABLE foo (\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"          col1 int,\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"          col2 string\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"        );\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"      `\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"),\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        []\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    );\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    t.\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"deepEqual\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        exec.\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"query\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"`\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"          INSERT INTO foo\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"          VALUES\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"              1, 'aString';\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"        `\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"),\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        []\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    );\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    t.\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"deepEqual\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        exec.\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"query\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"`\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"          INSERT INTO foo\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"          VALUES\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"              4, 'aDiffString with spaces';\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"        `\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"),\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        []\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    );\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    t.\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"deepEqual\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        exec.\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"query\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"`\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"          SELECT\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            col1,\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            col2\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"          FROM\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"              foo;\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"        `\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"),\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        [\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            {\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                col1\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"1\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                col2\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"aString\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            },\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            {\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                col1\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"4\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"                col2\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"aDiffString with spaces\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"            },\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        ]\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    );\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"});\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"test\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"parse error\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", (\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"t\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"const\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" exec \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"Execution\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"();\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    t.\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"throws\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(() \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" exec.\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"query\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"`sad`\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"), { code\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"GenericFailure\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", message\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"Parse Error\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" });\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"});\"})})]})})]}),`\n`,(0,l.jsx)(e.p,{children:\"In the success case we get an array of records, in the failure case a JS error is thrown.\"}),`\n`,(0,l.jsxs)(e.h2,{id:\"async-support\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#async-support\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Async Support\"]}),`\n`,(0,l.jsx)(e.p,{children:\"My db does not have any async code yet so lets play with a dummy example.\"}),`\n`,(0,l.jsxs)(e.p,{children:[\"To enable async support you can enable the \",(0,l.jsx)(e.code,{children:\"tokio_rt\"}),\" feature on the napi crate in the \",(0,l.jsx)(e.code,{children:\"Cargo.toml\"})]}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"Cargo.toml\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"toml\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"[\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"dependencies\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"]\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"napi\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" { \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"version\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"2.10.0\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"default-features\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"false\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"features\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" [\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"napi4\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"tokio_rt\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:'\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"] }\"})]})]})})]}),`\n`,(0,l.jsx)(e.p,{children:\"Let's add a dummy function on the execution class that will accept a promise as a parameter that will resolve to the query to run\"}),`\n`,(0,l.jsx)(\"div\",{className:\"remark-code-title\",children:\"src/lib.rs\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"rust\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"#[napi]\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"impl\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"NodeExec\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"    /// # Safety\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"    ///\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"    /// The execution struct should not be handled in multiple async functions\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\"    /// at a time.\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    #[napi(ts_return_type \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:'\"Promise\u003cArray\u003cRecord\u003cstring,string\u003e\u003e\u003e\"'}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\")]\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"pub\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"async\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"unsafe\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"fn\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"query_async\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"\u0026mut\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\",\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        query_promise\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\":\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Promise\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"String\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e,\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    ) \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"-\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" napi\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"::\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"Result\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003c\"}),(0,l.jsx)(e.span,{style:{color:\"#8BE9FD\"},children:\"QueryRes\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"\u003e {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"let\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" query \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" query_promise\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".await?\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"}),(0,l.jsx)(e.span,{style:{color:\"#6272A4\"},children:\" // awaits the js promise like any other rust future\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"        \"}),(0,l.jsx)(e.span,{style:{color:\"#BD93F9\"},children:\"self\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\".\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"query\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(query)\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    }\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"}\"})})]})})]}),`\n`,(0,l.jsxs)(e.p,{children:[\"One thing you will notice is that we needed to mark the function as \",(0,l.jsx)(e.code,{children:\"unsafe\"}),\" since we take in \",(0,l.jsx)(e.code,{children:\"\u0026mut self\"}),\" in an \",(0,l.jsx)(e.code,{children:\"async\"}),\" function. The issue is rust can not enforce its borrow checker rules across the boundary with node. In sync code this is not an issue since node is single threaded. However, in async contexts another async task could mutate the Execution struct while a different task using that struct is suspended.\"]}),`\n`,(0,l.jsx)(e.p,{children:\"We can then test it like so\"}),`\n`,(0,l.jsxs)(e.pre,{className:\"shiki dracula\",style:{backgroundColor:\"#282A36\",color:\"#F8F8F2\"},children:[(0,l.jsx)(e.div,{className:\"language-id\",children:\"javascript\"}),(0,l.jsx)(e.div,{className:\"code-container\",children:(0,l.jsxs)(e.code,{children:[(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"test\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"async function\"}),(0,l.jsx)(e.span,{style:{color:\"#E9F284\"},children:\"'\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\", \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"async\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" (\"}),(0,l.jsx)(e.span,{style:{color:\"#FFB86C\"},children:\"t\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\") \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"const\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" exec \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"new\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"Execution\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"();\"})]}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"const\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"get_query\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"async\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" () \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"=\u003e\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" {\"})]}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"    \"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"return\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" \"}),(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"`\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            CREATE TABLE foo (\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"                col1 int,\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"                col2 string\"})}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"            );\"})}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F1FA8C\"},children:\"        `\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\";\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  };\"})}),(0,l.jsx)(e.div,{className:\"line\"}),(0,l.jsxs)(e.div,{className:\"line\",children:[(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"  t.\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"deepEqual\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#FF79C6\"},children:\"await\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\" exec.\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"queryAsync\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"(\"}),(0,l.jsx)(e.span,{style:{color:\"#50FA7B\"},children:\"get_query\"}),(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"()), []);\"})]}),(0,l.jsx)(e.div,{className:\"line\",children:(0,l.jsx)(e.span,{style:{color:\"#F8F8F2\"},children:\"});\"})})]})})]}),`\n`,(0,l.jsxs)(e.h2,{id:\"napi-limitations\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#napi-limitations\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"napi limitations\"]}),`\n`,(0,l.jsxs)(e.p,{children:[`One of the main issues with napi (or any rust FFI) is that some \\u201Crustisms\\u201D don't transfer well to JS/TS.\nFor example JS uses exceptions and not Result so any napi function returning a result will throw an error in node. Similar issue for option which just becomes `,(0,l.jsx)(e.code,{children:\"undefined | T\"}),\". Would be cool if napi had a feature flag to make rust results be exposed as a \",(0,l.jsx)(e.a,{href:\"https://github.com/supermacro/neverthrow\",children:\"https://github.com/supermacro/neverthrow\"}),\" result or a similar lib.\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"The other main issue is there is overhead involved when passing large/complex type between node and rust. Rust needs to serialize/deserialize the JS types into a format it can use. There are workarounds like using buffers/typed arrays but that requires some manual work on both ends to manually serialize/deserialize the objects. In the \",(0,l.jsx)(e.a,{href:\"https://github.com/napi-rs/napi-rs/issues/1493\",children:\"napi v3\"}),\" goals they plan on adding ways to make working around this simpler.\"]}),`\n`,(0,l.jsxs)(e.p,{children:[\"Lastly there is currently only \",(0,l.jsx)(e.a,{href:\"https://docs.rs/napi/latest/napi/iterator/trait.Generator.html\",children:\"experimental JS generator support\"}),\" (with no docs on it that I can find), and no support for async generators/node streams. While you could manually add JS code to support these would be much nicer if napi did it for you. Stream support is planned for v3, so hopefully the others will follow.\"]}),`\n`,(0,l.jsxs)(e.h2,{id:\"wrap-up\",children:[(0,l.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#wrap-up\",children:(0,l.jsx)(e.span,{className:\"icon icon-link\"})}),\"Wrap up\"]}),`\n`,(0,l.jsx)(e.p,{children:`Overall napi is very useable and with my limited use of cross language FFI tools, it has had the nicest user experience.\nWhile it has limitations/some issues overall nothing major is in your way from exposing very useable and performant code if you put in a little extra work.`})]})}}var g=A;function f(n,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+n+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return E;})();\n;return Component;","toc":[{"value":"Setting up napi","url":"#setting-up-napi","depth":2},{"value":"Using napi","url":"#using-napi","depth":2},{"value":"Allowed values","url":"#allowed-values","depth":3},{"value":"Exposing Classes","url":"#exposing-classes","depth":3},{"value":"Async Support","url":"#async-support","depth":2},{"value":"napi limitations","url":"#napi-limitations","depth":2},{"value":"Wrap up","url":"#wrap-up","depth":2}],"frontMatter":{"readingTime":{"text":"10 min read","minutes":9.32,"time":559200,"words":1864},"slug":"exposing-a-rust-library-to-node-with-napirs","fileName":"exposing-a-rust-library-to-node-with-napirs.md","title":"Exposing a Rust Library to Node with Napi-rs","date":"2023-05-01T17:21:59.515Z","tags":["rust","node","typescript"],"draft":false,"summary":"Short guide/exploration on making native node addons with rust","images":[],"layout":"PostLayout"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.215,"time":12900,"words":43},"slug":["default"],"fileName":"default.md","name":"John Murray","avatar":"/static/images/me.jpg","occupation":"Software Engineer","github":"https://github.com/JRMurr","twitter":"https://twitter.com/JRMurrCodes","mastodon":"https://hachyderm.io/@jrmurr","email":"johnreillymurray@gmail.com","date":null}],"series":null},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["exposing-a-rust-library-to-node-with-napirs"]},"buildId":"s10FPnTlL5cwtRs3HC583","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>