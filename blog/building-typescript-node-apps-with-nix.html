<!DOCTYPE html><html lang="en-us" class="__variable_587f35 scroll-smooth"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/2d141e1a38819612-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/895662d5d095c22a.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/14fb540b7a3ad639.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-278bcb5a0daf8917.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-28d8581e6e02654e.js" async="" crossorigin=""></script><script src="/_next/static/chunks/69-dbeadf5c9f0cdabc.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-bef4f1fcfc072c84.js" async="" crossorigin=""></script><script src="/_next/static/chunks/250-a30085ccab20449f.js" async=""></script><script src="/_next/static/chunks/781-9238b26c3a132736.js" async=""></script><script src="/_next/static/chunks/app/layout-9608048ecb38eb6e.js" async=""></script><script src="/_next/static/chunks/749-ed776d54eb5c7205.js" async=""></script><script src="/_next/static/chunks/app/blog/%5B...slug%5D/page-fd9b73ee915812e8.js" async=""></script><title>Building Typescript Node Apps With Nix | John&#x27;s Codes</title><meta name="description" content="Trying some different nix builders for typescript node apps"/><meta name="robots" content="index, follow"/><meta name="googlebot" content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"/><link rel="canonical" href="https://johns.codes/blog/building-typescript-node-apps-with-nix"/><link rel="alternate" type="application/rss+xml" href="https://johns.codes/feed.xml"/><meta property="og:title" content="Building Typescript Node Apps With Nix"/><meta property="og:description" content="Trying some different nix builders for typescript node apps"/><meta property="og:url" content="https://johns.codes/blog/building-typescript-node-apps-with-nix"/><meta property="og:site_name" content="John&#x27;s Codes"/><meta property="og:locale" content="en_US"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2022-09-06T23:57:55.477Z"/><meta property="article:modified_time" content="2022-09-06T23:57:55.477Z"/><meta property="article:author" content="John Murray"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Building Typescript Node Apps With Nix"/><meta name="twitter:description" content="Trying some different nix builders for typescript node apps"/><meta name="next-size-adjust"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-950 dark:text-white"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><section class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between font-sans"><header class="flex items-center justify-between py-10"><div><a aria-label="John&#x27;s Codes" href="/"><div class="flex items-center justify-between"><div class="hidden h-6 text-2xl font-semibold sm:block">John&#x27;s Codes</div></div></a></div><div class="flex items-center space-x-4 leading-5 sm:space-x-6"><a class="hidden font-medium text-gray-900 dark:text-gray-100 sm:block" href="/blog">Blog</a><a class="hidden font-medium text-gray-900 dark:text-gray-100 sm:block" href="/tags">Tags</a><a class="hidden font-medium text-gray-900 dark:text-gray-100 sm:block" href="/projects">Projects</a><a class="hidden font-medium text-gray-900 dark:text-gray-100 sm:block" href="/about">About</a><button aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6 text-gray-900 dark:text-gray-100"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path></svg></button><button aria-label="Toggle Menu" class="sm:hidden"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-8 w-8 text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed left-0 top-0 z-10 h-full w-full transform bg-white opacity-95 duration-300 ease-in-out dark:bg-gray-950 dark:opacity-[0.98] translate-x-full"><div class="flex justify-end"><button class="mr-8 mt-11 h-8 w-8" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/">Home</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/projects">Projects</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></header><main class="mb-auto"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Building Typescript Node Apps With Nix","datePublished":"2022-09-06T23:57:55.477Z","dateModified":"2022-09-06T23:57:55.477Z","description":"Trying some different nix builders for typescript node apps","author":[{"@type":"Person","name":"John Murray"}]}</script><section class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed bottom-8 right-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div><header><div class="space-y-1 border-b border-gray-200 pb-10 text-center dark:border-gray-700"><dl><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2022-09-06T23:57:55.477Z">September 6, 2022</time><span class="mx-2">-</span><span class="ml-1">10<!-- --> min read</span></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Building Typescript Node Apps With Nix</h1></div></div></header><div class="grid-rows-[auto_1fr] divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:divide-y-0"><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pb-8 pt-10 dark:prose-invert"><details open=""><summary class="ml-6 pb-2 pt-2 text-xl font-bold">Table of Contents</summary><div class="ml-6"><ul class=""><li><a href="#being-a-nix-stan">Being a Nix Stan</a></li><li><a href="#the-app">The APP</a></li><li><a href="#nix-builds">Nix Builds</a><ul class=""><li><a href="#the-standard-environment">The Standard Environment</a></li><li><a href="#node2nix">node2nix</a></li><li><a href="#dream2nix">dream2nix</a></li></ul></li><li><a href="#conclusion">Conclusion</a></li></ul></div></details><h2 id="being-a-nix-stan"><a href="#being-a-nix-stan" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Being a Nix Stan</h2><p>I recently accepted that I am obsessed with Nix. Ask any remotely technical person with a pulse, and they can probably mention at least 10 times I&#x27;ve told them &quot;But with nix X is way easier/a nonissue&quot; (same with rust, but that&#x27;s for another day...).</p><p>The issue is, that I am a bit of a poser. I&#x27;ve been using Nix on/off for about 2.5 years but only seriously for the last 10ish months. I&#x27;ve mostly just consumed existing NixOS modules, nix packages, setup basic nix-shells/flakes, and relatively simple Nix builders. All of these uses of Nix were pretty great, and it made my life easier, but it only went so far as to solve some of the challenges I come across in my projects/work.</p><p>During my initial nix learning phase, I came across <code>node2nix</code> but the codegen step made me think that node and nix just don&#x27;t get along well, and I never looked further. My job primarily involves node web servers written in typescript. All I&#x27;ve done with Nix so far at work is set up basic dev environments with node. While it did make our README(s) a little nicer, it does not solve our issues in actually deploying our apps. Now that I got over the initial hump of adding nix to some of our processes, it&#x27;s time to make it even better!</p><p>If you are not familiar with Nix, <a href="/blog/rust-enviorment-and-docker-build-with-nix-flakes">this post</a> goes over the basics of Nix and builds a basic Rust app.</p><h2 id="the-app"><a href="#the-app" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The APP</h2><p>The source code for the app is <a target="_blank" rel="noopener noreferrer" href="https://github.com/JRMurr/example-ts-node-nix">here</a></p><p>First I need a basic app to build. I have been using <a target="_blank" rel="noopener noreferrer" href="https://www.fastify.io/">Fastify</a> recently, so I will attempt to build this basic web server.</p><div class="remark-code-title">index.ts</div><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">#!/usr/bin/env node</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">import</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> fastify </span><span style="color:#d73a49;--shiki-dark:#F97583">from</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;fastify&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">const</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> server</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> fastify</span><span style="color:#24292e;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">server.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">get</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;/ping&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">, </span><span style="color:#d73a49;--shiki-dark:#F97583">async</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> (</span><span style="color:#e36209;--shiki-dark:#FFAB70">_request</span><span style="color:#24292e;--shiki-dark:#E1E4E8">, </span><span style="color:#e36209;--shiki-dark:#FFAB70">_reply</span><span style="color:#24292e;--shiki-dark:#E1E4E8">) </span><span style="color:#d73a49;--shiki-dark:#F97583">=&gt;</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">  return</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;pong</span><span style="color:#005cc5;--shiki-dark:#79B8FF">\n</span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">server.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">listen</span><span style="color:#24292e;--shiki-dark:#E1E4E8">({ host: </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;0.0.0.0&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">, port: </span><span style="color:#005cc5;--shiki-dark:#79B8FF">8080</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> }, (</span><span style="color:#e36209;--shiki-dark:#FFAB70">err</span><span style="color:#24292e;--shiki-dark:#E1E4E8">, </span><span style="color:#e36209;--shiki-dark:#FFAB70">address</span><span style="color:#24292e;--shiki-dark:#E1E4E8">) </span><span style="color:#d73a49;--shiki-dark:#F97583">=&gt;</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">  if</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> (err) {</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    console.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">error</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(err);</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    process.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">exit</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#005cc5;--shiki-dark:#79B8FF">1</span><span style="color:#24292e;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">  console.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">log</span><span style="color:#24292e;--shiki-dark:#E1E4E8">(</span><span style="color:#032f62;--shiki-dark:#9ECBFF">`Server listening at ${</span><span style="color:#24292e;--shiki-dark:#E1E4E8">address</span><span style="color:#032f62;--shiki-dark:#9ECBFF">}`</span><span style="color:#24292e;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">});</span></span>
<span class="line"></span></code></pre></div><p>One important note about the <code>index.ts</code> file is the node shebang at the top. This will allow this file to act as a binary/entry point for the server.</p><p>I also added a strict tsconfig that outputs to <code>./dist</code> and a package.json that looks like</p><div class="remark-code-title">package.json</div><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79B8FF">  &quot;name&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">: </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;example-node-nix&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79B8FF">  &quot;version&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">: </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;1.0.0&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79B8FF">  &quot;main&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">: </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;dist/index.js&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79B8FF">  &quot;bin&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79B8FF">    &quot;example-node-nix&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">: </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;dist/index.js&quot;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79B8FF">  &quot;scripts&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79B8FF">    &quot;build&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">: </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;tsc -p tsconfig.json&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79B8FF">    &quot;start&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">: </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;node dist/index.js&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79B8FF">  &quot;license&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">: </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;MIT&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79B8FF">  &quot;dependencies&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79B8FF">    &quot;fastify&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">: </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;^4.5.3&quot;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79B8FF">  &quot;devDependencies&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79B8FF">    &quot;@tsconfig/node16&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">: </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;^1.0.1&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79B8FF">    &quot;@tsconfig/node16-strictest&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">: </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;^1.0.0&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79B8FF">    &quot;@types/node&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">: </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;^18.7.14&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79B8FF">    &quot;typescript&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">: </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;^4.8.2&quot;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre></div><p>I made a simple <code>flake.nix</code> to set up Node then ran</p><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">$</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> npm</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> run</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> build</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">$</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> npm</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> run</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> start</span></span>
<span class="line"></span></code></pre></div><p>The server is up and is responding.</p><h2 id="nix-builds"><a href="#nix-builds" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Nix Builds</h2><p>Like usual with nix I first try to see if other people have figured this out already, looking at the <a target="_blank" rel="noopener noreferrer" href="https://nixos.org/manual/nixpkgs/stable/#language-javascript">nixpkgs JS docs</a>, it mentions a few builders like <code>mkYarnPackage</code>, <a target="_blank" rel="noopener noreferrer" href="https://github.com/svanderburg/node2nix">node2nix</a>, <a target="_blank" rel="noopener noreferrer" href="https://github.com/nix-community/npmlock2nix">npmlock2nix</a>, and <a target="_blank" rel="noopener noreferrer" href="https://github.com/serokell/nix-npm-buildpackage">nix-npm-buildpackage</a>. These all seemed fine, but I couldn&#x27;t find any good typescript examples, or the docs were a little lacking to get started. So I figured why not just do it the dumb way to start and do it manually, what&#x27;s the worst that can happen?</p><h3 id="the-standard-environment"><a href="#the-standard-environment" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The Standard Environment</h3><p><a target="_blank" rel="noopener noreferrer" href="https://nixos.org/manual/nixpkgs/stable/#sec-using-stdenv">stdenv.mkDerivation</a> is what most &quot;high-level&quot; builders wrap. It provides you with a sandbox environment with some common programs like <code>coreutils</code>, <code>grep</code>, <code>awk</code>, <code>make</code>, etc., to build a program. It is very versatile and surprisingly easy to use once you get comfortable with its ideas. I was hopeful I could throw something together, so to start I just focused on the <code>buildPhase</code> and a very basic <code>installPhase</code> to verify everything was built, I would deal with running it later.</p><div class="remark-code-title">flake.nix</div><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  description</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;Sample Nix ts-node build&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  inputs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    nixpkgs</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">url</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;github:nixos/nixpkgs/nixos-unstable&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    flake-utils</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">url</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;github:numtide/flake-utils&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    gitignore</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">      url</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;github:hercules-ci/gitignore.nix&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">      inputs</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">nixpkgs</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">follows</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;nixpkgs&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    };</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  outputs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> { self</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> nixpkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> flake-utils</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> gitignore</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#d73a49;--shiki-dark:#F97583"> ... </span><span style="color:#24292e;--shiki-dark:#E1E4E8">}:</span></span>
<span class="line"><span style="color:#e36209;--shiki-dark:#FFAB70">    flake-utils</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">lib</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">eachDefaultSystem</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> (system:</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">      let</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        pkgs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> import</span><span style="color:#e36209;--shiki-dark:#FFAB70"> nixpkgs</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> { </span><span style="color:#d73a49;--shiki-dark:#F97583">inherit</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> system</span><span style="color:#24292e;--shiki-dark:#E1E4E8">; };</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        nodejs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> pkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">nodejs-16_x</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">        # NOTE: this does not work</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        appBuild</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> pkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">stdenv</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">mkDerivation</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          name</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;example-ts-node&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          version</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;0.1.0&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          src</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> gitignore</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">lib</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">gitignoreSource</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> ./.</span><span style="color:#24292e;--shiki-dark:#E1E4E8">; </span><span style="color:#6a737d;--shiki-dark:#6A737D"># uses the gitignore in the repo to only copy files git would see</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          buildInputs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> [ </span><span style="color:#e36209;--shiki-dark:#FFAB70">nodejs</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> ];</span></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">          # https://nixos.org/manual/nixpkgs/stable/#sec-stdenv-phases</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          buildPhase</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &#x27;&#x27;</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            # each phase has pre/postHooks. When you make your own phase be sure to still call the hooks</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            runHook preBuild</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            npm ci</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            npm run build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            runHook postBuild</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">          &#x27;&#x27;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          installPhase</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &#x27;&#x27;</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            runHook preInstall</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            cp -r node_modules $out/node_modules</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            cp package.json $out/package.json</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            cp -r dist $out/dist</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            runHook postInstall</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">          &#x27;&#x27;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">      in</span><span style="color:#d73a49;--shiki-dark:#F97583"> with</span><span style="color:#e36209;--shiki-dark:#FFAB70"> pkgs</span><span style="color:#24292e;--shiki-dark:#E1E4E8">; {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        defaultPackage</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> appBuild</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        devShell</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> mkShell</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> { </span><span style="color:#6f42c1;--shiki-dark:#B392F0">buildInputs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> [ </span><span style="color:#e36209;--shiki-dark:#FFAB70">nodejs</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> ]; };</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">      });</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre></div><p>I tried <code>nix build</code> but I got this error</p><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span>error: builder for &#x27;/nix/store/7lis43p7zj10y2cf6inzicjdgzc3b5qs-example-ts-node.drv&#x27; failed with exit code 1;</span></span>
<span class="line"><span>       last 10 log lines:</span></span>
<span class="line"><span>       &gt; no configure script, doing nothing</span></span>
<span class="line"><span>       &gt; building</span></span>
<span class="line"><span>       &gt; npm ERR! code EAI_AGAINler: sill audit bulk request {[0m</span></span>
<span class="line"><span>       &gt; npm ERR! syscall getaddrinfo</span></span>
<span class="line"><span>       &gt; npm ERR! errno EAI_AGAIN</span></span>
<span class="line"><span>       &gt; npm ERR! request to https://registry.npmjs.org/yallist/-/yallist-4.0.0.tgz failed, reason: getaddrinfo EAI_AGAIN registry.npmjs.org</span></span>
<span class="line"><span>       &gt;</span></span>
<span class="line"><span>       &gt; npm ERR! Log files were not written due to an error writing to the directory: /homeless-shelter/.npm/_logs</span></span>
<span class="line"><span>       &gt; npm ERR! You can rerun the command with `--loglevel=verbose` to see the logs in your terminal</span></span>
<span class="line"><span>       &gt;</span></span>
<span class="line"><span>       For full logs, run &#x27;nix log /nix/store/7lis43p7zj10y2cf6inzicjdgzc3b5qs-example-ts-node.drv&#x27;.</span></span>
<span class="line"><span></span></span></code></pre></div><p>The error <code>getaddrinfo EAI_AGAIN registry.npmjs.org</code> is a failure to connect to the NPM registry to install the dependencies. What I failed to realize is that the nix sandbox would block outside requests in the builder since they are not fully reproducible. You can disable the nix sandbox, but that would be gross. So time to try one of these builders.</p><h3 id="node2nix"><a href="#node2nix" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>node2nix</h3><p>Of all the builders I&#x27;ve seen so far <a target="_blank" rel="noopener noreferrer" href="https://github.com/svanderburg/node2nix">node2nix</a> seemed like the most mature. It&#x27;s used in the <a target="_blank" rel="noopener noreferrer" href="https://github.com/NixOS/nixpkgs/tree/master/pkgs/development/node-packages">official nixpkgs repo</a>. At a high level <code>node2nix</code> will parse your <code>package.json</code> or <code>package-lock.json</code> and do code-gen to give you nix files that use <a target="_blank" rel="noopener noreferrer" href="https://ryantm.github.io/nixpkgs/builders/fetchers/">fetchers</a> to download all <code>node_modules</code> and build your node app.</p><p>You can install <code>node2nix</code> from <code>nixpkgs</code> as <code>pkgs.node2nix</code>. To run it I have this script</p><div class="remark-code-title">runNode2Nix.sh</div><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">#!/usr/bin/env bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D"># You need to re-run this file anytime your package/package-lock.json changes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">node2nix</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> -16</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> --development</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> \</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79B8FF">    --input</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> package.json</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> \</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79B8FF">    --lock</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> package-lock.json</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> \</span></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">    # Put all generated code in the `./nix` directory</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    --node-env</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> ./nix/node-env.nix</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> \</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79B8FF">    --composition</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> ./nix/default.nix</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> \</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79B8FF">    --output</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> ./nix/node-package.nix</span></span>
<span class="line"></span></code></pre></div><p>While node2nix does have helpers in <code>node-env.nix</code> to build a node package, those only really run <code>npm install</code>, to call our <code>npm run build</code> step. Thankfully as described <a target="_blank" rel="noopener noreferrer" href="https://github.com/svanderburg/node2nix#using-the-nodejs-environment-in-other-nix-derivations">here</a> <code>node2nix</code> exposes an output of just the <code>node_modules</code> of the dependencies, allowing us to make our own derivation.</p><div class="remark-code-title">flake.nix</div><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  description</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;Sample Nix ts-node build&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  inputs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    nixpkgs</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">url</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;github:nixos/nixpkgs/nixos-unstable&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    flake-utils</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">url</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;github:numtide/flake-utils&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    gitignore</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">      url</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;github:hercules-ci/gitignore.nix&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">      inputs</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">nixpkgs</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">follows</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;nixpkgs&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    };</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  outputs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> { self</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> nixpkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> flake-utils</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> gitignore</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#d73a49;--shiki-dark:#F97583"> ... </span><span style="color:#24292e;--shiki-dark:#E1E4E8">}:</span></span>
<span class="line"><span style="color:#e36209;--shiki-dark:#FFAB70">    flake-utils</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">lib</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">eachDefaultSystem</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> (system:</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">      let</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        pkgs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> import</span><span style="color:#e36209;--shiki-dark:#FFAB70"> nixpkgs</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> { </span><span style="color:#d73a49;--shiki-dark:#F97583">inherit</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> system</span><span style="color:#24292e;--shiki-dark:#E1E4E8">; };</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        nodejs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> pkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">nodejs-16_x</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        node2nixOutput</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> import</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> ./nix</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> { </span><span style="color:#d73a49;--shiki-dark:#F97583">inherit</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> pkgs</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> nodejs</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> system</span><span style="color:#24292e;--shiki-dark:#E1E4E8">; };</span></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">        # NOTE: may want to try https://github.com/svanderburg/node2nix/issues/301 to limit rebuilds</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        nodeDeps</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> node2nixOutput</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">nodeDependencies</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        app</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> pkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">stdenv</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">mkDerivation</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          name</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;example-ts-node&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          version</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;0.1.0&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          src</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> gitignore</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">lib</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">gitignoreSource</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> ./.</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          buildInputs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> [ </span><span style="color:#e36209;--shiki-dark:#FFAB70">nodejs</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> ];</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          buildPhase</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &#x27;&#x27;</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            runHook preBuild</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            # symlink the generated node deps to the current directory for building</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            ln -sf </span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">${</span><span style="color:#005cc5;--shiki-dark:#79B8FF;font-style:italic;--shiki-dark-font-style:italic">nodeDeps</span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">}</span><span style="color:#032f62;--shiki-dark:#9ECBFF">/lib/node_modules ./node_modules</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            export PATH=&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">${</span><span style="color:#005cc5;--shiki-dark:#79B8FF;font-style:italic;--shiki-dark-font-style:italic">nodeDeps</span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">}</span><span style="color:#032f62;--shiki-dark:#9ECBFF">/bin:$PATH&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            npm run build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            runHook postBuild</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">          &#x27;&#x27;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          installPhase</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &#x27;&#x27;</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            runHook preInstall</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            # Note: you need some sort of `mkdir` on $out for any of the following commands to work</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            mkdir -p $out/bin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            # copy only whats needed for running the built app</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            cp package.json $out/package.json</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            cp -r dist $out/dist</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            ln -sf </span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">${</span><span style="color:#005cc5;--shiki-dark:#79B8FF;font-style:italic;--shiki-dark-font-style:italic">nodeDeps</span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">}</span><span style="color:#032f62;--shiki-dark:#9ECBFF">/lib/node_modules $out/node_modules</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            # copy entry point, in this case our index.ts has the node shebang</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            # nix will patch the shebang to be the node version specified in buildInputs</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            # you could also copy in a script that is basically `npm run start`</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            cp dist/index.js $out/bin/example-ts-nix</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            chmod a+x $out/bin/example-ts-nix</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">            runHook postInstall</span></span>
<span class="line"><span style="color:#032f62;--shiki-dark:#9ECBFF">          &#x27;&#x27;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">      in</span><span style="color:#d73a49;--shiki-dark:#F97583"> with</span><span style="color:#e36209;--shiki-dark:#FFAB70"> pkgs</span><span style="color:#24292e;--shiki-dark:#E1E4E8">; {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        defaultPackage</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> app</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        devShell</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> mkShell</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> { </span><span style="color:#6f42c1;--shiki-dark:#B392F0">buildInputs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> [ </span><span style="color:#e36209;--shiki-dark:#FFAB70">nodejs</span><span style="color:#e36209;--shiki-dark:#FFAB70"> node2nix</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> ]; };</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">      });</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>After running <code>nix build</code>, the output will be symlinked to <code>./result</code> in my case it looks like</p><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">$</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> exa</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> --tree</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> --level</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> 3</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> ./result/</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">./result</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0"></span><span style="color:#032f62;--shiki-dark:#9ECBFF"> bin</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0"></span><span style="color:#032f62;--shiki-dark:#9ECBFF">  </span><span style="color:#032f62;--shiki-dark:#9ECBFF"> example-ts-nix</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0"></span><span style="color:#032f62;--shiki-dark:#9ECBFF"> dist</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0"></span><span style="color:#032f62;--shiki-dark:#9ECBFF">  </span><span style="color:#032f62;--shiki-dark:#9ECBFF"> index.js</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0"></span><span style="color:#032f62;--shiki-dark:#9ECBFF"> node_modules</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> -</span><span style="color:#d73a49;--shiki-dark:#F97583">&gt;</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> /nix/store/fdzk00z6bmw50mfqv124lgn9fzjhd7yw-node-dependencies-example-node-nix-1.0.0/lib/node_modules</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0"></span><span style="color:#032f62;--shiki-dark:#9ECBFF"> package.json</span></span>
<span class="line"></span></code></pre></div><p>To verify the app worked you can run <code>./result/bin/example-ts-nix</code>.</p><p>While at first this looks like a lot It&#x27;s pretty straightforward. <code>node2nixOutput = import ./nix { inherit pkgs nodejs system; };</code> calls the generated <code>default.nix</code> which exposes many outputs for building. In our case we only use <code>nodeDeps = node2nixOutput.nodeDependencies;</code>.</p><p>The <code>buildPhase</code> just symlinks the generated <code>nodeDependencies</code> and builds the app. The <code>installPhase</code> copies the built output into the final derivation. If you are familiar with docker files this is sorta like having a build layer than a final layer to copy the outputs to. One thing nix does for you is patch shebangs to reference the <code>buildInputs</code> of the derivation, in this case, if you run</p><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">$</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> cat</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> ./result/bin/example-ts-nix</span></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">#!/nix/store/6cdccplrjwga5rd3b2s7xb8zd25hnsix-nodejs-16.17.0/bin/node</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">&quot;use strict&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005cc5;--shiki-dark:#79B8FF">...</span></span>
<span class="line"></span></code></pre></div><p>It changed <code>#!/usr/bin/env node</code> to <code>#!/nix/store/6cdccplrjwga5rd3b2s7xb8zd25hnsix-nodejs-16.17.0/bin/node</code> for us automatically.</p><p><strong>node2nix Pros</strong></p><ul><li>Simple to follow the build process</li><li>Somewhat easy to customize</li><li>Has support for custom registries/private git repos</li></ul><p><strong>node2nix Cons</strong></p><ul><li>Having to re-run <code>node2nix</code> on package.json changes is annoying</li><li>The generated outputs seem to re-build too often, see <a target="_blank" rel="noopener noreferrer" href="https://github.com/svanderburg/node2nix/issues/301">here</a></li><li>With the current setup, the final build is still using the development <code>node_modules</code> which is wasteful</li></ul><p>Overall I think <code>node2nix</code> is a good start for most node apps. Since it&#x27;s all mostly code-gen It&#x27;s easy to follow what&#x27;s going on. I&#x27;ve come across <a target="_blank" rel="noopener noreferrer" href="https://github.com/MatrixAI/TypeScript-Demo-Lib-Native">this template</a> which seems to have figured out to work around some cons listed, but I have not tried it yet so your mileage may vary.</p><h3 id="dream2nix"><a href="#dream2nix" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>dream2nix</h3><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/nix-community/dream2nix">dream2nix</a> says it&#x27;s &quot;A framework for automated nix packaging&quot; by mostly standardizing the many &quot;2nix&quot; tools. The <a target="_blank" rel="noopener noreferrer" href="https://nix-community.github.io/dream2nix/">docs</a> list Rust, Haskell, Python, and Node builders. For whatever reason I have been skeptical of dream2nix. It looked &quot;too good to be true&quot; so I never really gave it a fair shake. Better late than never, let&#x27;s try it</p><div class="remark-code-title">flake.nix</div><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  description</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;Sample Nix ts-node build&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  inputs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    nixpkgs</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">url</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;github:nixos/nixpkgs/nixos-unstable&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    flake-utils</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">url</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;github:numtide/flake-utils&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    gitignore</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">      url</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;github:hercules-ci/gitignore.nix&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">      inputs</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">nixpkgs</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">follows</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;nixpkgs&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    };</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    dream2nix</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">url</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;github:nix-community/dream2nix&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  outputs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> { self</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> nixpkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> flake-utils</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> gitignore</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> dream2nix</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#d73a49;--shiki-dark:#F97583"> ... </span><span style="color:#24292e;--shiki-dark:#E1E4E8">}:</span></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">    # Note: no need for flake-utils.lib.eachDefaultSystem, dream2nix does it for us</span></span>
<span class="line"><span style="color:#e36209;--shiki-dark:#FFAB70">    dream2nix</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">lib</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">makeFlakeOutputs</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">      systems</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> flake-utils</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">lib</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">defaultSystems</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">      config</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">projectRoot</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> ./.</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">      source</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> gitignore</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">lib</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">gitignoreSource</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> ./.</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    };</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre></div><p>The core idea of dream2nix is that it will find you package.json/package-lock.json to figure out what node deps you need and how to build <code>npm run build</code> or w/e else. You can customize it but for most apps, this should &quot;just work&quot;.</p><p>Running <code>nix flake show</code> returns</p><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span>git+file:///home/jr/code/node/example-node-nix</span></span>
<span class="line"><span>devShell</span></span>
<span class="line"><span>   aarch64-darwin: development environment &#x27;nix-shell&#x27;</span></span>
<span class="line"><span>   aarch64-linux: development environment &#x27;nix-shell&#x27;</span></span>
<span class="line"><span>   i686-linux: development environment &#x27;nix-shell&#x27;</span></span>
<span class="line"><span>   x86_64-darwin: development environment &#x27;nix-shell&#x27;</span></span>
<span class="line"><span>   x86_64-linux: development environment &#x27;nix-shell&#x27;</span></span>
<span class="line"><span>devShells</span></span>
<span class="line"><span>   aarch64-darwin</span></span>
<span class="line"><span>      default: development environment &#x27;nix-shell&#x27;</span></span>
<span class="line"><span>      example-node-nix: development environment &#x27;nix-shell&#x27;</span></span>
<span class="line"><span>   aarch64-linux</span></span>
<span class="line"><span>      default: development environment &#x27;nix-shell&#x27;</span></span>
<span class="line"><span>      example-node-nix: development environment &#x27;nix-shell&#x27;</span></span>
<span class="line"><span>   i686-linux</span></span>
<span class="line"><span>      default: development environment &#x27;nix-shell&#x27;</span></span>
<span class="line"><span>      example-node-nix: development environment &#x27;nix-shell&#x27;</span></span>
<span class="line"><span>   x86_64-darwin</span></span>
<span class="line"><span>      default: development environment &#x27;nix-shell&#x27;</span></span>
<span class="line"><span>      example-node-nix: development environment &#x27;nix-shell&#x27;</span></span>
<span class="line"><span>   x86_64-linux</span></span>
<span class="line"><span>       default: development environment &#x27;nix-shell&#x27;</span></span>
<span class="line"><span>       example-node-nix: development environment &#x27;nix-shell&#x27;</span></span>
<span class="line"><span>packages</span></span>
<span class="line"><span>   aarch64-darwin</span></span>
<span class="line"><span>      default: package &#x27;example-node-nix-1.0.0&#x27;</span></span>
<span class="line"><span>      example-node-nix: package &#x27;example-node-nix-1.0.0&#x27;</span></span>
<span class="line"><span>      resolveImpure: package &#x27;resolve&#x27;</span></span>
<span class="line"><span>   aarch64-linux</span></span>
<span class="line"><span>      default: package &#x27;example-node-nix-1.0.0&#x27;</span></span>
<span class="line"><span>      example-node-nix: package &#x27;example-node-nix-1.0.0&#x27;</span></span>
<span class="line"><span>      resolveImpure: package &#x27;resolve&#x27;</span></span>
<span class="line"><span>   i686-linux</span></span>
<span class="line"><span>      default: package &#x27;example-node-nix-1.0.0&#x27;</span></span>
<span class="line"><span>      example-node-nix: package &#x27;example-node-nix-1.0.0&#x27;</span></span>
<span class="line"><span>      resolveImpure: package &#x27;resolve&#x27;</span></span>
<span class="line"><span>   x86_64-darwin</span></span>
<span class="line"><span>      default: package &#x27;example-node-nix-1.0.0&#x27;</span></span>
<span class="line"><span>      example-node-nix: package &#x27;example-node-nix-1.0.0&#x27;</span></span>
<span class="line"><span>      resolveImpure: package &#x27;resolve&#x27;</span></span>
<span class="line"><span>   x86_64-linux</span></span>
<span class="line"><span>       default: package &#x27;example-node-nix-1.0.0&#x27;</span></span>
<span class="line"><span>       example-node-nix: package &#x27;example-node-nix-1.0.0&#x27;</span></span>
<span class="line"><span>       resolveImpure: package &#x27;resolve&#x27;</span></span>
<span class="line"><span>projectsJson: unknown</span></span>
<span class="line"><span></span></span></code></pre></div><p>dream2nix gave us a dev shell and package build for us, neat. Expecting something to break I ran <code>nix build</code> to build the app and got no errors. Looking at <code>./result</code> gives</p><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">$</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> exa</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> --tree</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> --level</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> 3</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> ./result/</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">./result</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0"></span><span style="color:#032f62;--shiki-dark:#9ECBFF"> bin</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0"></span><span style="color:#032f62;--shiki-dark:#9ECBFF">  </span><span style="color:#032f62;--shiki-dark:#9ECBFF"> ts-node-nix</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> -</span><span style="color:#d73a49;--shiki-dark:#F97583">&gt;</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> ../lib/node_modules/example-node-nix/dist/index.js</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0"></span><span style="color:#032f62;--shiki-dark:#9ECBFF"> lib</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">   </span><span style="color:#032f62;--shiki-dark:#9ECBFF"> node_modules</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">      </span><span style="color:#032f62;--shiki-dark:#9ECBFF"> example-node-nix</span></span>
<span class="line"></span></code></pre></div><p><code>ts-node-nix</code> is a compiled javascript file with the right shebang. Still somewhat shocked running <code>./result/bin/ts-node-nix</code> ran the server, and it worked!</p><p>This is simply wild, I really expected something to break here and require a manual build step of some kind. One nice thing to note is the <a target="_blank" rel="noopener noreferrer" href="https://nix-community.github.io/dream2nix/guides/getting-started-nodejs.html#development-shell">node dev shell</a> it gives will copy over the <code>node_modules</code> folder for you so you don&#x27;t need to manually run <code>npm install</code>.</p><p>To limit my excitement a bit this is a simple build. I need to investigate how well it works with more complicated builds with native node add-ons, mono repo tools like NX, etc. Though the examples in the <a target="_blank" rel="noopener noreferrer" href="https://github.com/nix-community/dream2nix#test-the-experimental-version-of-dream2nix">README</a> seem promising to allow for easily overriding the builds.</p><p><strong>dream2nix Pros</strong></p><ul><li>very little code to set up</li><li>generated dev shell is really nice</li></ul><p><strong>dream2nix Cons</strong></p><ul><li>A bit of a &quot;black box&quot; which could make debugging harder</li><li>It seems to include the full development dependencies in the output</li></ul><h2 id="conclusion"><a href="#conclusion" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Conclusion</h2><p>I came into this thinking building ts node apps with nix would be a pain, and I&#x27;m happily surprised it is not. While <code>node2nix</code> may be good for highly customizable builds, <code>dream2nix</code> is just a delight. I haven&#x27;t come across a nix utility that just worked like that with minimal messing around.</p><p>I&#x27;ve been meaning to give <a target="_blank" rel="noopener noreferrer" href="https://napi.rs/">napi-rs</a> a shot, so maybe that will be a good test case to see how well <code>dream2nix</code> builds rust projects and native node add-ons all in one.</p><p>Since you made it to the end here&#x27;s a <code>dream2nix</code> example with a docker build</p><div class="remark-code-title">flake.nix</div><div class="relative"><pre class="rounded-lg border shiki shiki-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8"><code><span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  description</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;Sample Nix ts-node build&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  inputs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    nixpkgs</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">url</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;github:nixos/nixpkgs/nixos-unstable&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    flake-utils</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">url</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;github:numtide/flake-utils&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    gitignore</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">      url</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;github:hercules-ci/gitignore.nix&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">      inputs</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">nixpkgs</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">follows</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;nixpkgs&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">    };</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">    dream2nix</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">url</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;github:nix-community/dream2nix&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">  outputs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> { self</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> nixpkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> flake-utils</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> gitignore</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> dream2nix</span><span style="color:#d73a49;--shiki-dark:#F97583">,</span><span style="color:#d73a49;--shiki-dark:#F97583"> ... </span><span style="color:#24292e;--shiki-dark:#E1E4E8">}:</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">    let</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">      dream2nixOutputs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> dream2nix</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">lib</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">makeFlakeOutputs</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        systems</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> flake-utils</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">lib</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">defaultSystems</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        config</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">projectRoot</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> ./.</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">        source</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> gitignore</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">lib</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">gitignoreSource</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> ./.</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">      };</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">      customOutput</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> flake-utils</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">lib</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">eachDefaultSystem</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> (system:</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">        let</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          pkgs</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> import</span><span style="color:#e36209;--shiki-dark:#FFAB70"> nixpkgs</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> { </span><span style="color:#d73a49;--shiki-dark:#F97583">inherit</span><span style="color:#6f42c1;--shiki-dark:#B392F0"> system</span><span style="color:#24292e;--shiki-dark:#E1E4E8">; };</span></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">          # the dream2nix output for this system</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          app</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> dream2nixOutputs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">packages</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">${</span><span style="color:#005cc5;--shiki-dark:#79B8FF;font-style:italic;--shiki-dark-font-style:italic">system</span><span style="color:#24292e;--shiki-dark:#E1E4E8;font-style:italic;--shiki-dark-font-style:italic">}</span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">example-node-nix</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">        in</span><span style="color:#d73a49;--shiki-dark:#F97583"> with</span><span style="color:#e36209;--shiki-dark:#FFAB70"> pkgs</span><span style="color:#24292e;--shiki-dark:#E1E4E8">; {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">          packages</span><span style="color:#24292e;--shiki-dark:#E1E4E8">.</span><span style="color:#6f42c1;--shiki-dark:#B392F0">docker</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> dockerTools</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">buildImage</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">            name</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> app</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">packageName</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">            copyToRoot</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> pkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">buildEnv</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">              name</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#e36209;--shiki-dark:#FFAB70"> app</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">packageName</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">              paths</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> [ </span><span style="color:#e36209;--shiki-dark:#FFAB70">app</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> ];</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">              pathsToLink</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> [ </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;/bin&quot;</span><span style="color:#032f62;--shiki-dark:#9ECBFF"> &quot;/lib&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> ];</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">            # This ensures symlinks to directories are preserved in the image</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">            keepContentsDirlinks</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#005cc5;--shiki-dark:#79B8FF"> true</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6f42c1;--shiki-dark:#B392F0">            config</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> { </span><span style="color:#6f42c1;--shiki-dark:#B392F0">Cmd</span><span style="color:#d73a49;--shiki-dark:#F97583"> =</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> [ </span><span style="color:#032f62;--shiki-dark:#9ECBFF">&quot;/bin/ts-node-nix&quot;</span><span style="color:#24292e;--shiki-dark:#E1E4E8"> ]; };</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">          };</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">        });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a737d;--shiki-dark:#6A737D">      # deep merge outputs together</span></span>
<span class="line"><span style="color:#d73a49;--shiki-dark:#F97583">    in</span><span style="color:#e36209;--shiki-dark:#FFAB70"> nixpkgs</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">lib</span><span style="color:#d73a49;--shiki-dark:#F97583">.</span><span style="color:#e36209;--shiki-dark:#FFAB70">recursiveUpdate</span><span style="color:#e36209;--shiki-dark:#FFAB70"> dream2nixOutputs</span><span style="color:#e36209;--shiki-dark:#FFAB70"> customOutput</span><span style="color:#24292e;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292e;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre></div><p>You can then run <code>nix build .#docker</code> and then run <code>docker load &lt; result</code> to load the image into docker. See <a href="/blog/rust-enviorment-and-docker-build-with-nix-flakes">here</a> for some more info on nix docker builds.</p></div><div><div class="pb-6 pt-6 text-sm text-gray-700 dark:text-gray-300"><a target="_blank" rel="nofollow" href="https://mobile.twitter.com/search?q=https%3A%2F%2Fjohns.codes%2Fblog%2Fbuilding-typescript-node-apps-with-nix">Discuss on Twitter</a>  <a target="_blank" rel="noopener noreferrer" href="https://github.com/JRMurr/JRMurr.github.io/blob/main/content/blog/building-typescript-node-apps-with-nix.md">View on GitHub</a></div><div class="pb-6 pt-6 text-center text-gray-700 dark:text-gray-300" id="comment"><button>Load Comments</button></div></div></div><footer><div class="flex flex-col text-sm font-medium sm:flex-row sm:justify-between sm:text-base"><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" aria-label="Previous post: Making a PR to Nixpkgs" href="/blog/updating-a-package-in-nixpkgs"> <!-- -->Making a PR to Nixpkgs</a></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" aria-label="Next post: Building a Simple DB in Rust - Part 1 - Parsing" href="/blog/build-a-db/part01">Building a Simple DB in Rust - Part 1 - Parsing<!-- --> </a></div></div></footer></div></div></article></section></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/JRMurr"><span class="sr-only">github</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://twitter.com/JRMurrCodes"><span class="sr-only">twitter</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://hachyderm.io/@jrmurr"><span class="sr-only">mastodon</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6"><path d="M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="/feed.xml"><span class="sr-only">rss</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6"><path d="M3.692 17.517A3.696 3.696 0 0 0 0 21.211C0 23.244 1.656 24.9 3.692 24.9s3.694-1.657 3.694-3.689a3.697 3.697 0 0 0-3.694-3.694z"></path><path d="M.384 8.142A.386.386 0 0 0 0 8.527v4.688c0 .211.173.383.384.383 6.02 0 10.919 4.898 10.919 10.92 0 .209.171.383.384.383h4.705a.385.385 0 0 0 .387-.383l-.018-.121C16.692 15.423 9.37 8.142.384 8.142z"></path><path d="M24.89 24.397C24.825 10.936 13.854.011.384.011A.385.385 0 0 0 0 .397v4.824c0 .212.173.383.384.383 10.429 0 18.913 8.486 18.913 18.914 0 .209.172.383.382.383h4.845a.39.39 0 0 0 .388-.383l-.022-.121z"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>John Murray</div><div>  </div><div> 2024</div><div>  </div><a href="/">John&#x27;s Codes</a></div></div></footer></div></section><script src="/_next/static/chunks/webpack-278bcb5a0daf8917.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/2d141e1a38819612-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/css/895662d5d095c22a.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L3\"\n"])</script><script>self.__next_f.push([1,"4:HL[\"/_next/static/css/14fb540b7a3ad639.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"5:I[7690,[],\"\"]\n8:I[5613,[],\"\"]\na:I[1778,[],\"\"]\nb:I[8029,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"781\",\"static/chunks/781-9238b26c3a132736.js\",\"185\",\"static/chunks/app/layout-9608048ecb38eb6e.js\"],\"ThemeProviders\"]\nc:I[5935,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"781\",\"static/chunks/781-9238b26c3a132736.js\",\"185\",\"static/chunks/app/layout-9608048ecb38eb6e.js\"],\"\"]\nd:I[9266,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"781\",\"static/chunks/781-9238b26c3a132736.js\",\"185\",\"static/chunks/app/lay"])</script><script>self.__next_f.push([1,"out-9608048ecb38eb6e.js\"],\"KBarSearchProvider\"]\ne:I[5250,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"749\",\"static/chunks/749-ed776d54eb5c7205.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-fd9b73ee915812e8.js\"],\"\"]\nf:I[2146,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"781\",\"static/chunks/781-9238b26c3a132736.js\",\"185\",\"static/chunks/app/layout-9608048ecb38eb6e.js\"],\"KBarButton\"]\n10:I[5021,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"781\",\"static/chunks/781-9238b26c3a132736.js\",\"185\",\"static/"])</script><script>self.__next_f.push([1,"chunks/app/layout-9608048ecb38eb6e.js\"],\"\"]\n11:I[123,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"781\",\"static/chunks/781-9238b26c3a132736.js\",\"185\",\"static/chunks/app/layout-9608048ecb38eb6e.js\"],\"\"]\n14:I[8955,[],\"\"]\n9:[\"slug\",\"building-typescript-node-apps-with-nix\",\"c\"]\n12:T44f,"])</script><script>self.__next_f.push([1,"M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"])</script><script>self.__next_f.push([1,"15:[]\n"])</script><script>self.__next_f.push([1,"3:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/895662d5d095c22a.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L5\",null,{\"buildId\":\"KJjil5QzPbaOHvzNe1zNm\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/blog/building-typescript-node-apps-with-nix\",\"initialTree\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"building-typescript-node-apps-with-nix\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"building-typescript-node-apps-with-nix\\\"]}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"building-typescript-node-apps-with-nix\",\"c\"],{\"children\":[\"__PAGE__\",{},[\"$L6\",\"$L7\",null]]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"$9\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/14fb540b7a3ad639.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}]]},[null,[\"$\",\"html\",null,{\"lang\":\"en-us\",\"className\":\"__variable_587f35 scroll-smooth\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"sizes\":\"76x76\",\"href\":\"/static/favicons/apple-touch-icon.png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"32x32\",\"href\":\"/static/favicons/favicon-32x32.png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"16x16\",\"href\":\"/static/favicons/favicon-16x16.png\"}],[\"$\",\"link\",null,{\"rel\":\"manifest\",\"href\":\"/static/favicons/site.webmanifest\"}],[\"$\",\"link\",null,{\"rel\":\"mask-icon\",\"href\":\"/static/favicons/safari-pinned-tab.svg\",\"color\":\"#5bbad5\"}],[\"$\",\"meta\",null,{\"name\":\"msapplication-TileColor\",\"content\":\"#000000\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: light)\",\"content\":\"#fff\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: dark)\",\"content\":\"#000\"}],[\"$\",\"link\",null,{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"/feed.xml\"}],[\"$\",\"body\",null,{\"className\":\"bg-white text-black antialiased dark:bg-gray-950 dark:text-white\",\"children\":[\"$\",\"$Lb\",null,{\"children\":[[[\"$\",\"$Lc\",null,{\"strategy\":\"lazyOnload\",\"data-domain\":\"johns.codes\",\"data-api\":\"$undefined\",\"src\":\"https://plausible.io/js/plausible.js\"}],[\"$\",\"$Lc\",null,{\"strategy\":\"lazyOnload\",\"id\":\"plausible-script\",\"children\":\"\\n            window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }\\n        \"}]],[\"$\",\"section\",null,{\"className\":\"mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex h-screen flex-col justify-between font-sans\",\"children\":[[\"$\",\"$Ld\",null,{\"kbarConfig\":{\"searchDocumentsPath\":\"search.json\"},\"children\":[[\"$\",\"header\",null,{\"className\":\"flex items-center justify-between py-10\",\"children\":[[\"$\",\"div\",null,{\"children\":[\"$\",\"$Le\",null,{\"href\":\"/\",\"aria-label\":\"John's Codes\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between\",\"children\":[\"$\",\"div\",null,{\"className\":\"hidden h-6 text-2xl font-semibold sm:block\",\"children\":\"John's Codes\"}]}]}]}],[\"$\",\"div\",null,{\"className\":\"flex items-center space-x-4 leading-5 sm:space-x-6\",\"children\":[[[\"$\",\"$Le\",null,{\"href\":\"/blog\",\"className\":\"hidden font-medium text-gray-900 dark:text-gray-100 sm:block\",\"children\":\"Blog\"}],[\"$\",\"$Le\",null,{\"href\":\"/tags\",\"className\":\"hidden font-medium text-gray-900 dark:text-gray-100 sm:block\",\"children\":\"Tags\"}],[\"$\",\"$Le\",null,{\"href\":\"/projects\",\"className\":\"hidden font-medium text-gray-900 dark:text-gray-100 sm:block\",\"children\":\"Projects\"}],[\"$\",\"$Le\",null,{\"href\":\"/about\",\"className\":\"hidden font-medium text-gray-900 dark:text-gray-100 sm:block\",\"children\":\"About\"}]],[\"$\",\"$Lf\",null,{\"aria-label\":\"Search\",\"children\":[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"fill\":\"none\",\"viewBox\":\"0 0 24 24\",\"strokeWidth\":1.5,\"stroke\":\"currentColor\",\"className\":\"h-6 w-6 text-gray-900 dark:text-gray-100\",\"children\":[\"$\",\"path\",null,{\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"d\":\"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z\"}]}]}],[\"$\",\"$L10\",null,{}],[\"$\",\"$L11\",null,{}]]}]]}],[\"$\",\"main\",null,{\"className\":\"mb-auto\",\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"className\":\"flex flex-col items-start justify-start md:mt-24 md:flex-row md:items-center md:justify-center md:space-x-6\",\"children\":[[\"$\",\"div\",null,{\"className\":\"space-x-2 pb-8 pt-6 md:space-y-5\",\"children\":[\"$\",\"h1\",null,{\"className\":\"text-6xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 md:border-r-2 md:px-6 md:text-8xl md:leading-14\",\"children\":\"404\"}]}],[\"$\",\"div\",null,{\"className\":\"max-w-md\",\"children\":[[\"$\",\"p\",null,{\"className\":\"mb-4 text-xl font-bold leading-normal md:text-2xl\",\"children\":\"Sorry we couldn't find this page.\"}],[\"$\",\"p\",null,{\"className\":\"mb-8\",\"children\":\"But dont worry, you can find plenty of other things on our homepage.\"}],[\"$\",\"$Le\",null,{\"href\":\"/\",\"className\":\"focus:shadow-outline-blue inline rounded-lg border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium leading-5 text-white shadow transition-colors duration-150 hover:bg-blue-700 focus:outline-none dark:hover:bg-blue-500\",\"children\":\"Back to homepage\"}]]}]]}],\"notFoundStyles\":[],\"styles\":null}]}]]}],[\"$\",\"footer\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"mt-16 flex flex-col items-center\",\"children\":[[\"$\",\"div\",null,{\"className\":\"mb-3 flex space-x-4\",\"children\":[null,[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/JRMurr\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"github\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6\",\"children\":[\"$\",\"path\",null,{\"d\":\"M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12\"}]}]]}],[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://twitter.com/JRMurrCodes\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"twitter\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6\",\"children\":[\"$\",\"path\",null,{\"d\":\"M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z\"}]}]]}],[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://hachyderm.io/@jrmurr\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"mastodon\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6\",\"children\":[\"$\",\"path\",null,{\"d\":\"$12\"}]}]]}],[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"/feed.xml\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"rss\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M3.692 17.517A3.696 3.696 0 0 0 0 21.211C0 23.244 1.656 24.9 3.692 24.9s3.694-1.657 3.694-3.689a3.697 3.697 0 0 0-3.694-3.694z\"}],[\"$\",\"path\",null,{\"d\":\"M.384 8.142A.386.386 0 0 0 0 8.527v4.688c0 .211.173.383.384.383 6.02 0 10.919 4.898 10.919 10.92 0 .209.171.383.384.383h4.705a.385.385 0 0 0 .387-.383l-.018-.121C16.692 15.423 9.37 8.142.384 8.142z\"}],[\"$\",\"path\",null,{\"d\":\"M24.89 24.397C24.825 10.936 13.854.011.384.011A.385.385 0 0 0 0 .397v4.824c0 .212.173.383.384.383 10.429 0 18.913 8.486 18.913 18.914 0 .209.172.383.382.383h4.845a.39.39 0 0 0 .388-.383l-.022-.121z\"}]]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400\",\"children\":[[\"$\",\"div\",null,{\"children\":\"John Murray\"}],[\"$\",\"div\",null,{\"children\":\"  \"}],[\"$\",\"div\",null,{\"children\":\" 2024\"}],[\"$\",\"div\",null,{\"children\":\"  \"}],[\"$\",\"$Le\",null,{\"href\":\"/\",\"children\":\"John's Codes\"}]]}]]}]}]]}]}]]}]}]]}],null]],\"initialHead\":[false,\"$L13\"],\"globalErrorComponent\":\"$14\",\"missingSlots\":\"$W15\"}]]\n"])</script><script>self.__next_f.push([1,"16:I[144,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"749\",\"static/chunks/749-ed776d54eb5c7205.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-fd9b73ee915812e8.js\"],\"\"]\n17:I[2502,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"749\",\"static/chunks/749-ed776d54eb5c7205.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-fd9b73ee915812e8.js\"],\"\"]\n18:I[4282,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"749\",\"static/chunks/749-ed776d54eb5c7205.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-fd9b7"])</script><script>self.__next_f.push([1,"3ee915812e8.js\"],\"\"]\n19:I[4970,[\"250\",\"static/chunks/250-a30085ccab20449f.js\",\"749\",\"static/chunks/749-ed776d54eb5c7205.js\",\"797\",\"static/chunks/app/blog/%5B...slug%5D/page-fd9b73ee915812e8.js\"],\"\"]\n"])</script><script>self.__next_f.push([1,"7:[[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"BlogPosting\\\",\\\"headline\\\":\\\"Building Typescript Node Apps With Nix\\\",\\\"datePublished\\\":\\\"2022-09-06T23:57:55.477Z\\\",\\\"dateModified\\\":\\\"2022-09-06T23:57:55.477Z\\\",\\\"description\\\":\\\"Trying some different nix builders for typescript node apps\\\",\\\"author\\\":[{\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"John Murray\\\"}]}\"}}],[\"$\",\"section\",null,{\"className\":\"mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0\",\"children\":[[\"$\",\"$L16\",null,{}],[\"$\",\"article\",null,{\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"header\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"space-y-1 border-b border-gray-200 pb-10 text-center dark:border-gray-700\",\"children\":[[\"$\",\"dl\",null,{\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"dt\",null,{\"className\":\"sr-only\",\"children\":\"Published on\"}],[\"$\",\"dd\",null,{\"className\":\"text-base font-medium leading-6 text-gray-500 dark:text-gray-400\",\"children\":[[\"$\",\"time\",null,{\"dateTime\":\"2022-09-06T23:57:55.477Z\",\"children\":\"September 6, 2022\"}],[\"$\",\"span\",null,{\"className\":\"mx-2\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"ml-1\",\"children\":[10,\" min read\"]}]]}]]}]}],[\"$\",\"div\",null,{\"children\":[\"$\",\"h1\",null,{\"className\":\"text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14\",\"children\":\"Building Typescript Node Apps With Nix\"}]}]]}]}],[\"$\",\"div\",null,{\"className\":\"grid-rows-[auto_1fr] divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:divide-y-0\",\"children\":[[\"$\",\"div\",null,{\"className\":\"divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0\",\"children\":[[\"$\",\"div\",null,{\"className\":\"prose max-w-none pb-8 pt-10 dark:prose-invert\",\"children\":[[\"$\",\"$L17\",null,{\"series\":null,\"currSlug\":\"building-typescript-node-apps-with-nix\"}],[[\"$\",\"details\",null,{\"open\":true,\"children\":[[\"$\",\"summary\",null,{\"className\":\"ml-6 pb-2 pt-2 text-xl font-bold\",\"children\":\"Table of Contents\"}],[\"$\",\"div\",null,{\"className\":\"ml-6\",\"children\":[\"$\",\"ul\",null,{\"className\":\"\",\"children\":[[\"$\",\"li\",\"0\",{\"children\":[[\"$\",\"a\",null,{\"href\":\"#being-a-nix-stan\",\"children\":\"Being a Nix Stan\"}],null]}],[\"$\",\"li\",\"1\",{\"children\":[[\"$\",\"a\",null,{\"href\":\"#the-app\",\"children\":\"The APP\"}],null]}],[\"$\",\"li\",\"2\",{\"children\":[[\"$\",\"a\",null,{\"href\":\"#nix-builds\",\"children\":\"Nix Builds\"}],[\"$\",\"ul\",null,{\"className\":\"\",\"children\":[[\"$\",\"li\",\"0\",{\"children\":[[\"$\",\"a\",null,{\"href\":\"#the-standard-environment\",\"children\":\"The Standard Environment\"}],null]}],[\"$\",\"li\",\"1\",{\"children\":[[\"$\",\"a\",null,{\"href\":\"#node2nix\",\"children\":\"node2nix\"}],null]}],[\"$\",\"li\",\"2\",{\"children\":[[\"$\",\"a\",null,{\"href\":\"#dream2nix\",\"children\":\"dream2nix\"}],null]}]]}]]}],[\"$\",\"li\",\"3\",{\"children\":[[\"$\",\"a\",null,{\"href\":\"#conclusion\",\"children\":\"Conclusion\"}],null]}]]}]}]]}],[\"$\",\"h2\",null,{\"id\":\"being-a-nix-stan\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#being-a-nix-stan\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Being a Nix Stan\"]}],[\"$\",\"p\",null,{\"children\":\"I recently accepted that I am obsessed with Nix. Ask any remotely technical person with a pulse, and they can probably mention at least 10 times I've told them \\\"But with nix X is way easier/a nonissue\\\" (same with rust, but that's for another day...).\"}],[\"$\",\"p\",null,{\"children\":\"The issue is, that I am a bit of a poser. I've been using Nix on/off for about 2.5 years but only seriously for the last 10ish months. I've mostly just consumed existing NixOS modules, nix packages, setup basic nix-shells/flakes, and relatively simple Nix builders. All of these uses of Nix were pretty great, and it made my life easier, but it only went so far as to solve some of the challenges I come across in my projects/work.\"}],[\"$\",\"p\",null,{\"children\":[\"During my initial nix learning phase, I came across \",[\"$\",\"code\",null,{\"children\":\"node2nix\"}],\" but the codegen step made me think that node and nix just don't get along well, and I never looked further. My job primarily involves node web servers written in typescript. All I've done with Nix so far at work is set up basic dev environments with node. While it did make our README(s) a little nicer, it does not solve our issues in actually deploying our apps. Now that I got over the initial hump of adding nix to some of our processes, it's time to make it even better!\"]}],[\"$\",\"p\",null,{\"children\":[\"If you are not familiar with Nix, \",[\"$\",\"$Le\",null,{\"href\":\"/blog/rust-enviorment-and-docker-build-with-nix-flakes\",\"children\":\"this post\"}],\" goes over the basics of Nix and builds a basic Rust app.\"]}],[\"$\",\"h2\",null,{\"id\":\"the-app\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#the-app\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"The APP\"]}],[\"$\",\"p\",null,{\"children\":[\"The source code for the app is \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/JRMurr/example-ts-node-nix\",\"children\":\"here\"}]]}],[\"$\",\"p\",null,{\"children\":[\"First I need a basic app to build. I have been using \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://www.fastify.io/\",\"children\":\"Fastify\"}],\" recently, so I will attempt to build this basic web server.\"]}],[\"$\",\"div\",null,{\"className\":\"remark-code-title\",\"children\":\"index.ts\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"#!/usr/bin/env node\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"import\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" fastify \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"from\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"fastify\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" server\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" fastify\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"server.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"/ping\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"_request\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"_reply\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"  return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"pong\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"\\\\n\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"});\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"server.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"listen\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"({ host: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"0.0.0.0\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\", port: \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"8080\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" }, (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"err\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"address\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"  if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" (err) {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    console.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"error\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(err);\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    process.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"exit\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"1\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"  console.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"log\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"`Server listening at ${\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"address\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"}`\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"});\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"One important note about the \",[\"$\",\"code\",null,{\"children\":\"index.ts\"}],\" file is the node shebang at the top. This will allow this file to act as a binary/entry point for the server.\"]}],[\"$\",\"p\",null,{\"children\":[\"I also added a strict tsconfig that outputs to \",[\"$\",\"code\",null,{\"children\":\"./dist\"}],\" and a package.json that looks like\"]}],[\"$\",\"div\",null,{\"className\":\"remark-code-title\",\"children\":\"package.json\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"{\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"  \\\"name\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"example-node-nix\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"  \\\"version\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"1.0.0\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"  \\\"main\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"dist/index.js\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"  \\\"bin\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\": {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"    \\\"example-node-nix\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"dist/index.js\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"  },\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"  \\\"scripts\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\": {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"    \\\"build\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"tsc -p tsconfig.json\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"    \\\"start\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"node dist/index.js\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"  },\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"  \\\"license\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"MIT\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"  \\\"dependencies\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\": {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"    \\\"fastify\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"^4.5.3\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"  },\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"  \\\"devDependencies\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\": {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"    \\\"@tsconfig/node16\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"^1.0.1\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"    \\\"@tsconfig/node16-strictest\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"^1.0.0\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"    \\\"@types/node\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"^18.7.14\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"    \\\"typescript\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"^4.8.2\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"I made a simple \",[\"$\",\"code\",null,{\"children\":\"flake.nix\"}],\" to set up Node then ran\"]}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"$$\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" npm\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" run\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" build\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"$$\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" npm\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" run\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" start\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":\"The server is up and is responding.\"}],[\"$\",\"h2\",null,{\"id\":\"nix-builds\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#nix-builds\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Nix Builds\"]}],[\"$\",\"p\",null,{\"children\":[\"Like usual with nix I first try to see if other people have figured this out already, looking at the \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://nixos.org/manual/nixpkgs/stable/#language-javascript\",\"children\":\"nixpkgs JS docs\"}],\", it mentions a few builders like \",[\"$\",\"code\",null,{\"children\":\"mkYarnPackage\"}],\", \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/svanderburg/node2nix\",\"children\":\"node2nix\"}],\", \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/nix-community/npmlock2nix\",\"children\":\"npmlock2nix\"}],\", and \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/serokell/nix-npm-buildpackage\",\"children\":\"nix-npm-buildpackage\"}],\". These all seemed fine, but I couldn't find any good typescript examples, or the docs were a little lacking to get started. So I figured why not just do it the dumb way to start and do it manually, what's the worst that can happen?\"]}],[\"$\",\"h3\",null,{\"id\":\"the-standard-environment\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#the-standard-environment\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"The Standard Environment\"]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://nixos.org/manual/nixpkgs/stable/#sec-using-stdenv\",\"children\":\"stdenv.mkDerivation\"}],\" is what most \\\"high-level\\\" builders wrap. It provides you with a sandbox environment with some common programs like \",[\"$\",\"code\",null,{\"children\":\"coreutils\"}],\", \",[\"$\",\"code\",null,{\"children\":\"grep\"}],\", \",[\"$\",\"code\",null,{\"children\":\"awk\"}],\", \",[\"$\",\"code\",null,{\"children\":\"make\"}],\", etc., to build a program. It is very versatile and surprisingly easy to use once you get comfortable with its ideas. I was hopeful I could throw something together, so to start I just focused on the \",[\"$\",\"code\",null,{\"children\":\"buildPhase\"}],\" and a very basic \",[\"$\",\"code\",null,{\"children\":\"installPhase\"}],\" to verify everything was built, I would deal with running it later.\"]}],[\"$\",\"div\",null,{\"className\":\"remark-code-title\",\"children\":\"flake.nix\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"{\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  description\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"Sample Nix ts-node build\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  inputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    nixpkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"url\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"github:nixos/nixpkgs/nixos-unstable\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    flake-utils\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"url\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"github:numtide/flake-utils\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    gitignore\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"      url\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"github:hercules-ci/gitignore.nix\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"      inputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"nixpkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"follows\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"nixpkgs\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"  };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  outputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" { self\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" nixpkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" flake-utils\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" gitignore\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" ... \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"}:\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"    flake-utils\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"lib\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"eachDefaultSystem\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" (system:\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"      let\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" import\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" nixpkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"inherit\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" system\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"; };\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        nodejs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"nodejs-16_x\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"        # NOTE: this does not work\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        appBuild\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"stdenv\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"mkDerivation\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"example-ts-node\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          version\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"0.1.0\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          src\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" gitignore\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"lib\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"gitignoreSource\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ./.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"# uses the gitignore in the repo to only copy files git would see\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          buildInputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" [ \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"nodejs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" ];\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"          # https://nixos.org/manual/nixpkgs/stable/#sec-stdenv-phases\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          buildPhase\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ''\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            # each phase has pre/postHooks. When you make your own phase be sure to still call the hooks\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            runHook preBuild\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            npm ci\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            npm run build\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            runHook postBuild\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"          ''\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          installPhase\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ''\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            runHook preInstall\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            cp -r node_modules $out/node_modules\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            cp package.json $out/package.json\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            cp -r dist $out/dist\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            runHook postInstall\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"          ''\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"        };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"      in\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" with\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"; {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        defaultPackage\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" appBuild\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        devShell\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" mkShell\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"buildInputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" [ \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"nodejs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" ]; };\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"      });\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"I tried \",[\"$\",\"code\",null,{\"children\":\"nix build\"}],\" but I got this error\"]}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"error: builder for '/nix/store/7lis43p7zj10y2cf6inzicjdgzc3b5qs-example-ts-node.drv' failed with exit code 1;\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"       last 10 log lines:\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"       \u003e no configure script, doing nothing\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"       \u003e building\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"       \u003e npm ERR! code EAI_AGAINler: sill audit bulk request {[0m\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"       \u003e npm ERR! syscall getaddrinfo\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"       \u003e npm ERR! errno EAI_AGAIN\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"       \u003e npm ERR! request to https://registry.npmjs.org/yallist/-/yallist-4.0.0.tgz failed, reason: getaddrinfo EAI_AGAIN registry.npmjs.org\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"       \u003e\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"       \u003e npm ERR! Log files were not written due to an error writing to the directory: /homeless-shelter/.npm/_logs\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"       \u003e npm ERR! You can rerun the command with `--loglevel=verbose` to see the logs in your terminal\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"       \u003e\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"       For full logs, run 'nix log /nix/store/7lis43p7zj10y2cf6inzicjdgzc3b5qs-example-ts-node.drv'.\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{}]}]]}]}],[\"$\",\"p\",null,{\"children\":[\"The error \",[\"$\",\"code\",null,{\"children\":\"getaddrinfo EAI_AGAIN registry.npmjs.org\"}],\" is a failure to connect to the NPM registry to install the dependencies. What I failed to realize is that the nix sandbox would block outside requests in the builder since they are not fully reproducible. You can disable the nix sandbox, but that would be gross. So time to try one of these builders.\"]}],[\"$\",\"h3\",null,{\"id\":\"node2nix\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#node2nix\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"node2nix\"]}],[\"$\",\"p\",null,{\"children\":[\"Of all the builders I've seen so far \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/svanderburg/node2nix\",\"children\":\"node2nix\"}],\" seemed like the most mature. It's used in the \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/NixOS/nixpkgs/tree/master/pkgs/development/node-packages\",\"children\":\"official nixpkgs repo\"}],\". At a high level \",[\"$\",\"code\",null,{\"children\":\"node2nix\"}],\" will parse your \",[\"$\",\"code\",null,{\"children\":\"package.json\"}],\" or \",[\"$\",\"code\",null,{\"children\":\"package-lock.json\"}],\" and do code-gen to give you nix files that use \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://ryantm.github.io/nixpkgs/builders/fetchers/\",\"children\":\"fetchers\"}],\" to download all \",[\"$\",\"code\",null,{\"children\":\"node_modules\"}],\" and build your node app.\"]}],[\"$\",\"p\",null,{\"children\":[\"You can install \",[\"$\",\"code\",null,{\"children\":\"node2nix\"}],\" from \",[\"$\",\"code\",null,{\"children\":\"nixpkgs\"}],\" as \",[\"$\",\"code\",null,{\"children\":\"pkgs.node2nix\"}],\". To run it I have this script\"]}],[\"$\",\"div\",null,{\"className\":\"remark-code-title\",\"children\":\"runNode2Nix.sh\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"#!/usr/bin/env bash\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"# You need to re-run this file anytime your package/package-lock.json changes\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"node2nix\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" -16\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" --development\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" \\\\\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"    --input\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" package.json\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" \\\\\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"    --lock\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" package-lock.json\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" \\\\\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"    # Put all generated code in the `./nix` directory\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    --node-env\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ./nix/node-env.nix\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" \\\\\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"    --composition\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ./nix/default.nix\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" \\\\\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"    --output\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ./nix/node-package.nix\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"While node2nix does have helpers in \",[\"$\",\"code\",null,{\"children\":\"node-env.nix\"}],\" to build a node package, those only really run \",[\"$\",\"code\",null,{\"children\":\"npm install\"}],\", to call our \",[\"$\",\"code\",null,{\"children\":\"npm run build\"}],\" step. Thankfully as described \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/svanderburg/node2nix#using-the-nodejs-environment-in-other-nix-derivations\",\"children\":\"here\"}],\" \",[\"$\",\"code\",null,{\"children\":\"node2nix\"}],\" exposes an output of just the \",[\"$\",\"code\",null,{\"children\":\"node_modules\"}],\" of the dependencies, allowing us to make our own derivation.\"]}],[\"$\",\"div\",null,{\"className\":\"remark-code-title\",\"children\":\"flake.nix\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"{\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  description\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"Sample Nix ts-node build\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  inputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    nixpkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"url\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"github:nixos/nixpkgs/nixos-unstable\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    flake-utils\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"url\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"github:numtide/flake-utils\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    gitignore\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"      url\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"github:hercules-ci/gitignore.nix\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"      inputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"nixpkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"follows\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"nixpkgs\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"  };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  outputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" { self\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" nixpkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" flake-utils\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" gitignore\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" ... \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"}:\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"    flake-utils\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"lib\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"eachDefaultSystem\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" (system:\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"      let\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" import\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" nixpkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"inherit\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" system\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"; };\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        nodejs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"nodejs-16_x\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        node2nixOutput\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" import\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ./nix\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"inherit\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" nodejs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" system\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"; };\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"        # NOTE: may want to try https://github.com/svanderburg/node2nix/issues/301 to limit rebuilds\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        nodeDeps\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" node2nixOutput\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"nodeDependencies\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        app\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"stdenv\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"mkDerivation\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"example-ts-node\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          version\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"0.1.0\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          src\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" gitignore\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"lib\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"gitignoreSource\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ./.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          buildInputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" [ \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"nodejs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" ];\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          buildPhase\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ''\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            runHook preBuild\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            # symlink the generated node deps to the current directory for building\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            ln -sf \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"$${\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"nodeDeps\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"}\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"/lib/node_modules ./node_modules\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            export PATH=\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"$${\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"nodeDeps\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"}\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"/bin:$PATH\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            npm run build\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            runHook postBuild\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"          ''\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          installPhase\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ''\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            runHook preInstall\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            # Note: you need some sort of `mkdir` on $out for any of the following commands to work\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            mkdir -p $out/bin\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            # copy only whats needed for running the built app\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            cp package.json $out/package.json\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            cp -r dist $out/dist\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            ln -sf \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"$${\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"nodeDeps\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"}\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"/lib/node_modules $out/node_modules\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            # copy entry point, in this case our index.ts has the node shebang\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            # nix will patch the shebang to be the node version specified in buildInputs\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            # you could also copy in a script that is basically `npm run start`\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            cp dist/index.js $out/bin/example-ts-nix\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            chmod a+x $out/bin/example-ts-nix\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"            runHook postInstall\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"          ''\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"        };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"      in\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" with\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"; {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        defaultPackage\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" app\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        devShell\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" mkShell\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"buildInputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" [ \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"nodejs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" node2nix\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" ]; };\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"      });\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"After running \",[\"$\",\"code\",null,{\"children\":\"nix build\"}],\", the output will be symlinked to \",[\"$\",\"code\",null,{\"children\":\"./result\"}],\" in my case it looks like\"]}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"$$\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" exa\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" --tree\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" --level\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" 3\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ./result/\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"./result\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" bin\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" example-ts-nix\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" dist\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" index.js\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" node_modules\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" -\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" /nix/store/fdzk00z6bmw50mfqv124lgn9fzjhd7yw-node-dependencies-example-node-nix-1.0.0/lib/node_modules\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" package.json\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"To verify the app worked you can run \",[\"$\",\"code\",null,{\"children\":\"./result/bin/example-ts-nix\"}],\".\"]}],[\"$\",\"p\",null,{\"children\":[\"While at first this looks like a lot It's pretty straightforward. \",[\"$\",\"code\",null,{\"children\":\"node2nixOutput = import ./nix { inherit pkgs nodejs system; };\"}],\" calls the generated \",[\"$\",\"code\",null,{\"children\":\"default.nix\"}],\" which exposes many outputs for building. In our case we only use \",[\"$\",\"code\",null,{\"children\":\"nodeDeps = node2nixOutput.nodeDependencies;\"}],\".\"]}],[\"$\",\"p\",null,{\"children\":[\"The \",[\"$\",\"code\",null,{\"children\":\"buildPhase\"}],\" just symlinks the generated \",[\"$\",\"code\",null,{\"children\":\"nodeDependencies\"}],\" and builds the app. The \",[\"$\",\"code\",null,{\"children\":\"installPhase\"}],\" copies the built output into the final derivation. If you are familiar with docker files this is sorta like having a build layer than a final layer to copy the outputs to. One thing nix does for you is patch shebangs to reference the \",[\"$\",\"code\",null,{\"children\":\"buildInputs\"}],\" of the derivation, in this case, if you run\"]}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"$$\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" cat\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ./result/bin/example-ts-nix\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"#!/nix/store/6cdccplrjwga5rd3b2s7xb8zd25hnsix-nodejs-16.17.0/bin/node\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"\\\"use strict\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\"...\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"It changed \",[\"$\",\"code\",null,{\"children\":\"#!/usr/bin/env node\"}],\" to \",[\"$\",\"code\",null,{\"children\":\"#!/nix/store/6cdccplrjwga5rd3b2s7xb8zd25hnsix-nodejs-16.17.0/bin/node\"}],\" for us automatically.\"]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"node2nix Pros\"}]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"Simple to follow the build process\"}],[\"$\",\"li\",null,{\"children\":\"Somewhat easy to customize\"}],[\"$\",\"li\",null,{\"children\":\"Has support for custom registries/private git repos\"}]]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"node2nix Cons\"}]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"Having to re-run \",[\"$\",\"code\",null,{\"children\":\"node2nix\"}],\" on package.json changes is annoying\"]}],[\"$\",\"li\",null,{\"children\":[\"The generated outputs seem to re-build too often, see \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/svanderburg/node2nix/issues/301\",\"children\":\"here\"}]]}],[\"$\",\"li\",null,{\"children\":[\"With the current setup, the final build is still using the development \",[\"$\",\"code\",null,{\"children\":\"node_modules\"}],\" which is wasteful\"]}]]}],[\"$\",\"p\",null,{\"children\":[\"Overall I think \",[\"$\",\"code\",null,{\"children\":\"node2nix\"}],\" is a good start for most node apps. Since it's all mostly code-gen It's easy to follow what's going on. I've come across \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/MatrixAI/TypeScript-Demo-Lib-Native\",\"children\":\"this template\"}],\" which seems to have figured out to work around some cons listed, but I have not tried it yet so your mileage may vary.\"]}],[\"$\",\"h3\",null,{\"id\":\"dream2nix\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#dream2nix\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"dream2nix\"]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/nix-community/dream2nix\",\"children\":\"dream2nix\"}],\" says it's \\\"A framework for automated nix packaging\\\" by mostly standardizing the many \\\"2nix\\\" tools. The \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://nix-community.github.io/dream2nix/\",\"children\":\"docs\"}],\" list Rust, Haskell, Python, and Node builders. For whatever reason I have been skeptical of dream2nix. It looked \\\"too good to be true\\\" so I never really gave it a fair shake. Better late than never, let's try it\"]}],[\"$\",\"div\",null,{\"className\":\"remark-code-title\",\"children\":\"flake.nix\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"{\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  description\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"Sample Nix ts-node build\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  inputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    nixpkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"url\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"github:nixos/nixpkgs/nixos-unstable\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    flake-utils\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"url\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"github:numtide/flake-utils\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    gitignore\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"      url\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"github:hercules-ci/gitignore.nix\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"      inputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"nixpkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"follows\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"nixpkgs\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    dream2nix\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"url\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"github:nix-community/dream2nix\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"  };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  outputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" { self\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" nixpkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" flake-utils\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" gitignore\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" dream2nix\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" ... \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"}:\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"    # Note: no need for flake-utils.lib.eachDefaultSystem, dream2nix does it for us\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"    dream2nix\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"lib\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"makeFlakeOutputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"      systems\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" flake-utils\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"lib\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"defaultSystems\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"      config\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"projectRoot\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ./.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"      source\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" gitignore\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"lib\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"gitignoreSource\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ./.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"The core idea of dream2nix is that it will find you package.json/package-lock.json to figure out what node deps you need and how to build \",[\"$\",\"code\",null,{\"children\":\"npm run build\"}],\" or w/e else. You can customize it but for most apps, this should \\\"just work\\\".\"]}],[\"$\",\"p\",null,{\"children\":[\"Running \",[\"$\",\"code\",null,{\"children\":\"nix flake show\"}],\" returns\"]}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"git+file:///home/jr/code/node/example-node-nix\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"devShell\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"   aarch64-darwin: development environment 'nix-shell'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"   aarch64-linux: development environment 'nix-shell'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"   i686-linux: development environment 'nix-shell'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"   x86_64-darwin: development environment 'nix-shell'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"   x86_64-linux: development environment 'nix-shell'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"devShells\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"   aarch64-darwin\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"      default: development environment 'nix-shell'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"      example-node-nix: development environment 'nix-shell'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"   aarch64-linux\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"      default: development environment 'nix-shell'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"      example-node-nix: development environment 'nix-shell'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"   i686-linux\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"      default: development environment 'nix-shell'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"      example-node-nix: development environment 'nix-shell'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"   x86_64-darwin\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"      default: development environment 'nix-shell'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"      example-node-nix: development environment 'nix-shell'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"   x86_64-linux\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"       default: development environment 'nix-shell'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"       example-node-nix: development environment 'nix-shell'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"packages\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"   aarch64-darwin\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"      default: package 'example-node-nix-1.0.0'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"      example-node-nix: package 'example-node-nix-1.0.0'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"      resolveImpure: package 'resolve'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"   aarch64-linux\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"      default: package 'example-node-nix-1.0.0'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"      example-node-nix: package 'example-node-nix-1.0.0'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"      resolveImpure: package 'resolve'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"   i686-linux\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"      default: package 'example-node-nix-1.0.0'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"      example-node-nix: package 'example-node-nix-1.0.0'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"      resolveImpure: package 'resolve'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"   x86_64-darwin\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"      default: package 'example-node-nix-1.0.0'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"      example-node-nix: package 'example-node-nix-1.0.0'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"      resolveImpure: package 'resolve'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"   x86_64-linux\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"       default: package 'example-node-nix-1.0.0'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"       example-node-nix: package 'example-node-nix-1.0.0'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"       resolveImpure: package 'resolve'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"children\":\"projectsJson: unknown\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{}]}]]}]}],[\"$\",\"p\",null,{\"children\":[\"dream2nix gave us a dev shell and package build for us, neat. Expecting something to break I ran \",[\"$\",\"code\",null,{\"children\":\"nix build\"}],\" to build the app and got no errors. Looking at \",[\"$\",\"code\",null,{\"children\":\"./result\"}],\" gives\"]}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"$$\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" exa\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" --tree\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" --level\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" 3\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ./result/\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"./result\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" bin\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ts-node-nix\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" -\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ../lib/node_modules/example-node-nix/dist/index.js\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" lib\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"   \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" node_modules\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" example-node-nix\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"ts-node-nix\"}],\" is a compiled javascript file with the right shebang. Still somewhat shocked running \",[\"$\",\"code\",null,{\"children\":\"./result/bin/ts-node-nix\"}],\" ran the server, and it worked!\"]}],[\"$\",\"p\",null,{\"children\":[\"This is simply wild, I really expected something to break here and require a manual build step of some kind. One nice thing to note is the \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://nix-community.github.io/dream2nix/guides/getting-started-nodejs.html#development-shell\",\"children\":\"node dev shell\"}],\" it gives will copy over the \",[\"$\",\"code\",null,{\"children\":\"node_modules\"}],\" folder for you so you don't need to manually run \",[\"$\",\"code\",null,{\"children\":\"npm install\"}],\".\"]}],[\"$\",\"p\",null,{\"children\":[\"To limit my excitement a bit this is a simple build. I need to investigate how well it works with more complicated builds with native node add-ons, mono repo tools like NX, etc. Though the examples in the \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/nix-community/dream2nix#test-the-experimental-version-of-dream2nix\",\"children\":\"README\"}],\" seem promising to allow for easily overriding the builds.\"]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"dream2nix Pros\"}]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"very little code to set up\"}],[\"$\",\"li\",null,{\"children\":\"generated dev shell is really nice\"}]]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"dream2nix Cons\"}]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"A bit of a \\\"black box\\\" which could make debugging harder\"}],[\"$\",\"li\",null,{\"children\":\"It seems to include the full development dependencies in the output\"}]]}],[\"$\",\"h2\",null,{\"id\":\"conclusion\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#conclusion\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Conclusion\"]}],[\"$\",\"p\",null,{\"children\":[\"I came into this thinking building ts node apps with nix would be a pain, and I'm happily surprised it is not. While \",[\"$\",\"code\",null,{\"children\":\"node2nix\"}],\" may be good for highly customizable builds, \",[\"$\",\"code\",null,{\"children\":\"dream2nix\"}],\" is just a delight. I haven't come across a nix utility that just worked like that with minimal messing around.\"]}],[\"$\",\"p\",null,{\"children\":[\"I've been meaning to give \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://napi.rs/\",\"children\":\"napi-rs\"}],\" a shot, so maybe that will be a good test case to see how well \",[\"$\",\"code\",null,{\"children\":\"dream2nix\"}],\" builds rust projects and native node add-ons all in one.\"]}],[\"$\",\"p\",null,{\"children\":[\"Since you made it to the end here's a \",[\"$\",\"code\",null,{\"children\":\"dream2nix\"}],\" example with a docker build\"]}],[\"$\",\"div\",null,{\"className\":\"remark-code-title\",\"children\":\"flake.nix\"}],[\"$\",\"$L18\",null,{\"className\":\"shiki shiki-themes github-light github-dark\",\"style\":{\"backgroundColor\":\"#fff\",\"--shiki-dark-bg\":\"#24292e\",\"color\":\"#24292e\",\"--shiki-dark\":\"#e1e4e8\"},\"tabIndex\":\"0\",\"children\":[\"$\",\"code\",null,{\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"{\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  description\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"Sample Nix ts-node build\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  inputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    nixpkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"url\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"github:nixos/nixpkgs/nixos-unstable\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    flake-utils\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"url\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"github:numtide/flake-utils\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    gitignore\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"      url\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"github:hercules-ci/gitignore.nix\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"      inputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"nixpkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"follows\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"nixpkgs\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"    };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"    dream2nix\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"url\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"github:nix-community/dream2nix\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"  };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"  outputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" { self\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" nixpkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" flake-utils\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" gitignore\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" dream2nix\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" ... \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"}:\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"    let\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"      dream2nixOutputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" dream2nix\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"lib\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"makeFlakeOutputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        systems\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" flake-utils\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"lib\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"defaultSystems\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        config\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"projectRoot\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ./.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"        source\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" gitignore\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"lib\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"gitignoreSource\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" ./.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"      };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"      customOutput\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" flake-utils\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"lib\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"eachDefaultSystem\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" (system:\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"        let\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" import\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" nixpkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"inherit\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\" system\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"; };\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"          # the dream2nix output for this system\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          app\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" dream2nixOutputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"packages\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"$${\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"system\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\",\"fontStyle\":\"italic\",\"--shiki-dark-font-style\":\"italic\"},\"children\":\"}\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"example-node-nix\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"        in\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" with\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"; {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"          packages\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"docker\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" dockerTools\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"buildImage\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"            name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" app\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"packageName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"            copyToRoot\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" pkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"buildEnv\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"              name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" app\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"packageName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"              paths\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" [ \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"app\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" ];\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"              pathsToLink\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" [ \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"/bin\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\" \\\"/lib\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" ];\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"            };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"            # This ensures symlinks to directories are preserved in the image\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"            keepContentsDirlinks\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005cc5\",\"--shiki-dark\":\"#79B8FF\"},\"children\":\" true\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"            config\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6f42c1\",\"--shiki-dark\":\"#B392F0\"},\"children\":\"Cmd\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" [ \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032f62\",\"--shiki-dark\":\"#9ECBFF\"},\"children\":\"\\\"/bin/ts-node-nix\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\" ]; };\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"          };\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"        });\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6a737d\",\"--shiki-dark\":\"#6A737D\"},\"children\":\"      # deep merge outputs together\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\"    in\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" nixpkgs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"lib\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#d73a49\",\"--shiki-dark\":\"#F97583\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\"recursiveUpdate\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" dream2nixOutputs\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#e36209\",\"--shiki-dark\":\"#FFAB70\"},\"children\":\" customOutput\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292e\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}]]}]}],[\"$\",\"p\",null,{\"children\":[\"You can then run \",[\"$\",\"code\",null,{\"children\":\"nix build .#docker\"}],\" and then run \",[\"$\",\"code\",null,{\"children\":\"docker load \u003c result\"}],\" to load the image into docker. See \",[\"$\",\"$Le\",null,{\"href\":\"/blog/rust-enviorment-and-docker-build-with-nix-flakes\",\"children\":\"here\"}],\" for some more info on nix docker builds.\"]}]]]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"div\",null,{\"className\":\"pb-6 pt-6 text-sm text-gray-700 dark:text-gray-300\",\"children\":[[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"nofollow\",\"href\":\"https://mobile.twitter.com/search?q=https%3A%2F%2Fjohns.codes%2Fblog%2Fbuilding-typescript-node-apps-with-nix\",\"children\":\"Discuss on Twitter\"}],\"  \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/JRMurr/JRMurr.github.io/blob/main/content/blog/building-typescript-node-apps-with-nix.md\",\"children\":\"View on GitHub\"}]]}],[\"$\",\"div\",null,{\"className\":\"pb-6 pt-6 text-center text-gray-700 dark:text-gray-300\",\"id\":\"comment\",\"children\":[\"$\",\"$L19\",null,{}]}],\"$undefined\"]}]]}],[\"$\",\"footer\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col text-sm font-medium sm:flex-row sm:justify-between sm:text-base\",\"children\":[[\"$\",\"div\",null,{\"className\":\"pt-4 xl:pt-8\",\"children\":[\"$\",\"$Le\",null,{\"href\":\"/blog/updating-a-package-in-nixpkgs\",\"className\":\"text-primary-500 hover:text-primary-600 dark:hover:text-primary-400\",\"aria-label\":\"Previous post: Making a PR to Nixpkgs\",\"children\":[\" \",\"Making a PR to Nixpkgs\"]}]}],[\"$\",\"div\",null,{\"className\":\"pt-4 xl:pt-8\",\"children\":[\"$\",\"$Le\",null,{\"href\":\"/blog/build-a-db/part01\",\"className\":\"text-primary-500 hover:text-primary-600 dark:hover:text-primary-400\",\"aria-label\":\"Next post: Building a Simple DB in Rust - Part 1 - Parsing\",\"children\":[\"Building a Simple DB in Rust - Part 1 - Parsing\",\" \"]}]}]]}]}]]}]]}]}]]}]]\n"])</script><script>self.__next_f.push([1,"13:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Building Typescript Node Apps With Nix | John's Codes\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Trying some different nix builders for typescript node apps\"}],[\"$\",\"meta\",\"4\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"5\",{\"name\":\"googlebot\",\"content\":\"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1\"}],[\"$\",\"link\",\"6\",{\"rel\":\"canonical\",\"href\":\"https://johns.codes/blog/building-typescript-node-apps-with-nix\"}],[\"$\",\"link\",\"7\",{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"https://johns.codes/feed.xml\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:title\",\"content\":\"Building Typescript Node Apps With Nix\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:description\",\"content\":\"Trying some different nix builders for typescript node apps\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:url\",\"content\":\"https://johns.codes/blog/building-typescript-node-apps-with-nix\"}],[\"$\",\"meta\",\"11\",{\"property\":\"og:site_name\",\"content\":\"John's Codes\"}],[\"$\",\"meta\",\"12\",{\"property\":\"og:locale\",\"content\":\"en_US\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"14\",{\"property\":\"article:published_time\",\"content\":\"2022-09-06T23:57:55.477Z\"}],[\"$\",\"meta\",\"15\",{\"property\":\"article:modified_time\",\"content\":\"2022-09-06T23:57:55.477Z\"}],[\"$\",\"meta\",\"16\",{\"property\":\"article:author\",\"content\":\"John Murray\"}],[\"$\",\"meta\",\"17\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"18\",{\"name\":\"twitter:title\",\"content\":\"Building Typescript Node Apps With Nix\"}],[\"$\",\"meta\",\"19\",{\"name\":\"twitter:description\",\"content\":\"Trying some different nix builders for typescript node apps\"}],[\"$\",\"meta\",\"20\",{\"name\":\"next-size-adjust\"}]]\n"])</script><script>self.__next_f.push([1,"6:null\n"])</script><script>self.__next_f.push([1,""])</script></body></html>